<!doctype html><html class=no-js lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>如何用CentOS上的SARG日志分析器来分析Squid日志 - Linux.cn Archive</title>
<script>(function(e,t){e[t]=e[t].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content><meta property="og:title" content="如何用CentOS上的SARG日志分析器来分析Squid日志"><meta property="og:description" content="上一节教程中，我们展示了如何在CentOS上使用Squid配置透明代理。Squid提供了很多有用的特性，但是分析一个原始Squid日志文件并不直接。比如，你如何分析下面Squid日志中的时间戳和数字？SARG（或者说是Squid分析报告生成器）是一款基于web的工具，用于从Squid日志中生成报告。SARG提供了一个由Squid处理的网络流量视图，易于理解，并且它可以很容易地设置和维护。在下面的教程中，我们会展示如何在CentOS平台上设置SARG。"><meta property="og:type" content="article"><meta property="og:url" content="/article-3616-1.html"><meta property="article:section" content="posts"><meta property="article:published_time" content="2014-08-14T16:23:59+00:00"><meta property="article:modified_time" content="2014-08-14T16:23:59+00:00"><meta itemprop=name content="如何用CentOS上的SARG日志分析器来分析Squid日志"><meta itemprop=description content="上一节教程中，我们展示了如何在CentOS上使用Squid配置透明代理。Squid提供了很多有用的特性，但是分析一个原始Squid日志文件并不直接。比如，你如何分析下面Squid日志中的时间戳和数字？SARG（或者说是Squid分析报告生成器）是一款基于web的工具，用于从Squid日志中生成报告。SARG提供了一个由Squid处理的网络流量视图，易于理解，并且它可以很容易地设置和维护。在下面的教程中，我们会展示如何在CentOS平台上设置SARG。"><meta itemprop=datePublished content="2014-08-14T16:23:59+00:00"><meta itemprop=dateModified content="2014-08-14T16:23:59+00:00"><meta itemprop=wordCount content="235"><meta itemprop=keywords content="CentOS,Squid,"><link rel=preconnect href=https://fonts.bunny.net crossorigin><link rel=dns-prefetch href=//fonts.bunny.net><link rel=dns-prefetch href=//fonts.bunny.net><link rel=stylesheet href="https://fonts.bunny.net/css?family=Open+Sans:400,400i,700"><link rel=stylesheet href=/css/style.css><link rel="shortcut icon" href=/favicon.ico></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class=logo><a class=logo__link href=/ title="Linux.cn Archive" rel=home><div class="logo__item logo__text"><div class=logo__title>Linux.cn Archive</div></div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>Menu</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/><span class=menu__text>Home</span></a></li><li class=menu__item><a class=menu__link href=/categories/><span class=menu__text>Categories</span></a></li><li class=menu__item><a class=menu__link href=/tags/><span class=menu__text>Tags</span></a></li><li class=menu__item><a class=menu__link href><span class=menu__text>RSS</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>如何用CentOS上的SARG日志分析器来分析Squid日志</h1><div class="post__meta meta"><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class=meta__text datetime=2014-08-14T16:23:59Z>August 14, 2014</time></div></div></header><div class="content post__content clearfix"><p><img src=/data/attachment/album/201408/14/162237f7og5j6ch5m7lcco.png alt></p><p><a href=http://xmodulo.com/2014/06/squid-transparent-web-proxy-centos-rhel.html>上一节教程</a>中，我们展示了如何在CentOS上使用Squid配置透明代理。Squid提供了很多有用的特性，但是分析一个原始Squid日志文件并不直接。比如，你如何分析下面Squid日志中的时间戳和数字？</p><pre tabindex=0><code>1404788984.429   1162 172.17.1.23 TCP_MISS/302 436 GET http://facebook.com/ - DIRECT/173.252.110.27 text/html
1404788985.046  12416 172.17.1.23 TCP_MISS/200 4169 CONNECT stats.pusher.com:443 - DIRECT/173.255.223.127 -
1404788986.124    174 172.17.1.23 TCP_MISS/200 955 POST http://ocsp.digicert.com/ - DIRECT/117.18.237.29 application/ocsp-response
1404788989.738    342 172.17.1.23 TCP_MISS/200 3890 CONNECT www.google.com:443 - DIRECT/74.125.200.106 -
1404788989.757    226 172.17.1.23 TCP_MISS/200 942 POST http://clients1.google.com/ocsp - DIRECT/74.125.200.113 application/ocsp-response
1404788990.839   3939 172.17.1.23 TCP_MISS/200 78944 CONNECT fbstatic-a.akamaihd.net:443 - DIRECT/184.26.162.35 -
1404788990.846   2148 172.17.1.23 TCP_MISS/200 118947 CONNECT fbstatic-a.akamaihd.net:443 - DIRECT/184.26.162.35 -
1404788990.849   2151 172.17.1.23 TCP_MISS/200 76809 CONNECT fbstatic-a.akamaihd.net:443 - DIRECT/184.26.162.35 -
1404788991.140    611 172.17.1.23 TCP_MISS/200 110073 CONNECT fbstatic-a.akamaihd.net:443 - DIRECT/184.26.162.35 –
</code></pre><p>我们使用yum来安装安装必要的依赖。</p><pre tabindex=0><code># yum install gcc make wget httpd crond 
</code></pre><p>在启动时加载必要的服务</p><pre tabindex=0><code># service httpd start; service crond start
# chkconfig httpd on; chkconfig crond on 
</code></pre><p>现在我们下载并解压SARG</p><pre tabindex=0><code># wget http://downloads.sourceforge.net/project/sarg/sarg/sarg-2.3.8/sarg-2.3.8.tar.gz?
# tar zxvf sarg-2.3.8.tar.gz
# cd sarg-2.3.8 
</code></pre><p><strong>注意</strong>: 对于64位的Linux，log.c的源代码需要用下面的文件打补丁。</p><pre tabindex=0><code>1506c1506
&lt;            if (fprintf(ufile-&gt;file, &#34;%s\t%s\t%s\t%s\t%&#34;PRIi64&#34;\t%s\t%ld\t%s\n&#34;,dia,hora,ip,url,nbytes,code,elap_time,smartfilter)&lt;=0) {
---
&gt;            if (fprintf(ufile-&gt;file, &#34;%s\t%s\t%s\t%s\t%&#34;PRIi64&#34;\t%s\t%ld\t%s\n&#34;,dia,hora,ip,url,(int64_t)nbytes,code,elap_time,smartfilter)&lt;=0) {
1513c1513
&lt;                fprintf(fp_log, &#34;%s\t%s\t%s\t%s\t%s\t%&#34;PRIi64&#34;\t%s\t%ld\t%s\n&#34;,dia,hora,user,ip,url,nbytes,code,elap_time,smartfilter);
---
&gt;                fprintf(fp_log, &#34;%s\t%s\t%s\t%s\t%s\t%&#34;PRIi64&#34;\t%s\t%ld\t%s\n&#34;,dia,hora,user,ip,url,(int64_t)nbytes,code,elap_time,smartfilter);
1564c1564
&lt;                printf(&#34;LEN=\t%&#34;PRIi64&#34;\n&#34;,nbytes);
---
&gt;                printf(&#34;LEN=\t%&#34;PRIi64&#34;\n&#34;,(int64_t)nbytes);
</code></pre><p>如下继续并编译/安装SARG</p><pre tabindex=0><code># ./configure
# make
# make install 
</code></pre><p>SARG安装之后，配置文件可以按你的要求修改。下面是一个SARG配置的例子。</p><pre tabindex=0><code># vim /usr/local/etc/sarg.conf 
</code></pre><hr><pre tabindex=0><code>access_log /var/log/squid/access.log
temporary_dir /tmp
output_dir /var/www/html/squid-reports
date_format e     ## We use Europian DD-MM-YYYY format here ##
## we don’t want multiple reports for single day/week/month ##
overwrite_report yes
</code></pre><p>现在是时候测试运行了，我们用调试模式运行sarg来查看是否存在错误。</p><pre tabindex=0><code># sarg -x
</code></pre><p>如果i一切正常，sarg会根系Squid日志，并在/var/www/html/squid-reports下创建报告。报告也可以在浏览器中通过地址http://&lt;服务器IP>/squid-reports/访问。</p><p><a href=https://camo.githubusercontent.com/5f3e90eaa7c9f09de466633855fa7e6ea3e0c03c/68747470733a2f2f6661726d332e737461746963666c69636b722e636f6d2f323933312f31343633313430333933355f346666333465303762395f7a2e6a7067><img src=https://camo.githubusercontent.com/5f3e90eaa7c9f09de466633855fa7e6ea3e0c03c/68747470733a2f2f6661726d332e737461746963666c69636b722e636f6d2f323933312f31343633313430333933355f346666333465303762395f7a2e6a7067 alt></a></p><p><a href=https://camo.githubusercontent.com/73b63de6bf943e4082f4ac9372cee93a5ceb8090/68747470733a2f2f6661726d342e737461746963666c69636b722e636f6d2f333930312f31343632393238313634345f666563333130313463355f7a2e6a7067><img src=https://camo.githubusercontent.com/73b63de6bf943e4082f4ac9372cee93a5ceb8090/68747470733a2f2f6661726d342e737461746963666c69636b722e636f6d2f333930312f31343632393238313634345f666563333130313463355f7a2e6a7067 alt></a></p><p>、SARG可以用于创建日、周、月度报告。时间范围用“-d”参数来指定，值的形式很可能为day-n、 week-n 或者 month-n，n的值为向前推移的天/周/月的数量。比如，使用week-1,SARG会生成之前一星期的报告。使用day-2,SARG会生成之前两天的报告。</p><p>作为演示，我们会准备一个计划任务来每天运行SARG。</p><pre tabindex=0><code># vim /etc/cron.daily/sarg 
</code></pre><hr><pre tabindex=0><code>#!/bin/sh
/usr/local/bin/sarg -d day-1
</code></pre><p>文件需要可执行权限。</p><pre tabindex=0><code># chmod 755 /usr/local/bin/sarg 
</code></pre><p>现在SARG应该会每天准备关于Squid管理的流量报告。这些报告可以很容易地通过SARG网络接口访问。</p><p>总结一下，SARG一款基于网络的工具，它可以分析Squid日志，并以更详细的方式展示分析。系统管理员可以利用SARG来监视哪些网站被访问了，并跟踪访问量最大的网站和用户。本教程包含了SARG配置工作。你可以进一步自定义配置来满足自己的要求。</p><p>希望这篇教程对您有帮助。</p><hr><p><a href=http://amar-linux.blogspot.com/>Sarmed Rahman</a></p><ul><li><a href=http://twitter.com/SarmedRahman>Twitter 地址</a></li><li><a href=http://www.linkedin.com/in/sarmedrahman>LinkedIn 地址</a></li></ul><p>Sarmed Rahman是一名孟加拉国的IT专业人士。他坚持时不时地写作技术文章，并坚信技术可以通过分享而提高。在空闲时间里，他喜欢打游戏，喜欢和朋友一起度过。</p><hr><p>via: <a href=http://xmodulo.com/2014/07/analyze-squid-logs-sarg-log-analyzer-centos.html>http://xmodulo.com/2014/07/analyze-squid-logs-sarg-log-analyzer-centos.html</a></p><p>译者：<a href=https://github.com/geekpi>geekpi</a> 校对：<a href=https://github.com/carolinewuyan>Caroline</a></p><p>本文由 <a href=https://github.com/LCTT/TranslateProject>LCTT</a> 原创翻译，<a href=http://linux.cn/>Linux中国</a> 荣誉推出</p></div><footer class=post__footer><div class="post__tags tags clearfix"><svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5.0 11V3C0 1.5.8.8.8.8S1.5.0 3 0h8c1.5.0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 100-6 3 3 0 000 6z"/></svg><ul class=tags__list><li class=tags__item><a class="tags__link btn" href=/tags/centos/ rel=tag>CentOS</a></li><li class=tags__item><a class="tags__link btn" href=/tags/squid/ rel=tag>Squid</a></li></ul></div></footer></article></main></div></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2025 Linux.cn Archive.
<span class=footer__copyright-credits>Generated with <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> and <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a> theme.</span></div></div></footer></div><script async defer src=/js/menu.js></script></body></html>