<!doctype html><html class=no-js lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>在 Kubernetes 集群中运行 WordPress - Linux.cn Archive</title>
<script>(function(e,t){e[t]=e[t].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content><meta property="og:title" content="在 Kubernetes 集群中运行 WordPress"><meta property="og:description" content="在这篇文章中，我们将会从一些简单的操作开始，了解一下 Kubernetes 平台，看看如何将一个 WordPress 网站部署在本地机器上的一个单节点集群中。"><meta property="og:type" content="article"><meta property="og:url" content="/article-8881-1.html"><meta property="article:section" content="posts"><meta property="article:published_time" content="2017-09-19T09:24:31+00:00"><meta property="article:modified_time" content="2017-09-19T09:24:31+00:00"><meta itemprop=name content="在 Kubernetes 集群中运行 WordPress"><meta itemprop=description content="在这篇文章中，我们将会从一些简单的操作开始，了解一下 Kubernetes 平台，看看如何将一个 WordPress 网站部署在本地机器上的一个单节点集群中。"><meta itemprop=datePublished content="2017-09-19T09:24:31+00:00"><meta itemprop=dateModified content="2017-09-19T09:24:31+00:00"><meta itemprop=wordCount content="293"><meta itemprop=keywords content="Kubernetes,WordPress,容器,"><link rel=preconnect href=https://fonts.bunny.net crossorigin><link rel=dns-prefetch href=//fonts.bunny.net><link rel=dns-prefetch href=//fonts.bunny.net><link rel=stylesheet href="https://fonts.bunny.net/css?family=Open+Sans:400,400i,700"><link rel=stylesheet href=/css/style.css><link rel="shortcut icon" href=/favicon.ico></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class=logo><a class=logo__link href=/ title="Linux.cn Archive" rel=home><div class="logo__item logo__text"><div class=logo__title>Linux.cn Archive</div></div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>Menu</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/><span class=menu__text>Home</span></a></li><li class=menu__item><a class=menu__link href=/categories/><span class=menu__text>Categories</span></a></li><li class=menu__item><a class=menu__link href=/tags/><span class=menu__text>Tags</span></a></li><li class=menu__item><a class=menu__link href><span class=menu__text>RSS</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>在 Kubernetes 集群中运行 WordPress</h1><div class="post__meta meta"><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class=meta__text datetime=2017-09-19T09:24:31Z>September 19, 2017</time></div></div></header><div class="content post__content clearfix"><p><img src=/data/attachment/album/201709/19/092435z39irasw73b99rqb.jpg alt></p><p>作为一名开发者，我会尝试留意那些我可能不会每天使用的技术的进步。了解这些技术至关重要，因为它们可能会间接影响到我的工作。比如<a href=http://www.zdnet.com/article/what-is-docker-and-why-is-it-so-darn-popular/>由 Docker 推动</a>的、近期正在兴起的容器化技术，可用于上规模地托管 Web 应用。从技术层面来讲，我并不是一个 DevOps，但当我每天构建 Web 应用时，多去留意这些技术如何去发展，会对我有所裨益。</p><p>这种进步的一个绝佳的例子，是近一段时间高速发展的容器编排平台。它允许你轻松地部署、管理容器化应用，并对它们的规模进行调整。目前看来，容器编排的流行工具有 <a href=https://kubernetes.io/>Kubernetes （来自 Google）</a>，<a href=https://docs.docker.com/engine/swarm/>Docker Swarm</a> 和 <a href=http://mesos.apache.org/>Apache Mesos</a>。如果你想较好的了解上面那些技术以及它们的区别，我推荐你看一下<a href=https://mesosphere.com/blog/docker-vs-kubernetes-vs-apache-mesos/>这篇文章</a>。</p><p>在这篇文章中，我们将会从一些简单的操作开始，了解一下 Kubernetes 平台，看看如何将一个 WordPress 网站部署在本地机器上的一个单节点集群中。</p><h3 id=安装-kubernetes>安装 Kubernetes</h3><p>在 <a href=https://kubernetes.io/docs/tutorials/kubernetes-basics/>Kubernetes 文档</a>中有一个很好的互动教程，涵盖了很多东西。但出于本文的目的，我只会介绍在 MacOS 中 Kuberentes 的安装和使用。</p><p>我们要做的第一件事是在你的本地主机中安装 Kubernetes。我们将使用一个叫做 <a href=https://kubernetes.io/docs/getting-started-guides/minikube/>MiniKube</a> 的工具，它专门用于在你的机器上方便地设置一个用于测试的 Kubernetes 集群。</p><p>根据 Minikube 文档，在我们开始之前，有一些先决条件。首先要保证你已经安装了一个 Hypervisor （我将会使用 Virtualbox）。接下来，我们需要<a href=https://kubernetes.io/docs/tasks/tools/install-kubectl/>安装 Kubernetes 命令行工具</a>（也就是 <code>kubectl</code>）。如果你在用 Homebrew，这一步非常简单，只需要运行命令：</p><pre tabindex=0><code>$ brew install kubectl
</code></pre><p>现在我们可以真正 <a href=https://github.com/kubernetes/minikube/releases>安装 Minikube</a> 了：</p><pre tabindex=0><code>$ curl -Lo minikube https://storage.googleapis.com/minikube/releases/v0.21.0/minikube-darwin-amd64 &amp;&amp; chmod +x minikube &amp;&amp; sudo mv minikube /usr/local/bin/
</code></pre><p>最后，我们要<a href=https://kubernetes.io/docs/getting-started-guides/minikube/#quickstart>启动 Minicube</a> 创建一个虚拟机，来作为我们的单节点 Kubernetes 集群。现在我要说一点：尽管我们在本文中只在本地运行它，但是在<a href=https://kubernetes.io/docs/tutorials/kubernetes-basics/>真正的服务器</a>上运行 Kubernetes 集群时，后面提到的大多数概念都会适用。在多节点集群上，“主节点”将负责管理其它工作节点（虚拟机或物理服务器），并且 Kubernetes 将会在集群中自动进行容器的分发和调度。</p><pre tabindex=0><code>$ minikube start --vm-driver=virtualbox
</code></pre><h3 id=安装-helm>安装 Helm</h3><p>现在，本机中应该有一个正在运行的（单节点）Kubernetes 集群了。我们现在可以用任何方式来与 Kubernetes 交互。如果你想现在可以体验一下，我觉得 <a href=http://kubernetesbyexample.com/>kubernetesbyexample.com</a> 可以很好地向你介绍 Kubernetes 的概念和术语。</p><p>虽然我们可以手动配置这些东西，但实际上我们将会使用另外的工具，来将我们的 WordPress 应用部署到 Kubernetes 集群中。<a href=https://docs.helm.sh/>Helm</a> 被称为“Kubernetes 的包管理工具”，它可以让你轻松地在你的集群中部署预构建的软件包，也就是“ 图表 chart ”。你可以把图表看做一组专为特定应用（如 WordPress）而设计的容器定义和配置。首先我们在本地主机上安装 Helm：</p><pre tabindex=0><code>$ brew install kubernetes-helm
</code></pre><p>然后我们需要在集群中安装 Helm。 幸运的是，只需要运行下面的命令就好：</p><pre tabindex=0><code>$ helm init
</code></pre><h3 id=安装-wordpress>安装 WordPress</h3><p>现在 Helm 已经在我们的集群中运行了，我们可以安装 <a href=https://kubeapps.com/charts/stable/wordpress>WordPress 图表</a>。运行：</p><pre tabindex=0><code>$ helm install --namespace wordpress --name wordpress --set serviceType=NodePort stable/wordpress  
</code></pre><p>这条命令将会在容器中安装并运行 WordPress，并在容器中运行 MariaDB 作为数据库。它在 Kubernetes 中被称为“Pod”。一个 <a href=https://kubernetes.io/docs/tutorials/kubernetes-basics/explore-intro/>Pod</a> 基本上可视为一个或多个应用程序容器和这些容器的一些共享资源（例如存储卷，网络等）的组合的抽象。</p><p>我们需要给这个部署一个名字和一个命名空间，以将它们组织起来并便于查找。我们同样会将 <code>serviceType</code> 设置为 <code>NodePort</code> 。这一步非常重要，因为在默认设置中，服务类型会被设置为 <code>LoadBalancer</code>。由于我们的集群现在没有负载均衡器，所以我们将无法在集群外访问我们的 WordPress 站点。</p><p>在输出数据的最后一部分，你会注意到一些关于访问你的 WordPress 站点的有用的命令。运行那些命令，你可以获取到我们的 WordPress 站点的外部 IP 地址和端口：</p><pre tabindex=0><code>$ export NODE_PORT=$(kubectl get --namespace wordpress -o jsonpath=&#34;{.spec.ports[0].nodePort}&#34; services wordpress-wordpress)
$ export NODE_IP=$(kubectl get nodes --namespace wordpress -o jsonpath=&#34;{.items[0].status.addresses[0].address}&#34;)
$ echo http://$NODE_IP:$NODE_PORT/admin
</code></pre><p>你现在访问刚刚生成的 URL（忽略 <code>/admin</code> 部分），就可以看到 WordPress 已经在你的 Kubernetes 集群中运行了！</p><h3 id=扩展-wordpress>扩展 WordPress</h3><p>Kubernetes 等服务编排平台的一个伟大之处，在于它将应用的扩展和管理变得易如反掌。我们看一下应用的部署状态：</p><pre tabindex=0><code>$ kubectl get deployments --namespace=wordpress
</code></pre><p><a href=https://cdn.deliciousbrains.com/content/uploads/2017/08/07120711/image4.png><img src=/data/attachment/album/201709/19/092437fu4o5jx5u7oj0f0f.png alt="kubectl get deployments"></a></p><p>可以看到，我们有两个部署，一个是 Mariadb 数据库，一个是 WordPress 本身。现在，我们假设你的 WordPress 开始承载大量的流量，所以我们想将这些负载分摊在多个实例上。我们可以通过一个简单的命令来扩展 <code>wordpress-wordpress</code> 部署：</p><pre tabindex=0><code>$ kubectl scale --replicas 2 deployments wordpress-wordpress --namespace=wordpress
</code></pre><p>再次运行 <code>kubectl get deployments</code>，我们现在应该会看到下面的场景：</p><p><a href=https://cdn.deliciousbrains.com/content/uploads/2017/08/07120710/image2.png><img src=/data/attachment/album/201709/19/092438t1cz2uppzo3uc51b.png alt="kubectl get deployments"></a></p><p>你刚刚扩大了你的 WordPress 站点规模！超级简单，对不对？现在我们有了多个 WordPress 容器，可以在它们之中对流量进行负载均衡。想了解 Kubernetes 扩展的更多信息，参见<a href=https://kubernetes.io/docs/tutorials/kubernetes-basics/scale-intro/>这篇指南</a>。</p><h3 id=高可用>高可用</h3><p>Kubernetes 等平台的的另一大特色在于，它不单单能进行方便的扩展，还可以通过自愈组件来提供高可用性。假设我们的一个 WordPress 部署因为某些原因失效了，那 Kubernetes 会立刻自动替换掉这个部署。我们可以通过删除我们 WordPress 部署的一个 pod 来模拟这个过程。</p><p>首先运行命令，获取 pod 列表：</p><pre tabindex=0><code>$ kubectl get pods --namespace=wordpress
</code></pre><p><a href=https://cdn.deliciousbrains.com/content/uploads/2017/08/07120711/image3.png><img src=/data/attachment/album/201709/19/092440iosh45bz5swv33wb.png alt="kubectl get pods"></a></p><p>然后删除其中一个 pod：</p><pre tabindex=0><code>$ kubectl delete pod wordpress-wordpress-876183909-jqc8s --namespace=wordpress
</code></pre><p>如果你再次运行 <code>kubectl get pods</code> 命令，应该会看到 Kubernetes 立刻换上了新的 pod （<code>3l167</code>）。</p><p><a href=https://cdn.deliciousbrains.com/content/uploads/2017/08/07120709/image1.png><img src=/data/attachment/album/201709/19/092442eg1ncufxyfuxcckk.png alt="kubectl get pods"></a></p><h3 id=更进一步>更进一步</h3><p>我们只是简单了解了 Kubernetes 能完成工作的表面。如果你想深入研究，我建议你查看以下功能：</p><ul><li><a href=https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale/>平行扩展</a></li><li><a href=https://kubernetes.io/docs/concepts/workloads/controllers/replicationcontroller/#what-is-a-replicationcontroller>自愈</a></li><li><a href=https://kubernetes.io/docs/concepts/workloads/controllers/deployment/#what-is-a-deployment>自动更新及回滚</a></li><li><a href=https://kubernetes.io/docs/concepts/configuration/secret/>密钥管理</a></li></ul><p>你在容器平台上运行过 WordPress 吗？有没有使用过 Kubernetes（或其它容器编排平台），有没有什么好的技巧？你通常会怎么扩展你的 WordPress 站点？请在评论中告诉我们。</p><hr><p>作者简介：</p><p>Gilbert 喜欢构建软件。从 jQuery 脚本到 WordPress 插件，再到完整的 SaaS 应用程序，Gilbert 一直在创造优雅的软件。 他粗昂做的最有名的的产品，应该是 Nivo Slider.</p><hr><p>via: <a href=https://deliciousbrains.com/running-wordpress-kubernetes-cluster/>https://deliciousbrains.com/running-wordpress-kubernetes-cluster/</a></p><p>作者：<a href=https://deliciousbrains.com/author/gilbert-pellegrom/>Gilbert Pellegrom</a> 译者：<a href=https://github.com/StdioA>StdioA</a> 校对：<a href=https://github.com/wxy>wxy</a></p><p>本文由 <a href=https://github.com/LCTT/TranslateProject>LCTT</a> 原创编译，<a href=https://linux.cn/>Linux中国</a> 荣誉推出</p></div><footer class=post__footer><div class="post__tags tags clearfix"><svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5.0 11V3C0 1.5.8.8.8.8S1.5.0 3 0h8c1.5.0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 100-6 3 3 0 000 6z"/></svg><ul class=tags__list><li class=tags__item><a class="tags__link btn" href=/tags/kubernetes/ rel=tag>Kubernetes</a></li><li class=tags__item><a class="tags__link btn" href=/tags/wordpress/ rel=tag>WordPress</a></li><li class=tags__item><a class="tags__link btn" href=/tags/%E5%AE%B9%E5%99%A8/ rel=tag>容器</a></li></ul></div></footer></article></main></div></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2025 Linux.cn Archive.
<span class=footer__copyright-credits>Generated with <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> and <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a> theme.</span></div></div></footer></div><script async defer src=/js/menu.js></script></body></html>