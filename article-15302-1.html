<!doctype html><html class=no-js lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>如何用 Kubeadm 在 Debian 11 上安装 Kubernetes 集群 - Linux.cn Archive</title>
<script>(function(e,t){e[t]=e[t].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content><meta property="og:title" content="如何用 Kubeadm 在 Debian 11 上安装 Kubernetes 集群"><meta property="og:description" content="你是否在寻找一份在 Debian 11（Bullseye）上安装 Kubernetes 集群的简易指南？"><meta property="og:type" content="article"><meta property="og:url" content="/article-15302-1.html"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-11-30T09:19:30+00:00"><meta property="article:modified_time" content="2022-11-30T09:19:30+00:00"><meta itemprop=name content="如何用 Kubeadm 在 Debian 11 上安装 Kubernetes 集群"><meta itemprop=description content="你是否在寻找一份在 Debian 11（Bullseye）上安装 Kubernetes 集群的简易指南？"><meta itemprop=datePublished content="2022-11-30T09:19:30+00:00"><meta itemprop=dateModified content="2022-11-30T09:19:30+00:00"><meta itemprop=wordCount content="564"><meta itemprop=keywords content="Kubernetes,k8s,"><link rel=preconnect href=https://fonts.bunny.net crossorigin><link rel=dns-prefetch href=//fonts.bunny.net><link rel=dns-prefetch href=//fonts.bunny.net><link rel=stylesheet href="https://fonts.bunny.net/css?family=Open+Sans:400,400i,700"><link rel=stylesheet href=/css/style.css><link rel="shortcut icon" href=/favicon.ico></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class=logo><a class=logo__link href=/ title="Linux.cn Archive" rel=home><div class="logo__item logo__text"><div class=logo__title>Linux.cn Archive</div></div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>Menu</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/><span class=menu__text>Home</span></a></li><li class=menu__item><a class=menu__link href=/categories/><span class=menu__text>Categories</span></a></li><li class=menu__item><a class=menu__link href=/tags/><span class=menu__text>Tags</span></a></li><li class=menu__item><a class=menu__link href><span class=menu__text>RSS</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>如何用 Kubeadm 在 Debian 11 上安装 Kubernetes 集群</h1><div class="post__meta meta"><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class=meta__text datetime=2022-11-30T09:19:30Z>November 30, 2022</time></div></div></header><div class="content post__content clearfix"><p><img src=/data/attachment/album/202211/30/091928zlxbvttw58x6rztw.jpg alt></p><blockquote><p>你是否在寻找一份在 Debian 11（Bullseye）上安装 Kubernetes 集群的简易指南？</p></blockquote><p>这份分步指南将向你展示如何使用 Kubeadm 工具在 Debian 11 上安装 Kubernetes 集群。</p><p>Kubernetes（k8s）集群包含主控节点和工作节点，用于运行容器化的应用程序。主控节点作为控制平面，工作节点为实际工作负载提供环境。</p><p>前置条件：</p><ul><li>已安装 Debian 11</li><li>2 CPU / vCPU</li><li>2 GB RAM</li><li>20 GB 空闲硬盘空间</li><li>有管理员权限的 sudo 用户</li><li>稳定的网络连接</li></ul><p>实验环境配置：</p><p>在本文中，我使用了 3 个 Debian 11 系统的节点，配置如下</p><ul><li>主控节点（<code>k8s-master</code>） – 192.168.1.236</li><li>工作节点 1（<code>k8s-worker1</code>） – 192.168.1.237</li><li>工作节点 2（<code>k8s-worker2</code>） – 192.168.1.238</li></ul><p>事不宜迟，我们直接进入安装步骤。</p><h3 id=1设置主机名和更新-etchosts-文件>1、设置主机名和更新 /etc/hosts 文件</h3><p>在主控节点和工作节点上使用 <code>hostnamectl</code> 命令来设置主机名：</p><pre tabindex=0><code>$ sudo hostnamectl set-hostname &#34;k8s-master&#34;       // 在主控节点运行
$ sudo hostnamectl set-hostname &#34;k8s-worker1&#34;      // 在工作节点 1 运行
$ sudo hostnamectl set-hostname &#34;k8s-worker2&#34;      // 在工作节点 2 运行
</code></pre><p>在所有节点的 <code>/etc/hosts</code> 文件末尾添加下面几行内容：</p><pre tabindex=0><code>192.168.1.236       k8s-master
192.168.1.237       k8s-worker1
192.168.1.238       k8s-worker2
</code></pre><h3 id=2在所有节点上关闭交换分区>2、在所有节点上关闭交换分区</h3><p>我推荐关闭交换分区，以便更丝滑地使用 <code>kubelet</code>。在所有节点上执行以下命令来关闭交换分区：</p><pre tabindex=0><code>$ sudo swapoff -a
$ sudo sed -i &#39;/ swap / s/^\(.*\)$/#\1/g&#39; /etc/fstab
</code></pre><h3 id=3配置-kubernetes-集群相关的防火墙规则>3、配置 Kubernetes 集群相关的防火墙规则</h3><p>如果你的操作系统防火墙是打开的，请分别在主控节点和工作节点允许以下的端口。</p><p>在主控节点，执行：</p><pre tabindex=0><code>$ sudo ufw allow 6443/tcp
$ sudo ufw allow 2379/tcp
$ sudo ufw allow 2380/tcp
$ sudo ufw allow 10250/tcp
$ sudo ufw allow 10251/tcp
$ sudo ufw allow 10252/tcp
$ sudo ufw allow 10255/tcp
$ sudo ufw reload
</code></pre><p>在工作节点，执行：</p><pre tabindex=0><code>$ sudo ufw allow 10250/tcp
$ sudo ufw allow 30000:32767/tcp
$ sudo ufw reload
</code></pre><p>注意：如果你的 Debian 11 系统防火墙是关闭的，可以跳过此步骤。</p><h3 id=4在所有节点安装-containerd-运行时>4、在所有节点安装 Containerd 运行时</h3><p>Containerd 是容器运行时的行业标准，所有节点必须安装 Containerd。</p><p>先在所有节点上配置如下的核心参数，再安装 Containerd。</p><pre tabindex=0><code>$ cat &lt;&lt;EOF | sudo tee /etc/modules-load.d/containerd.conf
overlay
br_netfilter
EOF

$ sudo modprobe overlay
$ sudo modprobe br_netfilter

$ cat &lt;&lt;EOF | sudo tee /etc/sysctl.d/99-kubernetes-k8s.conf
net.bridge.bridge-nf-call-iptables = 1
net.ipv4.ip_forward = 1
net.bridge.bridge-nf-call-ip6tables = 1
EOF
</code></pre><p>运行如下命令，以使上面的更改生效：</p><pre tabindex=0><code>$ sudo sysctl --system
</code></pre><p>现在，在所有节点上运行如下 <code>apt</code> 命令来安装 Conatinerd。</p><pre tabindex=0><code>$ sudo apt  update
$ sudo apt -y install containerd
</code></pre><p>在所有节点上运行如下命令来配置 Containerd：</p><pre tabindex=0><code>$ containerd config default | sudo tee /etc/containerd/config.toml &gt;/dev/null 2&gt;&amp;1
</code></pre><p>在所有节点上设置 <code>cgroupdriver</code> 为 <code>systemd</code>，编辑 <code>/etc/containerd/config.toml</code> 文件，找到 <code>[plugins."io.containerd.grpc.v1.cri".containerd.runtimes.runc.options]</code> 部分，添加一行内容：<code>SystemdCgroup = true</code>：</p><pre tabindex=0><code>$ sudo vi /etc/containerd/config.toml
</code></pre><p><img src=/data/attachment/album/202211/30/091931d0niz8ur284i9mzr.png alt=systemdCgroup-true-containerd-config-toml></p><p>保存并退出文件。</p><p>在所有节点上重启并启用 <code>containerd</code> 服务：</p><pre tabindex=0><code>$ sudo systemctl restart containerd
$ sudo systemctl enable containerd
</code></pre><h3 id=5添加-kubernetes-apt-库>5、添加 Kubernetes Apt 库</h3><p>执行以下命令，添加 Kubernetes Apt 库：</p><pre tabindex=0><code>$ sudo apt install gnupg gnupg2 curl software-properties-common -y
$ curl -s https://packages.cloud.google.com/apt/doc/apt-key.gpg | sudo gpg --dearmour -o /etc/apt/trusted.gpg.d/cgoogle.gpg
$ sudo apt-add-repository &#34;deb http://apt.kubernetes.io/ kubernetes-xenial main&#34;
</code></pre><h3 id=6在所有节点上安装-kubeletkubectl-和-kubeadm>6、在所有节点上安装 kubelet、kubectl 和 kubeadm</h3><p>在所有节点上执行以下 <code>apt</code> 命令，安装 Kubernetes 集群组件，如 <code>kubelet</code>、<code>kubectl</code> 以及 <code>kubeadm</code>。</p><pre tabindex=0><code>$ sudo apt update
$ sudo apt install kubelet kubeadm kubectl -y
$ sudo apt-mark hold kubelet kubeadm kubectl
</code></pre><h3 id=7使用-kubeadm-创建-kubernetes-集群>7、使用 Kubeadm 创建 Kubernetes 集群</h3><p>现在我们可以创建 Kubernetes 集群了，在主控节点上执行以下命令：</p><pre tabindex=0><code>$ sudo kubeadm init --control-plane-endpoint=k8s-master
</code></pre><p>命令输出：</p><p><img src=/data/attachment/album/202211/30/091931d99hajs1393vkxex.png alt=Kubernetes-Control-Plane-Initialization-Debian11></p><p>出现以上内容，说明控制平面初始化成功。在输出中，有普通用户与集群交互的命令，也有把任何工作节点加入到集群的命令。</p><p>要开始与集群进行交互，请在主控节点上运行以下命令：</p><pre tabindex=0><code>$ mkdir -p $HOME/.kube
$ sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
$ sudo chown $(id -u):$(id -g) $HOME/.kube/config
</code></pre><p>执行以下 <code>kubectl</code> 命令来获取节点和集群的信息：</p><pre tabindex=0><code>$ kubectl get nodes
$ kubectl cluster-info
</code></pre><p>以上命令的输出：</p><p><img src=/data/attachment/album/202211/30/091932re5fwe9q5fw5ifm9.png alt=Nodes-Cluster-Info-Kubectl></p><p>通过执行 <code>kubeadm join</code> 命令来把两个工作节点加入到集群。</p><p>注意：请从 <code>kubeadm init</code> 命令的输出中复制完整的命令。在我的例子中，命令如下：</p><pre tabindex=0><code>$ sudo kubeadm join k8s-master:6443 --token ta622t.enl212euq7z87mgj \
   --discovery-token-ca-cert-hash sha256:2be58f54458d0e788c96b8841f811069019161f9a3dd8502a38c773e5c6ead17
</code></pre><p>在工作节点 1 上的输出如下：</p><p><img src=/data/attachment/album/202211/30/091932wu38rcr87ydxduiu.png alt=Worker-Node1-Join-Kunernetes-Cluster></p><p>在工作节点 2 上的输出如下：</p><p><img src=/data/attachment/album/202211/30/091933crf4ws9ju48myzjf.png alt=Worker-Node2-Join-Kubernetes-Cluster></p><p>在主控节点上执行以下命令，检查节点的状态：</p><pre tabindex=0><code>$ kubectl get nodes
NAME          STATUS     ROLES           AGE     VERSION
k8s-master    NotReady   control-plane   23m     v1.25.0
k8s-worker1   NotReady   &lt;none&gt;          9m27s   v1.25.0
k8s-worker2   NotReady   &lt;none&gt;          2m19s   v1.25.0
$
</code></pre><p>为了使节点状态变为 <code>ready</code>，我们需要安装 容器荚 Pod 网络插件，如 Calico 或 flannel。</p><h3 id=8安装-calico-pod-网络插件>8、安装 Calico Pod 网络插件</h3><p>在主控节点上执行以下命令安装 Calico：</p><pre tabindex=0><code>$ kubectl apply -f https://projectcalico.docs.tigera.io/manifests/calico.yaml
</code></pre><p>输出：</p><p><img src=/data/attachment/album/202211/30/091934r8kz8vkufhv0uhhv.png alt=Install-calico-pod-network-addon-debian11></p><p>在所有节点上执行以下命令，配置防火墙允许 Calico 的端口：</p><pre tabindex=0><code>$ sudo ufw allow 179/tcp
$ sudo ufw allow 4789/udp
$ sudo ufw allow 51820/udp
$ sudo ufw allow 51821/udp
$ sudo ufw allow 4789/udp
$ sudo ufw reload
</code></pre><p>执行以下命令检查下 Calico 的状态：</p><pre tabindex=0><code>$ kubectl get pods -n kube-system
</code></pre><p><img src=/data/attachment/album/202211/30/091935kyytijujjnpi14pq.png alt=Calico-Pods-Status-Kuberenetes-Debian11></p><p>完美！现在再检查下节点状态：</p><p><img src=/data/attachment/album/202211/30/091935m68ka1g2at62ms8s.png alt=Nodes-status-after-calico-Installation></p><p>非常棒！上面的输出说明主控节点和工作节点的状态都是 <code>ready</code>。现在这个集群可以正常工作了。</p><h3 id=9检查-kubernetes-集群安装是否正确>9、检查 Kubernetes 集群安装是否正确</h3><p>我们尝试通过 <code>deployment</code> 命令来部署基于 Nginx 的应用程序，来验证 Kubernetes 集群的安装是否正确。执行以下命令：</p><pre tabindex=0><code>$ kubectl create deployment nginx-app --image=nginx --replicas 2
$ kubectl expose deployment nginx-app --name=nginx-web-svc --type NodePort --port 80 --target-port 80
$ kubectl describe svc nginx-web-svc
</code></pre><p>以上命令的输出：</p><p><img src=/data/attachment/album/202211/30/091936jz9b9ndbbd77bx6p.png alt=Nginx-Based-App-Kubernetes-Cluster-Debian11></p><p>使用以下的 <code>curl</code> 命令通过节点端口 30036 来访问基于 nginx 的应用程序。</p><p>注意：在 <code>curl</code> 命令中，可以使用两个工作节点任一的主机名。</p><pre tabindex=0><code>$ curl http://k8s-worker1:30036
</code></pre><p><img src=/data/attachment/album/202211/30/091936awvwne1fzee31e55.png alt=Access-Nginx-Based-App-via-NodePort-Kubernetes-Debian11></p><p>以上的输出说明我们可以正常访问基于 nginx 的应用程序了。</p><p>以上为全部内容。希望本文对你有用，参照本文可以在 Debian 11 上正常安装 Kubernetes 集群。如有任何问题，请在下面评论区告诉我。</p><hr><p>via: <a href=https://www.linuxtechi.com/install-kubernetes-cluster-on-debian/>https://www.linuxtechi.com/install-kubernetes-cluster-on-debian/</a></p><p>作者：<a href=https://www.linuxtechi.com/author/pradeep/>Pradeep Kumar</a> 选题：<a href=https://github.com/lkxed>lkxed</a> 译者：<a href=https://github.com/lxbwolf>lxbwolf</a> 校对：<a href=https://github.com/wxy>wxy</a></p><p>本文由 <a href=https://github.com/LCTT/TranslateProject>LCTT</a> 原创编译，<a href=https://linux.cn/>Linux中国</a> 荣誉推出</p></div><footer class=post__footer><div class="post__tags tags clearfix"><svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5.0 11V3C0 1.5.8.8.8.8S1.5.0 3 0h8c1.5.0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 100-6 3 3 0 000 6z"/></svg><ul class=tags__list><li class=tags__item><a class="tags__link btn" href=/tags/kubernetes/ rel=tag>Kubernetes</a></li><li class=tags__item><a class="tags__link btn" href=/tags/k8s/ rel=tag>k8s</a></li></ul></div></footer></article></main></div></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2025 Linux.cn Archive.
<span class=footer__copyright-credits>Generated with <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> and <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a> theme.</span></div></div></footer></div><script async defer src=/js/menu.js></script></body></html>