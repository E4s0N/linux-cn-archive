<!doctype html><html class=no-js lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>如何编写 VS Code 扩展 - Linux.cn Archive</title>
<script>(function(e,t){e[t]=e[t].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content><meta property="og:title" content="如何编写 VS Code 扩展"><meta property="og:description" content="通过为流行的代码编辑器编写自己的扩展来添加缺失的功能。"><meta property="og:type" content="article"><meta property="og:url" content="/article-12310-1.html"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-06-13T10:54:57+00:00"><meta property="article:modified_time" content="2020-06-13T10:54:57+00:00"><meta itemprop=name content="如何编写 VS Code 扩展"><meta itemprop=description content="通过为流行的代码编辑器编写自己的扩展来添加缺失的功能。"><meta itemprop=datePublished content="2020-06-13T10:54:57+00:00"><meta itemprop=dateModified content="2020-06-13T10:54:57+00:00"><meta itemprop=wordCount content="654"><meta itemprop=keywords content="VSCode,扩展,"><link rel=preconnect href=https://fonts.bunny.net crossorigin><link rel=dns-prefetch href=//fonts.bunny.net><link rel=dns-prefetch href=//fonts.bunny.net><link rel=stylesheet href="https://fonts.bunny.net/css?family=Open+Sans:400,400i,700"><link rel=stylesheet href=/css/style.css><link rel="shortcut icon" href=/favicon.ico></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class=logo><a class=logo__link href=/ title="Linux.cn Archive" rel=home><div class="logo__item logo__text"><div class=logo__title>Linux.cn Archive</div></div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>Menu</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/><span class=menu__text>Home</span></a></li><li class=menu__item><a class=menu__link href=/categories/><span class=menu__text>Categories</span></a></li><li class=menu__item><a class=menu__link href=/tags/><span class=menu__text>Tags</span></a></li><li class=menu__item><a class=menu__link href><span class=menu__text>RSS</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>如何编写 VS Code 扩展</h1><div class="post__meta meta"><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class=meta__text datetime=2020-06-13T10:54:57Z>June 13, 2020</time></div></div></header><div class="content post__content clearfix"><blockquote><p>通过为流行的代码编辑器编写自己的扩展来添加缺失的功能。</p></blockquote><p><img src=/data/attachment/album/202006/13/105415w5u1d0z5bdoneb82.jpg alt></p><p>Visual Studio Code（VS Code）是微软为 Linux、Windows 和 macOS 创建的跨平台代码编辑器。遗憾的是，微软版本的 <a href=https://code.visualstudio.com/>VS Code</a> 是在 <a href=https://code.visualstudio.com/license>Microsoft Software License</a> 下发布的，这不是一个开源的许可证。然而，它的源代码是开源的，在 MIT 许可证下由 <a href=https://vscodium.com/>VSCodium</a> 项目发布。</p><p>VSCodium 和 VS Code一样，支持扩展、内嵌式 Git 控制、GitHub 集成、语法高亮、调试、智能代码补完、代码片段等。换句话说，对于大多数用户来说，使用 VS Code 和 VSCodium 没有什么区别，而且后者是完全开源的！</p><h3 id=什么是-vs-code-扩展>什么是 VS Code 扩展？</h3><p>扩展 extension 可以让你为 VS Code 或 VSCodium 添加功能。你可以在 GUI 中或从终端安装扩展。</p><p>你也可以构建自己的扩展。有几个你可能想学习如何构建扩展的原因：</p><ol><li><strong>想要添加一些功能：</strong> 如果缺失你想要的功能，你可以创建一个扩展来添加它。</li><li><strong>为了乐趣和学习：</strong> 扩展 API 允许你探索 VSCodium 是如何工作的，这是一件有趣的事情。</li><li><strong>为了提高您的技能：</strong> 创建扩展可以提高你的编程技能。</li><li><strong>为了成名：</strong> 创建一个对他人有用的扩展可以提高你的公众形象。</li></ol><h3 id=安装工具>安装工具</h3><p>在你开始之前，你必须已经安装了 <a href=https://nodejs.org/en/>Node.js</a>、<a href=https://www.npmjs.com/>npm</a> 和 VS Code 或 <a href=https://vscodium.com/>VSCodium</a>。</p><p>要生成一个扩展，你还需要以下工具：<a href=https://yeoman.io/>Yeoman</a>，是一个开源的客户端脚手架工具，可以帮助你搭建新项目；以及 <a href=https://github.com/Microsoft/vscode-generator-code>vscode-generator-code</a>，是 VS Code 团队创建的 Yeoman 生成器。</p><h3 id=构建一个扩展>构建一个扩展</h3><p>在本教程中，你将构建一个扩展，它可以为应用程序初始化一个 Docker 镜像。</p><h4 id=生成一个扩展骨架>生成一个扩展骨架</h4><p>要在全局范围内安装并运行 Yeoman 生成器，请在命令提示符或终端中输入以下内容：</p><pre tabindex=0><code>npm install -g yo generator-code
</code></pre><p>导航到要生成扩展的文件夹，键入以下命令，然后按回车：</p><pre tabindex=0><code>yo code
</code></pre><p>根据提示，你必须回答一些关于你的扩展的问题：</p><ul><li><strong>你想创建什么类型的扩展？</strong> 使用上下箭头选择其中一个选项。在本文中，我将只介绍第一个选项，<code>New Extension (TypeScript)</code>。</li><li><strong>你的扩展名称是什么？</strong> 输入你的扩展名称。我的叫 <code>initdockerapp</code>。（我相信你会有一个更好的名字。）</li><li><strong>你的扩展的标识符是什么？</strong> 请保持原样。</li><li><strong>你的扩展的描述是什么？</strong> 写一些关于你的扩展的内容（你可以现在填写或稍后编辑它）。</li><li><strong>初始化 Git 仓库？</strong> 这将初始化一个 Git 仓库，你可以稍后添加 <code>set-remote</code>。</li><li><strong>使用哪个包管理器？</strong> 你可以选择 <code>yarn</code> 或 <code>npm</code>；我使用 <code>npm</code>。</li></ul><p>按回车键后，就会开始安装所需的依赖项。最后显示：</p><blockquote><p>&ldquo;Your extension <strong>initdockerapp</strong> has been created!&rdquo;</p></blockquote><p>干的漂亮！</p><h3 id=检查项目的结构>检查项目的结构</h3><p>检查你生成的东西和项目结构。导航到新的文件夹，并在终端中键入 <code>cd initdockerapp</code>。</p><p>一旦你进入该目录，键入 <code>.code</code>。它将在你的编辑器中打开，看起来像这样。</p><p><img src=/data/attachment/album/202006/13/105508u16aztgy1pe4dy8t.png alt="Project file structure in VSCodium" title="Project file structure in VSCodium"></p><p>（Hussain Ansari, <a href=https://creativecommons.org/licenses/by-sa/4.0/>CC BY-SA 4.0</a>）</p><p>最需要注意的两个文件是 <code>src</code> 文件夹内的 <code>package.json</code> 和 <code>extension.ts</code>。</p><h4 id=packagejson>package.json</h4><p>首先来看看 <code>package.json</code>，它应该是这样的：</p><pre tabindex=0><code>{
        &#34;name&#34;: &#34;initdockerapp&#34;,
        &#34;displayName&#34;: &#34;initdockerapp&#34;,
        &#34;description&#34;: &#34;&#34;,
        &#34;version&#34;: &#34;0.0.1&#34;,
        &#34;engines&#34;: {
                &#34;vscode&#34;: &#34;^1.44.0&#34;
        },
        &#34;categories&#34;: [
                &#34;Other&#34;
        ],
        &#34;activationEvents&#34;: [
                &#34;onCommand:initdockerapp.initialize&#34;
        ],
        &#34;main&#34;: &#34;./out/extension.js&#34;,
        &#34;contributes&#34;: {
                &#34;commands&#34;: [
                        {
                                &#34;command&#34;: &#34;initdockerapp.initialize&#34;,
                                &#34;title&#34;: &#34;Initialize A Docker Application&#34;
                        }
                ]
        },
        &#34;scripts&#34;: {
                &#34;vscode:prepublish&#34;: &#34;npm run compile&#34;,
                &#34;compile&#34;: &#34;tsc -p ./&#34;,
                &#34;lint&#34;: &#34;eslint src --ext ts&#34;,
                &#34;watch&#34;: &#34;tsc -watch -p ./&#34;,
                &#34;pretest&#34;: &#34;npm run compile &amp;&amp; npm run lint&#34;,
                &#34;test&#34;: &#34;node ./out/test/runTest.js&#34;
        },
        &#34;devDependencies&#34;: {
                &#34;@types/vscode&#34;: &#34;^1.44.0&#34;,
                &#34;@types/glob&#34;: &#34;^7.1.1&#34;,
                &#34;@types/mocha&#34;: &#34;^7.0.2&#34;,
                &#34;@types/node&#34;: &#34;^13.11.0&#34;,
                &#34;eslint&#34;: &#34;^6.8.0&#34;,
                &#34;@typescript-eslint/parser&#34;: &#34;^2.26.0&#34;,
                &#34;@typescript-eslint/eslint-plugin&#34;: &#34;^2.26.0&#34;,
                &#34;glob&#34;: &#34;^7.1.6&#34;,
                &#34;mocha&#34;: &#34;^7.1.1&#34;,
                &#34;typescript&#34;: &#34;^3.8.3&#34;,
                &#34;vscode-test&#34;: &#34;^1.3.0&#34;
        }
}
{
        &#34;name&#34;: &#34;initdockerapp&#34;,
        &#34;displayName&#34;: &#34;initdockerapp&#34;,
        &#34;description&#34;: &#34;&#34;,
        &#34;version&#34;: &#34;0.0.1&#34;,
        &#34;engines&#34;: {
                &#34;vscode&#34;: &#34;^1.44.0&#34;
        },
        &#34;categories&#34;: [
                &#34;Other&#34;
        ],
        &#34;activationEvents&#34;: [
                &#34;onCommand:initdockerapp.initialize&#34;
        ],
        &#34;main&#34;: &#34;./out/extension.js&#34;,
        &#34;contributes&#34;: {
                &#34;commands&#34;: [
                        {
                                &#34;command&#34;: &#34;initdockerapp.initialize&#34;,
                                &#34;title&#34;: &#34;Initialize A Docker Application&#34;
                        }
                ]
        },
        &#34;scripts&#34;: {
                &#34;vscode:prepublish&#34;: &#34;npm run compile&#34;,
                &#34;compile&#34;: &#34;tsc -p ./&#34;,
                &#34;lint&#34;: &#34;eslint src --ext ts&#34;,
                &#34;watch&#34;: &#34;tsc -watch -p ./&#34;,
                &#34;pretest&#34;: &#34;npm run compile &amp;&amp; npm run lint&#34;,
                &#34;test&#34;: &#34;node ./out/test/runTest.js&#34;
        },
        &#34;devDependencies&#34;: {
                &#34;@types/vscode&#34;: &#34;^1.44.0&#34;,
                &#34;@types/glob&#34;: &#34;^7.1.1&#34;,
                &#34;@types/mocha&#34;: &#34;^7.0.2&#34;,
                &#34;@types/node&#34;: &#34;^13.11.0&#34;,
                &#34;eslint&#34;: &#34;^6.8.0&#34;,
                &#34;@typescript-eslint/parser&#34;: &#34;^2.26.0&#34;,
                &#34;@typescript-eslint/eslint-plugin&#34;: &#34;^2.26.0&#34;,
                &#34;glob&#34;: &#34;^7.1.6&#34;,
                &#34;mocha&#34;: &#34;^7.1.1&#34;,
                &#34;typescript&#34;: &#34;^3.8.3&#34;,
                &#34;vscode-test&#34;: &#34;^1.3.0&#34;
        }
}
</code></pre><p>如果你是 Node.js 开发者，其中一些可能看起来很熟悉，因为 <code>name</code>、<code>description</code>、<code>version</code> 和 <code>scripts</code> 是 Node.js 项目的常见部分。</p><p>有几个部分是非常重要的：</p><ul><li><code>engines</code>：说明该扩展将支持哪个版本的 VS Code / VSCodium。</li><li><code>categories</code>：设置扩展类型；你可以从 <code>Languages</code>、<code>Snippets</code>、<code>Linters</code>、<code>Themes</code>、<code>Debuggers</code>、<code>Formatters</code>、<code>Keymaps</code> 和 <code>Other</code>中选择。</li><li><code>contributes</code>：可用于与你的扩展一起运行的命令清单。</li><li><code>main</code>：扩展的入口点。</li><li><code>activationEvents</code>：指定激活事件发生的时间。具体来说，这决定了扩展何时会被加载到你的编辑器中。扩展是懒加载的，所以在激活事件触发之前，它们不会被激活。</li></ul><h4 id=srcextensionts>src/extension.ts</h4><p>接下来看看 <code>src/extension.ts</code>，它应该是这样的：</p><pre tabindex=0><code>// The module &#39;vscode&#39; contains the VSCodium extensibility API
// Import the module and reference it with the alias vscode in your code below
import * as vscode from &#34;vscode&#34;;
const fs = require(&#34;fs&#34;);
const path = require(&#34;path&#34;);

// this method is called when your extension is activated
// your extension is activated the very first time the command is executed
export function activate(context: vscode.ExtensionContext) {

        // Use the console to output diagnostic information (console.log) and errors (console.error)
        // This line of code will only be executed once when your extension is activated
        console.log(&#39;Congratulations, your extension &#34;initdockerapp&#34; is now active!&#39;);
       
        // The command has been defined in the package.json file
        // Now provide the implementation of the command with registerCommand
        // The commandId parameter must match the command field in package.json
        let disposable = vscode.commands.registerCommand(&#39;initdockerapp.initialize&#39;, () =&gt; {
                // The code you place here will be executed every time your command is executed

                let fileContent =`
                FROM node:alpine
                WORKDIR /usr/src/app

                COPY package.json .
                RUN npm install
               
                COPY . .
               
                EXPOSE 3000
                CMD [&#34;npm&#34;, &#34;start&#34;]
                `;
               
                fs.writeFile(path.join(vscode.workspace.rootPath, &#34;Dockerfile&#34;), fileContent, (err:any) =&gt; {
                        if (err) {
                                return vscode.window.showErrorMessage(&#34;Failed to initialize docker file!&#34;);
                        }
                        vscode.window.showInformationMessage(&#34;Dockerfile has been created!&#34;);
                });
        });

        context.subscriptions.push(disposable);
}

// this method is called when your extension is deactivated
export function deactivate() {}
</code></pre><p>这是为你的扩展写代码的地方。已经有一些自动生成的代码了，我再来分析一下。</p><p>注意，<code>vscode.command.registerCommand</code> 里面的 <code>initdockerapp.initialize</code> 和 <code>package.json</code> 里面的命令是一样的。它需要两个参数。</p><ol><li>要注册的命令名称</li><li>执行命令的功能</li></ol><p>另一个需要注意的函数是 <code>fs.writeFile</code>，这是你写在 <code>vscode.command.registerCommand</code> 函数里面的。这将在你的项目根目录下创建一个 Dockerfile，并在其中附加代码来创建一个 Docker 镜像。</p><h3 id=调试扩展>调试扩展</h3><p>现在你已经写好了扩展，是时候调试它了。点击“Run”菜单，选择“Start Debugging”（或者直接按 <code>F5</code>）打开调试窗口。</p><p>在调试窗口里面点击“Add Folder”或“Clone Repository”按钮，打开该项目。</p><p>接下来，用 <code>Ctrl+Shift+P</code>（在 macOS 上，用 <code>Command</code> 键代替 <code>Ctrl</code>）打开命令面板，运行 <code>Initialize A Docker Application</code>。</p><ul><li>第一次运行此命令时，自 VSCodium 启动后，激活函数尚未执行。因此，调用激活函数，并由激活 函数注册该命令。</li><li>如果命令已注册，那么它将被执行。</li></ul><p>你会看到右下角有一条信息，上面写着：<code>Dockerfile has been created!</code>。这就创建了一个 Dockerfile，里面有一些预定义的代码，看起来是这样的：</p><p><img src=/data/attachment/album/202006/13/105512l8sb7sjcnvmafni8.png alt="Running the new extension command" title="Running the new extension command"></p><p>（Hussain Ansari, <a href=https://creativecommons.org/licenses/by-sa/4.0/>CC BY-SA 4.0</a>）</p><h3 id=总结>总结</h3><p>有许多有用的 API 可以帮助你创建你想要构建的扩展。VS Code 扩展 API 还有许多其他强大的方法可以使用。</p><p>你可以在 VS Code 扩展 API 文档中了解更多关于 VS Code API 的信息。</p><hr><p>via: <a href=https://opensource.com/article/20/6/vs-code-extension>https://opensource.com/article/20/6/vs-code-extension</a></p><p>作者：<a href=https://opensource.com/users/uidoyen>Ashique Hussain Ansari</a> 选题：<a href=https://github.com/lujun9972>lujun9972</a> 译者：<a href=https://github.com/wxy>wxy</a> 校对：<a href=https://github.com/wxy>wxy</a></p><p>本文由 <a href=https://github.com/LCTT/TranslateProject>LCTT</a> 原创编译，<a href=https://linux.cn/>Linux中国</a> 荣誉推出</p></div><footer class=post__footer><div class="post__tags tags clearfix"><svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5.0 11V3C0 1.5.8.8.8.8S1.5.0 3 0h8c1.5.0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 100-6 3 3 0 000 6z"/></svg><ul class=tags__list><li class=tags__item><a class="tags__link btn" href=/tags/vscode/ rel=tag>VSCode</a></li><li class=tags__item><a class="tags__link btn" href=/tags/%E6%89%A9%E5%B1%95/ rel=tag>扩展</a></li></ul></div></footer></article></main></div></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2025 Linux.cn Archive.
<span class=footer__copyright-credits>Generated with <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> and <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a> theme.</span></div></div></footer></div><script async defer src=/js/menu.js></script></body></html>