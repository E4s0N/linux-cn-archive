<!doctype html><html class=no-js lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>如何使用 Tmpwatch/Tmpreaper 删除旧文件 - Linux.cn Archive</title>
<script>(function(e,t){e[t]=e[t].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content><meta property="og:title" content="如何使用 Tmpwatch/Tmpreaper 删除旧文件"><meta property="og:description" content="你可能忘记了删除计算机上某个目录中不再需要的文件的操作。"><meta property="og:type" content="article"><meta property="og:url" content="/article-12284-1.html"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-06-05T09:18:22+00:00"><meta property="article:modified_time" content="2020-06-05T09:18:22+00:00"><meta itemprop=name content="如何使用 Tmpwatch/Tmpreaper 删除旧文件"><meta itemprop=description content="你可能忘记了删除计算机上某个目录中不再需要的文件的操作。"><meta itemprop=datePublished content="2020-06-05T09:18:22+00:00"><meta itemprop=dateModified content="2020-06-05T09:18:22+00:00"><meta itemprop=wordCount content="272"><meta itemprop=keywords content="删除,"><link rel=preconnect href=https://fonts.bunny.net crossorigin><link rel=dns-prefetch href=//fonts.bunny.net><link rel=dns-prefetch href=//fonts.bunny.net><link rel=stylesheet href="https://fonts.bunny.net/css?family=Open+Sans:400,400i,700"><link rel=stylesheet href=/css/style.css><link rel="shortcut icon" href=/favicon.ico></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class=logo><a class=logo__link href=/ title="Linux.cn Archive" rel=home><div class="logo__item logo__text"><div class=logo__title>Linux.cn Archive</div></div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>Menu</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/><span class=menu__text>Home</span></a></li><li class=menu__item><a class=menu__link href=/categories/><span class=menu__text>Categories</span></a></li><li class=menu__item><a class=menu__link href=/tags/><span class=menu__text>Tags</span></a></li><li class=menu__item><a class=menu__link href><span class=menu__text>RSS</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>如何使用 Tmpwatch/Tmpreaper 删除旧文件</h1><div class="post__meta meta"><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class=meta__text datetime=2020-06-05T09:18:22Z>June 05, 2020</time></div></div></header><div class="content post__content clearfix"><p><img src=/data/attachment/album/202006/05/091806zrnwahdl9fdyznrw.jpg alt></p><p>你可能忘记了删除计算机上某个目录中不再需要的文件的操作。这可能是“下载”或任何其他目录。它可能已经增长了一段时间。</p><p>即便有足够的存储空间，你也应该删除它们，因为这会在列出文件时降低系统速度。同样，当一个目录中有成千上万个文件时，它可能很会很臃肿。</p><p>当你不知道要检查的文件名时，很难在特定目录中找到文件。</p><p>我们可以通过结合使用 <code>find</code> 命令和一些组合来做到这一点，我们过去已经写过一篇文章。</p><ul><li><a href=/article-11490-1.html>使用 Bash 脚本在 Linux 中删除早于 “X” 天的文件/文件夹</a></li></ul><p>今天，我们将向你展示如何在 Linux 上使用 Tmpwatch 程序来实现这一目标。</p><h3 id=什么是-tmpwatch>什么是 tmpwatch</h3><p><code>tmpwatch</code> 会在指定目录中递归删除指定时间段内未被访问的文件。通常，它用于自动清除临时文件系统目录，例如 <code>/tmp</code> 和 <code>/var/tmp</code>。</p><p>它只会删除空目录、常规文件和符号链接。它不会切换到其他文件系统，并避开了属于根用户的 <code>lost+found</code> 目录。</p><p>默认情况下，<code>tmpwatch</code> 会根据文件的 atime（访问时间）而不是 mtime（修改时间）删除文件。</p><p>你可以在 <code>tmpwatch</code> 命令中添加其他参数来更改这些行为。</p><p><strong>警告：</strong> 请不要在 <code>/</code> 中运行 <code>tmpwatch</code> 或 <code>tmpreaper</code>，因为该程序中没有防止这种情况的机制。</p><h3 id=如何在-linux-上安装-tmpwatch>如何在 Linux 上安装 tmpwatch</h3><p>可以在官方仓库中按以下方式安装 <code>tmpwatch</code>。</p><p>对于 RHEL/CentOS 6 系统，请使用 <a href=https://www.2daygeek.com/linux-yum-command-examples-manage-packages-rhel-centos-systems/>yum 命令</a>安装 <code>tmpwatch</code>。</p><pre tabindex=0><code>$ sudo yum install -y tmpwatch
</code></pre><p>对于 Debian 和 Ubuntu 系统，请使用 <a href=https://www.2daygeek.com/apt-command-examples-manage-packages-debian-ubuntu-systems/>apt 命令</a> 或 <a href=https://www.2daygeek.com/apt-get-apt-cache-command-examples-manage-packages-debian-ubuntu-systems/>apt-get 命令</a> 安装 <code>tmpreaper</code>。</p><pre tabindex=0><code>$ sudo apt-get install tmpreaper
</code></pre><p>对于 openSUSE 系统，请使用 <a href=https://www.2daygeek.com/zypper-command-examples-manage-packages-opensuse-system/>zypper 命令</a> 安装 <code>tmpwatch</code>。</p><pre tabindex=0><code>$ sudo zypper install -y tmpwatch
</code></pre><p>对于 Fedora 系统，请使用 <a href=https://www.2daygeek.com/linux-dnf-command-examples-manage-packages-fedora-centos-rhel-systems/>dnf 命令</a> 安装 <code>tmpwatch</code>。</p><pre tabindex=0><code>$ sudo dnf install -y tmpwatch
</code></pre><p><strong>请注意：</strong> 如果你使用的是基于 Debian 的系统，请使用 <code>tmpreaper</code> 而不是 <code>tmpwatch</code>。所有示例都可以如预期工作。</p><h3 id=了解关键选项和参数>了解关键选项和参数</h3><ul><li><code>atime</code>（文件上次访问时间）：显示命令或脚本等任意进程最后一次访问文件中数据的时间。</li><li><code>mtime</code>（文件上次修改时间）：显示修改文件内容或保存文件的时间。除非是更改文件属性，否则大多数情况下 <code>ctime</code> 和 <code>mtime</code> 会相同。</li><li><code>ctime</code>（文件上次更改时间）：显示文件元数据更改时间。这意味着更改文件属性的时间（如所有权或组等）。</li><li><code>dirmtime</code>（目录的上次修改时间）：显示目录的上一次修改时间。</li></ul><p>时间参数定义删除文件的阈值。</p><ul><li><code>d</code> – 天</li><li><code>h</code> – 小时</li><li><code>m</code> – 分钟</li><li><code>s</code> – 秒</li></ul><h3 id=如何使用-tmpwatch-命令删除一段时间未访问的文件>如何使用 tmpwatch 命令删除一段时间未访问的文件</h3><p>正如我在本文开头所说，<code>tmpwatch</code> 默认根据文件访问时间（<code>atime</code>）来删除文件。另外，由于小时是默认参数，因此如果使用小时单位，那么无需在时间上添加后缀。</p><p>例如，运行以下命令以递归方式删除过去 5 个小时未访问的文件。</p><pre tabindex=0><code># tmpwatch 5 /tmp
</code></pre><p>运行以下命令删除最近 10 个小时未修改的文件。如果要使用修改时间（<code>mtime</code>）来删除文件，那么需要在 <code>tmpwatch</code> 命令中添加 <code>-m</code> 选项。</p><pre tabindex=0><code># tmpwatch -m 10 /home/daygeek/Downloads
</code></pre><h3 id=如何使用-tmpwatch-命令删除超过-x-天未访问的文件>如何使用 tmpwatch 命令删除超过 “X” 天未访问的文件</h3><p>如果要使用天数删除文件，那么需要添加后缀 <code>d</code>。以下示例删除了 30 天以上的文件。</p><pre tabindex=0><code># tmpwatch 30d /home/daygeek/Downloads
</code></pre><h3 id=如何使用-tmpwatch-命令删除一段时间内未访问的所有文件>如何使用 tmpwatch 命令删除一段时间内未访问的所有文件</h3><p>以下命令将基于修改时间（<code>mtime</code>）删除所有类型的文件，而不仅仅是常规文件、符号链接和目录。</p><pre tabindex=0><code># tmpwatch -am 12 /tmp
</code></pre><h3 id=如何在-tmpwatch-中排除目录>如何在 tmpwatch 中排除目录</h3><p>以下命令将删除过去 10 个小时未修改的所有文件，并排除目录。</p><pre tabindex=0><code># tmpwatch -am 10 --nodirs /home/daygeek/Downloads
</code></pre><h3 id=如何在-tmpwatch-中排除特定路径>如何在 tmpwatch 中排除特定路径</h3><p>以下命令将删除过去 10 个小时未被修改的所有文件，除了下面排除的文件夹。</p><pre tabindex=0><code># tmpwatch -am 10 --exclude=/home/daygeek/Downloads/Movies /home/daygeek/Downloads
</code></pre><h3 id=如何在-tmpwatch-中排除特定模式>如何在 tmpwatch 中排除特定模式</h3><p>以下命令将删除过去 10 小时未被修改的所有文件，除了满足下面列出的模式的文件。</p><pre tabindex=0><code># tmpwatch -am 10 --exclude-pattern=&#39;*.pdf&#39; /home/daygeek/Downloads
</code></pre><h3 id=如何让-tmpwatch-命令空运行>如何让 tmpwatch 命令空运行</h3><p>如果要空运行，请运行以下命令。</p><pre tabindex=0><code># tmpwatch -t 5h /home/daygeek/Downloads
</code></pre><h3 id=如何设置-cronjob-来使用-tmpwatch-定期删除文件>如何设置 cronjob 来使用 tmpwatch 定期删除文件</h3><p>默认情况下，它在 <code>/etc/cron.daily/tmpreaper</code> 目录下有一个 <a href=https://www.2daygeek.com/linux-crontab-cron-job-to-schedule-jobs-task/>cronjob</a> 文件。该 cronjob 根据位于 <code>/etc/timereaper.conf</code> 中的配置文件工作。你可以根据需要自定义文件。</p><p>它每天运行一次，并删除 7 天之前的文件。</p><p>另外，如果你希望常规执行某项操作，那么可以根据需要手动添加一个 cronjob。</p><pre tabindex=0><code># crontab -e

0 10 * * * /usr/sbin/tmpwatch 15d /home/daygeek/Downloads
</code></pre><p>上面的 cronjob 将在每天上午 10 点删除早于 15 天的文件。</p><hr><p>via: <a href=https://www.2daygeek.com/how-to-remove-files-older-than-n-days-using-tmpwatch-tmpreaper-on-linux/>https://www.2daygeek.com/how-to-remove-files-older-than-n-days-using-tmpwatch-tmpreaper-on-linux/</a></p><p>作者：<a href=https://www.2daygeek.com/author/magesh/>Magesh Maruthamuthu</a> 选题：<a href=https://github.com/lujun9972>lujun9972</a> 译者：<a href=https://github.com/geekpi>geekpi</a> 校对：<a href=https://github.com/wxy>wxy</a></p><p>本文由 <a href=https://github.com/LCTT/TranslateProject>LCTT</a> 原创编译，<a href=https://linux.cn/>Linux中国</a> 荣誉推出</p></div><footer class=post__footer><div class="post__tags tags clearfix"><svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5.0 11V3C0 1.5.8.8.8.8S1.5.0 3 0h8c1.5.0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 100-6 3 3 0 000 6z"/></svg><ul class=tags__list><li class=tags__item><a class="tags__link btn" href=/tags/%E5%88%A0%E9%99%A4/ rel=tag>删除</a></li></ul></div></footer></article></main></div></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2025 Linux.cn Archive.
<span class=footer__copyright-credits>Generated with <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> and <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a> theme.</span></div></div></footer></div><script async defer src=/js/menu.js></script></body></html>