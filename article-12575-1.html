<!doctype html><html class=no-js lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>scp 用户的 rsync 迁移指南 - Linux.cn Archive</title>
<script>(function(e,t){e[t]=e[t].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content><meta property="og:title" content="scp 用户的 rsync 迁移指南"><meta property="og:description" content="OpenSSH 项目表示，他们认为 scp 协议已经过时，不灵活，而且不容易修复，然后他们继而推荐使用 sftp 或 rsync 来进行文件传输。"><meta property="og:type" content="article"><meta property="og:url" content="/article-12575-1.html"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-09-03T10:30:08+00:00"><meta property="article:modified_time" content="2020-09-03T10:30:08+00:00"><meta itemprop=name content="scp 用户的 rsync 迁移指南"><meta itemprop=description content="OpenSSH 项目表示，他们认为 scp 协议已经过时，不灵活，而且不容易修复，然后他们继而推荐使用 sftp 或 rsync 来进行文件传输。"><meta itemprop=datePublished content="2020-09-03T10:30:08+00:00"><meta itemprop=dateModified content="2020-09-03T10:30:08+00:00"><meta itemprop=wordCount content="331"><meta itemprop=keywords content="rsync,scp,"><link rel=preconnect href=https://fonts.bunny.net crossorigin><link rel=dns-prefetch href=//fonts.bunny.net><link rel=dns-prefetch href=//fonts.bunny.net><link rel=stylesheet href="https://fonts.bunny.net/css?family=Open+Sans:400,400i,700"><link rel=stylesheet href=/css/style.css><link rel="shortcut icon" href=/favicon.ico></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class=logo><a class=logo__link href=/ title="Linux.cn Archive" rel=home><div class="logo__item logo__text"><div class=logo__title>Linux.cn Archive</div></div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>Menu</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/><span class=menu__text>Home</span></a></li><li class=menu__item><a class=menu__link href=/categories/><span class=menu__text>Categories</span></a></li><li class=menu__item><a class=menu__link href=/tags/><span class=menu__text>Tags</span></a></li><li class=menu__item><a class=menu__link href><span class=menu__text>RSS</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>scp 用户的 rsync 迁移指南</h1><div class="post__meta meta"><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class=meta__text datetime=2020-09-03T10:30:08Z>September 03, 2020</time></div></div></header><div class="content post__content clearfix"><p><img src=/data/attachment/album/202009/03/102942u7rxf79a7rsr9txz.jpg alt></p><p>在 <a href=https://lists.mindrot.org/pipermail/openssh-unix-dev/2019-March/037672.html>SSH 8.0 预发布公告</a>中，OpenSSH 项目表示，他们认为 scp 协议已经过时，不灵活，而且不容易修复，然后他们继而推荐使用 <code>sftp</code> 或 <code>rsync</code> 来进行文件传输。</p><p>然而，很多用户都是从小用着 <code>scp</code> 命令长大的，所以对 <code>rsync</code> 并不熟悉。此外，<code>rsync</code> 可以做的事情也远不止复制文件，这可能会给菜鸟们留下复杂和难以掌握的印象。尤其是，<code>scp</code> 命令的标志大体上可以直接对应到 <code>cp</code> 命令的标志，而 <code>rsync</code> 命令的标志却和它大相径庭。</p><p>本文将为熟悉 <code>scp</code> 的人提供一个介绍和过渡的指南。让我们跳进最常见的场景：复制文件和复制目录。</p><h3 id=复制文件>复制文件</h3><p>对于复制单个文件而言，<code>scp</code> 和 <code>rsync</code> 命令实际上是等价的。比方说，你需要把 <code>foo.txt</code> 传到你在名为 <code>server</code> 的服务器上的主目录下：</p><pre tabindex=0><code>$ scp foo.txt me@server:/home/me/
</code></pre><p>相应的 <code>rsync</code> 命令只需要输入 <code>rsync</code> 取代 <code>scp</code>：</p><pre tabindex=0><code>$ rsync foo.txt me@server:/home/me/
</code></pre><h3 id=复制目录>复制目录</h3><p>对于复制目录，就有了很大的分歧，这也解释了为什么 <code>rsync</code> 会被认为比 <code>scp</code> 更复杂。如果你想把 <code>bar</code> 目录复制到 <code>server</code> 服务器上，除了指定 <code>ssh</code> 信息外，相应的 <code>scp</code> 命令和 <code>cp</code> 命令一模一样。</p><pre tabindex=0><code>$ scp -r bar/ me@server:/home/me/
</code></pre><p>对于 <code>rsync</code>，考虑的因素比较多，因为它是一个比较强大的工具。首先，我们来看一下最简单的形式：</p><pre tabindex=0><code>$ rsync -r bar/ me@server:/home/me/
</code></pre><p>看起来很简单吧？对于只包含目录和普通文件的简单情况，这就可以了。然而，<code>rsync</code> 更在意发送与主机系统中一模一样的文件。让我们来创建一个稍微复杂一些，但并不罕见的例子：</p><pre tabindex=0><code># 创建多级目录结构
$ mkdir -p bar/baz
# 在其根目录下创建文件
$ touch bar/foo.txt
# 现在创建一个符号链接指回到该文件
$ cd bar/baz
$ ln -s ../foo.txt link.txt
# 返回原位置
$ cd -
</code></pre><p>现在我们有了一个如下的目录树：</p><pre tabindex=0><code>bar
├── baz
│   └── link.txt -&gt; ../foo.txt
└── foo.txt

1 directory, 2 files
</code></pre><p>如果我们尝试上面的命令来复制 <code>bar</code>，我们会注意到非常不同的（并令人惊讶的）结果。首先，我们来试试 <code>scp</code>：</p><pre tabindex=0><code>$ scp -r bar/ me@server:/home/me/
</code></pre><p>如果你 <code>ssh</code> 进入你的服务器，看看 <code>bar</code> 的目录树，你会发现它和你的主机系统有一个重要而微妙的区别：</p><pre tabindex=0><code>bar
├── baz
│   └── link.txt
└── foo.txt

1 directory, 2 files
</code></pre><p>请注意，<code>link.txt</code> 不再是一个符号链接，它现在是一个 <code>foo.txt</code> 的完整副本。如果你习惯于使用 <code>cp</code>，这可能会是令人惊讶的行为。如果你尝试使用 <code>cp -r</code> 复制 <code>bar</code> 目录，你会得到一个新的目录，里面的符号链接和 <code>bar</code> 的一样。现在如果我们尝试使用之前的 <code>rsync</code> 命令，我们会得到一个警告：</p><pre tabindex=0><code>$ rsync -r bar/ me@server:/home/me/
skipping non-regular file &#34;bar/baz/link.txt&#34;
</code></pre><p><code>rsync</code> 警告我们它发现了一个非常规文件，并正在跳过它。因为你没有告诉它可以复制符号链接，所以它忽略了它们。<code>rsync</code> 在手册中有一节“符号链接”，解释了所有可能的行为选项。在我们的例子中，我们需要添加 <code>-links</code> 标志：</p><pre tabindex=0><code>$ rsync -r --links bar/ me@server:/home/me/
</code></pre><p>在远程服务器上，我们看到这个符号链接是作为一个符号链接复制过来的。请注意，这与 <code>scp</code> 复制符号链接的方式不同。</p><pre tabindex=0><code>bar/
├── baz
│   └── link.txt -&gt; ../foo.txt
└── foo.txt

1 directory, 2 files
</code></pre><p>为了省去一些打字工作，并利用更多的文件保护选项，在复制目录时可以使用归档标志 <code>-archive</code>（简称 <code>-a</code>）。该归档标志将做大多数人所期望的事情，因为它可以实现递归复制、符号链接复制和许多其他选项。</p><pre tabindex=0><code>$ rsync -a bar/ me@server:/home/me/
</code></pre><p>如果你感兴趣的话，<code>rsync</code> 手册页有关于存档标志的深入解释。</p><h3 id=注意事项>注意事项</h3><p>不过，使用 <code>rsync</code> 有一个注意事项。使用 <code>scp</code> 比使用 <code>rsync</code> 更容易指定一个非标准的 ssh 端口。例如，如果 <code>server</code> 使用 8022 端口的 SSH 连接，那么这些命令就会像这样：</p><pre tabindex=0><code>$ scp -P 8022 foo.txt me@server:/home/me/
</code></pre><p>而在使用 <code>rsync</code> 时，你必须指定要使用的“远程 shell”命令，默认是 <code>ssh</code>。你可以使用 <code>-e</code> 标志来指定。</p><pre tabindex=0><code>$ rsync -e &#39;ssh -p 8022&#39; foo.txt me@server:/home/me/
</code></pre><p><code>rsync</code> 会使用你的 <code>ssh</code> 配置；但是，如果你经常连接到这个服务器，你可以在你的 <code>~/.ssh/config</code> 文件中添加以下代码。这样你就不需要再为 <code>rsync</code> 或 <code>ssh</code> 命令指定端口了！</p><pre tabindex=0><code>Host server
    Port 8022
</code></pre><p>另外，如果你连接的每一台服务器都在同一个非标准端口上运行，你还可以配置 <code>RSYNC_RSH</code> 环境变量。</p><h3 id=为什么你还是应该切换到-rsync>为什么你还是应该切换到 rsync？</h3><p>现在我们已经介绍了从 <code>scp</code> 切换到 <code>rsync</code> 的日常使用案例和注意事项，让我们花一些时间来探讨一下为什么你可能想要使用 <code>rsync</code> 的优点。很多人在很久以前就已经开始使用 <code>rsync</code> 了，就是因为这些优点。</p><h4 id=即时压缩>即时压缩</h4><p>如果你和服务器之间的网络连接速度较慢或有限，<code>rsync</code> 可以花费更多的 CPU 处理能力来节省网络带宽。它通过在发送数据之前对数据进行即时压缩来实现。压缩可以用 <code>-z</code> 标志来启用。</p><h4 id=差量传输>差量传输</h4><p><code>rsync</code> 也只在目标文件与源文件不同的情况下复制文件。这可以在目录中递归地工作。例如，如果你拿我们上面的最后一个 <code>bar</code> 的例子，并多次重新运行那个 <code>rsync</code> 命令，那么在最初的传输之后就不会有任何传输。如果你知道你会重复使用这些命令，例如备份到 U 盘，那么使用 <code>rsync</code> 即使是进行本地复制也是值得的，因为这个功能可以节省处理大型数据集的大量的时间。</p><h4 id=同步>同步</h4><p>顾名思义，<code>rsync</code> 可以做的不仅仅是复制数据。到目前为止，我们只演示了如何使用 <code>rsync</code> 复制文件。如果你想让 <code>rsync</code> 把目标目录变成源目录的样子，你可以在 <code>rsync</code> 中添加删除标志 <code>-delete</code>。这个删除标志使得 <code>rsync</code> 将从源目录中复制不存在于目标目录中的文件，然后它将删除目标目录中不存在于源目录中的文件。结果就是目标目录和源目录完全一样。相比之下，<code>scp</code> 只会在目标目录下添加文件。</p><h3 id=结论>结论</h3><p>对于简单的使用情况，<code>rsync</code> 并不比老牌的 <code>scp</code> 工具复杂多少。唯一显著的区别是在递归复制目录时使用 <code>-a</code> 而不是 <code>-r</code>。然而，正如我们看到的，<code>rsync</code> 的 <code>-a</code> 标志比 <code>scp</code> 的 <code>-r</code> 标志更像 <code>cp</code> 的 <code>-r</code> 标志。</p><p>希望通过这些新命令，你可以加快你的文件传输工作流程。</p><hr><p>via: <a href=https://fedoramagazine.org/scp-users-migration-guide-to-rsync/>https://fedoramagazine.org/scp-users-migration-guide-to-rsync/</a></p><p>作者：<a href=https://fedoramagazine.org/author/chasinglogic/>chasinglogic</a> 选题：<a href=https://github.com/lujun9972>lujun9972</a> 译者：<a href=https://github.com/wxy>wxy</a> 校对：<a href=https://github.com/wxy>wxy</a></p><p>本文由 <a href=https://github.com/LCTT/TranslateProject>LCTT</a> 原创编译，<a href=https://linux.cn/>Linux中国</a> 荣誉推出</p></div><footer class=post__footer><div class="post__tags tags clearfix"><svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5.0 11V3C0 1.5.8.8.8.8S1.5.0 3 0h8c1.5.0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 100-6 3 3 0 000 6z"/></svg><ul class=tags__list><li class=tags__item><a class="tags__link btn" href=/tags/rsync/ rel=tag>rsync</a></li><li class=tags__item><a class="tags__link btn" href=/tags/scp/ rel=tag>scp</a></li></ul></div></footer></article></main></div></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2025 Linux.cn Archive.
<span class=footer__copyright-credits>Generated with <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> and <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a> theme.</span></div></div></footer></div><script async defer src=/js/menu.js></script></body></html>