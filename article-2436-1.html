<!doctype html><html class=no-js lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Linux下Nagios的安装与配置 - Linux.cn Archive</title>
<script>(function(e,t){e[t]=e[t].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content><meta property="og:title" content="Linux下Nagios的安装与配置"><meta property="og:description" content="Nagios是企业普遍使用的最具影响力的网络信息监视系统之一，它可以动态监视指定的网络状态，并在状态异常时发出警告音或邮件报警通知运维人员。监控的类型和警报定时器是完全可定制的。
Nagios的另一强大功能是它能 &mldr;
"><meta property="og:type" content="article"><meta property="og:url" content="/article-2436-1.html"><meta property="article:section" content="posts"><meta property="article:published_time" content="2014-01-03T10:08:00+00:00"><meta property="article:modified_time" content="2014-01-03T10:08:00+00:00"><meta itemprop=name content="Linux下Nagios的安装与配置"><meta itemprop=description content="Nagios是企业普遍使用的最具影响力的网络信息监视系统之一，它可以动态监视指定的网络状态，并在状态异常时发出警告音或邮件报警通知运维人员。监控的类型和警报定时器是完全可定制的。
Nagios的另一强大功能是它能 &mldr;
"><meta itemprop=datePublished content="2014-01-03T10:08:00+00:00"><meta itemprop=dateModified content="2014-01-03T10:08:00+00:00"><meta itemprop=wordCount content="559"><meta itemprop=keywords content="Nagios,"><link rel=preconnect href=https://fonts.bunny.net crossorigin><link rel=dns-prefetch href=//fonts.bunny.net><link rel=dns-prefetch href=//fonts.bunny.net><link rel=stylesheet href="https://fonts.bunny.net/css?family=Open+Sans:400,400i,700"><link rel=stylesheet href=/css/style.css><link rel="shortcut icon" href=/favicon.ico></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class=logo><a class=logo__link href=/ title="Linux.cn Archive" rel=home><div class="logo__item logo__text"><div class=logo__title>Linux.cn Archive</div></div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>Menu</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/><span class=menu__text>Home</span></a></li><li class=menu__item><a class=menu__link href=/categories/><span class=menu__text>Categories</span></a></li><li class=menu__item><a class=menu__link href=/tags/><span class=menu__text>Tags</span></a></li><li class=menu__item><a class=menu__link href><span class=menu__text>RSS</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>Linux下Nagios的安装与配置</h1><div class="post__meta meta"><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class=meta__text datetime=2014-01-03T10:08:00Z>January 03, 2014</time></div></div></header><div class="content post__content clearfix"><p><a href=http://www.nagios.org/>Nagios</a>是企业普遍使用的最具影响力的网络信息监视系统之一，它可以动态监视指定的网络状态，并在状态异常时发出警告音或邮件报警通知运维人员。监控的类型和警报定时器是完全可定制的。</p><p>Nagios的另一强大功能是它能同时监测主机和服务。例如，它可以同时监测到IP地址和TCP/UDP端口号。为进一步阐述此功能，我们假定有台需要监测的web服务器，Nagios可运用在服务器上基于IP/服务器名运行ping命令的方法检测服务器是否在线，同时当服务器的RTT（往返时延）增加时，Nagios会随时告警。另外，Nagios还能检测TCP的80端口(web服务器)是否可达，比如可能出现服务器在线但Apache/IIS没有响应的情况。</p><p>而基于Nagios的第三方监测工具如<a href=http://www.centreon.com/>Centreon</a>, <a href=http://www.fullyautomatednagios.org/>FAN</a> , <a href=http://www.op5.com/>op5 Monitor</a> 在界面设计，自动化运行和技术支持方面在独立的Nagios引擎基础上提供了相应的补充。</p><p>本段教程将展示<strong>Linux下Nagios的安装与配置</strong>.</p><h2 id=debian或ubuntu下nagios的安装>Debian或Ubuntu下Nagios的安装</h2><p>Debian系统用户使用apt-get命令就可安装Nagios:</p><pre tabindex=0><code>root@mrtg:~# apt-get install nagios3 
</code></pre><p>Nagios安装过程中可以设置邮件服务器，安装后也可以进行自定义设置。</p><p>提示：为使Nagios可正常发送邮件通知，需正确配置SMTP。</p><p><a href=http://www.flickr.com/photos/xmodulo/11198373625/><img src=/data/attachment/album/201412/19/230011zdhdfsbhk5kifahb.jpg alt></a></p><p>可以看到Nagios支持多种邮件传送方式。最常见的莫过于服务器（Internet Site）直接向接收者发送邮件，另一种常见的形式是用智能主机或中继服务器，将邮件传送至中继邮件服务器，然后它负责将邮件传送给接收者。</p><p>进行下一步操作时服务器的域名需要包含进去。</p><p><a href=http://www.flickr.com/photos/xmodulo/11198394746/><img src=/data/attachment/album/201412/19/230014g21uht8mmrt1powr.jpg alt></a></p><p>最后，设置一下Nagios管理员‘nagiosadmin’的密码，用户可以之后自行修改密码。</p><p><a href=http://www.flickr.com/photos/xmodulo/11198378964/><img src=/data/attachment/album/201412/19/230016i4r4zj4a0zveynfn.jpg alt></a></p><h2 id=centos或rhel下nagios的安装>CentOS或RHEL下Nagios的安装</h2><p>使用yum命令来安装，<a href=http://xmodulo.com/2013/01/how-to-set-up-rpmforge-repoforge-repository-on-centos.html>建立repoforge库</a>之后运行如下yum命令:</p><pre tabindex=0><code>[root@mrtg ~]# yum install nagios nagios-plugins
</code></pre><h2 id=监测需求>监测需求</h2><p>本段教程中，我们希望完成以下监测内容：</p><ol><li>每三分钟监测一次所有Linux服务器。</li><li>每三分钟监测一次所有思科路由器。</li><li>所有的邮件告警集中发送至<a href=mailto:sentinel@example.tst>sentinel@example.tst</a>。</li><li>发出告警前Nagios都将进行3次验证以确保问题确有发生。</li><li>当设备的往返时延超过100ms并且/或包丢失量超过20%将发出邮件告警。</li></ol><p>余下的教程将指导您如何在Linux系统中配置Nagios。</p><h2 id=ubuntu下nagios的配置>Ubuntu下Nagios的配置</h2><p>明确Nagios配置文件的地址至关重要，以下路径指明了Debian系统下Nagios的配置文件地址。</p><pre tabindex=0><code>/etc/nagios-plugins     实现监测功能的专有脚本存放地址
/etc/nagios3    添加主机、服务，定义检测和定时器的配置文件
/usr/lib/nagios/plugins     用于监测的可执行文件
</code></pre><p>接下来的步骤相互关联，由此开始定义主机，主机组及向主机组添加服务操作。</p><h3 id=添加主机模板>添加主机模板</h3><p>我们对同一类型的主机定义了对应的模板，这里使用安装文件作举例说明。</p><p>首先，为Linux设备定义主机模板。</p><pre tabindex=0><code>root@mrtg:~# cd /etc/nagios3/conf.d
root@mrtg:/etc/nagios3/conf.d/# cp generic-host_nagios2.cfg linux-server.cfg 
</code></pre><p>如下编辑linux-server.cfg。需要修改部分已经标出。</p><pre tabindex=0><code>root@mrtg:/etc/nagios3/conf.d/# vim linux-server.cfg    
</code></pre><ul><li></li></ul><pre tabindex=0><code>define host{
name                        linux-server    ; 名称，需修改
notifications_enabled       1   
event_handler_enabled       1   
flap_detection_enabled      1   
failure_prediction_enabled  1   
process_perf_data           1   
retain_status_information   1   
retain_nonstatus_information    1 
check_command               example-host-check  ; 检查所用脚本，需修改
check_interval              3       ; 连续检查的间隔，需修改
max_check_attempts          3       ; 产生邮件告警前的自检次数，需修改
notification_interval       0
notification_period 24x7
notification_options        d,u,r
contact_groups              admins  ; 邮件将要发送至的组，需修改
register0
}
</code></pre><p>接下来，为Cisco设备定义主机模板。</p><pre tabindex=0><code>root@mrtg:/etc/nagios3/conf.d/# cp linux-server.cfg cisco-device.cfg 
</code></pre><p>如下修改cisco-device.cfg。需要修改部分已经标出。</p><pre tabindex=0><code>root@mrtg:/etc/nagios3/conf.d/# vim cisco-device.cfg 
</code></pre><ul><li></li></ul><pre tabindex=0><code>define host{
name                        cisco-device    ；名称，需修改
notifications_enabled       1   
event_handler_enabled       1   
flap_detection_enabled      1   
failure_prediction_enabled  1   
process_perf_data           1   
retain_status_information   1   
retain_nonstatus_information    1 
check_command               example-host-check  ; 检查时使用的脚本，需修改
check_interval              3   ; 连续检查间隔，需修改
max_check_attempts          3   ; 产生邮件告警前的自检次数，需修改
notification_interval       0
notification_period         24x7            
notification_options        d,u,r
contact_groups              admins  ; 邮件将要发至的组，需修改
register                    0       
}
</code></pre><h3 id=添加主机>添加主机</h3><p>现在已定义主机模板，就可以添加需要监测的主机。以默认的文件作例子展示如下内容。</p><pre tabindex=0><code>root@mrtg:/etc/nagios3/conf.d/# cp localhost_nagios2.cfg example.cfg
root@mrtg:/etc/nagios3/conf.d/# vim example.cfg 
</code></pre><ul><li></li></ul><pre tabindex=0><code># Host 1
define host{
use                     linux-server    ; 使用的主机模板名
host_name               our-server      ; nagios使用的主机名
alias                   our-server
address                 172.17.1.23     ; 主机的IP地址
}

# Host 2
define host{
use                     cisco-device    ; 使用的主机模板名
host_name               our-router      ; nagios使用的主机名
alias                   our-router
address                 172.17.1.1      ; 主机的IP地址
}
</code></pre><h3 id=主机组定义>主机组定义</h3><p>当有多个主机时，为方便管理，建议将相似的主机组成一组。</p><pre tabindex=0><code>root@mrtg:/etc/nagios3/conf.d/# vim hostgroups_nagios2.cfg 
</code></pre><ul><li></li></ul><pre tabindex=0><code>define hostgroup {
hostgroup_name  linux-server    ; 主机组名
alias           Linux Servers
members         our-server      ; 组员列表
}

define hostgroup {
hostgroup_name  cisco-device    ; 主机组名
alias           Cisco Devices
members         our-server      ; comma separated list of members
}
</code></pre><h3 id=定义服务>定义服务</h3><p>首先，定义一个服务example-host-check：当往返时延达到100ms预警值并且有20%包丢失时发出警告，而紧急告警设置为5000ms且包丢失比率为100%，只执行一个IPv4的ping请求检测。</p><pre tabindex=0><code>root@mrtg:~# vim /etc/nagios-plugins/config/ping.cfg 
</code></pre><ul><li></li></ul><pre tabindex=0><code>define command{
      command_name    example-host-check
      command_line    /usr/lib/nagios/plugins/check_ping -H &#39;$HOSTADDRESS$&#39; -w 100,20% -c 5000,100% -p 1 -4
}
</code></pre><p>然后，将命令关联至主机组。</p><pre tabindex=0><code>root@mrtg:/etc/nagios3/conf.d/# vim services_nagios2.cfg 
</code></pre><ul><li></li></ul><pre tabindex=0><code>define service {
hostgroup_name            linux-server
service_description       Linux Servers
check_command             example-host-check
use                       generic-service
notification_interval     0 ; 初始化设置为0
}

define service {
hostgroup_name            cisco-device
service_description       Cisco Devices
check_command             example-host-check
use                       generic-service
notification_interval     0 ; 初始化设置为0
}
</code></pre><h3 id=联系人定义>联系人定义</h3><p>进行如下定义将发送邮件需要的地址添加至Nagios。</p><pre tabindex=0><code>root@mrtg:/etc/nagios3/conf.d/# vim contacts.cfg
</code></pre><ul><li></li></ul><pre tabindex=0><code>define contact{
contact_name                    root
alias                           Root
service_notification_period     24x7
host_notification_period        24x7
service_notification_options    w,u,c,r
host_notification_options       d,r
service_notification_commands   notify-service-by-email
host_notification_commands      notify-host-by-email
email                           root@localhost, sentinel@example.tst
}
</code></pre><p>最后，试运行初始化检测是否有配置错误。如果没有错误，Nagios开始安全运行。</p><pre tabindex=0><code>root@mrtg:~# nagios -v /etc/nagios3/nagios.cfg
root@mrtg:~# service nagios3 restart 
</code></pre><h2 id=centosrhel上的nagios配置>CentOS/RHEL上的Nagios配置</h2><p>Redhat系统中Nagios的配置文件地址如下所示。</p><pre tabindex=0><code>/etc/nagios/objects     添加主机、服务，定义监测和定时器的配置文件

/usr/lib/nagios/plugins     实现监测的可执行文件
</code></pre><h3 id=添加主机模板-1>添加主机模板</h3><p>为特定类型的主机创建所需的模板，相应修改安装所需的文件。</p><pre tabindex=0><code>[root@mrtg objects]# cd /etc/nagios/objects/
[root@mrtg objects]# vim templates.cfg 
</code></pre><ul><li></li></ul><pre tabindex=0><code> define host{
 name                   linux-server    
 use                    generic-host    
 check_period           24x7      
 check_interval         3
 retry_interval         1
 max_check_attempts     3
 check_command          example-host-check
 notification_period    24x7
 notification_interval  0
 notification_options   d,u,r
 contact_groups         admins
 register               0
 }

 define host{
 name                   cisco-router    
 use                    generic-host    
 check_period           24x7      
 check_interval         3
 retry_interval         1
 max_check_attempts     3
 check_command          example-host-check
 notification_period    24x7
 notification_interval  0
 notification_options   d,u,r
 contact_groups         admins
 register               0
 }
</code></pre><h3 id=添加主机和主机组>添加主机和主机组</h3><p>这里以默认的配置文件为例，主机和主机组添加至配置文件中。</p><pre tabindex=0><code>[root@mrtg objects]# cp localhost.cfg example.cfg
[root@mrtg objects]# vim example.cfg 
</code></pre><ul><li></li></ul><pre tabindex=0><code>#Adding Linux server
define host{
use         linux-server
host_name   our-server
alias       our-server
address     172.17.1.23
}

#Adding Cisco Router
define host{
use         cisco-router
host_name   our-router
alias       our-router
address     172.17.1.1
}

# HOST GROUP DEFINITION
define hostgroup{
hostgroup_name  linux-servers
alias           Linux Servers
members         our-server
}

define hostgroup{
hostgroup_name  cisco-router
alias           cisco-router
members         our-router
}
</code></pre><h3 id=服务定义>服务定义</h3><p>定义一个服务example-host-check：当往返时延达到100ms预警值并且有20%包丢失时发出警告，而紧急告警设置为5000ms且包丢失比率为100%，只执行一个IPv4的ping请求检测。</p><pre tabindex=0><code>[root@mrtg objects]# vim commands.cfg 
</code></pre><ul><li></li></ul><pre tabindex=0><code>define command{
command_name    example-host-check
command_line    $USER1$/check_ping -H $HOSTADDRESS$ -w 100.0,20% -c 5000.0,100% -p 1 -4
}
</code></pre><h3 id=联系人定义-1>联系人定义</h3><p>告警要发送的邮件地址添加至Nagios中。</p><pre tabindex=0><code>[root@objects objects]# vim contacts.cfg 
</code></pre><ul><li></li></ul><pre tabindex=0><code>define contact{
contact_name    nagiosadmin       
use             generic-contact
alias           Nagios Admin
email           nagios@localhost, sentinel@example.tst
}
</code></pre><p>最后，准备启动Nagios服务，可先试运行检测配置是否出错。</p><pre tabindex=0><code>[root@mrtg ~]# nagios –v /etc/nagios/nagios.cfg
[root@mrtg ~]# service nagios restart
[root@mrtg ~]# chkconfig nagios on 
</code></pre><h3 id=配置后访问nagios>配置后访问Nagios</h3><p>现在一切就绪，可以开始Nagios之旅了。Ubuntu/Debian用户可以通过打开 http://IP地址/nagios3 网页访问Nagios，CentOS/RHEL用户可以打开 http://IP地址/nagios ，如 <a href=http://172.17.1.23/nagios3>http://172.17.1.23/nagios3</a> 来访问Nagios。“nagiosadmin”用户则需要认证来访问页面。</p><p><a href=http://www.flickr.com/photos/xmodulo/11198394806/><img src=/data/attachment/album/201412/19/230018v737jjjmiccc3ems.jpg alt></a></p><p>若Nagios没有依原设定运行，首先要做的是建立一个测试运行（dry run）。</p><p>Debian或Ubuntu系统：</p><pre tabindex=0><code># nagios3 -v /etc/nagios3/nagios.cfg
</code></pre><p>CentOS或RHEL系统：</p><pre tabindex=0><code># nagios -v /etc/nagios/nagios.cfg
</code></pre><p>日志文件也会提供重要线索,若需查看可以转至路径/var/log/nagios/nagios.log。</p><p>希望本文有所帮助。</p><hr><p>via: <a href=http://xmodulo.com/2013/12/install-configure-nagios-linux.html>http://xmodulo.com/2013/12/install-configure-nagios-linux.html</a></p><p>译者：<a href=https://github.com/icybreaker>icybreaker</a> 校对：<a href=https://github.com/wxy>wxy</a></p><p>本文由 <a href=https://github.com/LCTT/TranslateProject>LCTT</a> 原创翻译，<a href=http://linux.cn/>Linux中国</a> 荣誉推出</p></div><footer class=post__footer><div class="post__tags tags clearfix"><svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5.0 11V3C0 1.5.8.8.8.8S1.5.0 3 0h8c1.5.0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 100-6 3 3 0 000 6z"/></svg><ul class=tags__list><li class=tags__item><a class="tags__link btn" href=/tags/nagios/ rel=tag>Nagios</a></li></ul></div></footer></article></main></div></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2025 Linux.cn Archive.
<span class=footer__copyright-credits>Generated with <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> and <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a> theme.</span></div></div></footer></div><script async defer src=/js/menu.js></script></body></html>