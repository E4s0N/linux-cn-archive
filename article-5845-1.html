<!doctype html><html class=no-js lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>如何在 Fedora 22 上面配置 Apache 的 Docker 容器 - Linux.cn Archive</title>
<script>(function(e,t){e[t]=e[t].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content><meta property="og:title" content="如何在 Fedora 22 上面配置 Apache 的 Docker 容器"><meta property="og:description" content="在这篇文章中，我们将会学习关于Docker的一些知识，如何使用Docker部署Apache httpd服务，并且共享到Docker Hub上面去。首先，我们学习怎样拉取和使用Docker Hub里面的镜像，然后在一个Fedora 22的镜像上交互式地安装Apache，之后我们将会学习如何用一个Dockerfile文件来以一种更快，更优雅的方式制作一个镜像。最后，我们将我们创建的镜像发布到Docker Hub上，这样以后任何人都可以下载并使用它。  安装并初体验Docker 要求 运行Docker，你至少需要满足这些：  你需要一个64位的内核，版本3.10或者更高 Iptables 1.4 - Docker会用它来做"><meta property="og:type" content="article"><meta property="og:url" content="/article-5845-1.html"><meta property="article:section" content="posts"><meta property="article:published_time" content="2015-07-19T10:13:00+00:00"><meta property="article:modified_time" content="2015-07-19T10:13:00+00:00"><meta itemprop=name content="如何在 Fedora 22 上面配置 Apache 的 Docker 容器"><meta itemprop=description content="在这篇文章中，我们将会学习关于Docker的一些知识，如何使用Docker部署Apache httpd服务，并且共享到Docker Hub上面去。首先，我们学习怎样拉取和使用Docker Hub里面的镜像，然后在一个Fedora 22的镜像上交互式地安装Apache，之后我们将会学习如何用一个Dockerfile文件来以一种更快，更优雅的方式制作一个镜像。最后，我们将我们创建的镜像发布到Docker Hub上，这样以后任何人都可以下载并使用它。  安装并初体验Docker 要求 运行Docker，你至少需要满足这些：  你需要一个64位的内核，版本3.10或者更高 Iptables 1.4 - Docker会用它来做"><meta itemprop=datePublished content="2015-07-19T10:13:00+00:00"><meta itemprop=dateModified content="2015-07-19T10:13:00+00:00"><meta itemprop=wordCount content="403"><meta itemprop=keywords content="Docker,Apache,镜像,"><link rel=preconnect href=https://fonts.bunny.net crossorigin><link rel=dns-prefetch href=//fonts.bunny.net><link rel=dns-prefetch href=//fonts.bunny.net><link rel=stylesheet href="https://fonts.bunny.net/css?family=Open+Sans:400,400i,700"><link rel=stylesheet href=/css/style.css><link rel="shortcut icon" href=/favicon.ico></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class=logo><a class=logo__link href=/ title="Linux.cn Archive" rel=home><div class="logo__item logo__text"><div class=logo__title>Linux.cn Archive</div></div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>Menu</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/><span class=menu__text>Home</span></a></li><li class=menu__item><a class=menu__link href=/categories/><span class=menu__text>Categories</span></a></li><li class=menu__item><a class=menu__link href=/tags/><span class=menu__text>Tags</span></a></li><li class=menu__item><a class=menu__link href><span class=menu__text>RSS</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>如何在 Fedora 22 上面配置 Apache 的 Docker 容器</h1><div class="post__meta meta"><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class=meta__text datetime=2015-07-19T10:13:00Z>July 19, 2015</time></div></div></header><div class="content post__content clearfix"><p>在这篇文章中，我们将会学习关于Docker的一些知识，如何使用Docker部署Apache httpd服务，并且共享到Docker Hub上面去。首先，我们学习怎样拉取和使用Docker Hub里面的镜像，然后在一个Fedora 22的镜像上交互式地安装Apache，之后我们将会学习如何用一个Dockerfile文件来以一种更快，更优雅的方式制作一个镜像。最后，我们将我们创建的镜像发布到Docker Hub上，这样以后任何人都可以下载并使用它。</p><p><img src=/data/attachment/album/201507/18/222135wkezye1y1o5zhhia.jpg alt></p><h3 id=安装并初体验docker>安装并初体验Docker</h3><p><strong>要求</strong></p><p>运行Docker，你至少需要满足这些：</p><ul><li>你需要一个64位的内核，版本3.10或者更高</li><li>Iptables 1.4 - Docker会用它来做网络配置，如网络地址转换（NAT）</li><li>Git 1.7 - Docker会使用Git来与仓库交流，如Docker Hub</li><li>ps - 在大多数环境中这个工具都存在，在procps包里有提供</li><li>root - 尽管一般用户可以通过TCP或者其他方式来运行Docker，但是为了简化，我们会假定你就是root</li></ul><h4 id=使用dnf安装docker>使用dnf安装docker</h4><p>以下的命令会安装Docker</p><pre tabindex=0><code>dnf update &amp;&amp; dnf install docker
</code></pre><p><strong>注意</strong>：在Fedora 22里，你仍然可以使用Yum命令，但是它被DNF取代了，而且在纯净安装时不可用了。</p><h4 id=检查安装>检查安装</h4><p>我们将要使用的第一个命令是docker info，这会输出很多信息给你：</p><pre tabindex=0><code>docker info
</code></pre><p>也可以试着用<strong>docker version</strong>：</p><pre tabindex=0><code>docker version
</code></pre><h4 id=以守护进程方式启动dcoker>以守护进程方式启动Dcoker</h4><p>你应该启动一个docker实例，然后她会处理我们的请求。</p><pre tabindex=0><code>docker -d
</code></pre><p>现在我们设置 docker 随系统启动，以便我们不需要每次重启都需要运行上述命令。</p><pre tabindex=0><code>chkconfig docker on
</code></pre><p>让我们用Busybox来打印hello world：</p><pre tabindex=0><code>dockr run -t busybox /bin/echo &#34;hello world&#34;
</code></pre><p>这个命令里，我们告诉Docker在Busybox镜像的一个实例/容器里执行 /bin/echo &ldquo;hello world&rdquo;。Busybox是一个小型的POSIX环境，将许多小工具都结合到了一个单独的可执行程序里。</p><p>如果Docker不能在你的系统里找到本地的Busybox镜像，她就会自动从Docker Hub里拉取镜像，正如你可以看下如下的快照：</p><p><img src=/data/attachment/album/201507/18/222140i55kyke5p9ph5pk2.png alt="Hello world with Busybox"></p><p><em>Hello world with Busybox</em></p><p>再次尝试相同的命令，这次由于Docker已经有了本地的Busybox镜像，你将会看到的全部就是echo的输出：</p><pre tabindex=0><code>docker run -t busybox /bin/echo &#34;hello world&#34;
</code></pre><p>也可以尝试以下的命令进入到容器环境里去：</p><pre tabindex=0><code>docker run -it busybox /bin/sh
</code></pre><p>使用<strong>exit</strong>命令可以离开容器并停止它</p><h3 id=交互式地docker化apache>交互式地Docker化Apache</h3><p>拉取/下载 Fedora 镜像：</p><pre tabindex=0><code>docker pull fedora:22
</code></pre><p>启动一个容器在后台运行：</p><pre tabindex=0><code>docker run -d -t fedora:22 /bin/bash
</code></pre><p>列出正在运行地容器及其名字标识，如下</p><pre tabindex=0><code>docker ps
</code></pre><p><img src=/data/attachment/album/201507/18/222141ym3qoi88ib0qlk6x.png alt="listing with docker ps and attaching with docker attach"></p><p><em>使用docker ps列出，并使用docker attach进入一个容器里</em></p><p>angry_noble是docker分配给我们容器的名字，所以我们来连接上去：</p><pre tabindex=0><code>docker attach angry_noble
</code></pre><p>注意：每次你启动一个容器，就会被给与一个新的名字，如果你的容器需要一个固定的名字，你应该在 docker run 命令里使用 -name 参数。</p><h4 id=安装apache>安装Apache</h4><p>下面的命令会更新DNF的数据库，下载安装Apache（httpd包）并清理dnf缓存使镜像尽量小</p><pre tabindex=0><code>dnf -y update &amp;&amp; dnf -y install httpd &amp;&amp; dnf -y clean all
</code></pre><p><strong>配置Apache</strong></p><p>我们需要修改httpd.conf的唯一地方就是ServerName，这会使Apache停止抱怨</p><pre tabindex=0><code>sed -i.orig &#39;s/#ServerName/ServerName/&#39; /etc/httpd/conf/httpd.conf
</code></pre><p><strong>设定环境</strong></p><p>为了使Apache运行为独立模式，你必须以环境变量的格式提供一些信息，并且你也需要创建这些变量里的目录，所以我们将会用一个小的shell脚本干这个工作，当然也会启动Apache</p><pre tabindex=0><code>vi /etc/httpd/run_apache_foreground
</code></pre><hr><pre tabindex=0><code>#!/bin/bash

#设置环境变量
APACHE_LOG_DI=R&#34;/var/log/httpd&#34;
APACHE_LOCK_DIR=&#34;/var/lock/httpd&#34;
APACHE_RUN_USER=&#34;apache&#34;
APACHE_RUN_GROUP=&#34;apache&#34;
APACHE_PID_FILE=&#34;/var/run/httpd/httpd.pid&#34;
APACHE_RUN_DIR=&#34;/var/run/httpd&#34;

#如果需要的话，创建目录
if ! [ -d /var/run/httpd ]; then mkdir /var/run/httpd;fi
if ! [ -d /var/log/httpd ]; then mkdir /var/log/httpd;fi
if ! [ -d /var/lock/httpd ]; then mkdir /var/lock/httpd;fi

#运行 Apache
httpd -D FOREGROUND
</code></pre><p><strong>另外地</strong>，你可以粘贴这个片段代码到容器shell里并运行:</p><pre tabindex=0><code>dnf -y install git &amp;&amp; git clone https://github.com/gaiada/run-apache-foreground.git &amp;&amp; cd run-apach* &amp;&amp; ./install &amp;&amp; dnf erase git
</code></pre><p>上面的内嵌脚本会安装Git，克隆<a href=https://github.com/gaiada/run-apache-foreground>这个仓库</a>，到文件里去运行脚本，并询问你是否卸载Git。</p><p><strong>保存你的容器状态</strong></p><p>你的容器现在准备好运行Apache，是时候保存容器当前的状态为一个镜像，以备你需要的时候使用。</p><p>为了离开容器环境，你必须顺序按下 <strong>Ctrl+q</strong> 和 <strong>Ctrl+p</strong>，如果你仅仅在shell执行exit，你同时也会停止容器，失去目前为止你做过的所有工作。</p><p>回到Docker主机，使用 <strong>docker commit</strong> 及容器名和你想要的仓库名字/标签：</p><pre tabindex=0><code>docker commit angry_noble gaiada/apache
</code></pre><p>现在，你保存了容器的状态到一个镜像里，可以使用 <strong>docker stop</strong> 停止容器了：</p><pre tabindex=0><code>docker stop angry_noble
</code></pre><p><strong>运行并测试你的镜像</strong></p><p>最后，从你的新镜像启动一个容器，并且重定向80端口到该容器：</p><pre tabindex=0><code>docker run -p 80:80 -d -t gaiada/apache /etc/httpd/run_apache_foreground
</code></pre><p>到目前，你正在你的容器里运行Apache，打开你的浏览器访问该服务，在<a href=http://localhost/>http://localhost</a>，你将会看到如下Apache默认的页面</p><p><img src=/data/attachment/album/201507/18/222142v25gpwhznvv0pl37.png alt="Apache default page running from Docker container"></p><p><em>在容器里运行的Apache默认页面</em></p><h3 id=使用dockerfile-docker化apache>使用Dockerfile Docker化Apache</h3><p>现在，我们将要去创建一个新的Apache镜像，这次所有步骤会写在一个Dockerfile文件里，文件将会被用于生成该镜像。</p><p>首先，新建一个目录，在里面放Dockerfile文件，并进入该目录：</p><pre tabindex=0><code>mkdir apachedf; cd apachedf
</code></pre><p>然后创建一个名为Dockerfile的文件，添加以下内容：</p><pre tabindex=0><code>FROM fedora:22

MAINTAINER Carlos Alberto
LABEL version=&#34;0.1&#34;

RUN dnf -y update &amp;&amp; dnf -y install httpd &amp;&amp; dnf -y clean all

RUN [ -d /var/log/httpd ] || mkdir /var/log/httpd
RUN [ -d /var/run/httpd ] || mkdir /var/run/httpd
RUN [ -d /var/lock/httpd ] || mkdir /var/lock/httpd

RUN sed -i.orig &#39;s/#ServerName/ServerName/&#39; /etc/httpd/conf/httpd.conf

ENV APACHE_RUN_USER apache
ENV APACHE_RUN_GROUP apache
ENV APACHE_LOG_DIR /var/log/httpd
ENV APACHE_LOCK_DIR /var/lock/httpd
ENV APACHE_RUN_DIR /var/run/httpd
ENV APACHE_PID_FILE /var/run/httpd/httpd.pid

EXPOSE 80

CMD [&#34;/usr/sbin/httpd&#34;, &#34;-D&#34;, &#34;FOREGROUND&#34;]
</code></pre><p>我们一起来看看Dockerfile里面有什么：</p><ul><li><strong>FROM</strong> - 这告诉docker，我们将要使用Fedora 22作为基础镜像</li><li><strong>MAINTAINER</strong> 和 <strong>LABLE</strong> - 这些命令对镜像没有直接作用，属于标记信息</li><li><strong>RUN</strong> - 自动完成我们之前交互式做的工作，安装Apache，新建目录并编辑httpd.conf</li><li><strong>ENV</strong> - 设置环境变量，现在我们再不需要run<em>apache</em>foreground脚本</li><li><strong>EXPOSE</strong> - 暴露80端口给外网</li><li><strong>CMD</strong> - 设置默认的命令启动httpd服务，这样我们就不需要每次起一个新的容器都重复这个工作</li></ul><p><strong>建立该镜像</strong></p><p>现在，我们将要建立这个镜像，并为其添加tag gaiada/apachedf</p><pre tabindex=0><code>docker build -t gaiada/apachedf:0.1 .
</code></pre><p><img src=/data/attachment/album/201507/18/222143el2g77alygcld997.png alt="docker build complete"></p><p><em>docker完成创建</em></p><p>使用 <strong>docker images</strong> 列出本地镜像，查看是否存在你新建的镜像：</p><pre tabindex=0><code>docker images
</code></pre><p>然后运行新的镜像:</p><pre tabindex=0><code>docker run -t -p 80:80 gaiada/apachedf
</code></pre><p>这就是Dockerfile的工作，使用这项功能会使得事情更加容易，快速并且可重复生成。</p><h3 id=发布你的镜像>发布你的镜像</h3><p>直到现在，你仅仅是从Docker Hub拉取了镜像，但是你也可以推送你的镜像，以后需要也可以再次拉取他们。实际上，其他人也可以下载你的镜像，在他们的系统中使用它而不需要改变任何东西。现在我们将要学习如何使我们的镜像对世界上的其他人可用。</p><p><strong>创建帐号</strong></p><p>为了能够在Docker Hub上推送你的镜像，你需要创建一个帐号。访问 <a href=https://hub.docker.com/account/signup/>https://hub.docker.com/account/signup/</a>，填写下面的表格：</p><p><img src=/data/attachment/album/201507/18/222143jf9zcj8cnc7ce1c7.png alt="Docker Hub signup page"></p><p><em>Docker Hub 注册页面</em></p><p><strong>登录</strong></p><p>输入下面的命令，接着输入你注册时提供的用户名，密码和邮箱</p><pre tabindex=0><code>docker login
</code></pre><p>第一次登录过后，你的帐号信息会被记录在 <strong>～/.dockercfg</strong></p><p><strong>推送</strong></p><p>推送镜像，使用 <strong>docker push [registry/]your<em>login/repository</em>name[:tag]</strong></p><pre tabindex=0><code>docker push docker.io/gaiada/apachedf
</code></pre><p>你可能会看见像这样的输出，在你的控制台上：</p><p><img src=/data/attachment/album/201507/18/222144sp083p0xxw0g0t2t.png alt="Docker push Apache image complete"></p><p><em>Docker推送Apache镜像完成</em></p><h3 id=结论>结论</h3><p>现在，你知道如何Docker化Apache，试一试包含其他一些组件，Perl，PHP，proxy，HTTPS，或者任何你需要的东西。我希望你们这些家伙喜欢她，并推送你们自己的镜像到Docker Hub。</p><hr><p>via: <a href=http://linoxide.com/linux-how-to/configure-apache-containers-docker-fedora-22/>http://linoxide.com/linux-how-to/configure-apache-containers-docker-fedora-22/</a></p><p>作者：<a href=http://linoxide.com/author/carlosal/>Carlos Alberto</a> 译者：<a href=https://github.com/wi-cuckoo>wi-cuckoo</a> 校对：<a href=https://github.com/wxy>wxy</a></p><p>本文由 <a href=https://github.com/LCTT/TranslateProject>LCTT</a> 原创翻译，<a href=https://linux.cn/>Linux中国</a> 荣誉推出</p></div><footer class=post__footer><div class="post__tags tags clearfix"><svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5.0 11V3C0 1.5.8.8.8.8S1.5.0 3 0h8c1.5.0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 100-6 3 3 0 000 6z"/></svg><ul class=tags__list><li class=tags__item><a class="tags__link btn" href=/tags/docker/ rel=tag>Docker</a></li><li class=tags__item><a class="tags__link btn" href=/tags/apache/ rel=tag>Apache</a></li><li class=tags__item><a class="tags__link btn" href=/tags/%E9%95%9C%E5%83%8F/ rel=tag>镜像</a></li></ul></div></footer></article></main></div></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2025 Linux.cn Archive.
<span class=footer__copyright-credits>Generated with <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> and <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a> theme.</span></div></div></footer></div><script async defer src=/js/menu.js></script></body></html>