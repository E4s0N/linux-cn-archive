<!doctype html><html class=no-js lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>给系统管理员的 15 条实用 Linux/Unix 磁带管理命令 - Linux.cn Archive</title>
<script>(function(e,t){e[t]=e[t].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content><meta property="og:title" content="给系统管理员的 15 条实用 Linux/Unix 磁带管理命令"><meta property="og:description" content="磁带设备应只用于定期的文件归档或将数据从一台服务器传送至另一台。通常磁带设备与 Unix 机器连接，用 mt 或 mtx 控制。强烈建议您将所有的数据同时备份到磁盘（也许是云中）和磁带设备中。"><meta property="og:type" content="article"><meta property="og:url" content="/article-7326-1.html"><meta property="article:section" content="posts"><meta property="article:published_time" content="2016-05-11T14:18:00+00:00"><meta property="article:modified_time" content="2016-05-11T14:18:00+00:00"><meta itemprop=name content="给系统管理员的 15 条实用 Linux/Unix 磁带管理命令"><meta itemprop=description content="磁带设备应只用于定期的文件归档或将数据从一台服务器传送至另一台。通常磁带设备与 Unix 机器连接，用 mt 或 mtx 控制。强烈建议您将所有的数据同时备份到磁盘（也许是云中）和磁带设备中。"><meta itemprop=datePublished content="2016-05-11T14:18:00+00:00"><meta itemprop=dateModified content="2016-05-11T14:18:00+00:00"><meta itemprop=wordCount content="1084"><meta itemprop=keywords content="磁带,备份,恢复,"><link rel=preconnect href=https://fonts.bunny.net crossorigin><link rel=dns-prefetch href=//fonts.bunny.net><link rel=dns-prefetch href=//fonts.bunny.net><link rel=stylesheet href="https://fonts.bunny.net/css?family=Open+Sans:400,400i,700"><link rel=stylesheet href=/css/style.css><link rel="shortcut icon" href=/favicon.ico></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class=logo><a class=logo__link href=/ title="Linux.cn Archive" rel=home><div class="logo__item logo__text"><div class=logo__title>Linux.cn Archive</div></div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>Menu</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/><span class=menu__text>Home</span></a></li><li class=menu__item><a class=menu__link href=/categories/><span class=menu__text>Categories</span></a></li><li class=menu__item><a class=menu__link href=/tags/><span class=menu__text>Tags</span></a></li><li class=menu__item><a class=menu__link href><span class=menu__text>RSS</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>给系统管理员的 15 条实用 Linux/Unix 磁带管理命令</h1><div class="post__meta meta"><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class=meta__text datetime=2016-05-11T14:18:00Z>May 11, 2016</time></div></div></header><div class="content post__content clearfix"><p>磁带设备应只用于定期的文件归档或将数据从一台服务器传送至另一台。通常磁带设备与 Unix 机器连接，用 mt 或 mtx 控制。强烈建议您将所有的数据同时备份到磁盘（也许是云中）和磁带设备中。在本教程中你将会了解到：</p><ul><li>磁带设备名</li><li>管理磁带驱动器的基本命令</li><li>基本的备份和恢复命令</li></ul><p><img src=/data/attachment/album/201605/11/082111wmjdbpeuq7sumsry.jpg alt></p><h3 id=为什么备份>为什么备份？</h3><p>一个备份计划对定期备份文件来说很有必要，如果你宁愿选择不备份，那么丢失重要数据的风险会大大增加。有了备份，你就有了从磁盘故障中恢复的能力。备份还可以帮助你抵御：</p><ul><li>意外的文件删除</li><li>文件或文件系统损坏</li><li>服务器完全毁坏，包括由于火灾或其他问题导致的同盘备份毁坏</li><li>硬盘或 SSD 崩溃</li><li>病毒或勒索软件破坏或删除文件</li></ul><p>你可以使用磁带归档备份整个服务器并将其离线存储。</p><h3 id=理解磁带文件标记和块大小>理解磁带文件标记和块大小</h3><p><img src=/data/attachment/album/201605/11/082146jvro6b7n885lc8z1.jpg alt="Fig.01: Tape file marks"></p><p><em>图01：磁带文件标记</em></p><p>每个磁带设备能存储多个备份文件。磁带备份文件通过 cpio，tar，dd 等命令创建。同时，磁带设备可以由多种程序打开、写入数据、及关闭。你可以存储若干备份（磁带文件）到一个物理磁带上。在每个磁带文件之间有个“磁带文件标记”。这用来指示一个物理磁带上磁带文件的结尾以及另一个文件的开始。你需要使用 mt 命令来定位磁带（快进，倒带和标记）。</p><h4 id=磁带上的数据是如何存储的>磁带上的数据是如何存储的</h4><p><img src=/data/attachment/album/201605/11/082146riwfqicz7cmuw3q1.jpg alt="Fig.02: How data is stored on a tape"></p><p><em>图02：磁带上的数据是如何存储的</em></p><p>所有的数据使用 tar 以连续磁带存储格式连续地存储。第一个磁带归档会从磁带的物理开始端开始存储（tar #0）。接下来的就是 tar #1，以此类推。</p><h3 id=unix-上的磁带设备名>Unix 上的磁带设备名</h3><ol><li>/dev/rmt/0 或 /dev/rmt/1 或 /dev/rmt/[0-127] ：Unix 上的常规磁带设备名。磁带自动倒回。</li><li>/dev/rmt/0n ：以无倒回为特征，换言之，磁带使用之后，停留在当前状态等待下个命令。</li><li>/dev/rmt/0b ：使用磁带接口，也就是 BSD 的行为。各种类型的操作系统比如 AIX，Windows，Linux，FreeBSD 等的行为更有可读性。</li><li>/dev/rmt/0l ：设置密度为低。</li><li>/dev/rmt/0m ：设置密度为中。</li><li>/dev/rmt/0u ：设置密度为高。</li><li>/dev/rmt/0c ：设置密度为压缩。</li><li>/dev/st[0-9] ：Linux 特定 SCSI 磁带设备名。</li><li>/dev/sa[0-9] ：FreeBSD 特定 SCSI 磁带设备名。</li><li>/dev/esa0 ：FreeBSD 特定 SCSI 磁带设备名，在关闭时弹出（如果可以的话）。</li></ol><h4 id=磁带设备名示例>磁带设备名示例</h4><ul><li>/dev/rmt/1cn 指明正在使用 unity 1，压缩密度，无倒回。</li><li>/dev/rmt/0hb 指明正在使用 unity 0，高密度，BSD 行为。</li><li>Linux 上的自动倒回 SCSI 磁带设备名：/dev/st0</li><li>Linux 上的无倒回 SCSI 磁带设备名：/dev/nst0</li><li>FreeBSD 上的自动倒回 SCSI 磁带设备名：/dev/sa0</li><li>FreeBSD 上的无倒回 SCSI 磁带设备名：/dev/nsa0</li></ul><h4 id=如何列出已安装的-scsi-磁带设备>如何列出已安装的 scsi 磁带设备？</h4><p>输入下列命令：</p><pre tabindex=0><code>### Linux（更多信息参阅 man） ###
lsscsi
lsscsi -g

### IBM AIX ###
lsdev -Cc tape
lsdev -Cc adsm
lscfg -vl rmt*

### Solaris Unix ###
cfgadm –a
cfgadm -al
luxadm probe
iostat -En

### HP-UX Unix ###
ioscan Cf
ioscan -funC tape
ioscan -fnC tape
ioscan -kfC tape
</code></pre><p>来自我的 Linux 服务器的输出示例：</p><p><img src=/data/attachment/album/201605/11/082147e16pydcwwwcttnuk.jpg alt="Fig.03: Installed tape devices on Linux server"></p><p><em>图03：Linux 服务器上已安装的磁带设备</em></p><h3 id=mt-命令示例>mt 命令示例</h3><p>在 Linux 和类 Unix 系统上，mt 命令用来控制磁带驱动器的操作，比如查看状态或查找磁带上的文件或写入磁带控制标记。下列大多数命令需要作为 root 用户执行。语法如下：</p><pre tabindex=0><code>mt -f /tape/device/name operation
</code></pre><h4 id=设置环境>设置环境</h4><p>你可以设置 TAPE shell 变量。这是磁带驱动器的路径名。在 FreeBSD 上默认的（如果变量没有设置，而不是 null）是 /dev/nsa0。可以通过 mt 命令的 -f 参数传递变量覆盖它，就像下面解释的那样。</p><pre tabindex=0><code> ### 添加到你的 shell 配置文件 ###
 TAPE=/dev/st1 #Linux
 TAPE=/dev/rmt/2 #Unix
 TAPE=/dev/nsa3 #FreeBSD
 export TAPE
</code></pre><h3 id=1显示磁带驱动器状态>1：显示磁带/驱动器状态</h3><pre tabindex=0><code>mt status  ### Use default
mt -f /dev/rmt/0  status ### Unix
mt -f /dev/st0 status ### Linux
mt -f /dev/nsa0 status ### FreeBSD
mt -f /dev/rmt/1 status ### Unix unity 1 也就是 tape device no. 1
</code></pre><p>你可以像下面一样使用 shell 循环语句遍历一个系统并定位其所有的磁带驱动器：</p><pre tabindex=0><code>for d in 0 1 2 3 4 5
do
 mt -f &#34;/dev/rmt/${d}&#34; status
done
</code></pre><h3 id=2倒带>2：倒带</h3><pre tabindex=0><code>mt rew
mt rewind
mt -f /dev/mt/0 rewind
mt -f /dev/st0 rewind
</code></pre><h3 id=3弹出磁带>3：弹出磁带</h3><pre tabindex=0><code>mt off
mt offline
mt eject
mt -f /dev/mt/0 off
mt -f /dev/st0 eject
</code></pre><h3 id=4擦除磁带倒带在支持的情况下卸载磁带>4：擦除磁带（倒带，在支持的情况下卸载磁带）</h3><pre tabindex=0><code>mt erase
mt -f /dev/st0 erase  #Linux
mt -f /dev/rmt/0 erase #Unix
</code></pre><h3 id=5张紧磁带盒>5：张紧磁带盒</h3><p>如果磁带在读取时发生错误，你重新张紧磁带，清洁磁带驱动器，像下面这样再试一次：</p><pre tabindex=0><code>mt retension
mt -f /dev/rmt/1 retension #Unix
mt -f /dev/st0 retension #Linux
</code></pre><h3 id=6在磁带当前位置写入-eof-标记>6：在磁带当前位置写入 EOF 标记</h3><pre tabindex=0><code>mt eof
mt weof
mt -f /dev/st0 eof
</code></pre><h3 id=7将磁带前进指定的文件标记数目即跳过指定个-eof-标记>7：将磁带前进指定的文件标记数目，即跳过指定个 EOF 标记</h3><p>磁带定位在下一个文件的第一个块，即磁带会定位在下一区域的第一个块（见图01）：</p><pre tabindex=0><code>mt fsf
mt -f /dev/rmt/0 fsf
mt -f /dev/rmt/1 fsf 1 #go 1 forward file/tape (see fig.01)
</code></pre><h3 id=8将磁带后退指定的文件标记数目即倒带指定个-eof-标记>8：将磁带后退指定的文件标记数目，即倒带指定个 EOF 标记</h3><p>磁带定位在下一个文件的第一个块，即磁带会定位在 EOF 标记之后（见图01）：</p><pre tabindex=0><code>mt bsf
mt -f /dev/rmt/1 bsf
mt -f /dev/rmt/1 bsf 1 #go 1 backward file/tape (see fig.01)
</code></pre><p>这里是磁带定位命令列表：</p><pre tabindex=0><code>   fsf    前进指定的文件标记数目。磁带定位在下一个文件的第一块。

   fsfm   前进指定的文件标记数目。磁带定位在前一文件的最后一块。

   bsf    后退指定的文件标记数目。磁带定位在前一文件的最后一块。

   bsfm   后退指定的文件标记数目。磁带定位在下一个文件的第一块。

   asf    磁带定位在指定文件标记数目的开始位置。定位通过先倒带，再前进指定的文件标记数目来实现。

   fsr    前进指定的记录数。

   bsr    后退指定的记录数。

   fss    （SCSI tapes）前进指定的 setmarks。

   bss    （SCSI tapes）后退指定的 setmarks。
</code></pre><h3 id=基本备份命令>基本备份命令</h3><p>让我们来看看备份和恢复命令。</p><h3 id=9备份目录tar-格式>9：备份目录（tar 格式）</h3><pre tabindex=0><code>tar cvf /dev/rmt/0n /etc
tar cvf /dev/st0 /etc
</code></pre><h3 id=10恢复目录tar-格式>10：恢复目录（tar 格式）</h3><pre tabindex=0><code>tar xvf /dev/rmt/0n -C /path/to/restore
tar xvf /dev/st0 -C /tmp
</code></pre><h3 id=11列出或检查磁带内容tar-格式>11：列出或检查磁带内容（tar 格式）</h3><pre tabindex=0><code>mt -f /dev/st0 rewind; dd if=/dev/st0 of=-

### tar 格式 ###
tar tvf {DEVICE} {Directory-FileName}
tar tvf /dev/st0
tar tvf /dev/st0 desktop
tar tvf /dev/rmt/0 foo &gt; list.txt
</code></pre><h3 id=12使用-dump-或-ufsdump-备份分区>12：使用 dump 或 ufsdump 备份分区</h3><pre tabindex=0><code>### Unix 备份 c0t0d0s2 分区 ###
ufsdump 0uf /dev/rmt/0  /dev/rdsk/c0t0d0s2

### Linux 备份 /home 分区 ###
dump 0uf /dev/nst0 /dev/sda5
dump 0uf /dev/nst0 /home

### FreeBSD 备份 /usr 分区 ###
dump -0aL -b64 -f /dev/nsa0 /usr
</code></pre><h3 id=12使用-ufsrestore-或-restore-恢复分区>12：使用 ufsrestore 或 restore 恢复分区</h3><pre tabindex=0><code>### Unix ###
ufsrestore xf /dev/rmt/0
### Unix 交互式恢复 ###
ufsrestore if /dev/rmt/0

### Linux ###
restore rf /dev/nst0
### 从磁带媒介上的第6个备份交互式恢复 ###
restore isf 6 /dev/nst0

### FreeBSD 恢复 ufsdump 格式 ###
restore -i -f /dev/nsa0
</code></pre><h3 id=13从磁带开头开始写入见图02>13：从磁带开头开始写入（见图02）</h3><pre tabindex=0><code>### 这会覆盖磁带上的所有数据 ###
mt -f /dev/st1 rewind

### 备份 home ###
tar cvf /dev/st1 /home

### 离线并卸载磁带 ###
mt -f /dev/st0 offline
</code></pre><p>从磁带开头开始恢复：</p><pre tabindex=0><code>mt -f /dev/st0 rewind
tar xvf /dev/st0
mt -f /dev/st0 offline
</code></pre><h3 id=14从最后一个-tar-后开始写入见图02>14：从最后一个 tar 后开始写入（见图02）</h3><pre tabindex=0><code>### 这会保留之前写入的数据 ###
mt -f /dev/st1 eom

### 备份 home ###
tar cvf /dev/st1 /home

### 卸载 ###
mt -f /dev/st0 offline
</code></pre><h3 id=15从-tar-number-2-后开始写入见图02>15：从 tar number 2 后开始写入（见图02）</h3><pre tabindex=0><code>### 在 tar number 2 之后写入（应该是 2+1）###
mt -f /dev/st0 asf 3
tar cvf /dev/st0 /usr

### asf 等效于 fsf ###
mt -f /dev/sf0 rewind
mt -f /dev/st0 fsf 2
</code></pre><p>从 tar number 2 恢复 tar：</p><pre tabindex=0><code>mt -f /dev/st0 asf 3
tar xvf /dev/st0
mt -f /dev/st0 offline
</code></pre><h3 id=如何验证使用-tar-创建的备份磁带>如何验证使用 tar 创建的备份磁带？</h3><p>定期做全系统修复和服务测试是很重要的，这是唯一确定整个系统正确工作的途径。参见我们的<a href=http://www.cyberciti.biz/faq/unix-verify-tape-backup/>验证 tar 命令磁带备份的教程</a>以获取更多信息。</p><h3 id=示例-shell-脚本>示例 shell 脚本</h3><pre tabindex=0><code>#!/bin/bash
# A UNIX / Linux shell script to backup dirs to tape device like /dev/st0 (linux)
# This script make both full and incremental backups.
# You need at two sets of five  tapes. Label each tape as Mon, Tue, Wed, Thu and Fri.
# You can run script at midnight or early morning each day using cronjons.
# The operator or sys admin can replace the tape every day after the script has done.
# Script must run as root or configure permission via sudo.
# -------------------------------------------------------------------------
# Copyright (c) 1999 Vivek Gite &lt;vivek@nixcraft.com&gt;
# This script is licensed under GNU GPL version 2.0 or above
# -------------------------------------------------------------------------
# This script is part of nixCraft shell script collection (NSSC)
# Visit http://bash.cyberciti.biz/ for more information.
# -------------------------------------------------------------------------
# Last updated on : March-2003 - Added log file support.
# Last updated on : Feb-2007 - Added support for excluding files / dirs.
# -------------------------------------------------------------------------
LOGBASE=/root/backup/log

# Backup dirs; do not prefix /
BACKUP_ROOT_DIR=&#34;home sales&#34;

# Get todays day like Mon, Tue and so on
NOW=$(date +&#34;%a&#34;)

# Tape devie name
TAPE=&#34;/dev/st0&#34;

# Exclude file
TAR_ARGS=&#34;&#34;
EXCLUDE_CONF=/root/.backup.exclude.conf

# Backup Log file
LOGFIILE=$LOGBASE/$NOW.backup.log

# Path to binaries
TAR=/bin/tar
MT=/bin/mt
MKDIR=/bin/mkdir

# ------------------------------------------------------------------------
# Excluding files when using tar
# Create a file called $EXCLUDE_CONF using a text editor
# Add files matching patterns such as follows (regex allowed):
# home/vivek/iso
# home/vivek/*.cpp~
# ------------------------------------------------------------------------
[ -f $EXCLUDE_CONF ] &amp;&amp; TAR_ARGS=&#34;-X $EXCLUDE_CONF&#34;

#### Custom functions #####
# Make a full backup
full_backup(){
    local old=$(pwd)
    cd /
    $TAR $TAR_ARGS -cvpf $TAPE $BACKUP_ROOT_DIR
    $MT -f $TAPE rewind
    $MT -f $TAPE offline
    cd $old
}

# Make a  partial backup
partial_backup(){
    local old=$(pwd)
    cd /
    $TAR $TAR_ARGS -cvpf $TAPE -N &#34;$(date -d &#39;1 day ago&#39;)&#34; $BACKUP_ROOT_DIR
    $MT -f $TAPE rewind
    $MT -f $TAPE offline
    cd $old
}

# Make sure all dirs exits
verify_backup_dirs(){
    local s=0
    for d in $BACKUP_ROOT_DIR
    do
        if [ ! -d /$d ];
        then
            echo &#34;Error : /$d directory does not exits!&#34;
            s=1
        fi
    done
    # if not; just die
    [ $s -eq 1 ] &amp;&amp; exit 1
}

#### Main logic ####

# Make sure log dir exits
[ ! -d $LOGBASE ] &amp;&amp; $MKDIR -p $LOGBASE

# Verify dirs
verify_backup_dirs

# Okay let us start backup procedure
# If it is Monday make a full backup;
# For Tue to Fri make a partial backup
# Weekend no backups
case $NOW in
    Mon)    full_backup;;
    Tue|Wed|Thu|Fri)    partial_backup;;
    *) ;;
esac &gt; $LOGFIILE 2&gt;&amp;1
</code></pre><h3 id=关于第三方备份工具>关于第三方备份工具</h3><p>Linux 和类Unix系统都提供了许多第三方工具，可以用来安排备份，包括磁带备份在内，如：</p><ul><li>Amanda</li><li>Bacula</li><li>rsync</li><li>duplicity</li><li>rsnapshot</li></ul><p>另行参阅</p><ul><li>Man pages - <a href=http://www.manpager.com/linux/man1/mt.1.html>mt(1)</a>, <a href=http://www.manpager.com/linux/man1/mtx.1.html>mtx(1)</a>, <a href=http://www.manpager.com/linux/man1/tar.1.html>tar(1)</a>, <a href=http://www.manpager.com/linux/man8/dump.8.html>dump(8)</a>, <a href=http://www.manpager.com/linux/man8/restore.8.html>restore(8)</a></li></ul><hr><p>via: <a href=http://www.cyberciti.biz/hardware/unix-linux-basic-tape-management-commands/>http://www.cyberciti.biz/hardware/unix-linux-basic-tape-management-commands/</a></p><p>作者：Vivek Gite 译者：<a href=https://github.com/alim0x>alim0x</a> 校对：<a href=https://github.com/tinyeyeser>Mr小眼儿</a></p><p>本文由 <a href=https://github.com/LCTT/TranslateProject>LCTT</a> 原创编译，<a href=https://linux.cn/>Linux中国</a> 荣誉推出</p></div><footer class=post__footer><div class="post__tags tags clearfix"><svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5.0 11V3C0 1.5.8.8.8.8S1.5.0 3 0h8c1.5.0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 100-6 3 3 0 000 6z"/></svg><ul class=tags__list><li class=tags__item><a class="tags__link btn" href=/tags/%E7%A3%81%E5%B8%A6/ rel=tag>磁带</a></li><li class=tags__item><a class="tags__link btn" href=/tags/%E5%A4%87%E4%BB%BD/ rel=tag>备份</a></li><li class=tags__item><a class="tags__link btn" href=/tags/%E6%81%A2%E5%A4%8D/ rel=tag>恢复</a></li></ul></div></footer></article></main></div></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2025 Linux.cn Archive.
<span class=footer__copyright-credits>Generated with <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> and <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a> theme.</span></div></div></footer></div><script async defer src=/js/menu.js></script></body></html>