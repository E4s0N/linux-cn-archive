<!doctype html><html class=no-js lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>使用 LVM 为你的 Fedora 系统添加存储 - Linux.cn Archive</title>
<script>(function(e,t){e[t]=e[t].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content><meta property="og:title" content="使用 LVM 为你的 Fedora 系统添加存储"><meta property="og:description" content="LVM 的好处之处在于它相当灵活。有几种方法可以添加一块磁盘。这篇文章介绍了一种方法。"><meta property="og:type" content="article"><meta property="og:url" content="/article-12936-1.html"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-12-20T10:05:18+00:00"><meta property="article:modified_time" content="2020-12-20T10:05:18+00:00"><meta itemprop=name content="使用 LVM 为你的 Fedora 系统添加存储"><meta itemprop=description content="LVM 的好处之处在于它相当灵活。有几种方法可以添加一块磁盘。这篇文章介绍了一种方法。"><meta itemprop=datePublished content="2020-12-20T10:05:18+00:00"><meta itemprop=dateModified content="2020-12-20T10:05:18+00:00"><meta itemprop=wordCount content="657"><meta itemprop=keywords content="LVM,"><link rel=preconnect href=https://fonts.bunny.net crossorigin><link rel=dns-prefetch href=//fonts.bunny.net><link rel=dns-prefetch href=//fonts.bunny.net><link rel=stylesheet href="https://fonts.bunny.net/css?family=Open+Sans:400,400i,700"><link rel=stylesheet href=/css/style.css><link rel="shortcut icon" href=/favicon.ico></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class=logo><a class=logo__link href=/ title="Linux.cn Archive" rel=home><div class="logo__item logo__text"><div class=logo__title>Linux.cn Archive</div></div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>Menu</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/><span class=menu__text>Home</span></a></li><li class=menu__item><a class=menu__link href=/categories/><span class=menu__text>Categories</span></a></li><li class=menu__item><a class=menu__link href=/tags/><span class=menu__text>Tags</span></a></li><li class=menu__item><a class=menu__link href><span class=menu__text>RSS</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>使用 LVM 为你的 Fedora 系统添加存储</h1><div class="post__meta meta"><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class=meta__text datetime=2020-12-20T10:05:18Z>December 20, 2020</time></div></div></header><div class="content post__content clearfix"><p><img src=/data/attachment/album/202012/20/100519bj1df01ffhdw831k.jpg alt></p><p>有时需要在系统中添加另一块磁盘。这就是 逻辑卷管理 Logical Volume Management （LVM）的用武之地。LVM 的好处之处在于它相当灵活。有几种方法可以添加一块磁盘。这篇文章介绍了一种方法。</p><h3 id=注意>注意！</h3><p>这篇文章并不包括将新的磁盘物理地安装到系统中的过程。请查阅你的系统和磁盘文档，了解如何正确地进行安装。</p><p><strong>重要：</strong> 一定要确保你已经备份重要数据。如果新磁盘已有数据，那么本文中描述的步骤将破坏数据。</p><h3 id=最好了解>最好了解</h3><p>本文并没有深入介绍 LVM 的每一个功能，重点是添加磁盘。但基本上你要了解，LVM 有 卷组 volume group （VG），它由一个或多个分区和/或磁盘组成。你把这些分区或磁盘以 物理卷 physical volume （PV）的方式添加到卷组。一个卷组可以分成许多 逻辑卷 logical volume （LV）。逻辑卷可以作为文件系统、ramdisk 等其他存储使用。更多信息可以在<a href=https://en.wikipedia.org/wiki/Logical_Volume_Manager_(Linux)>这里</a>中找到。</p><p>可以看作是，把物理卷形成一个存储池（一个卷组），然后从这个存储池中划分出逻辑卷，供你的系统直接使用。</p><h3 id=准备>准备</h3><p>确保你能看到你要添加的磁盘。在添加磁盘之前使用 <code>lsblk</code> 查看哪些存储空间已经可用或正在使用。</p><pre tabindex=0><code>$ lsblk
NAME                   MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
zram0                  251:0    0  989M  0 disk [SWAP]
vda                    252:0    0   20G  0 disk
├─vda1                 252:1    0    1G  0 part /boot
└─vda2                 252:2    0   19G  0 part
└─fedora_fedora-root   253:0    0   19G  0 lvm  /
</code></pre><p>本文使用的是带有虚拟存储的虚拟机，因此设备名称以 <code>vda</code> 开头代表第一个磁盘，<code>vdb</code> 代表第二个磁盘，以此类推。你的设备名称可能不同。许多系统会将 <code>sda</code> 作为第一个物理磁盘，<code>sdb</code> 代表第二个磁盘，以此类推。</p><p>当已连接新磁盘，并且你的系统已备份且正在运行，再次使用 <code>lsblk</code> 来查看新的块设备。</p><pre tabindex=0><code>$ lsblk
NAME                   MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
zram0                  251:0    0  989M  0 disk [SWAP]
vda                    252:0    0   20G  0 disk
├─vda1                 252:1    0    1G  0 part /boot
└─vda2                 252:2    0   19G  0 part
└─fedora_fedora-root 253:0    0   19G  0 lvm  /
vdb                    252:16   0   10G  0 disk
</code></pre><p>现在有一个名为 <code>vdb</code> 的新设备。该设备的位置是 <code>/dev/vdb</code>。</p><pre tabindex=0><code>$ ls -l /dev/vdb
brw-rw----. 1 root disk 252, 16 Nov 24 12:56 /dev/vdb
</code></pre><p>我们可以看到磁盘，但我们还不能用 LVM 来使用它。如果你运行 <code>blkid</code>，你应该不会看到它被列出。对于这个和之后的命令，你需要确保你的系统<a href=https://fedoramagazine.org/howto-use-sudo/>已配置好，这样你可以使用 sudo</a>：</p><pre tabindex=0><code>$ sudo blkid
/dev/vda1: UUID=&#34;4847cb4d-6666-47e3-9e3b-12d83b2d2448&#34; BLOCK_SIZE=&#34;4096&#34; TYPE=&#34;ext4&#34; PARTUUID=&#34;830679b8-01&#34;
/dev/vda2: UUID=&#34;k5eWpP-6MXw-foh5-Vbgg-JMZ1-VEf9-ARaGNd&#34; TYPE=&#34;LVM2_member&#34; PARTUUID=&#34;830679b8-02&#34;
/dev/mapper/fedora_fedora-root: UUID=&#34;f8ab802f-8c5f-4766-af33-90e78573f3cc&#34; BLOCK_SIZE=&#34;4096&#34; TYPE=&#34;ext4&#34;
/dev/zram0: UUID=&#34;fc6d7a48-2bd5-4066-9bcf-f062b61f6a60&#34; TYPE=&#34;swap&#34;
</code></pre><h3 id=将磁盘添加到-lvm-中>将磁盘添加到 LVM 中</h3><p>使用 <code>pvcreate</code> 初始化磁盘。你需要传递设备的完整路径。在这个例子中，它是 <code>/dev/vdb</code>。在你的系统中，它可能是 <code>/dev/sdb</code> 或其他设备名。</p><pre tabindex=0><code>$ sudo pvcreate /dev/vdb
Physical volume &#34;/dev/vdb&#34; successfully created.
</code></pre><p>当你运行 <code>blkid</code> 时，你应该看到磁盘已经被初始化为一个 <code>LVM2_member</code>：</p><pre tabindex=0><code>$ sudo blkid
/dev/vda1: UUID=&#34;4847cb4d-6666-47e3-9e3b-12d83b2d2448&#34; BLOCK_SIZE=&#34;4096&#34; TYPE=&#34;ext4&#34; PARTUUID=&#34;830679b8-01&#34;
/dev/vda2: UUID=&#34;k5eWpP-6MXw-foh5-Vbgg-JMZ1-VEf9-ARaGNd&#34; TYPE=&#34;LVM2_member&#34; PARTUUID=&#34;830679b8-02&#34;
/dev/mapper/fedora_fedora-root: UUID=&#34;f8ab802f-8c5f-4766-af33-90e78573f3cc&#34; BLOCK_SIZE=&#34;4096&#34; TYPE=&#34;ext4&#34;
/dev/zram0: UUID=&#34;fc6d7a48-2bd5-4066-9bcf-f062b61f6a60&#34; TYPE=&#34;swap&#34;
/dev/vdb: UUID=&#34;4uUUuI-lMQY-WyS5-lo0W-lqjW-Qvqw-RqeroE&#34; TYPE=&#34;LVM2_member&#34;
</code></pre><p>你可以使用 <code>pvs</code> 列出当前所有可用的物理卷：</p><pre tabindex=0><code>$ sudo pvs
PV         VG            Fmt  Attr PSize   PFree
/dev/vda2  fedora_fedora lvm2 a--  &lt;19.00g     0
/dev/vdb                 lvm2 ---   10.00g 10.00g
</code></pre><p><code>/dev/vdb</code> 被列为一个 PV （物理卷），但还没有分配到一个 VG （卷组）。</p><h3 id=将物理卷添加到一个卷组>将物理卷添加到一个卷组</h3><p>你可以使用 <code>vgs</code> 找到可用的卷组列表：</p><pre tabindex=0><code>$ sudo vgs
VG            #PV #LV #SN Attr   VSize   VFree
fedora_fedora   1   1   0 wz--n- 19.00g    0
</code></pre><p>在本例中，只有一个卷组可用。接下来，将物理卷添加到 <code>fedora_fedora</code>：</p><pre tabindex=0><code>$ sudo vgextend fedora_fedora /dev/vdb
Volume group &#34;fedora_fedora&#34; successfully extended
</code></pre><p>你现在应该看到物理卷已被添加到卷组中：</p><pre tabindex=0><code>$ sudo pvs 
PV        VG            Fmt  Attr PSize   PFree
/dev/vda2 fedora_fedora lvm2 a–   &lt;19.00g 0
/dev/vdb  fedora_fedora lvm2 a–   &lt;10.00g &lt;10.00g
</code></pre><p>看一下卷组：</p><pre tabindex=0><code>$ sudo vgs
VG            #PV #LV #SN Attr  VSize  VFree
fedora_fedora 2   1   0   wz–n- 28.99g &lt;10.00g
</code></pre><p>你也可以获得具体卷组和物理卷的详细列表：</p><pre tabindex=0><code>$ sudo vgdisplay fedora_fedora
--- Volume group ---
VG Name               fedora_fedora
System ID
Format                lvm2
Metadata Areas        2
Metadata Sequence No  3
VG Access             read/write
VG Status             resizable
MAX LV                0
Cur LV                1
Open LV               1
Max PV                0
Cur PV                2
Act PV                2
VG Size               28.99 GiB
PE Size               4.00 MiB
Total PE              7422
Alloc PE / Size       4863 / 19.00 GiB
Free  PE / Size       2559 / 10.00 GiB
VG UUID               C5dL2s-dirA-SQ15-TfQU-T3yt-l83E-oI6pkp
</code></pre><p>看下物理卷：</p><pre tabindex=0><code>$ sudo pvdisplay /dev/vdb
--- Physical volume ---
PV Name               /dev/vdb
VG Name               fedora_fedora
PV Size               10.00 GiB / not usable 4.00 MiB
Allocatable           yes
PE Size               4.00 MiB
Total PE              2559
Free PE               2559
Allocated PE          0
PV UUID               4uUUuI-lMQY-WyS5-lo0W-lqjW-Qvqw-RqeroE 
</code></pre><p>现在我们已经添加了磁盘，我们可以为逻辑卷 （LV） 分配空间：</p><pre tabindex=0><code>$ sudo lvs
LV VG Attr LSize Pool Origin Data% Meta% Move Log Cpy%Sync Convert
root fedora_fedora -wi-ao---- 19.00g
</code></pre><p>看一下逻辑卷。下面是详细的逻辑卷信息：</p><pre tabindex=0><code>$ sudo lvdisplay fedora_fedora/root
--- Logical volume ---
LV Path                /dev/fedora_fedora/root
LV Name                root
VG Name                fedora_fedora
LV UUID                yqc9cw-AvOw-G1Ni-bCT3-3HAa-qnw3-qUSHGM
LV Write Access        read/write
LV Creation host, time fedora, 2020-11-24 11:44:36 -0500
LV Status              available
LV Size                19.00 GiB
Current LE             4863
Segments               1
Allocation             inherit
Read ahead sectors     auto
- currently set to     256
Block device           253:0
</code></pre><p>查看根文件系统（<code>/</code>）的大小，并将它与逻辑卷大小进行比较。</p><pre tabindex=0><code>$ df -h /
Filesystem                      Size  Used Avail Use% Mounted on
/dev/mapper/fedora_fedora-root   19G  1.4G   17G   8% /
</code></pre><p>逻辑卷和文件系统大小都为 19G。让我们给根逻辑卷（<code>root</code>）增加 5G。</p><pre tabindex=0><code>$ sudo lvresize -L +5G fedora_fedora/root
Size of logical volume fedora_fedora/root changed from 19.00 GiB (4863 extents) to 24.00 GiB (6143 extents).
Logical volume fedora_fedora/root successfully resized.
</code></pre><p>我们现在有 24G 的逻辑卷可用。看看根文件系统（<code>/</code>）。</p><pre tabindex=0><code>$ df -h /
Filesystem                      Size  Used Avail Use% Mounted on
/dev/mapper/fedora_fedora-root   19G  1.4G   17G   8% /
</code></pre><p>我们仍然显示只有 19G 的空闲空间，这是因为逻辑卷与文件系统不一样。要使用增加到逻辑卷的新空间，请调整文件系统的大小。</p><pre tabindex=0><code>$ sudo resize2fs /dev/fedora_fedora/root
resize2fs 1.45.6 (20-Mar-2020)
Filesystem at /dev/fedora_fedora/root is mounted on /; on-line resizing required
old_desc_blocks = 3, new_desc_blocks = 3
The filesystem on /dev/fedora_fedora/root is now 6290432 (4k) blocks long.
</code></pre><p>看看文件系统的大小。</p><pre tabindex=0><code>$ df -h /
Filesystem                      Size  Used Avail Use% Mounted on
/dev/mapper/fedora_fedora-root   24G  1.4G   21G   7% /
</code></pre><p>正如你所看到的，根文件系统（<code>/</code>）已经占用了逻辑卷上的所有可用空间，而且不需要重新启动。</p><p>现在你已经将一个磁盘初始化为物理卷，并使用新的物理卷扩展了卷组。之后，你增加了逻辑卷的大小，并调整了文件系统的大小，以使用逻辑卷的新空间。</p><hr><p>via: <a href=https://fedoramagazine.org/add-storage-to-your-fedora-system-with-lvm/>https://fedoramagazine.org/add-storage-to-your-fedora-system-with-lvm/</a></p><p>作者：<a href=https://fedoramagazine.org/author/maztaim/>Tim Bosse</a> 选题：<a href=https://github.com/lujun9972>lujun9972</a> 译者：<a href=https://github.com/geekpi>geekpi</a> 校对：<a href=https://github.com/wxy>wxy</a></p><p>本文由 <a href=https://github.com/LCTT/TranslateProject>LCTT</a> 原创编译，<a href=https://linux.cn/>Linux中国</a> 荣誉推出</p></div><footer class=post__footer><div class="post__tags tags clearfix"><svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5.0 11V3C0 1.5.8.8.8.8S1.5.0 3 0h8c1.5.0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 100-6 3 3 0 000 6z"/></svg><ul class=tags__list><li class=tags__item><a class="tags__link btn" href=/tags/lvm/ rel=tag>LVM</a></li></ul></div></footer></article></main></div></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2025 Linux.cn Archive.
<span class=footer__copyright-credits>Generated with <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> and <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a> theme.</span></div></div></footer></div><script async defer src=/js/menu.js></script></body></html>