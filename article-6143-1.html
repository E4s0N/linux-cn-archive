<!doctype html><html class=no-js lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>如何为你的平台部署一个公开的系统状态页 - Linux.cn Archive</title>
<script>(function(e,t){e[t]=e[t].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content><meta property="og:title" content="如何为你的平台部署一个公开的系统状态页"><meta property="og:description" content="如果你是一个系统管理员，负责关键的 IT 基础设置或公司的服务，你将明白有效的沟通在日常任务中的重要性。假设你的线上存储服务器故障了。你希望团队所有人达成共识你好尽快的解决问题。当你忙来忙去时，你不会想一半的人问你为什么他们不能访问他们的文档。当一个维护计划快到时间了你想在计划前提醒相关人员，这样避免了不必要的开销。 这一切的要求或多或少改进了你、你的团队、和你服务的用户之间沟通渠道。一个实现它的方法是维护一个集中的系统状态页面，报告和记录故障停机详情、进度更新和维护计划等。这样，在故障期间你避免了"><meta property="og:type" content="article"><meta property="og:url" content="/article-6143-1.html"><meta property="article:section" content="posts"><meta property="article:published_time" content="2015-09-03T18:49:28+00:00"><meta property="article:modified_time" content="2015-09-03T18:49:28+00:00"><meta itemprop=name content="如何为你的平台部署一个公开的系统状态页"><meta itemprop=description content="如果你是一个系统管理员，负责关键的 IT 基础设置或公司的服务，你将明白有效的沟通在日常任务中的重要性。假设你的线上存储服务器故障了。你希望团队所有人达成共识你好尽快的解决问题。当你忙来忙去时，你不会想一半的人问你为什么他们不能访问他们的文档。当一个维护计划快到时间了你想在计划前提醒相关人员，这样避免了不必要的开销。 这一切的要求或多或少改进了你、你的团队、和你服务的用户之间沟通渠道。一个实现它的方法是维护一个集中的系统状态页面，报告和记录故障停机详情、进度更新和维护计划等。这样，在故障期间你避免了"><meta itemprop=datePublished content="2015-09-03T18:49:28+00:00"><meta itemprop=dateModified content="2015-09-03T18:49:28+00:00"><meta itemprop=wordCount content="655"><meta itemprop=keywords content="Cachet,"><link rel=preconnect href=https://fonts.bunny.net crossorigin><link rel=dns-prefetch href=//fonts.bunny.net><link rel=dns-prefetch href=//fonts.bunny.net><link rel=stylesheet href="https://fonts.bunny.net/css?family=Open+Sans:400,400i,700"><link rel=stylesheet href=/css/style.css><link rel="shortcut icon" href=/favicon.ico></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class=logo><a class=logo__link href=/ title="Linux.cn Archive" rel=home><div class="logo__item logo__text"><div class=logo__title>Linux.cn Archive</div></div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>Menu</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/><span class=menu__text>Home</span></a></li><li class=menu__item><a class=menu__link href=/categories/><span class=menu__text>Categories</span></a></li><li class=menu__item><a class=menu__link href=/tags/><span class=menu__text>Tags</span></a></li><li class=menu__item><a class=menu__link href><span class=menu__text>RSS</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>如何为你的平台部署一个公开的系统状态页</h1><div class="post__meta meta"><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class=meta__text datetime=2015-09-03T18:49:28Z>September 03, 2015</time></div></div></header><div class="content post__content clearfix"><p>如果你是一个系统管理员，负责关键的 IT 基础设置或公司的服务，你将明白有效的沟通在日常任务中的重要性。假设你的线上存储服务器故障了。你希望团队所有人达成共识你好尽快的解决问题。当你忙来忙去时，你不会想一半的人问你为什么他们不能访问他们的文档。当一个维护计划快到时间了你想在计划前提醒相关人员，这样避免了不必要的开销。</p><p>这一切的要求或多或少改进了你、你的团队、和你服务的用户之间沟通渠道。一个实现它的方法是维护一个集中的系统状态页面，报告和记录故障停机详情、进度更新和维护计划等。这样，在故障期间你避免了不必要的打扰，也可以提醒一些相关方，以及加入一些可选的状态更新。</p><p>有一个不错的<strong>开源, 自承载系统状态页解决方案</strong>叫做 <a href=https://cachethq.io/>Cachet</a>。在这个教程，我将要描述如何用 Cachet 部署一个自承载系统状态页面。</p><p><img src=/data/attachment/album/201509/03/183416gquqoquu38ym01qi.png alt></p><h3 id=cachet-特性>Cachet 特性</h3><p>在详细的配置 Cachet 之前，让我简单的介绍一下它的主要特性。</p><ul><li><strong>全 JSON API</strong>：Cachet API 可以让你使用任意的外部程序或脚本（例如，uptime 脚本）连接到 Cachet 来自动报告突发事件或更新状态。</li><li><strong>认证</strong>：Cachet 支持基础认证和 JSON API 的 API 令牌，所以只有认证用户可以更新状态页面。</li><li><strong>衡量系统</strong>：这通常用来展现随着时间推移的自定义数据（例如，服务器负载或者响应时间）。</li><li><strong>通知</strong>：可选地，你可以给任一注册了状态页面的人发送突发事件的提示邮件。</li><li><strong>多语言</strong>：状态页被翻译为11种不同的语言。</li><li><strong>双因子认证</strong>：这允许你使用 Google 的双因子认证来提升 Cachet 管理账户的安全性。</li><li><strong>跨数据库支持</strong>：你可以选择 MySQL，SQLite，Redis，APC 和 PostgreSQL 作为后端存储。</li></ul><p>剩下的教程，我会说明如何在 Linux 上安装配置 Cachet。</p><h3 id=第一步下载和安装-cachet>第一步：下载和安装 Cachet</h3><p>Cachet 需要一个 web 服务器和一个后端数据库来运转。在这个教程中，我将使用 LAMP 架构。以下是一些特定发行版上安装 Cachet 和 LAMP 架构的指令。</p><h4 id=debianubuntu-或者-linux-mint>Debian，Ubuntu 或者 Linux Mint</h4><pre tabindex=0><code>$ sudo apt-get install curl git apache2 mysql-server mysql-client php5 php5-mysql
$ sudo git clone https://github.com/cachethq/Cachet.git /var/www/cachet
$ cd /var/www/cachet
$ sudo git checkout v1.1.1
$ sudo chown -R www-data:www-data .
</code></pre><p>在基于 Debian 的系统上设置 LAMP 架构的更多细节，参考这个<a href=http://xmodulo.com/install-lamp-stack-ubuntu-server.html>教程</a>。</p><h4 id=fedora-centos-或-rhel>Fedora， CentOS 或 RHEL</h4><p>在基于 Red Hat 系统上，你首先需要<a href=/article-4192-1.html>设置 REMI 软件库</a>（以满足 PHP 的版本需求）。然后执行下面命令。</p><pre tabindex=0><code>$ sudo yum install curl git httpd mariadb-server
$ sudo yum --enablerepo=remi-php56 install php php-mysql php-mbstring
$ sudo git clone https://github.com/cachethq/Cachet.git /var/www/cachet
$ cd /var/www/cachet
$ sudo git checkout v1.1.1
$ sudo chown -R apache:apache .
$ sudo firewall-cmd --permanent --zone=public --add-service=http
$ sudo firewall-cmd --reload
$ sudo systemctl enable httpd.service; sudo systemctl start httpd.service
$ sudo systemctl enable mariadb.service; sudo systemctl start mariadb.service
</code></pre><p>在基于 Red Hat 系统上设置 LAMP 的更多细节，参考这个<a href=/article-5789-1.html>教程</a>。</p><h3 id=配置-cachet-的后端数据库>配置 Cachet 的后端数据库</h3><p>下一步是配置后端数据库。</p><p>登录到 MySQL/MariaDB 服务，然后创建一个空的数据库称为‘cachet’。</p><pre tabindex=0><code>$ sudo mysql -uroot -p
</code></pre><pre tabindex=0><code>mysql&gt; create database cachet;
mysql&gt; quit
</code></pre><p>现在用一个示例配置文件创建一个 Cachet 配置文件。</p><pre tabindex=0><code>$ cd /var/www/cachet
$ sudo mv .env.example .env
</code></pre><p>在 .env 文件里，填写你自己设置的数据库信息（例如，DB_*）。其他的字段先不改变。</p><pre tabindex=0><code>APP_ENV=production
APP_DEBUG=false
APP_URL=http://localhost
APP_KEY=SomeRandomString

DB_DRIVER=mysql
DB_HOST=localhost
DB_DATABASE=cachet
DB_USERNAME=root
DB_PASSWORD=&lt;root-password&gt;

CACHE_DRIVER=apc
SESSION_DRIVER=apc
QUEUE_DRIVER=database

MAIL_DRIVER=smtp
MAIL_HOST=mailtrap.io
MAIL_PORT=2525
MAIL_USERNAME=null
MAIL_PASSWORD=null
MAIL_ADDRESS=null
MAIL_NAME=null

REDIS_HOST=null
REDIS_DATABASE=null
REDIS_PORT=null
</code></pre><h3 id=第三步安装-php-依赖和执行数据库迁移>第三步：安装 PHP 依赖和执行数据库迁移</h3><p>下面，我们将要安装必要的PHP依赖包。我们会使用 composer 来安装。如果你的系统还没有安装 composer，先安装它：</p><pre tabindex=0><code>$ curl -sS https://getcomposer.org/installer | sudo php -- --install-dir=/usr/local/bin --filename=composer
</code></pre><p>现在开始用 composer 安装 PHP 依赖包。</p><pre tabindex=0><code>$ cd /var/www/cachet
$ sudo composer install --no-dev -o
</code></pre><p>下面执行一次性的数据库迁移。这一步会在我们之前创建的数据库里面创建那些所需的表。</p><pre tabindex=0><code>$ sudo php artisan migrate
</code></pre><p>假设在 /var/www/cachet/.env 的数据库配置无误，数据库迁移应该像下面显示一样成功完成。</p><p><img src=/data/attachment/album/201509/03/184344pwrhooyinwrhbrhr.jpg alt></p><p>下面，创建一个密钥，它将用来加密进入 Cachet 的数据。</p><pre tabindex=0><code>$ sudo php artisan key:generate
$ sudo php artisan config:cache
</code></pre><p><img src=/data/attachment/album/201509/03/184409lhczh84t4ca86lzt.jpg alt></p><p>生成的应用密钥将自动添加到你的 .env 文件 APP_KEY 变量中。你不需要自己编辑 .env。</p><h3 id=第四步配置-apache-http-服务>第四步：配置 Apache HTTP 服务</h3><p>现在到了配置运行 Cachet 的 web 服务的时候了。我们使用 Apache HTTP 服务器，为 Cachet 创建一个新的<a href=http://xmodulo.com/configure-virtual-hosts-apache-http-server.html>虚拟主机</a>，如下：</p><h4 id=debianubuntu-或-linux-mint>Debian，Ubuntu 或 Linux Mint</h4><pre tabindex=0><code>$ sudo vi /etc/apache2/sites-available/cachet.conf
</code></pre><pre tabindex=0><code>&lt;VirtualHost *:80&gt;
    ServerName cachethost
    ServerAlias cachethost
    DocumentRoot &#34;/var/www/cachet/public&#34;
    &lt;Directory &#34;/var/www/cachet/public&#34;&gt;
        Require all granted
        Options Indexes FollowSymLinks
        AllowOverride All
        Order allow,deny
        Allow from all
    &lt;/Directory&gt;
&lt;/VirtualHost&gt;
</code></pre><p>启用新虚拟主机和 mod_rewrite：</p><pre tabindex=0><code>$ sudo a2ensite cachet.conf
$ sudo a2enmod rewrite
$ sudo service apache2 restart
</code></pre><h4 id=fedora-centos-或-rhel-1>Fedora， CentOS 或 RHEL</h4><p>在基于 Red Hat 系统上，创建一个虚拟主机文件，如下：</p><pre tabindex=0><code>$ sudo vi /etc/httpd/conf.d/cachet.conf
</code></pre><pre tabindex=0><code>&lt;VirtualHost *:80&gt;
    ServerName cachethost
    ServerAlias cachethost
    DocumentRoot &#34;/var/www/cachet/public&#34;
    &lt;Directory &#34;/var/www/cachet/public&#34;&gt;
        Require all granted
        Options Indexes FollowSymLinks
        AllowOverride All
        Order allow,deny
        Allow from all
    &lt;/Directory&gt;
&lt;/VirtualHost&gt;
</code></pre><p>现在重载 Apache 配置：</p><pre tabindex=0><code>$ sudo systemctl reload httpd.service
</code></pre><h3 id=第五步配置-etchosts-来测试-cachet>第五步：配置 /etc/hosts 来测试 Cachet</h3><p>这时候，初始的 Cachet 状态页面应该启动运行了，现在测试一下。</p><p>由于 Cachet 被配置为Apache HTTP 服务的虚拟主机，我们需要调整你的客户机的 /etc/hosts 来访问他。你将从这个客户端电脑访问 Cachet 页面。（LCTT 译注：如果你给了这个页面一个正式的主机地址，则不需要这一步。）</p><p>打开 /etc/hosts，加入如下行：</p><pre tabindex=0><code>$ sudo vi /etc/hosts
</code></pre><pre tabindex=0><code>&lt;cachet 服务器的 IP 地址&gt;    cachethost
</code></pre><p>上面名为“cachethost”必须匹配 Cachet 的 Apache 虚拟主机文件的 ServerName。</p><h3 id=测试-cachet-状态页面>测试 Cachet 状态页面</h3><p>现在你准备好访问 Cachet 状态页面。在你浏览器地址栏输入 http://cachethost。你将被转到如下的 Cachet 状态页的初始化设置页面。</p><p><img src=/data/attachment/album/201509/03/184549jye2h7u7j60v1zj2.jpg alt></p><p>选择 cache/session 驱动。这里 cache 和 session 驱动两个都选“File”。</p><p>下一步，输入关于状态页面的基本信息（例如，站点名称、域名、时区和语言），以及管理员认证账户。</p><p><img src=/data/attachment/album/201509/03/184615br82urofx1oz1uxd.jpg alt></p><p><img src=/data/attachment/album/201509/03/184635x9f1gkkld9ffy6vv.jpg alt></p><p><img src=/data/attachment/album/201509/03/184703h2t4jbf849tqj9eq.jpg alt></p><p>你的状态页初始化就要完成了。</p><p><img src=/data/attachment/album/201509/03/184726ime2x0epam2q6fe0.jpg alt></p><p>继续创建组件（你的系统单元）、事件或者任意你要做的维护计划。</p><p>例如，增加一个组件：</p><p><img src=/data/attachment/album/201509/03/184756k9d18l4a3l9dhe8d.jpg alt></p><p>增加一个维护计划：</p><p>公共 Cachet 状态页就像这样：</p><p><img src=/data/attachment/album/201509/03/184819ce2yyh92zki2xqi9.jpg alt></p><p>集成了 SMTP，你可以在状态更新时发送邮件给订阅者。并且你可以使用 CSS 和 markdown 格式来完全自定义布局和状态页面。</p><h3 id=结论>结论</h3><p>Cachet 是一个相当易于使用，自托管的状态页面软件。Cachet 一个高级特性是支持全 JSON API。使用它的 RESTful API，Cachet 可以轻松连接单独的监控后端（例如，<a href=http://xmodulo.com/monitor-common-services-nagios.html>Nagios</a>），然后回馈给 Cachet 事件报告并自动更新状态。比起手工管理一个状态页它更快和有效率。</p><p>最后一句，我喜欢提及一个事。用 Cachet 设置一个漂亮的状态页面是很简单的，但要将这个软件用好并不像安装它那么容易。你需要完全保障所有 IT 团队习惯准确及时的更新状态页，从而建立公共信息的准确性。同时，你需要教用户去查看状态页面。最后，如果没有很好的填充数据，部署状态页面就没有意义，并且/或者没有一个人查看它。记住这个，尤其是当你考虑在你的工作环境中部署 Cachet 时。</p><h3 id=故障排查>故障排查</h3><p>补充，万一你安装 Cachet 时遇到问题，这有一些有用的故障排查的技巧。</p><ol><li>Cachet 页面没有加载任何东西，并且你看到如下报错。</li></ol><pre tabindex=0><code>production.ERROR: exception &#39;RuntimeException&#39; with message &#39;No supported encrypter found. The cipher and / or key length are invalid.&#39; in /var/www/cachet/bootstrap/cache/compiled.php:6695
</code></pre><p><strong>解决方案</strong>：确保你创建了一个应用密钥，以及明确配置缓存如下所述。</p><pre tabindex=0><code>$ cd /path/to/cachet
$ sudo php artisan key:generate
$ sudo php artisan config:cache
</code></pre><ol start=2><li>调用 composer 命令时有如下报错。</li></ol><pre tabindex=0><code>- danielstjules/stringy 1.10.0 requires ext-mbstring * -the requested PHP extension mbstring is missing from your system.
- laravel/framework v5.1.8 requires ext-mbstring * -the requested PHP extension mbstring is missing from your system.
- league/commonmark 0.10.0 requires ext-mbstring * -the requested PHP extension mbstring is missing from your system.
</code></pre><p><strong>解决方案</strong>：确保在你的系统上安装了必要的 PHP 扩展 mbstring ，并且兼容你的 PHP 版本。在基于 Red Hat 的系统上，由于我们从 REMI-56 库安装PHP，所以要从同一个库安装扩展。</p><pre tabindex=0><code>$ sudo yum --enablerepo=remi-php56 install php-mbstring
</code></pre><ol start=3><li>你访问 Cachet 状态页面时得到一个白屏。HTTP 日志显示如下错误。</li></ol><pre tabindex=0><code>PHP Fatal error:  Uncaught exception &#39;UnexpectedValueException&#39; with message &#39;The stream or file &#34;/var/www/cachet/storage/logs/laravel-2015-08-21.log&#34; could not be opened: failed to open stream: Permission denied&#39; in /var/www/cachet/bootstrap/cache/compiled.php:12851
</code></pre><p><strong>解决方案</strong>：尝试如下命令。</p><pre tabindex=0><code>$ cd /var/www/cachet
$ sudo php artisan cache:clear
$ sudo chmod -R 777 storage
$ sudo composer dump-autoload
</code></pre><p>如果上面的方法不起作用，试试禁止 SELinux：</p><pre tabindex=0><code>$ sudo setenforce 0 
</code></pre><hr><p>via: <a href=http://xmodulo.com/setup-system-status-page.html>http://xmodulo.com/setup-system-status-page.html</a></p><p>作者：<a href=http://xmodulo.com/author/nanni>Dan Nanni</a> 译者：<a href=https://github.com/wyangsun>wyangsun</a> 校对：<a href=https://github.com/wxy>wxy</a></p><p>本文由 <a href=https://github.com/LCTT/TranslateProject>LCTT</a> 原创翻译，<a href=https://linux.cn/>Linux中国</a> 荣誉推出</p></div><footer class=post__footer><div class="post__tags tags clearfix"><svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5.0 11V3C0 1.5.8.8.8.8S1.5.0 3 0h8c1.5.0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 100-6 3 3 0 000 6z"/></svg><ul class=tags__list><li class=tags__item><a class="tags__link btn" href=/tags/cachet/ rel=tag>Cachet</a></li></ul></div></footer></article></main></div></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2025 Linux.cn Archive.
<span class=footer__copyright-credits>Generated with <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> and <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a> theme.</span></div></div></footer></div><script async defer src=/js/menu.js></script></body></html>