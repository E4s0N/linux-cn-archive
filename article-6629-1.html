<!doctype html><html class=no-js lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>如何在 Linux 上从 NetworkManager 切换为 systemd-network - Linux.cn Archive</title>
<script>(function(e,t){e[t]=e[t].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content><meta property="og:title" content="如何在 Linux 上从 NetworkManager 切换为 systemd-network"><meta property="og:description" content="在 Linux 世界里，对 systemd 的采用一直是激烈争论的主题，它的支持者和反对者之间的战火仍然在燃烧。到了今天，大部分主流 Linux 发行版都已经采用了 systemd 作为默认的初始化（init）系统。 正如其作者所说，作为一个 从未完成、从未完善、但一直追随技术进步 的系统，systemd 已经不只是一个初始化进程，它被设计为一个更广泛的系统以及服务管理平台，这个平台是一个包含了不断增长的核心系统进程、库和工具的生态系统。  systemd 的其中一部分是 systemd-networkd，它负责 systemd 生态中的网络配置。使用 systemd-networkd，你可以"><meta property="og:type" content="article"><meta property="og:url" content="/article-6629-1.html"><meta property="article:section" content="posts"><meta property="article:published_time" content="2015-11-23T10:45:00+00:00"><meta property="article:modified_time" content="2015-11-23T10:45:00+00:00"><meta itemprop=name content="如何在 Linux 上从 NetworkManager 切换为 systemd-network"><meta itemprop=description content="在 Linux 世界里，对 systemd 的采用一直是激烈争论的主题，它的支持者和反对者之间的战火仍然在燃烧。到了今天，大部分主流 Linux 发行版都已经采用了 systemd 作为默认的初始化（init）系统。 正如其作者所说，作为一个 从未完成、从未完善、但一直追随技术进步 的系统，systemd 已经不只是一个初始化进程，它被设计为一个更广泛的系统以及服务管理平台，这个平台是一个包含了不断增长的核心系统进程、库和工具的生态系统。  systemd 的其中一部分是 systemd-networkd，它负责 systemd 生态中的网络配置。使用 systemd-networkd，你可以"><meta itemprop=datePublished content="2015-11-23T10:45:00+00:00"><meta itemprop=dateModified content="2015-11-23T10:45:00+00:00"><meta itemprop=wordCount content="342"><meta itemprop=keywords content="systemd,网络,"><link rel=preconnect href=https://fonts.bunny.net crossorigin><link rel=dns-prefetch href=//fonts.bunny.net><link rel=dns-prefetch href=//fonts.bunny.net><link rel=stylesheet href="https://fonts.bunny.net/css?family=Open+Sans:400,400i,700"><link rel=stylesheet href=/css/style.css><link rel="shortcut icon" href=/favicon.ico></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class=logo><a class=logo__link href=/ title="Linux.cn Archive" rel=home><div class="logo__item logo__text"><div class=logo__title>Linux.cn Archive</div></div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>Menu</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/><span class=menu__text>Home</span></a></li><li class=menu__item><a class=menu__link href=/categories/><span class=menu__text>Categories</span></a></li><li class=menu__item><a class=menu__link href=/tags/><span class=menu__text>Tags</span></a></li><li class=menu__item><a class=menu__link href><span class=menu__text>RSS</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>如何在 Linux 上从 NetworkManager 切换为 systemd-network</h1><div class="post__meta meta"><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class=meta__text datetime=2015-11-23T10:45:00Z>November 23, 2015</time></div></div></header><div class="content post__content clearfix"><p>在 Linux 世界里，对 <a href=http://xmodulo.com/use-systemd-system-administration-debian.html>systemd</a> 的采用一直是激烈争论的主题，它的支持者和反对者之间的战火仍然在燃烧。到了今天，大部分主流 Linux 发行版都已经采用了 systemd 作为默认的 初始化 （ init ） 系统。</p><p>正如其作者所说，作为一个 “从未完成、从未完善、但一直追随技术进步” 的系统，systemd 已经不只是一个初始化进程，它被设计为一个更广泛的系统以及服务管理平台，这个平台是一个包含了不断增长的核心系统进程、库和工具的生态系统。</p><p><img src=/data/attachment/album/201511/22/234939mvxpgfanhaftwtbw.jpg alt></p><p><strong>systemd</strong> 的其中一部分是 <strong>systemd-networkd</strong>，它负责 systemd 生态中的网络配置。使用 systemd-networkd，你可以为网络设备配置基础的 DHCP/静态 IP 网络。它还可以配置虚拟网络功能，例如网桥、隧道和 VLAN。systemd-networkd 目前还不能直接支持无线网络，但你可以使用 wpa_supplicant 服务配置无线适配器，然后把它和 <strong>systemd-networkd</strong> 联系起来。</p><p>在很多 Linux 发行版中，NetworkManager 仍然作为默认的网络配置管理器。和 NetworkManager 相比，<strong>systemd-networkd</strong> 仍处于积极的开发状态，还缺少一些功能。例如，它还不能像 NetworkManager 那样能让你的计算机在任何时候通过多种接口保持连接。它还没有为更高层面的脚本编程提供 ifup/ifdown 钩子函数。但是，systemd-networkd 和其它 systemd 组件（例如用于域名解析的 <strong>resolved</strong>、NTP 的<strong>timesyncd</strong>，用于命名的 udevd）结合的非常好。随着时间增长，<strong>systemd-networkd</strong>只会在 systemd 环境中扮演越来越重要的角色。</p><p>如果你对 <strong>systemd-networkd</strong> 的进步感到高兴，从 NetworkManager 切换到 systemd-networkd 是值得你考虑的一件事。如果你强烈反对 systemd，对 NetworkManager 或<a href=http://xmodulo.com/disable-network-manager-linux.html>基础网络服务</a>感到很满意，那也很好。</p><p>但对于那些想尝试 systemd-networkd 的人，可以继续看下去，在这篇指南中学会在 Linux 中怎么从 NetworkManager 切换到 systemd-networkd。</p><h3 id=需求>需求</h3><p>systemd 210 及其更高版本提供了 systemd-networkd。因此诸如 Debian 8 &ldquo;Jessie&rdquo; (systemd 215)、 Fedora 21 (systemd 217)、 Ubuntu 15.04 (systemd 219) 或更高版本的 Linux 发行版和 systemd-networkd 兼容。</p><p>对于其它发行版，在开始下一步之前先检查一下你的 systemd 版本。</p><pre tabindex=0><code>$ systemctl --version
</code></pre><h3 id=从-networkmanager-切换到-systemd-networkd>从 NetworkManager 切换到 Systemd-networkd</h3><p>从 NetworkManager 切换到 systemd-networkd 其实非常简答（反过来也一样）。</p><p>首先，按照下面这样先停用 NetworkManager 服务，然后启用 systemd-networkd。</p><pre tabindex=0><code>$ sudo systemctl disable NetworkManager
$ sudo systemctl enable systemd-networkd
</code></pre><p>你还要启用 <strong>systemd-resolved</strong> 服务，systemd-networkd用它来进行域名解析。该服务还实现了一个缓存式 DNS 服务器。</p><pre tabindex=0><code>$ sudo systemctl enable systemd-resolved
$ sudo systemctl start systemd-resolved
</code></pre><p>当启动后，<strong>systemd-resolved</strong> 就会在 /run/systemd 目录下某个地方创建它自己的 resolv.conf。但是，把 DNS 解析信息存放在 /etc/resolv.conf 是更普遍的做法，很多应用程序也会依赖于 /etc/resolv.conf。因此为了兼容性，按照下面的方式创建一个到 /etc/resolv.conf 的符号链接。</p><pre tabindex=0><code>$ sudo rm /etc/resolv.conf
$ sudo ln -s /run/systemd/resolve/resolv.conf /etc/resolv.conf
</code></pre><h3 id=用-systemd-networkd-配置网络连接>用 systemd-networkd 配置网络连接</h3><p>要用 systemd-networkd 配置网络服务，你必须指定带.network 扩展名的配置信息文本文件。这些网络配置文件保存到 /etc/systemd/network 并从这里加载。当有多个文件时，systemd-networkd 会按照字母顺序一个个加载并处理。</p><p>首先创建 /etc/systemd/network 目录。</p><pre tabindex=0><code>$ sudo mkdir /etc/systemd/network
</code></pre><h4 id=dhcp-网络>DHCP 网络</h4><p>首先来配置 DHCP 网络。对于此，先要创建下面的配置文件。文件名可以任意，但记住文件是按照字母顺序处理的。</p><pre tabindex=0><code>$ sudo vi /etc/systemd/network/20-dhcp.network
</code></pre><hr><pre tabindex=0><code>[Match]
Name=enp3*

[Network]
DHCP=yes
</code></pre><p>正如你上面看到的，每个网络配置文件包括了一个或多个 “sections”，每个 “section”都用 [XXX] 开头。每个 section 包括了一个或多个键值对。<code>[Match]</code> 部分决定这个配置文件配置哪个（些）网络设备。例如，这个文件匹配所有名称以 ens3 开头的网络设备（例如 enp3s0、 enp3s1、 enp3s2 等等）对于匹配的接口，然后启用 [Network] 部分指定的 DHCP 网络配置。</p><h3 id=静态-ip-网络>静态 IP 网络</h3><p>如果你想给网络设备分配一个静态 IP 地址，那就新建下面的配置文件。</p><pre tabindex=0><code>$ sudo vi /etc/systemd/network/10-static-enp3s0.network
</code></pre><hr><pre tabindex=0><code>[Match]
Name=enp3s0

[Network]
Address=192.168.10.50/24
Gateway=192.168.10.1
DNS=8.8.8.8
</code></pre><p>正如你猜测的， enp3s0 接口地址会被指定为 192.168.10.50/24，默认网关是 192.168.10.1， DNS 服务器是 8.8.8.8。这里微妙的一点是，接口名 enp3s0 事实上也匹配了之前 DHCP 配置中定义的模式规则。但是，根据词汇顺序，文件 &ldquo;10-static-enp3s0.network&rdquo; 在 &ldquo;20-dhcp.network&rdquo; 之前被处理，对于 enp3s0 接口静态配置比 DHCP 配置有更高的优先级。</p><p>一旦你完成了创建配置文件，重启 systemd-networkd 服务或者重启机器。</p><pre tabindex=0><code>$ sudo systemctl restart systemd-networkd
</code></pre><p>运行以下命令检查服务状态：</p><pre tabindex=0><code>$ systemctl status systemd-networkd
$ systemctl status systemd-resolved
</code></pre><p><img src=/data/attachment/album/201511/22/234954e7a6toyokasovoyh.jpg alt></p><h3 id=用-systemd-networkd-配置虚拟网络设备>用 systemd-networkd 配置虚拟网络设备</h3><p><strong>systemd-networkd</strong> 同样允许你配置虚拟网络设备，例如网桥、VLAN、隧道、VXLAN、绑定等。你必须在用 .netdev 作为扩展名的文件中配置这些虚拟设备。</p><p>这里我展示了如何配置一个桥接接口。</p><h4 id=linux-网桥>Linux 网桥</h4><p>如果你想创建一个 Linux 网桥(br0) 并把物理接口(eth1) 添加到网桥，你可以新建下面的配置。</p><pre tabindex=0><code>$ sudo vi /etc/systemd/network/bridge-br0.netdev
</code></pre><hr><pre tabindex=0><code>[NetDev]
Name=br0
Kind=bridge
</code></pre><p>然后按照下面这样用 .network 文件配置网桥接口 br0 和从接口 eth1。</p><pre tabindex=0><code>$ sudo vi /etc/systemd/network/bridge-br0-slave.network
</code></pre><hr><pre tabindex=0><code>[Match]
Name=eth1

[Network]
Bridge=br0
</code></pre><hr><pre tabindex=0><code>$ sudo vi /etc/systemd/network/bridge-br0.network
</code></pre><hr><pre tabindex=0><code>[Match]
Name=br0

[Network]
Address=192.168.10.100/24
Gateway=192.168.10.1
DNS=8.8.8.8
</code></pre><p>最后，重启 systemd-networkd。</p><pre tabindex=0><code>$ sudo systemctl restart systemd-networkd
</code></pre><p>你可以用 <a href=http://xmodulo.com/how-to-configure-linux-bridge-interface.html>brctl 工具</a> 来验证是否创建好了网桥 br0。</p><h3 id=总结>总结</h3><p>当 systemd 誓言成为 Linux 的系统管理器时，有类似 systemd-networkd 的东西来管理网络配置也就不足为奇。但是在现阶段，systemd-networkd 看起来更适合于网络配置相对稳定的服务器环境。对于桌面/笔记本环境，它们有多种临时有线/无线接口，NetworkManager 仍然是比较好的选择。</p><p>对于想进一步了解 systemd-networkd 的人，可以参考官方<a href=http://www.freedesktop.org/software/systemd/man/systemd.network.html>man 手册</a>了解完整的支持列表和关键点。</p><hr><p>via: <a href=http://xmodulo.com/switch-from-networkmanager-to-systemd-networkd.html>http://xmodulo.com/switch-from-networkmanager-to-systemd-networkd.html</a></p><p>作者：<a href=http://xmodulo.com/author/nanni>Dan Nanni</a> 译者：<a href=http://mutouxiaogui.cn/blog>ictlyh</a> 校对：<a href=https://github.com/wxy>wxy</a></p><p>本文由 <a href=https://github.com/LCTT/TranslateProject>LCTT</a> 原创编译，<a href=https://linux.cn/>Linux中国</a> 荣誉推出</p></div><footer class=post__footer><div class="post__tags tags clearfix"><svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5.0 11V3C0 1.5.8.8.8.8S1.5.0 3 0h8c1.5.0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 100-6 3 3 0 000 6z"/></svg><ul class=tags__list><li class=tags__item><a class="tags__link btn" href=/tags/systemd/ rel=tag>systemd</a></li><li class=tags__item><a class="tags__link btn" href=/tags/%E7%BD%91%E7%BB%9C/ rel=tag>网络</a></li></ul></div></footer></article></main></div></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2025 Linux.cn Archive.
<span class=footer__copyright-credits>Generated with <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> and <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a> theme.</span></div></div></footer></div><script async defer src=/js/menu.js></script></body></html>