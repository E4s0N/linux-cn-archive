<!doctype html><html class=no-js lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>如何为 Linux 打包 Python 应用 - Linux.cn Archive</title>
<script>(function(e,t){e[t]=e[t].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content><meta property="og:title" content="如何为 Linux 打包 Python 应用"><meta property="og:description" content="了解如何使用 dh_virtualenv 来让你的 Python 应用可作为 .deb 包安装。"><meta property="og:type" content="article"><meta property="og:url" content="/article-12143-1.html"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-04-23T23:55:58+00:00"><meta property="article:modified_time" content="2020-04-23T23:55:58+00:00"><meta itemprop=name content="如何为 Linux 打包 Python 应用"><meta itemprop=description content="了解如何使用 dh_virtualenv 来让你的 Python 应用可作为 .deb 包安装。"><meta itemprop=datePublished content="2020-04-23T23:55:58+00:00"><meta itemprop=dateModified content="2020-04-23T23:55:58+00:00"><meta itemprop=wordCount content="298"><meta itemprop=keywords content="Python,打包,软件包,"><link rel=preconnect href=https://fonts.bunny.net crossorigin><link rel=dns-prefetch href=//fonts.bunny.net><link rel=dns-prefetch href=//fonts.bunny.net><link rel=stylesheet href="https://fonts.bunny.net/css?family=Open+Sans:400,400i,700"><link rel=stylesheet href=/css/style.css><link rel="shortcut icon" href=/favicon.ico></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class=logo><a class=logo__link href=/ title="Linux.cn Archive" rel=home><div class="logo__item logo__text"><div class=logo__title>Linux.cn Archive</div></div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>Menu</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/><span class=menu__text>Home</span></a></li><li class=menu__item><a class=menu__link href=/categories/><span class=menu__text>Categories</span></a></li><li class=menu__item><a class=menu__link href=/tags/><span class=menu__text>Tags</span></a></li><li class=menu__item><a class=menu__link href><span class=menu__text>RSS</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>如何为 Linux 打包 Python 应用</h1><div class="post__meta meta"><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class=meta__text datetime=2020-04-23T23:55:58Z>April 23, 2020</time></div></div></header><div class="content post__content clearfix"><blockquote><p>了解如何使用 dh_virtualenv 来让你的 Python 应用可作为 .deb 包安装。</p></blockquote><p><img src=/data/attachment/album/202004/23/235547iztz5d955t9s9b5t.jpg alt></p><p>在基于 Debian 的操作系统（例如 Debian 或 <a href=https://opensource.com/article/19/12/pantheon-linux-desktop>Elementary OS</a>）上安装 Python 应用的一种方法是使用 <a href=https://dh-virtualenv.readthedocs.io/en/latest/>dh_virtualenv</a> 工具。它可以构建一个 <code>.deb</code> 包，在应用之外封装了一个 Python 虚拟环境，并在安装时进行部署。</p><p>在本文中，我将以构建一个包含 <a href=https://opensource.com/article/19/8/getting-started-httpie>HTTPie</a> 工具的包为例来解释如何使用它，以便在无需激活虚拟环境的情况下从命令行测试 HTTP API。</p><h3 id=使用-dh_virtualenv-打包>使用 dh_virtualenv 打包</h3><p>首先，你需要安装 <code>dh_virtualenv</code> 所需的工具。<code>dh_virtualenv</code> 的<a href=https://dh-virtualenv.readthedocs.io/en/1.1/tutorial.html>文档</a>提供了所有安装选项。在基于 Debian 的系统上，我输入：</p><pre tabindex=0><code>apt-get install dh-virtualenv devscripts
</code></pre><p>尽管不需要 <a href=http://man.he.net/man1/devscripts>devscripts</a> 包，但它可以简化后续操作。</p><p>现在，创建一个目录来保存源码。由于这是一个本地的、非官方的 HTTPie 打包，因此我将其称为 <code>myhttp</code>。接下来，让我们在 <code>myhttp</code> 内创建一些文件，向 Debian 构建系统提供元数据。</p><p>首先，创建 <code>debian/control</code> 文件：</p><pre tabindex=0><code>Source: myhttp
Section: python
Priority: extra
Maintainer: Jan Doe &lt;jandoe@example.org&gt;
Build-Depends: debhelper (&gt;= 9), python3.7, dh-virtualenv (&gt;= 0.8)
Standards-Version: 3.9.5

Package: myhttp
Architecture: any
Pre-Depends: dpkg (&gt;= 1.16.1), python3.7, ${misc:Pre-Depends}
Depends: ${misc:Depends}
Description: http client
 Useful for doing stuff
</code></pre><p>那么这些是什么信息呢？正如 <a href=https://www.debian.org/doc/manuals/maint-guide/dreq.en.html#control>Debian 文档</a>指出的：</p><blockquote><p>“第 1–7 行是源码包的控制信息。第 9–13 行是二进制包的控制信息。”</p></blockquote><p>以下是我使用的：</p><ul><li><code>Section</code> 的值对于我们来说大多没有意义，但需要存在。它对给引导式 UI 安装程序提供信息是有意义的，但对于这个包来说，没有意义。</li><li><code>Priority</code> 对像这样的第三方包的正确值是 <code>extra</code>。</li><li>强烈建议在 <code>Maintainer</code> 字段中填写正确的联系人信息。但不一定非得是你的个人电子邮件，如果包由团队维护，并且你希望将问题发送到团队的邮件别名，例如 <code>Infrastructure Team &lt;infra-team-list@company.example.com></code>。</li><li><code>Build-Depends</code> 字段标识你需要 <code>debhelper</code>、<code>python</code> 和 <code>dh-virtualenv</code> 来构建包：包构建过程中将确保这些依赖项在包构建时已安装。</li><li><code>Standards-Version</code> 字段主要给人看。它表明你遵循的指南。本指南基于 <code>dh-virtualenv</code> 的官方文档，它是基于 Debian 的 3.9.5 指南。最好一直将源码包和二进制包命名相同。</li><li><code>Architecture</code> 字段应为 <code>Any</code>，因为除非虚拟环境可能包含一些特定于体系结构的文件。否则，最好选择该字段为 <code>any</code>。</li><li>保持 <code>Pre-Depends</code> 列表不变：它是一种非常严格的依赖关系形式，你很少会需要比这里建议的最小依赖更多的依赖项。依赖项通常由构建系统准确计算，因此没有理由手动指定它们。</li><li>如果你的包主要用于内部，那么 <code>Description</code> 字段可能只需要最少的信息或者指向公司 wiki 的链接，不然更多的信息会更有用。</li></ul><p>然后创建 <code>debian/compat</code> 文件，它<a href=https://www.debian.org/doc/manuals/maint-guide/dother.en.html#compat>主要出于历史目的而存在</a>：</p><pre tabindex=0><code>$ echo &#34;9&#34; &gt; debian/compat
</code></pre><p>接下来，创建更新日志以告知包用户自上次发布以来发生了什么变化。最简单的方法是使用 <code>dch --create</code> 创建模板，然后填写值。</p><p>填写后，它看起来像：</p><pre tabindex=0><code>myhttp (2.0.0-1) stable; urgency=medium

  * Initial release.

 -- Jan Doe &lt;jandoe@example.org&gt;  Fri, 27 Mar 2020 01:09:22 +0000
</code></pre><p>现在你需要告诉工具安装 HTTPie，但是哪个版本？</p><p>创建一个宽松版本的 <code>requirements.in</code> 文件：</p><pre tabindex=0><code>httpie
</code></pre><p>通常，宽松的需求文件将仅包含项目的直接依赖项，并在需要时指定最低版本。不一定总是需要指定最低版本：这些工具通常偏向于将依赖关系转化为“可能的最新版本”。如果你的 Debian 包与一个内部 Python 包相对应，这是内部应用中的一种常见情况，那么宽松的需求文件看起来将很相似：仅包含包名的一行。</p><p>然后使用 <code>pip-compile</code>（可通过安装 PyPI 包 <code>pip-tools</code> 获得）：</p><pre tabindex=0><code>$ pip-compile requirements.in &gt; requirements.txt
</code></pre><p>这会生成一个严格的依赖文件，名为 <code>requirements.txt</code>：</p><pre tabindex=0><code>#
# This file is autogenerated by pip-compile
# To update, run:
#
#    pip-compile requirements.in
#
certifi==2019.11.28       # via requests
chardet==3.0.4            # via requests
httpie==2.0.0             # via -r requirements.in
idna==2.9                 # via requests
pygments==2.6.1           # via httpie
requests==2.23.0          # via httpie
urllib3==1.25.8           # via requests
</code></pre><p>最后，写一个 <code>debian/rules</code> 文件来创建包。因为 <code>dh_virtualenv</code> 会处理所有困难的事，因此规则文件很简单：</p><pre tabindex=0><code>#!/usr/bin/make -f

%:
        dh $@ --with python-virtualenv --python /usr/bin/python3.7
</code></pre><p>确保指定 Python 解释器。默认它会使用 <code>/usr/bin/python</code>，这是 Python2，但是你应该使用一个<a href=https://opensource.com/article/19/11/end-of-life-python-2>受支持的 Python 版本</a>。</p><p>完成了，接下来就是构建包：</p><pre tabindex=0><code>$ debuild -b -us -uc
</code></pre><p>这会在父目录生成一个类似 <code>myhttp_2.0.0-1_amd64.deb</code> 的文件。该文件可在任何兼容的系统上安装。</p><p>通常，最好在同一平台上构建用于特定平台（例如 Debian 10.0）的 Debian 包。</p><p>你可以将此 Debian 包保存在软件仓库中，并使用例如 <a href=https://opensource.com/resources/what-ansible>Ansible</a> 的工具将其安装在所有相关系统上。</p><h3 id=总结>总结</h3><p>给基于 Debian 的系统的打包应用是一个有着多个步骤的过程。使用 <code>dh_virtualenv</code> 将使过程变得简单明了。</p><hr><p>via: <a href=https://opensource.com/article/20/4/package-python-applications-linux>https://opensource.com/article/20/4/package-python-applications-linux</a></p><p>作者：<a href=https://opensource.com/users/moshez>Moshe Zadka</a> 选题：<a href=https://github.com/lujun9972>lujun9972</a> 译者：<a href=https://github.com/geekpi>geekpi</a> 校对：<a href=https://github.com/wxy>wxy</a></p><p>本文由 <a href=https://github.com/LCTT/TranslateProject>LCTT</a> 原创编译，<a href=https://linux.cn/>Linux中国</a> 荣誉推出</p></div><footer class=post__footer><div class="post__tags tags clearfix"><svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5.0 11V3C0 1.5.8.8.8.8S1.5.0 3 0h8c1.5.0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 100-6 3 3 0 000 6z"/></svg><ul class=tags__list><li class=tags__item><a class="tags__link btn" href=/tags/python/ rel=tag>Python</a></li><li class=tags__item><a class="tags__link btn" href=/tags/%E6%89%93%E5%8C%85/ rel=tag>打包</a></li><li class=tags__item><a class="tags__link btn" href=/tags/%E8%BD%AF%E4%BB%B6%E5%8C%85/ rel=tag>软件包</a></li></ul></div></footer></article></main></div></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2025 Linux.cn Archive.
<span class=footer__copyright-credits>Generated with <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> and <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a> theme.</span></div></div></footer></div><script async defer src=/js/menu.js></script></body></html>