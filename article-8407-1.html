<!doctype html><html class=no-js lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>在 Linux 上使用 Nginx 和 Gunicorn 托管 Django 应用 - Linux.cn Archive</title>
<script>(function(e,t){e[t]=e[t].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content><meta property="og:title" content="在 Linux 上使用 Nginx 和 Gunicorn 托管 Django 应用"><meta property="og:description" content="托管 Django Web 应用程序相当简单，虽然它比标准的 PHP 应用程序更复杂一些。 让 Web 服务器对接 Django 的方法有很多。 Gunicorn 就是其中最简单的一个。"><meta property="og:type" content="article"><meta property="og:url" content="/article-8407-1.html"><meta property="article:section" content="posts"><meta property="article:published_time" content="2017-04-15T16:35:19+00:00"><meta property="article:modified_time" content="2017-04-15T16:35:19+00:00"><meta itemprop=name content="在 Linux 上使用 Nginx 和 Gunicorn 托管 Django 应用"><meta itemprop=description content="托管 Django Web 应用程序相当简单，虽然它比标准的 PHP 应用程序更复杂一些。 让 Web 服务器对接 Django 的方法有很多。 Gunicorn 就是其中最简单的一个。"><meta itemprop=datePublished content="2017-04-15T16:35:19+00:00"><meta itemprop=dateModified content="2017-04-15T16:35:19+00:00"><meta itemprop=wordCount content="388"><meta itemprop=keywords content="Django,Gunicorn,"><link rel=preconnect href=https://fonts.bunny.net crossorigin><link rel=dns-prefetch href=//fonts.bunny.net><link rel=dns-prefetch href=//fonts.bunny.net><link rel=stylesheet href="https://fonts.bunny.net/css?family=Open+Sans:400,400i,700"><link rel=stylesheet href=/css/style.css><link rel="shortcut icon" href=/favicon.ico></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class=logo><a class=logo__link href=/ title="Linux.cn Archive" rel=home><div class="logo__item logo__text"><div class=logo__title>Linux.cn Archive</div></div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>Menu</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/><span class=menu__text>Home</span></a></li><li class=menu__item><a class=menu__link href=/categories/><span class=menu__text>Categories</span></a></li><li class=menu__item><a class=menu__link href=/tags/><span class=menu__text>Tags</span></a></li><li class=menu__item><a class=menu__link href><span class=menu__text>RSS</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>在 Linux 上使用 Nginx 和 Gunicorn 托管 Django 应用</h1><div class="post__meta meta"><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class=meta__text datetime=2017-04-15T16:35:19Z>April 15, 2017</time></div></div></header><div class="content post__content clearfix"><p><img src=https://img.linux.net.cn/data/attachment/album/201704/15/163522an5lbtgga4lcx6gt.png alt></p><h3 id=介绍>介绍</h3><p>托管 Django Web 应用程序相当简单，虽然它比标准的 PHP 应用程序更复杂一些。 让 Web 服务器对接 Django 的方法有很多。 Gunicorn 就是其中最简单的一个。</p><p>Gunicorn（Green Unicorn 的缩写）在你的 Web 服务器 Django 之间作为中间服务器使用，在这里，Web 服务器就是 Nginx。 Gunicorn 服务于应用程序，而 Nginx 处理静态内容。</p><h3 id=gunicorn>Gunicorn</h3><h4 id=安装>安装</h4><p>使用 Pip 安装 Gunicorn 是超级简单的。 如果你已经使用 virtualenv 搭建好了你的 Django 项目，那么你就有了 Pip，并且应该熟悉 Pip 的工作方式。 所以，在你的 virtualenv 中安装 Gunicorn。</p><pre tabindex=0><code>$ pip install gunicorn
</code></pre><h4 id=配置>配置</h4><p>Gunicorn 最有吸引力的一个地方就是它的配置非常简单。处理配置最好的方法就是在 Django 项目的根目录下创建一个名叫 <code>Gunicorn</code> 的文件夹。然后在该文件夹内，创建一个配置文件。</p><p>在本篇教程中，配置文件名称是 <code>gunicorn-conf.py</code>。在该文件中，创建类似于下面的配置：</p><pre tabindex=0><code>import multiprocessing

bind = &#39;unix:///tmp/gunicorn1.sock&#39;
workers = multiprocessing.cpu_count() * 2 + 1
reload = True
daemon = True
</code></pre><p>在上述配置的情况下，Gunicorn 会在 <code>/tmp/</code> 目录下创建一个名为 <code>gunicorn1.sock</code> 的 Unix 套接字。 还会启动一些工作进程，进程数量相当于 CPU 内核数量的 2 倍。 它还会自动重新加载并作为守护进程运行。</p><h4 id=运行>运行</h4><p>Gunicorn 的运行命令有点长，指定了一些附加的配置项。 最重要的部分是将 Gunicorn 指向你项目的 <code>.wsgi</code> 文件。</p><pre tabindex=0><code>gunicorn -c gunicorn/gunicorn-conf.py -D --error-logfile gunicorn/error.log yourproject.wsgi
</code></pre><p>上面的命令应该从项目的根目录运行。 <code>-c</code> 选项告诉 Gunicorn 使用你创建的配置文件。 <code>-D</code> 再次指定 gunicorn 为守护进程。 最后一部分指定 Gunicorn 的错误日志文件在你创建 <code>Gunicorn</code> 文件夹中的位置。 命令结束部分就是为 Gunicorn 指定 <code>.wsgi</code> 文件的位置。</p><h3 id=nginx>Nginx</h3><p>现在 Gunicorn 配置好了并且已经开始运行了，你可以设置 Nginx 连接它，为你的静态文件提供服务。 本指南假定你已经配置好了 Nginx，而且你通过它托管的站点使用了单独的 server 块。 它还将包括一些 SSL 信息。</p><p>如果你想知道如何让你的网站获得免费的 SSL 证书，请查看我们的 <a href=https://linuxconfig.org/generate-ssl-certificates-with-letsencrypt-debian-linux>Let&rsquo;sEncrypt 指南</a>。</p><pre tabindex=0><code># 连接到 Gunicorn
upstream yourproject-gunicorn {
    server unix:/tmp/gunicorn1.sock fail_timeout=0;
}

# 将未加密的流量重定向到加密的网站
server {
    listen       80;
    server_name  yourwebsite.com;
    return       301 https://yourwebsite.com$request_uri;
}

# 主服务块
server {
    # 设置监听的端口，指定监听的域名
    listen 443 default ssl;
    client_max_body_size 4G;
    server_name yourwebsite.com;

    # 指定日志位置
    access_log /var/log/nginx/yourwebsite.access_log main;
    error_log /var/log/nginx/yourwebsite.error_log info;

    # 告诉 nginx 你的 ssl 证书
    ssl on;
    ssl_certificate /etc/letsencrypt/live/yourwebsite.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/yourwebsite.com/privkey.pem;

    # 设置根目录
    root /var/www/yourvirtualenv/yourproject;

    # 为 Nginx 指定静态文件路径
    location /static/ {
        # Autoindex the files to make them browsable if you want
        autoindex on;
        # The location of your files
        alias /var/www/yourvirtualenv/yourproject/static/;
        # Set up caching for your static files
        expires 1M;
        access_log off;
        add_header Cache-Control &#34;public&#34;;
        proxy_ignore_headers &#34;Set-Cookie&#34;;
    }

    # 为 Nginx 指定你上传文件的路径
    location /media/ {
        Autoindex if you want
        autoindex on;
        # The location of your uploaded files
        alias /var/www/yourvirtualenv/yourproject/media/;
        # Set up aching for your uploaded files
        expires 1M;
        access_log off;
        add_header Cache-Control &#34;public&#34;;
        proxy_ignore_headers &#34;Set-Cookie&#34;;
    }

    location / {
        # Try your static files first, then redirect to Gunicorn
        try_files $uri @proxy_to_app;
    }

    # 将请求传递给 Gunicorn
    location @proxy_to_app {
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header Host $http_host;
        proxy_redirect off;
        proxy_pass   http://njc-gunicorn;
    }

    # 缓存 HTML、XML 和 JSON
    location ~* \.(html?|xml|json)$ {
        expires 1h;
    }

    # 缓存所有其他的静态资源
    location ~* \.(jpg|jpeg|png|gif|ico|css|js|ttf|woff2)$ {
        expires 1M;
        access_log off;
        add_header Cache-Control &#34;public&#34;;
        proxy_ignore_headers &#34;Set-Cookie&#34;;
    }
}
</code></pre><p>配置文件有点长，但是还可以更长一些。其中重点是指向 Gunicorn 的 <code>upstream</code> 块以及将流量传递给 Gunicorn 的 <code>location</code> 块。大多数其他的配置项都是可选，但是你应该按照一定的形式来配置。配置中的注释应该可以帮助你了解具体细节。</p><p>保存文件之后，你可以重启 Nginx，让修改的配置生效。</p><pre tabindex=0><code># systemctl restart nginx
</code></pre><p>一旦 Nginx 在线生效，你的站点就可以通过域名访问了。</p><h3 id=结语>结语</h3><p>如果你想深入研究，Nginx 可以做很多事情。但是，上面提供的配置是一个很好的开始，并且你可以用于实践中。 如果你见惯了 Apache 和臃肿的 PHP 应用程序，像这样的服务器配置的速度应该是一个惊喜。</p><hr><p>via: <a href=https://linuxconfig.org/hosting-django-with-nginx-and-gunicorn-on-linux>https://linuxconfig.org/hosting-django-with-nginx-and-gunicorn-on-linux</a></p><p>作者：<a href=https://linuxconfig.org/hosting-django-with-nginx-and-gunicorn-on-linux>Nick Congleton</a> 译者：<a href=https://github.com/Flowsnow>Flowsnow</a> 校对：<a href=https://github.com/wxy>wxy</a></p><p>本文由 <a href=https://github.com/LCTT/TranslateProject>LCTT</a> 原创编译，<a href=https://linux.cn/>Linux中国</a> 荣誉推出</p></div><footer class=post__footer><div class="post__tags tags clearfix"><svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5.0 11V3C0 1.5.8.8.8.8S1.5.0 3 0h8c1.5.0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 100-6 3 3 0 000 6z"/></svg><ul class=tags__list><li class=tags__item><a class="tags__link btn" href=/tags/django/ rel=tag>Django</a></li><li class=tags__item><a class="tags__link btn" href=/tags/gunicorn/ rel=tag>Gunicorn</a></li></ul></div></footer></article></main></div></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2025 Linux.cn Archive.
<span class=footer__copyright-credits>Generated with <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> and <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a> theme.</span></div></div></footer></div><script async defer src=/js/menu.js></script></body></html>