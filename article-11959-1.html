<!doctype html><html class=no-js lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>在 Linux 下使用 fstrim 延长 SSD 驱动器的寿命 - Linux.cn Archive</title>
<script>(function(e,t){e[t]=e[t].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content><meta property="og:title" content="在 Linux 下使用 fstrim 延长 SSD 驱动器的寿命"><meta property="og:description" content="这个新的系统服务可以使你的生活更轻松。"><meta property="og:type" content="article"><meta property="og:url" content="/article-11959-1.html"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-03-04T12:16:58+00:00"><meta property="article:modified_time" content="2020-03-04T12:16:58+00:00"><meta itemprop=name content="在 Linux 下使用 fstrim 延长 SSD 驱动器的寿命"><meta itemprop=description content="这个新的系统服务可以使你的生活更轻松。"><meta itemprop=datePublished content="2020-03-04T12:16:58+00:00"><meta itemprop=dateModified content="2020-03-04T12:16:58+00:00"><meta itemprop=wordCount content="311"><meta itemprop=keywords content="SSD,"><link rel=preconnect href=https://fonts.bunny.net crossorigin><link rel=dns-prefetch href=//fonts.bunny.net><link rel=dns-prefetch href=//fonts.bunny.net><link rel=stylesheet href="https://fonts.bunny.net/css?family=Open+Sans:400,400i,700"><link rel=stylesheet href=/css/style.css><link rel="shortcut icon" href=/favicon.ico></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class=logo><a class=logo__link href=/ title="Linux.cn Archive" rel=home><div class="logo__item logo__text"><div class=logo__title>Linux.cn Archive</div></div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>Menu</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/><span class=menu__text>Home</span></a></li><li class=menu__item><a class=menu__link href=/categories/><span class=menu__text>Categories</span></a></li><li class=menu__item><a class=menu__link href=/tags/><span class=menu__text>Tags</span></a></li><li class=menu__item><a class=menu__link href><span class=menu__text>RSS</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>在 Linux 下使用 fstrim 延长 SSD 驱动器的寿命</h1><div class="post__meta meta"><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class=meta__text datetime=2020-03-04T12:16:58Z>March 04, 2020</time></div></div></header><div class="content post__content clearfix"><blockquote><p>这个新的系统服务可以使你的生活更轻松。</p></blockquote><p><img src=/data/attachment/album/202003/04/121625sl380ga10g56d33h.jpg alt></p><p>在过去的十年中，固态驱动器（SSD）带来了一种管理存储的新方法。与上一代的转盘产品相比，SSD 具有无声、更冷却的操作和更快的接口规格等优点。当然，新技术带来了新的维护和管理方法。SSD 具有一种称为 TRIM 的功能。从本质上讲，这是一种用于回收设备上未使用的块的方法，该块可能先前已被写入，但不再包含有效数据，因此可以返回到通用存储池以供重用。Opensource.com 的 Don Watkins 首先在其 2017 年的文章《<a href=/article-8177-1.html>Linux 固态驱动器：为 SSD 启用 TRIM</a>》中介绍过 TRIM 的内容。</p><p>如果你一直在 Linux 系统上使用此功能，则你可能熟悉下面描述的两种方法。</p><h3 id=老的方式>老的方式</h3><h4 id=丢弃选项>丢弃选项</h4><p>我最初使用 <code>mount</code> 命令的 <code>discard</code> 选项启用了此功能。每个文件系统的配置都放在 <code>/etc/fstab</code> 文件中。</p><pre tabindex=0><code># cat /etc/fstab
UUID=3453g54-6628-2346-8123435f  /home  xfs  defaults,discard   0 0
</code></pre><p>丢弃选项可启用自动的在线 TRIM。由于可能会对性能造成负面影响，最近关于这是否是最佳方法一直存在争议。使用此选项会在每次将新数据写入驱动器时启动 TRIM。这可能会引入其他磁盘活动，从而影响存储性能。</p><h4 id=cron-作业>Cron 作业</h4><p>我从 <code>fstab</code> 文件中删除了丢弃选项。然后，我创建了一个 cron 作业来按计划调用该命令。</p><pre tabindex=0><code># crontab -l
@midnight /usr/bin/trim
</code></pre><p>这是我最近在 Ubuntu Linux 系统上使用的方法，直到我了解到另一种方法。</p><h3 id=一个新的-trim-服务>一个新的 TRIM 服务</h3><p>我最近发现有一个用于 TRIM 的 systemd 服务。Fedora 在版本 30 中将其<a href=https://fedoraproject.org/wiki/Changes/EnableFSTrimTimer title="Fedora Project WIKI: Changes/EnableFSTrimTimer">引入</a>，尽管默认情况下在版本 30 和 31 中未启用它，但计划在版本 32 中使用它。如果你使用的是 Fedora 工作站 31，并且你想要开始使用此功能，可以非常轻松地启用它。我还将在下面向你展示如何对其进行测试。该服务并非 Fedora 独有的服务。它是否存在及其地位将因发行版而异。</p><h4 id=测试>测试</h4><p>我喜欢先进行测试，以更好地了解幕后情况。我通过打开终端并发出配置服务调用的命令来执行此操作。</p><pre tabindex=0><code>/usr/sbin/fstrim --fstab --verbose --quiet
</code></pre><p><code>fstrim</code> 的 <code>-help</code> 参数将描述这些信息和其他参数。</p><pre tabindex=0><code>$ sudo /usr/sbin/fstrim --help

Usage:
 fstrim [options] &lt;mount point&gt;

Discard unused blocks on a mounted filesystem.

Options:
 -a, --all           trim all supported mounted filesystems
 -A, --fstab         trim all supported mounted filesystems from /etc/fstab
 -o, --offset &lt;num&gt;  the offset in bytes to start discarding from
 -l, --length &lt;num&gt;  the number of bytes to discard
 -m, --minimum &lt;num&gt; the minimum extent length to discard
 -v, --verbose       print number of discarded bytes
     --quiet         suppress error messages
 -n, --dry-run       does everything, but trim

 -h, --help          display this help
 -V, --version       display version
</code></pre><p>因此，现在我可以看到这个 systemd 服务已配置为在我的 <code>/etc/fstab</code> 文件中的所有受支持的挂载文件系统上运行该修剪操作（<code>-fstab</code>），并打印出所丢弃的字节数（<code>-verbose</code>），但是抑制了任何可能会发生的错误消息（<code>–quiet</code>）。了解这些选项对测试很有帮助。例如，我可以从最安全的方法开始，即空运行。我还将去掉 <code>-quiet</code> 参数，以便确定驱动器设置是否发生任何错误。</p><pre tabindex=0><code>$ sudo /usr/sbin/fstrim --fstab --verbose --dry-run
</code></pre><p>这就会显示 <code>fstrim</code> 命令根据在 <code>/etc/fstab</code> 文件中找到的文件系统要执行的操作。</p><pre tabindex=0><code>$ sudo /usr/sbin/fstrim --fstab --verbose
</code></pre><p>现在，这会将 TRIM 操作发送到驱动器，并报告每个文件系统中丢弃的字节数。以下是我最近在新的 NVME SSD 上全新安装 Fedora 之后的示例。</p><pre tabindex=0><code>/home: 291.5 GiB (313011310592 bytes) trimmed on /dev/mapper/wkst-home
/boot/efi: 579.2 MiB (607301632 bytes) trimmed on /dev/nvme0n1p1
/boot: 787.5 MiB (825778176 bytes) trimmed on /dev/nvme0n1p2
/: 60.7 GiB (65154805760 bytes) trimmed on /dev/mapper/wkst-root
</code></pre><h4 id=启用>启用</h4><p>Fedora Linux 实现了一个计划每周运行它的 systemd 计时器服务。要检查其是否存在及当前状态，请运行 <code>systemctl status</code>。</p><pre tabindex=0><code>$ sudo systemctl status fstrim.timer
</code></pre><p>现在，启用该服务。</p><pre tabindex=0><code>$ sudo systemctl enable fstrim.timer
</code></pre><h4 id=验证>验证</h4><p>然后，你可以通过列出所有计时器来验证该计时器是否已启用。</p><pre tabindex=0><code>$ sudo systemctl list-timers --all
</code></pre><p>会显示出下列行，表明 <code>fstrim.timer</code> 存在。注意，该计时器实际上激活了 <code>fstrim.service</code> 服务。这是实际调用 <code>fstrim</code> 的地方。与时间相关的字段显示为 <code>n/a</code>，因为该服务已启用且尚未运行。</p><pre tabindex=0><code>NEXT   LEFT    LAST   PASSED   UNIT           ACTIVATES
n/a    n/a     n/a    n/a      fstrim.timer   fstrim.service
</code></pre><h3 id=结论>结论</h3><p>该服务似乎是在驱动器上运行 TRIM 的最佳方法。这比必须创建自己的 crontab 条目来调用 <code>fstrim</code> 命令要简单得多。不必编辑 <code>fstab</code> 文件也更安全。观察固态存储技术的发展很有趣，并且我很高兴看到 Linux 似乎正在朝着标准且安全的方向实现它。</p><p>在本文中，学习了固态驱动器与传统硬盘驱动器有何不同以及它的含义…</p><hr><p>via: <a href=https://opensource.com/article/20/2/trim-solid-state-storage-linux>https://opensource.com/article/20/2/trim-solid-state-storage-linux</a></p><p>作者：<a href=https://opensource.com/users/alanfdoss>Alan Formy-Duval</a> 选题：<a href=https://github.com/lujun9972>lujun9972</a> 译者：<a href=https://github.com/wxy>wxy</a> 校对：<a href=https://github.com/wxy>wxy</a></p><p>本文由 <a href=https://github.com/LCTT/TranslateProject>LCTT</a> 原创编译，<a href=https://linux.cn/>Linux中国</a> 荣誉推出</p></div><footer class=post__footer><div class="post__tags tags clearfix"><svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5.0 11V3C0 1.5.8.8.8.8S1.5.0 3 0h8c1.5.0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 100-6 3 3 0 000 6z"/></svg><ul class=tags__list><li class=tags__item><a class="tags__link btn" href=/tags/ssd/ rel=tag>SSD</a></li></ul></div></footer></article></main></div></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2025 Linux.cn Archive.
<span class=footer__copyright-credits>Generated with <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> and <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a> theme.</span></div></div></footer></div><script async defer src=/js/menu.js></script></body></html>