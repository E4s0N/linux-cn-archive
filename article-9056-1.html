<!doctype html><html class=no-js lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>怎么在一台树莓派上安装 Postgres 数据库 - Linux.cn Archive</title>
<script>(function(e,t){e[t]=e[t].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content><meta property="og:title" content="怎么在一台树莓派上安装 Postgres 数据库"><meta property="og:description" content="本教程介绍了怎么在一个树莓派上去安装 Postgres；创建一个表；写简单查询；在树莓派、PC，或者 Mac 上使用 pgAdmin 图形用户界面；从 Python 中与数据库交互。"><meta property="og:type" content="article"><meta property="og:url" content="/article-9056-1.html"><meta property="article:section" content="posts"><meta property="article:published_time" content="2017-11-17T10:10:00+00:00"><meta property="article:modified_time" content="2017-11-17T10:10:00+00:00"><meta itemprop=name content="怎么在一台树莓派上安装 Postgres 数据库"><meta itemprop=description content="本教程介绍了怎么在一个树莓派上去安装 Postgres；创建一个表；写简单查询；在树莓派、PC，或者 Mac 上使用 pgAdmin 图形用户界面；从 Python 中与数据库交互。"><meta itemprop=datePublished content="2017-11-17T10:10:00+00:00"><meta itemprop=dateModified content="2017-11-17T10:10:00+00:00"><meta itemprop=wordCount content="433"><meta itemprop=keywords content="PostgreSQL,树莓派,"><link rel=preconnect href=https://fonts.bunny.net crossorigin><link rel=dns-prefetch href=//fonts.bunny.net><link rel=dns-prefetch href=//fonts.bunny.net><link rel=stylesheet href="https://fonts.bunny.net/css?family=Open+Sans:400,400i,700"><link rel=stylesheet href=/css/style.css><link rel="shortcut icon" href=/favicon.ico></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class=logo><a class=logo__link href=/ title="Linux.cn Archive" rel=home><div class="logo__item logo__text"><div class=logo__title>Linux.cn Archive</div></div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>Menu</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/><span class=menu__text>Home</span></a></li><li class=menu__item><a class=menu__link href=/categories/><span class=menu__text>Categories</span></a></li><li class=menu__item><a class=menu__link href=/tags/><span class=menu__text>Tags</span></a></li><li class=menu__item><a class=menu__link href><span class=menu__text>RSS</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>怎么在一台树莓派上安装 Postgres 数据库</h1><div class="post__meta meta"><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class=meta__text datetime=2017-11-17T10:10:00Z>November 17, 2017</time></div></div></header><div class="content post__content clearfix"><blockquote><p>在你的下一个树莓派项目上安装和配置流行的开源数据库 Postgres 并去使用它。</p></blockquote><p><img src=https://img.linux.net.cn/data/attachment/album/201711/14/231228w1yr2z7zlzn1y0vr.png alt="How to set up a Postgres database on a Raspberry Pi" title="How to set up a Postgres database on a Raspberry Pi"></p><p>保存你的项目或应用程序持续增加的数据，数据库是一种很好的方式。你可以在一个会话中将数据写入到数据库，并且在下次你需要查找的时候找到它。一个设计良好的数据库可以做到在巨大的数据集中高效地找到数据，只要告诉它你想去找什么，而不用去考虑它是如何查找的。为一个基本的 <a href=https://en.wikipedia.org/wiki/Create,_read,_update_and_delete>CRUD</a> （创建、记录、更新、删除）应用程序安装一个数据库是非常简单的， 它是一个很通用的模式，并且也适用于很多项目。</p><p>为什么 <a href=https://www.postgresql.org/>PostgreSQL</a> 一般被为 Postgres？ 它被认为是功能和性能最好的开源数据库。如果你使用过 MySQL，它们是很相似的。但是，如果你希望使用它更高级的功能，你会发现优化 Postgres 是比较容易的。它便于安装、容易使用、方便安全， 而且在树莓派 3 上运行的非常好。</p><p>本教程介绍了怎么在一个树莓派上去安装 Postgres；创建一个表；写简单查询；在树莓派、PC，或者 Mac 上使用 pgAdmin 图形用户界面；从 Python 中与数据库交互。</p><p>你掌握了这些基础知识后，你可以让你的应用程序使用复合查询连接多个表，那个时候你需要考虑的是，怎么去使用主键或外键优化及最佳实践等等。</p><h3 id=安装>安装</h3><p>一开始，你将需要去安装 Postgres 和一些其它的包。打开一个终端窗口并连接到因特网，然后运行以下命令：</p><pre tabindex=0><code>sudo apt install postgresql libpq-dev postgresql-client 
postgresql-client-common -y
</code></pre><p><img src=https://img.linux.net.cn/data/attachment/album/201711/14/231229ybrcyjabbrchszyr.png alt="installing postgres" title="installing postgres"></p><p>当安装完成后，切换到 Postgres 用户去配置数据库：</p><pre tabindex=0><code>sudo su postgres
</code></pre><p>现在，你可以创建一个数据库用户。如果你创建了一个与你的 Unix 用户帐户相同名字的用户，那个用户将被自动授权访问该数据库。因此在本教程中，为简单起见，我们将假设你使用了默认用户 <code>pi</code> 。运行 <code>createuser</code> 命令以继续：</p><pre tabindex=0><code>createuser pi -P --interactive
</code></pre><p>当得到提示时，输入一个密码 （并记住它）， 选择 <code>n</code> 使它成为一个非超级用户（LCTT 译注：此处原文有误），接下来两个问题选择 <code>y</code>（LCTT 译注：分别允许创建数据库和其它用户）。</p><p><img src=https://img.linux.net.cn/data/attachment/album/201711/14/231229kj9hqr0qdsh0dqzd.png alt="creating a postgres user" title="creating a postgres user"></p><p>现在，使用 Postgres shell 连接到 Postgres 去创建一个测试数据库：</p><pre tabindex=0><code>$ psql
&gt; create database test;
</code></pre><p>按下 <code>Ctrl+D</code> <strong>两次</strong>从 psql shell 和 postgres 用户中退出，再次以 <code>pi</code> 用户登入。你创建了一个名为 <code>pi</code> 的 Postgres 用户后，你可以从这里无需登录凭据即可访问 Postgres shell：</p><pre tabindex=0><code>$ psql test
</code></pre><p>你现在已经连接到 &ldquo;test&rdquo; 数据库。这个数据库当前是空的，不包含任何表。你可以在 psql shell 里创建一个简单的表：</p><pre tabindex=0><code>test=&gt; create table people (name text, company text);
</code></pre><p>现在你可插入数据到表中：</p><pre tabindex=0><code>test=&gt; insert into people values (&#39;Ben Nuttall&#39;, &#39;Raspberry Pi Foundation&#39;);

test=&gt; insert into people values (&#39;Rikki Endsley&#39;, &#39;Red Hat&#39;);
</code></pre><p>然后尝试进行查询：</p><pre tabindex=0><code>test=&gt; select * from people;

     name      |         company         
---------------+-------------------------
 Ben Nuttall   | Raspberry Pi Foundation
 Rikki Endsley | Red Hat
(2 rows)
</code></pre><p><img src=https://img.linux.net.cn/data/attachment/album/201711/14/231230uyhiztyhmc9tw9cc.png alt="a postgres query" title="a postgres query"></p><pre tabindex=0><code>test=&gt; select name from people where company = &#39;Red Hat&#39;;

     name      | company 
---------------+---------
 Rikki Endsley | Red Hat
(1 row)
</code></pre><h3 id=pgadmin>pgAdmin</h3><p>如果希望使用一个图形工具去访问数据库，你可以使用它。 PgAdmin 是一个全功能的 PostgreSQL GUI，它允许你去创建和管理数据库和用户、创建和修改表、执行查询，和如同在电子表格一样熟悉的视图中浏览结果。psql 命令行工具可以很好地进行简单查询，并且你会发现很多高级用户一直在使用它，因为它的执行速度很快 （并且因为他们不需要借助 GUI），但是，一般用户学习和操作数据库，使用 pgAdmin 是一个更适合的方式。</p><p>关于 pgAdmin 可以做的其它事情：你可以用它在树莓派上直接连接数据库，或者用它在其它的电脑上远程连接到树莓派上的数据库。</p><p>如果你想去访问树莓派，你可以用 <code>apt</code> 去安装它：</p><pre tabindex=0><code>sudo apt install pgadmin3
</code></pre><p>它是和基于 Debian 的系统如 Ubuntu 是完全相同的；如果你在其它发行版上安装，尝试与你的系统相关的等价的命令。 或者，如果你在 Windows 或 macOS 上，尝试从 <a href=https://www.pgadmin.org/download/>pgAdmin.org</a> 上下载 pgAdmin。注意，在 <code>apt</code> 上的可用版本是 pgAdmin3，而最新的版本 pgAdmin4，在其网站上可以找到。</p><p>在同一台树莓派上使用 pgAdmin 连接到你的数据库，从主菜单上简单地打开 pgAdmin3 ，点击 <strong>new connection</strong> 图标，然后完成注册，这时，你将需要一个名字（连接名，比如 test），改变用户为 “pi”，然后剩下的输入框留空 (或者如它们原本不动）。点击 OK，然后你在左侧的侧面版中将发现一个新的连接。</p><p><img src=https://img.linux.net.cn/data/attachment/album/201711/14/231231ryspj0jzf25s2wh2.png alt="connect your database with pgadmin" title="connect your database with pgadmin"></p><p>要从另外一台电脑上使用 pgAdmin 连接到你的树莓派数据库上，你首先需要编辑 PostgreSQL 配置允许远程连接：</p><p>1、 编辑 PostgreSQL 配置文件 <code>/etc/postgresql/9.6/main/postgresql.conf</code> ，取消 <code>listen_addresses</code> 行的注释，并把它的值从 <code>localhost</code> 改变成 <code>*</code>。然后保存并退出。</p><p>2、 编辑 pg_hba 配置文件 <code>/etc/postgresql/9.6/main/postgresql.conf</code>，将 <code>127.0.0.1/32</code> 改变成 <code>0.0.0.0/0</code> （对于IPv4）和将 <code>::1/128</code> 改变成 <code>::/0</code> （对于 IPv6）。然后保存并退出。</p><p>3、 重启 PostgreSQL 服务： <code>sudo service postgresql restart</code>。</p><p>注意，如果你使用一个旧的 Raspbian 镜像或其它发行版，版本号可能不一样。</p><p><img src=https://img.linux.net.cn/data/attachment/album/201711/14/231231cpl8zu71q33eosxv.png alt=" edit the postgresql configuration to allow remote connections" title=" edit the postgresql configuration to allow remote connections"></p><p>做完这些之后，在其它的电脑上打开 pgAdmin 并创建一个新的连接。这时，需要提供一个连接名，输入树莓派的 IP 地址作为主机（这可以在任务栏的 WiFi 图标上悬停鼠标找到，或者在一个终端中输入 <code>hostname -I</code> 找到）。</p><p><img src=https://img.linux.net.cn/data/attachment/album/201711/14/231232wl25zlm3dahm3n2h.png alt="a remote connection" title="a remote connection"></p><p>不论你连接的是本地的还是远程的数据库，点击打开 <strong>Server Groups > Servers > test > Schemas > public > Tables</strong>，右键单击 <strong>people</strong> 表，然后选择 <strong>View Data > View top 100 Rows</strong>。你现在将看到你前面输入的数据。</p><p><img src=https://img.linux.net.cn/data/attachment/album/201711/14/231233itfcdqqc7qvdv7qi.png alt="viewing test data" title="viewing test data"></p><p>你现在可以创建和修改数据库和表、管理用户，和使用 GUI 去写你自己的查询了。你可能会发现这种可视化方法比命令行更易于管理。</p><h3 id=python>Python</h3><p>要从一个 Python 脚本连接到你的数据库，你将需要 <a href=http://initd.org/psycopg/>Psycopg2</a> 这个 Python 包。你可以用 <a href=https://pypi.python.org/pypi/pip>pip</a> 来安装它：</p><pre tabindex=0><code>sudo pip3 install psycopg2
</code></pre><p>现在打开一个 Python 编辑器写一些代码连接到你的数据库：</p><pre tabindex=0><code>import psycopg2

conn = psycopg2.connect(&#39;dbname=test&#39;)
cur = conn.cursor()

cur.execute(&#39;select * from people&#39;)

results = cur.fetchall()

for result in results:
    print(result)
</code></pre><p>运行这个代码去看查询结果。注意，如果你连接的是远程数据库，在连接字符串中你将需要提供更多的凭据，比如，增加主机 IP、用户名，和数据库密码：</p><pre tabindex=0><code>conn = psycopg2.connect(&#39;host=192.168.86.31 user=pi 
password=raspberry dbname=test&#39;)
</code></pre><p>你甚至可以创建一个函数去运行特定的查询：</p><pre tabindex=0><code>def get_all_people():
    query = &#34;&#34;&#34;
    SELECT
        *
    FROM
        people
    &#34;&#34;&#34;
    cur.execute(query)
    return cur.fetchall()
</code></pre><p>和一个包含参数的查询：</p><pre tabindex=0><code>def get_people_by_company(company):
    query = &#34;&#34;&#34;
    SELECT
        *
    FROM
        people
    WHERE
        company = %s
    &#34;&#34;&#34;
    values = (company, )
    cur.execute(query, values)
    return cur.fetchall()
</code></pre><p>或者甚至是一个增加记录的函数：</p><pre tabindex=0><code>def add_person(name, company):
    query = &#34;&#34;&#34;
    INSERT INTO
        people
    VALUES
        (%s, %s)
    &#34;&#34;&#34;
    values = (name, company)
    cur.execute(query, values)
</code></pre><p>注意，这里使用了一个注入字符串到查询中的安全的方法， 你不希望被 <a href=https://xkcd.com/327/>小鲍勃的桌子</a> 害死！</p><p><img src=https://img.linux.net.cn/data/attachment/album/201711/14/231234azhhh88heic8ezc4.png alt=Python title=Python></p><p>现在你知道了这些基础知识，如果你想去进一步掌握 Postgres ，查看在 <a href=https://www.fullstackpython.com/postgresql.html>Full Stack Python</a> 上的文章。</p><p>（题图：树莓派基金会）</p><hr><p>作者简介：</p><p>Ben Nuttall - 树莓派社区的管理者。除了它为树莓派基金会所做的工作之外 ，他也投入开源软件、数学、皮艇运动、GitHub、探险活动和 Futurama。在 Twitter <a href=http://www.twitter.com/ben_nuttall>@ben_nuttall</a> 上关注他。</p><hr><p>via: <a href=https://opensource.com/article/17/10/set-postgres-database-your-raspberry-pi>https://opensource.com/article/17/10/set-postgres-database-your-raspberry-pi</a></p><p>作者：<a href=https://opensource.com/users/bennuttall>Ben Nuttall</a> 译者：<a href=https://github.com/qhwdw>qhwdw</a> 校对：<a href=https://github.com/wxy>wxy</a></p><p>本文由 <a href=https://github.com/LCTT/TranslateProject>LCTT</a> 原创编译，<a href=https://linux.cn/>Linux中国</a> 荣誉推出</p></div><footer class=post__footer><div class="post__tags tags clearfix"><svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5.0 11V3C0 1.5.8.8.8.8S1.5.0 3 0h8c1.5.0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 100-6 3 3 0 000 6z"/></svg><ul class=tags__list><li class=tags__item><a class="tags__link btn" href=/tags/postgresql/ rel=tag>PostgreSQL</a></li><li class=tags__item><a class="tags__link btn" href=/tags/%E6%A0%91%E8%8E%93%E6%B4%BE/ rel=tag>树莓派</a></li></ul></div></footer></article></main></div></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2025 Linux.cn Archive.
<span class=footer__copyright-credits>Generated with <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> and <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a> theme.</span></div></div></footer></div><script async defer src=/js/menu.js></script></body></html>