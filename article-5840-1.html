<!doctype html><html class=no-js lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>PHP 7.0 升级备注 - Linux.cn Archive</title>
<script>(function(e,t){e[t]=e[t].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content><meta property="og:title" content="PHP 7.0 升级备注"><meta property="og:description" content="PHP 7.0.0 beta1 发布了，在带来了引人注目的性能提升的同时，也带来了不少语言特性方面的改变。以下由 LCTT 翻译自对官方的升级备注，虽然目前还不是正式发布版，不过想必距离正式发布的特性已经差别不大了。（本文会持续追踪更新）  1. 向后不兼容的变化 语言变化 变量处理的变化   间接变量、属性和方法引用现在以从左到右的语义进行解释。一些例子： $$foo // 解释做 ($$foo) $foo-$bar // 解释做 ($foo-$bar) $foo-$bar() // 解释做 ($foo-$bar)() Foo::$bar() // 解释做 (Foo::$bar)()  要恢复以前的行为，需要显式地加大括号： ${$"><meta property="og:type" content="article"><meta property="og:url" content="/article-5840-1.html"><meta property="article:section" content="posts"><meta property="article:published_time" content="2015-07-20T07:31:00+00:00"><meta property="article:modified_time" content="2015-07-20T07:31:00+00:00"><meta itemprop=name content="PHP 7.0 升级备注"><meta itemprop=description content="PHP 7.0.0 beta1 发布了，在带来了引人注目的性能提升的同时，也带来了不少语言特性方面的改变。以下由 LCTT 翻译自对官方的升级备注，虽然目前还不是正式发布版，不过想必距离正式发布的特性已经差别不大了。（本文会持续追踪更新）  1. 向后不兼容的变化 语言变化 变量处理的变化   间接变量、属性和方法引用现在以从左到右的语义进行解释。一些例子： $$foo // 解释做 ($$foo) $foo-$bar // 解释做 ($foo-$bar) $foo-$bar() // 解释做 ($foo-$bar)() Foo::$bar() // 解释做 (Foo::$bar)()  要恢复以前的行为，需要显式地加大括号： ${$"><meta itemprop=datePublished content="2015-07-20T07:31:00+00:00"><meta itemprop=dateModified content="2015-07-20T07:31:00+00:00"><meta itemprop=wordCount content="1256"><meta itemprop=keywords content="PHP,PHP 7,"><link rel=preconnect href=https://fonts.bunny.net crossorigin><link rel=dns-prefetch href=//fonts.bunny.net><link rel=dns-prefetch href=//fonts.bunny.net><link rel=stylesheet href="https://fonts.bunny.net/css?family=Open+Sans:400,400i,700"><link rel=stylesheet href=/css/style.css><link rel="shortcut icon" href=/favicon.ico></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class=logo><a class=logo__link href=/ title="Linux.cn Archive" rel=home><div class="logo__item logo__text"><div class=logo__title>Linux.cn Archive</div></div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>Menu</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/><span class=menu__text>Home</span></a></li><li class=menu__item><a class=menu__link href=/categories/><span class=menu__text>Categories</span></a></li><li class=menu__item><a class=menu__link href=/tags/><span class=menu__text>Tags</span></a></li><li class=menu__item><a class=menu__link href><span class=menu__text>RSS</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>PHP 7.0 升级备注</h1><div class="post__meta meta"><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class=meta__text datetime=2015-07-20T07:31:00Z>July 20, 2015</time></div></div></header><div class="content post__content clearfix"><p>PHP 7.0.0 beta1 发布了，在带来了引人注目的性能提升的同时，也带来了不少语言特性方面的改变。以下由 LCTT 翻译自对官方的<a href=https://github.com/php/php-src/blob/php-7.0.0beta1/UPGRADING>升级备注</a>，虽然目前还不是正式发布版，不过想必距离正式发布的特性已经差别不大了。（本文会持续追踪更新）</p><p><img src=/data/attachment/album/201507/18/180247oz05zwm8py7mw8zq.png alt></p><ol><li>向后不兼容的变化</li></ol><hr><h3 id=语言变化>语言变化</h3><h4 id=变量处理的变化>变量处理的变化</h4><ul><li>间接变量、属性和方法引用现在以从左到右的语义进行解释。一些例子：</li></ul><pre tabindex=0><code>$$foo[&#39;bar&#39;][&#39;baz&#39;] // 解释做 ($$foo)[&#39;bar&#39;][&#39;baz&#39;]   
$foo-&gt;$bar[&#39;baz&#39;]   // 解释做 ($foo-&gt;$bar)[&#39;baz&#39;]
$foo-&gt;$bar[&#39;baz&#39;]() // 解释做 ($foo-&gt;$bar)[&#39;baz&#39;]()
Foo::$bar[&#39;baz&#39;]()  // 解释做 (Foo::$bar)[&#39;baz&#39;]()
</code></pre><p>要恢复以前的行为，需要显式地加大括号：</p><pre tabindex=0><code>${$foo[&#39;bar&#39;][&#39;baz&#39;]}
$foo-&gt;{$bar[&#39;baz&#39;]}
$foo-&gt;{$bar[&#39;baz&#39;]}()
Foo::{$bar[&#39;baz&#39;]}()
</code></pre><ul><li>全局关键字现在只接受简单变量。像以前的</li></ul><pre tabindex=0><code>global $$foo-&gt;bar;
</code></pre><p>现在要求如下写法：</p><pre tabindex=0><code>global ${$foo-&gt;bar};
</code></pre><ul><li>变量或函数调用的前后加上括号不再有任何影响。例如下列代码，函数调用结果以引用的方式传给一个函数</li></ul><pre tabindex=0><code>function getArray() { return [1, 2, 3]; }

$last = array_pop(getArray());
// Strict Standards: 只有变量可以用引用方式传递
$last = array_pop((getArray()));
// Strict Standards: 只有变量可以用引用方式传递
</code></pre><p>现在无论是否使用括号，都会抛出一个严格标准错误。以前在第二种调用方式下不会有提示。</p><ul><li>数组元素或对象属性自动安装引用顺序创建，现在的结果顺序将不同。例如：</li></ul><pre tabindex=0><code>$array = [];
$array[&#34;a&#34;] =&amp; $array[&#34;b&#34;];
$array[&#34;b&#34;] = 1;
var_dump($array);
</code></pre><p>现在结果是 [&ldquo;a&rdquo; => 1, &ldquo;b&rdquo; => 1]，而以前的结果是 [&ldquo;b&rdquo; => 1, &ldquo;a&rdquo; => 1]。</p><p>相关的 RFC：</p><ul><li><a href=https://wiki.php.net/rfc/uniform_variable_syntax>https://wiki.php.net/rfc/uniform_variable_syntax</a></li><li><a href=https://wiki.php.net/rfc/abstract_syntax_tree>https://wiki.php.net/rfc/abstract_syntax_tree</a></li></ul><h4 id=list-的变化>list() 的变化</h4><ul><li>list() 不再以反序赋值，例如：</li></ul><pre tabindex=0><code>list($array[], $array[], $array[]) = [1, 2, 3];
var_dump($array);
</code></pre><p>现在结果是 $array == [1, 2, 3] ，而不是 [3, 2, 1]。注意仅赋值<strong>顺序</strong>变化了，而赋值仍然一致（LCTT 译注：即以前的 list()行为是从后面的变量开始逐一赋值，这样对与上述用法就会产生 [3,2,1] 这样的结果了。）。例如，类似如下的常规用法</p><pre tabindex=0><code>list($a, $b, $c) = [1, 2, 3];
// $a = 1; $b = 2; $c = 3;
</code></pre><p>仍然保持当前的行为。</p><ul><li>不再允许对空的 list() 赋值。如下全是无效的：</li></ul><pre tabindex=0><code>list() = $a;
list(,,) = $a;
list($x, list(), $y) = $a;
</code></pre><ul><li>list() 不再支持对字符串的拆分（以前也只在某些情况下支持）。如下代码：</li></ul><pre tabindex=0><code>$string = &#34;xy&#34;;
list($x, $y) = $string;
</code></pre><p>现在的结果是： $x == null 和 $y == null （没有提示），而以前的结果是： $x == &ldquo;x&rdquo; 和 $y == &ldquo;y&rdquo; 。此外， list() 现在总是可以处理实现了 ArrayAccess 的对象，例如：</p><pre tabindex=0><code>list($a, $b) = (object) new ArrayObject([0, 1]);
</code></pre><p>现在的结果是： $a == 0 和 $b == 1。 以前 $a 和 $b 都是 null。</p><p>相关 RFC:</p><ul><li><a href=https://wiki.php.net/rfc/abstract_syntax_tree#changes_to_list>https://wiki.php.net/rfc/abstract_syntax_tree#changes_to_list</a></li><li><a href=https://wiki.php.net/rfc/fix_list_behavior_inconsistency>https://wiki.php.net/rfc/fix_list_behavior_inconsistency</a></li></ul><h4 id=foreach-的变化>foreach 的变化</h4><ul><li>foreach() 迭代不再影响数组内部指针，数组指针可通过 current()/next() 等系列的函数访问。例如：</li></ul><pre tabindex=0><code>$array = [0, 1, 2];
foreach ($array as &amp;$val) {
    var_dump(current($array));
}
</code></pre><p>现在将指向值 int(0) 三次。以前的输出是 int(1)、int(2) 和 bool(false)。</p><ul><li>在对数组按值迭代时，foreach 总是在对数组副本进行操作，在迭代中任何对数组的操作都不会影响到迭代行为。例如：</li></ul><pre tabindex=0><code>$array = [0, 1, 2];
$ref =&amp; $array; // Necessary to trigger the old behavior
foreach ($array as $val) {
    var_dump($val);
    unset($array[1]);
}
</code></pre><p>现在将打印出全部三个元素 (0 1 2)，而以前第二个元素 1 会跳过 (0 2)。</p><ul><li>在对数组按引用迭代时，对数组的修改将继续会影响到迭代。不过，现在 PHP 在使用数字作为键时可以更好的维护数组内的位置。例如，在按引用迭代过程中添加数组元素：</li></ul><pre tabindex=0><code>$array = [0];
foreach ($array as &amp;$val) {
    var_dump($val);
    $array[1] = 1;
}
</code></pre><p>现在迭代会正确的添加了元素。如上代码输出是 &ldquo;int(0) int(1)"，而以前只是 &ldquo;int(0)"。</p><ul><li>对普通（不可遍历的）对象按值或按引用迭代的行为类似于对数组进行按引用迭代。这符合以前的行为，除了如上一点所述的更精确的位置管理的改进。</li><li>对可遍历对象的迭代行为保持不变。</li></ul><p>相关 RFC: <a href=https://wiki.php.net/rfc/php7_foreach>https://wiki.php.net/rfc/php7_foreach</a></p><h4 id=参数处理的变化>参数处理的变化</h4><ul><li>不能定义两个同名的函数参数。例如，下面的方法将会触发编译时错误：</li></ul><pre tabindex=0><code>public function foo($a, $b, $unused, $unused) {
    // ...
}
</code></pre><p>如上的代码应该修改使用不同的参数名，如：</p><pre tabindex=0><code>public function foo($a, $b, $unused1, $unused2) {
    // ...
}
</code></pre><ul><li>func_get_arg() 和 func_get_args() 函数不再返回传递给参数的原始值，而是返回其当前值（也许会被修改）。例如：</li></ul><pre tabindex=0><code>function foo($x) {
    $x++;
    var_dump(func_get_arg(0));
}
foo(1);
</code></pre><p>将会打印 &ldquo;2&rdquo; 而不是 &ldquo;1&rdquo;。代码应该改成仅在调用 func_get_arg(s) 后进行修改操作。</p><pre tabindex=0><code>function foo($x) {
    var_dump(func_get_arg(0));
    $x++;
}
</code></pre><p>或者应该避免修改参数：</p><pre tabindex=0><code>function foo($x) {
    $newX = $x + 1;
    var_dump(func_get_arg(0));
}
</code></pre><ul><li>类似的，异常回溯也不再显示传递给函数的原始值，而是修改后的值。例如：</li></ul><pre tabindex=0><code>function foo($x) {
    $x = 42;
    throw new Exception;
}
foo(&#34;string&#34;);
</code></pre><p>现在堆栈跟踪的结果是：</p><pre tabindex=0><code>Stack trace:
#0 file.php(4): foo(42)
#1 {main}
</code></pre><p>而以前是：</p><pre tabindex=0><code>Stack trace:
#0 file.php(4): foo(&#39;string&#39;)
#1 {main}
</code></pre><p>这并不会影响到你的代码的运行时行为，值得注意的是在调试时会有所不同。</p><p>同样的限制也会影响到 debug_backtrace() 及其它检查函数参数的函数。</p><p>相关 RFC: <a href=https://wiki.php.net/phpng>https://wiki.php.net/phpng</a></p><h4 id=整数处理的变化>整数处理的变化</h4><ul><li>无效的八进制表示（包含大于7的数字）现在会产生编译错误。例如，下列代码不再有效：</li></ul><pre tabindex=0><code>$i = 0781; // 8 不是一个有效的八进制数字！
</code></pre><p>以前，无效的数字（以及无效数字后的任何数字）会简单的忽略。以前如上 $i 的值是 7，因为后两位数字会被悄悄丢弃。</p><ul><li>二进制以负数镜像位移现在会抛出一个算术错误：</li></ul><pre tabindex=0><code>var_dump(1 &gt;&gt; -1);
// ArithmeticError: 以负数进行位移
</code></pre><ul><li>向左位移的位数超出了整型宽度时，结果总是 0。</li></ul><pre tabindex=0><code>var_dump(1 &lt;&lt; 64); // int(0)
</code></pre><p>以前上述代码的结果依赖于所用的 CPU 架构。例如，在 x86（包括 x86-64） 上结果是 int(1)，因为其位移操作数在范围内。</p><ul><li>类似的，向右位移的位数超出了整型宽度时，其结果总是 0 或 -1 （依赖于符号）：</li></ul><pre tabindex=0><code>var_dump(1 &gt;&gt; 64);  // int(0)
var_dump(-1 &gt;&gt; 64); // int(-1)
</code></pre><p>相关 RFC: <a href=https://wiki.php.net/rfc/integer_semantics>https://wiki.php.net/rfc/integer_semantics</a></p><h4 id=字符串处理的变化>字符串处理的变化</h4><ul><li>包含十六进制数字的字符串不会再被当做数字，也不会被特殊处理。参见例子中的新行为：</li></ul><pre tabindex=0><code>var_dump(&#34;0x123&#34; == &#34;291&#34;);     // bool(false)     (以前是 true)
var_dump(is_numeric(&#34;0x123&#34;));  // bool(false)     (以前是 true)
var_dump(&#34;0xe&#34; + &#34;0x1&#34;);        // int(0)          (以前是 16)

var_dump(substr(&#34;foo&#34;, &#34;0x1&#34;)); // string(3) &#34;foo&#34; (以前是 &#34;oo&#34;)
// 注意：遇到了一个非正常格式的数字
</code></pre><p>filter_var() 可以用来检查一个字符串是否包含了十六进制数字，或这个字符串是否能转换为整数：</p><pre tabindex=0><code>$str = &#34;0xffff&#34;;
$int = filter_var($str, FILTER_VALIDATE_INT, FILTER_FLAG_ALLOW_HEX);
if (false === $int) {
    throw new Exception(&#34;Invalid integer!&#34;);
}
var_dump($int); // int(65535)
</code></pre><ul><li>由于给双引号字符串和 HERE 文档增加了 Unicode 码点转义格式（Unicode Codepoint Escape Syntax）， 所以带有无效序列的 &ldquo;\u{&rdquo; 现在会造成错误：</li></ul><pre tabindex=0><code>$str = &#34;\u{xyz}&#34;; // 致命错误：无效的 UTF-8 码点转义序列
</code></pre><p>要避免这种情况，需要转义开头的反斜杠：</p><pre tabindex=0><code>$str = &#34;\\u{xyz}&#34;; // 正确
</code></pre><p>不过，不跟随 { 的 &ldquo;\u&rdquo; 不受影响。如下代码不会生成错误，和前面的一样工作：</p><pre tabindex=0><code>$str = &#34;\u202e&#34;; // 正确
</code></pre><p>相关 RFC:</p><ul><li><a href=https://wiki.php.net/rfc/remove_hex_support_in_numeric_strings>https://wiki.php.net/rfc/remove_hex_support_in_numeric_strings</a></li><li><a href=https://wiki.php.net/rfc/unicode_escape>https://wiki.php.net/rfc/unicode_escape</a></li></ul><h4 id=错误处理的变化>错误处理的变化</h4><ul><li>现在有两个异常类： Exception 和 Error 。这两个类都实现了一个新接口： Throwable 。在异常处理代码中的类型指示也许需要修改来处理这种情况。</li><li>一些致命错误和可恢复的致命错误现在改为抛出一个 Error 。由于 Error 是一个独立于 Exception 的类，这些异常不会被已有的 try/catch 块捕获。</li></ul><p>可恢复的致命错误被转换为一个异常，所以它们不能在错误处理里面悄悄的忽略。部分情况下，类型指示失败不再能忽略。</p><ul><li>解析错误现在会生成一个 Error 扩展的 ParseError 。除了以前的基于返回值 / error<em>get</em>last() 的处理，对某些可能无效的代码的 eval() 的错误处理应该改为捕获 ParseError 。</li><li>内部类的构造函数在失败时总是会抛出一个异常。以前一些构造函数会返回 NULL 或一个不可用的对象。</li><li>一些 E_STRICT 提示的错误级别改变了。</li></ul><p>相关 RFC:</p><ul><li><a href=https://wiki.php.net/rfc/engine_exceptions_for_php7>https://wiki.php.net/rfc/engine_exceptions_for_php7</a></li><li><a href=https://wiki.php.net/rfc/throwable-interface>https://wiki.php.net/rfc/throwable-interface</a></li><li><a href=https://wiki.php.net/rfc/internal_constructor_behaviour>https://wiki.php.net/rfc/internal_constructor_behaviour</a></li><li><a href=https://wiki.php.net/rfc/reclassify_e_strict>https://wiki.php.net/rfc/reclassify_e_strict</a></li></ul><h4 id=其它的语言变化>其它的语言变化</h4><ul><li>静态调用一个不兼容的 $this 上下文的非静态调用的做法不再支持。这种情况下，$this 是没有定义的，但是对它的调用是允许的，并带有一个废弃提示。例子：</li></ul><pre tabindex=0><code>class A {
    public function test() { var_dump($this); }
}

// 注意：没有从类 A 进行扩展
class B {
    public function callNonStaticMethodOfA() { A::test(); }
}

(new B)-&gt;callNonStaticMethodOfA();

// 废弃：非静态方法 A::test() 不应该被静态调用
// 提示：未定义的变量 $this
NULL
</code></pre><p>注意，这仅出现在来自不兼容上下文的调用上。如果类 B 扩展自类 A ，调用会被允许，没有任何提示。</p><ul><li>不能使用下列类名、接口名和特殊名（大小写敏感）：</li></ul><pre tabindex=0><code>bool
int
float
string
null
false
true
</code></pre><p>这用于 class/interface/trait 声明、 class_alias() 和 use 语句中。</p><p>此外，下列类名、接口名和特殊名保留做将来使用，但是使用时尚不会抛出错误：</p><pre tabindex=0><code>resource
object
mixed
numeric
</code></pre><ul><li>yield 语句结构当用在一个表达式上下文时，不再要求括号。它现在是一个优先级在 “print” 和 “=>” 之间的右结合操作符。在某些情况下这会导致不同的行为，例如：</li></ul><pre tabindex=0><code>echo yield -1;
// 以前被解释如下
echo (yield) - 1;
// 现在被解释如下
echo yield (-1);

yield $foo or die;
// 以前被解释如下
yield ($foo or die);
// 现在被解释如下
(yield $foo) or die;
</code></pre><p>这种情况可以通过增加括号来解决。</p><ul><li>移除了 ASP (&lt;%) 和 script () 标签。</li></ul><p>RFC: <a href=https://wiki.php.net/rfc/remove_alternative_php_tags>https://wiki.php.net/rfc/remove_alternative_php_tags</a></p><ul><li>不支持以引用的方式对 new 的结果赋值。</li><li>不支持对一个来自非兼容的 $this 上下文的非静态方法的域内调用。细节参见： <a href=https://wiki.php.net/rfc/incompat_ctx>https://wiki.php.net/rfc/incompat_ctx</a> 。</li><li>不支持 ini 文件中的 # 风格的备注。使用 ; 风格的备注替代。</li><li>$HTTP_RAW_POST_DATA 不再可用，使用 php://input 流替代。</li></ul><h3 id=标准库的变化>标准库的变化</h3><ul><li>call_user_method() 和 call_user_method_array() 不再存在。</li><li>在一个输出缓冲区被创建在输出缓冲处理器里时， ob_start() 不再发出 E_ERROR，而是 E_RECOVERABLE_ERROR。</li><li>改进的 zend_qsort （使用 hybrid 排序算法）性能更好，并改名为 zend_sort。</li><li>增加静态排序算法 zend_insert_sort。</li><li>移除 fpm-fcgi 的 dl() 函数。</li><li>setcookie() 如果 cookie 名为空会触发一个 WARNING ，而不是发出一个空的 set-cookie 头。</li></ul><h3 id=其它>其它</h3><ul><li><p>Curl:</p><ul><li>去除对禁用 CURLOPT_SAFE_UPLOAD 选项的支持。所有的 curl 文件上载必须使用 curl_file / CURLFile API。</li></ul></li><li><p>Date:</p><ul><li>从 mktime() 和 gmmktime() 中移除 $is_dst 参数</li></ul></li><li><p>DBA</p><ul><li>如果键也没有出现在 inifile 处理器中，dba_delete() 现在会返回 false。</li></ul></li><li><p>GMP</p><ul><li>现在要求 libgmp 版本 4.2 或更新。</li><li>gmp_setbit() 和 gmp_clrbit() 对于负指标返回 FALSE，和其它的 GMP 函数一致。</li></ul></li><li><p>Intl:</p><ul><li>移除废弃的别名 datefmt_set_timezone_id() 和 IntlDateFormatter::setTimeZoneID()。替代使用 datefmt_set_timezone() 和 IntlDateFormatter::setTimeZone()。</li></ul></li><li><p>libxml:</p><ul><li>增加 LIBXML_BIGLINES 解析器选项。从 libxml 2.9.0 开始可用，并增加了在错误报告中行号大于 16 位的支持。</li></ul></li><li><p>Mcrypt</p><ul><li>移除等同于 mcrypt_generic_deinit() 的废弃别名 mcrypt_generic_end()。</li><li>移除废弃的 mcrypt_ecb()、 mcrypt_cbc()、 mcrypt_cfb() 和 mcrypt_ofb() 函数，它们等同于使用 MCRYPT_MODE_* 标志的 mcrypt_encrypt() 和 mcrypt_decrypt() 。</li></ul></li><li><p>Session</p><ul><li>session_start() 以数组方式接受所有的 INI 设置。例如， [&lsquo;cache_limiter&rsquo;=>&lsquo;private&rsquo;] 会设置 session.cache_limiter=private 。也支持 &lsquo;read_and_close&rsquo; 以在读取数据后立即关闭会话数据。</li><li>会话保存处理器接受使用 validate_sid() 和 update_timestamp() 来校验会话 ID 是否存在、更新会话时间戳。对旧式的用户定义的会话保存处理器继续兼容。</li><li>增加了 SessionUpdateTimestampHandlerInterface 。 validateSid()、 updateTimestamp() 定义在接口里面。</li><li>session.lazy_write(默认是 On) 的 INI 设置支持仅在会话数据更新时写入。</li></ul></li><li><p>Opcache</p><ul><li>移除 opcache.load_comments 配置语句。现在文件内备注载入无成本，并且总是启用的。</li></ul></li><li><p>OpenSSL:</p><ul><li>移除 &ldquo;rsa_key_size&rdquo; SSL 上下文选项，按给出的协商的加密算法自动设置适当的大小。</li><li>移除 &ldquo;CN_match&rdquo; 和 &ldquo;SNI_server_name&rdquo; SSL 上下文选项。使用自动侦测或 &ldquo;peer_name&rdquo; 选项替代。</li></ul></li><li><p>PCRE:</p><ul><li>移除对 /e (PREG_REPLACE_EVAL) 修饰符的支持，使用 preg_replace_callback() 替代。</li></ul></li><li><p>PDO_pgsql:</p><ul><li>移除 PGSQL_ATTR_DISABLE_NATIVE_PREPARED_STATEMENT 属性，等同于 ATTR_EMULATE_PREPARES。</li></ul></li><li><p>Standard:</p><ul><li>移除 setlocale() 中的字符串类目支持。使用 LC_* 常量替代。 instead.</li><li>移除 set_magic_quotes_runtime() 及其别名 magic_quotes_runtime()。</li></ul></li><li><p>JSON:</p><ul><li>拒绝 json_decode 中的 RFC 7159 不兼容数字格式 - 顶层 (07, 0xff, .1, -.1) 和所有层的 ([1.], [1.e1])</li><li>用一个参数调用 json_decode 等价于用空的 PHP 字符串或值调用，转换为空字符串（NULL, FALSE）的结果是 JSON 格式错误。</li></ul></li><li><p>Stream:</p><ul><li>移除 set_socket_blocking() ，等同于其别名 stream_set_blocking()。</li></ul></li><li><p>XSL:</p><ul><li>移除 xsl.security_prefs ini 选项，使用 XsltProcessor::setSecurityPrefs() 替代。</li></ul></li></ul><ol start=2><li>新功能</li></ol><hr><ul><li><p>Core</p><ul><li>增加了组式 use 声明。 (RFC: <a href=https://wiki.php.net/rfc/group_use_declarations>https://wiki.php.net/rfc/group_use_declarations</a>)</li><li>增加了 null 合并操作符 (??)。 (RFC: <a href=https://wiki.php.net/rfc/isset_ternary>https://wiki.php.net/rfc/isset_ternary</a>)</li><li>在 64 位架构上支持长度 >= 2 31 字节的字符串。</li><li>增加了 Closure::call() 方法（仅工作在用户侧的类）。</li><li>在双引号字符串和 here 文档中增加了 \u{xxxxxx} Unicode 码点转义格式。</li><li>define() 现在支持数组作为常量值，修复了一个当 define() 还不支持数组常量值时的疏忽。</li><li>增加了比较操作符 (&lt;=>)，即太空船操作符。 (RFC: <a href=https://wiki.php.net/rfc/combined-comparison-operator>https://wiki.php.net/rfc/combined-comparison-operator</a>)</li><li>为委托生成器添加了类似协程的 yield from 操作符。 (RFC: <a href=https://wiki.php.net/rfc/generator-delegation>https://wiki.php.net/rfc/generator-delegation</a>)</li><li>保留的关键字现在可以用在几种新的上下文中。 (RFC: <a href=https://wiki.php.net/rfc/context_sensitive_lexer>https://wiki.php.net/rfc/context_sensitive_lexer</a>)</li><li>增加了标量类型的声明支持，并可以使用 declare(strict_types=1) 的声明严格模式。 (RFC: <a href=https://wiki.php.net/rfc/scalar_type_hints_v5>https://wiki.php.net/rfc/scalar_type_hints_v5</a>)</li><li>增加了对加密级安全的用户侧的随机数发生器的支持。 (RFC: <a href=https://wiki.php.net/rfc/easy_userland_csprng>https://wiki.php.net/rfc/easy_userland_csprng</a>)</li></ul></li><li><p>Opcache</p><ul><li>增加了基于文件的二级 opcode 缓存（实验性——默认禁用）。要启用它，PHP 需要使用 &ndash;enable-opcache-file 配置和构建，然后 opcache.file_cache= 配置指令就可以设置在 php.ini 中。二级缓存也许可以提升服务器重启或 SHM 重置时的性能。此外，也可以设置 opcache.file_cache_only=1 来使用文件缓存而根本不用 SHM（也许对于共享主机有用）；设置 opcache.file_cache_consistency_checks=0 来禁用文件缓存一致性检查，以加速载入过程，有安全风险。</li></ul></li><li><p>OpenSSL</p><ul><li>当用 OpenSSL 1.0.2 及更新构建时，增加了 &ldquo;alpn_protocols&rdquo; SSL 上下文选项来允许加密的客户端/服务器流使用 ALPN TLS 扩展去协商替代的协议。协商后的协议信息可以通过 stream_get_meta_data() 输出访问。</li></ul></li><li><p>Reflection</p><ul><li>增加了一个 ReflectionGenerator 类（yield from Traces，当前文件/行等等）。</li><li>增加了一个 ReflectionType 类来更好的支持新的返回类型和标量类型声明功能。新的 ReflectionParameter::getType() 和 ReflectionFunctionAbstract::getReturnType() 方法都返回一个 ReflectionType 实例。</li></ul></li><li><p>Stream</p><ul><li>添加了新的仅用于 Windows 的流上下文选项以允许阻塞管道读取。要启用该功能，当创建流上下文时，传递 array(&ldquo;pipe&rdquo; => array(&ldquo;blocking&rdquo; => true)) 。要注意的是，该选项会导致管道缓冲区的死锁，然而它在几个命令行场景中有用。</li></ul></li></ul><ol start=3><li>SAPI 模块的变化</li></ol><hr><ul><li>FPM<ul><li>修复错误 #65933 （不能设置超过1024字节的配置行）。</li><li>Listen = port 现在监听在所有地址上（IPv6 和 IPv4 映射的）。</li></ul></li></ul><ol start=4><li>废弃的功能</li></ol><hr><ul><li><p>Core</p><ul><li>废弃了 PHP 4 风格的构建函数（即构建函数名必须与类名相同）。</li><li>废弃了对非静态方法的静态调用。</li></ul></li><li><p>OpenSSL</p><ul><li>废弃了 &ldquo;capture_session_meta&rdquo; SSL 上下文选项。 在流资源上活动的加密相关的元数据可以通过 stream_get_meta_data() 的返回值访问。</li></ul></li></ul><ol start=5><li>函数的变化</li></ol><hr><ul><li><p>parse_ini_file():</p></li><li><p>parse_ini_string():</p><ul><li>添加了扫描模式 INI<em>SCANNER</em>TYPED 来得到 yield 类型的 .ini 值。</li></ul></li><li><p>unserialize():</p><ul><li>给 unserialize 函数添加了第二个参数 (RFC: <a href=https://wiki.php.net/rfc/secure_unserialize>https://wiki.php.net/rfc/secure_unserialize</a>) 来指定可接受的类： unserialize($foo, [&ldquo;allowed_classes&rdquo; => [&ldquo;MyClass&rdquo;, &ldquo;MyClass2&rdquo;]]);</li></ul></li><li><p>proc_open():</p><ul><li>可以被 proc_open() 使用的最大管道数以前被硬编码地限制为 16。现在去除了这个限制，只受限于 PHP 的可用内存大小。</li><li>新添加的仅用于 Windows 的配置选项 &ldquo;blocking_pipes&rdquo; 可以用于强制阻塞对子进程管道的读取。这可以用于几种命令行应用场景，但是它会导致死锁。此外，这与新的流的管道上下文选项相关。</li></ul></li><li><p>array_column():</p><ul><li>该函数现在支持把对象数组当做二维数组。只有公开属性会被处理，对象里面使用 __get() 的动态属性必须也实现 __isset() 才行。</li></ul></li><li><p>stream_context_create()</p><ul><li>现在可以接受一个仅 Windows 可用的配置 array(&ldquo;pipe&rdquo; => array(&ldquo;blocking&rdquo; => )) 来强制阻塞管道读取。该选项应该小心使用，该平台有可能导致管道缓冲区的死锁。</li></ul></li></ul><ol start=6><li>新函数</li></ol><hr><ul><li><p>GMP</p><ul><li>添加了 gmp_random_seed()。</li></ul></li><li><p>PCRE:</p><ul><li>添加了 preg_replace_callback_array 函数。 (RFC: <a href=https://wiki.php.net/rfc/preg_replace_callback_array>https://wiki.php.net/rfc/preg_replace_callback_array</a>)</li></ul></li><li><p>Standard . 添加了整数除法 intdiv() 函数。 . 添加了重置错误状态的 error_clear_last() 函数。</p></li><li><p>Zlib: . 添加了 deflate_init()、 deflate_add()、 inflate_init()、 inflate_add() 函数来运行递增和流的压缩/解压。</p></li></ul><ol start=7><li>新的类和接口</li></ol><hr><p>（暂无）</p><ol start=8><li>移除的扩展和 SAPI</li></ol><hr><ul><li>sapi/aolserver</li><li>sapi/apache</li><li>sapi/apache_hooks</li><li>sapi/apache2filter</li><li>sapi/caudium</li><li>sapi/continuity</li><li>sapi/isapi</li><li>sapi/milter</li><li>sapi/nsapi</li><li>sapi/phttpd</li><li>sapi/pi3web</li><li>sapi/roxen</li><li>sapi/thttpd</li><li>sapi/tux</li><li>sapi/webjames</li><li>ext/mssql</li><li>ext/mysql</li><li>ext/sybase_ct</li><li>ext/ereg</li></ul><p>更多细节参见：</p><ul><li><a href=https://wiki.php.net/rfc/removal_of_dead_sapis_and_exts>https://wiki.php.net/rfc/removal_of_dead_sapis_and_exts</a></li><li><a href=https://wiki.php.net/rfc/remove_deprecated_functionality_in_php7>https://wiki.php.net/rfc/remove_deprecated_functionality_in_php7</a></li></ul><p>注意：NSAPI 没有在 RFC 中投票，不过它会在以后移除。这就是说，它相关的 SDK 今后不可用。</p><ol start=9><li>扩展的其它变化</li></ol><hr><ul><li>Mhash<ul><li>Mhash 今后不是一个扩展了，使用 function_exists(&ldquo;mhash&rdquo;) 来检查器是否可用。</li></ul></li></ul><ol start=10><li>新的全局常量</li></ol><hr><ul><li><p>Core . 添加 PHP_INT_MIN</p></li><li><p>Zlib</p><ul><li>添加的这些常量用于控制新的增量deflate_add() 和 inflate_add() 函数的刷新行为：</li><li>ZLIB_NO_FLUSH</li><li>ZLIB_PARTIAL_FLUSH</li><li>ZLIB_SYNC_FLUSH</li><li>ZLIB_FULL_FLUSH</li><li>ZLIB_BLOCK</li><li>ZLIB_FINISH</li></ul></li><li><p>GD</p><ul><li><p>移除了 T1Lib 支持，这样由于对 T1Lib 的可选依赖，如下将来不可用：函数：</p></li><li><p>imagepsbbox()</p></li><li><p>imagepsencodefont()</p></li><li><p>imagepsextendedfont()</p></li><li><p>imagepsfreefont()</p></li><li><p>imagepsloadfont()</p></li><li><p>imagepsslantfont()</p></li><li><p>imagepstext()资源：</p></li><li><p>&lsquo;gd PS font&rsquo;</p></li><li><p>&lsquo;gd PS encoding&rsquo;</p></li></ul></li></ul><ol start=11><li>INI 文件处理的变化</li></ol><hr><ul><li>Core<ul><li>移除了 asp_tags ini 指令。如果启用它会导致致命错误。</li><li>移除了 always_populate_raw_post_data ini 指令。</li></ul></li></ul><ol start=12><li>Windows 支持</li></ol><hr><ul><li><p>Core</p><ul><li>在 64 位系统上支持原生的 64 位整数。</li><li>在 64 位系统上支持大文件。</li><li>支持 getrusage()。</li></ul></li><li><p>ftp</p><ul><li>所带的 ftp 扩展总是共享库的。</li><li>对于 SSL 支持，取消了对 openssl 扩展的依赖，取而代之仅依赖 openssl 库。如果在编译时需要，会自动启用 ftp_ssl_connect()。</li></ul></li><li><p>odbc</p><ul><li>所带的 odbc 扩展总是共享库的。</li></ul></li></ul><ol start=13><li>其它变化</li></ol><hr><ul><li>Core<ul><li>NaN 和 Infinity 转换为整数时总是 0，而不是未定义和平台相关的。</li><li>对非对象调用方法会触发一个可捕获错误，而不是致命错误；参见： <a href=https://wiki.php.net/rfc/catchable-call-to-member-of-non-object>https://wiki.php.net/rfc/catchable-call-to-member-of-non-object</a></li><li>zend_parse_parameters、类型提示和转换，现在总是用 &ldquo;integer&rdquo; 和 &ldquo;float&rdquo;，而不是 &ldquo;long&rdquo; 和 &ldquo;double&rdquo;。</li><li>如果 ignore_user_abort 设置为 true ，对应中断的连接，输出缓存会继续工作。</li></ul></li></ul><hr><p>via: <a href=https://github.com/php/php-src/blob/php-7.0.0beta1/UPGRADING>https://github.com/php/php-src/blob/php-7.0.0beta1/UPGRADING</a></p><p>作者：<a href=https://github.com/php>php</a> 译者：<a href=https://github.com/wxy>wxy</a> 校对：<a href=https://github.com/wxy>wxy</a></p><p>本文由 <a href=https://github.com/LCTT/TranslateProject>LCTT</a> 原创翻译，<a href=https://linux.cn/>Linux中国</a> 荣誉推出</p></div><footer class=post__footer><div class="post__tags tags clearfix"><svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5.0 11V3C0 1.5.8.8.8.8S1.5.0 3 0h8c1.5.0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 100-6 3 3 0 000 6z"/></svg><ul class=tags__list><li class=tags__item><a class="tags__link btn" href=/tags/php/ rel=tag>PHP</a></li><li class=tags__item><a class="tags__link btn" href=/tags/php-7/ rel=tag>PHP 7</a></li></ul></div></footer></article></main></div></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2025 Linux.cn Archive.
<span class=footer__copyright-credits>Generated with <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> and <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a> theme.</span></div></div></footer></div><script async defer src=/js/menu.js></script></body></html>