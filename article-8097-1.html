<!doctype html><html class=no-js lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Samba 系列（三）：使用 Windows 10 的 RSAT 工具来管理 Samba4 活动目录架构 - Linux.cn Archive</title>
<script>(function(e,t){e[t]=e[t].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content><meta property="og:title" content="Samba 系列（三）：使用 Windows 10 的 RSAT 工具来管理 Samba4 活动目录架构"><meta property="og:description" content="这一节的Samba4 AD DC 架构系列文章，我们将会讨论如何把 Windows 10 系统的电脑添加到 Samba4 域环境中，以及如何在 Windows 10 系统下管理域环境。"><meta property="og:type" content="article"><meta property="og:url" content="/article-8097-1.html"><meta property="article:section" content="posts"><meta property="article:published_time" content="2017-01-05T23:05:00+00:00"><meta property="article:modified_time" content="2017-01-05T23:05:00+00:00"><meta itemprop=name content="Samba 系列（三）：使用 Windows 10 的 RSAT 工具来管理 Samba4 活动目录架构"><meta itemprop=description content="这一节的Samba4 AD DC 架构系列文章，我们将会讨论如何把 Windows 10 系统的电脑添加到 Samba4 域环境中，以及如何在 Windows 10 系统下管理域环境。"><meta itemprop=datePublished content="2017-01-05T23:05:00+00:00"><meta itemprop=dateModified content="2017-01-05T23:05:00+00:00"><meta itemprop=wordCount content="583"><meta itemprop=keywords content="Samba,活动目录,"><link rel=preconnect href=https://fonts.bunny.net crossorigin><link rel=dns-prefetch href=//fonts.bunny.net><link rel=dns-prefetch href=//fonts.bunny.net><link rel=stylesheet href="https://fonts.bunny.net/css?family=Open+Sans:400,400i,700"><link rel=stylesheet href=/css/style.css><link rel="shortcut icon" href=/favicon.ico></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class=logo><a class=logo__link href=/ title="Linux.cn Archive" rel=home><div class="logo__item logo__text"><div class=logo__title>Linux.cn Archive</div></div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>Menu</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/><span class=menu__text>Home</span></a></li><li class=menu__item><a class=menu__link href=/categories/><span class=menu__text>Categories</span></a></li><li class=menu__item><a class=menu__link href=/tags/><span class=menu__text>Tags</span></a></li><li class=menu__item><a class=menu__link href><span class=menu__text>RSS</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>Samba 系列（三）：使用 Windows 10 的 RSAT 工具来管理 Samba4 活动目录架构</h1><div class="post__meta meta"><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class=meta__text datetime=2017-01-05T23:05:00Z>January 05, 2017</time></div></div></header><div class="content post__content clearfix"><p>这一节的Samba4 AD DC 架构系列文章，我们将会讨论如何把 Windows 10 系统的电脑添加到 Samba4 域环境中，以及如何在 Windows 10 系统下管理域环境。</p><p><img src=/data/attachment/album/201701/05/225257qbvfnlqngq2wlvqo.jpg alt></p><p>一旦 Windows 10 系统加入到 Samba4 AD DC ，我们就可以在 Windows 10 系统中创建、删除或者禁用域用户和组了，可以创建新的组织单元，创建、编辑和管理域策略，还可以管理 Samba4 域 DNS 服务。</p><p>上面所有的功能和其它一些复杂的与域管理相关的工作都可以通过 Windows 环境下的 RSAT 工具来完成—— Microsoft 远程服务器管理工具。</p><h4 id=要求>要求</h4><p>1、 <a href=/article-8065-1.html>在 Ubuntu 系统上使用 Samba4 来创建活动目录架构（一）</a></p><p>2、 <a href=/article-8070-1.html>在 Linux 命令行下管理 Samba4 AD 架构（二）</a></p><h3 id=第一步配置域时间同步>第一步：配置域时间同步</h3><p>1、在使用 Windows 10 系统的 RSAT 工具来管理 Samba4 ADDC 之前，我们需要了解与活动目录相关的一个很重要的服务，该服务要求<a href=http://www.tecmint.com/how-to-synchronize-time-with-ntp-server-in-ubuntu-linux-mint-xubuntu-debian/>精确的时间同步</a>。</p><p>在大多数的 Linux 发行版中，都由 NTP 进程提供时间同步机制。AD 环境默认允许最大的时间差距是 5 分钟。</p><p>如果时间差距超过 5 分钟，你将会遇到各种各样的异常报错，最严重的会影响到 AD 用户、域成员服务器或共享访问等。</p><p>为了在 Ubuntu 系统中安装网络时间协议进程和 NTP 客户端工具，可执行以下命令：</p><pre tabindex=0><code>$ sudo apt-get install ntp ntpdate
</code></pre><p><img src=/data/attachment/album/201701/05/230141e8r2a4477a94zp67.png alt="Install NTP on Ubuntu"></p><p><em>在 Ubuntu 系统下安装 NTP 服务</em></p><p>2、下一步，修改 NTP 配置文件，使用一个离你最近的 NTP 服务地址列表替换默认的 NTP 池服务列表。</p><p>NTP 服务器地址列表可以从 NTP 地址库项目官方网站获取：<a href=http://www.pool.ntp.org/en/>http://www.pool.ntp.org/en/</a>。</p><pre tabindex=0><code>$ sudo nano /etc/ntp.conf
</code></pre><p>在每一行 <code>pool</code> 前添加一个 <code>#</code> 符号以注释默认的服务器列表，并替换为适合你的 NTP 服务器地址，如下图所示：</p><pre tabindex=0><code>pool 0.ro.pool.ntp.org iburst
pool 1.ro.pool.ntp.org iburst
pool 2.ro.pool.ntp.org iburst
# Use Ubuntu&#39;s ntp server as a fallback.
pool 3.ro.pool.ntp.org
</code></pre><p><img src=/data/attachment/album/201701/05/230142ceky5ez9dek4udrn.png alt="Configure NTP Server in Ubuntu"></p><p><em>在 Ubuntu 系统下配置 NTP 服务</em></p><p>3、此时，先不要关闭该文件。移动光标到文件顶部，在 <code>driftfile</code> 参数后面添加下面一行内容。该设置是为了让客户端查询该服务时使用 AD 的 NTP 签署请求。</p><pre tabindex=0><code>ntpsigndsocket /var/lib/samba/ntp_signd/
</code></pre><p><img src=/data/attachment/album/201701/05/230143e8kixc8a7afcxxtt.png alt="Sync AD with NTP"></p><p><em>使用 NTP 来同步 AD</em></p><p>4、最后，移动光标到文件底部并添加如下一行内容，如截图所示，仅允许网络客户端查询该服务器上的时间。</p><pre tabindex=0><code>restrict default kod nomodify notrap nopeer mssntp
</code></pre><p><img src=/data/attachment/album/201701/05/230144dlglhukdnh1lffon.png alt="Query Clients to NTP Server"></p><p><em>限制 NTP 服务的查询客户端</em></p><p>5、设置完成之后，保存并关闭 NTP 配置文件，为了让 NTP 服务读取 <code>ntp_signed</code> 目录，需要授予 NTP 服务合适的权限。</p><p>以下是 Samba NTP socket 的系统路径。之后，重启 NTP 服务以应用更改，并使用 <a href=http://www.tecmint.com/20-netstat-commands-for-linux-network-management/>netstat 命令</a>与<a href=http://www.tecmint.com/12-practical-examples-of-linux-grep-command/>grep 过滤</a>相接合来检查 NTP 服务是否正常。</p><pre tabindex=0><code>$ sudo chown root:ntp /var/lib/samba/ntp_signd/
$ sudo chmod 750 /var/lib/samba/ntp_signd/
$ sudo systemctl restart ntp
$ sudo netstat –tulpn | grep ntp
</code></pre><p><img src=/data/attachment/album/201701/05/230145jcemacqwqgeddcac.png alt="Grant Permission to NTP"></p><p><em>给 NTP 服务授权</em></p><p>使用 ntpq 命令行工具来监控 NTP 进程，加上 <code>-p</code> 参数来显示摘要信息。</p><pre tabindex=0><code>$ ntpq -p
</code></pre><p><img src=/data/attachment/album/201701/05/230147weopy1x0uzu3ciee.png alt="Monitor NTP Server Pool"></p><p><em>监控 NTP 服务器池</em></p><h3 id=第二步处理-ntp-时间同步异常问题>第二步：处理 NTP 时间同步异常问题</h3><p>6、有时候 NTP 进程在尝试与上游 ntp 服务端同步时间的计算过程中会卡住，导致客户端使用 <code>ntpdate</code> 工具手动强制同步时间时报如下错误：</p><pre tabindex=0><code># ntpdate -qu adc1
ntpdate[4472]: no server suitable for synchronization found
</code></pre><p><img src=/data/attachment/album/201701/05/230148jz2u2p2mi828rnm2.png alt="NTP Time Synchronization Error"></p><p><em>NTP 时间同步异常</em></p><p><code>ntpdate</code> 命令加上 <code>-d</code> 调试选项：</p><pre tabindex=0><code># ntpdate -d adc1.tecmint.lan
Server dropped: Leap not in sync
</code></pre><p><img src=/data/attachment/album/201701/05/230149xbjzyjqticltnnyn.png alt="NTP Server Dropped Leap Not in Sync"></p><p><em>NTP Server Dropped Leap Not in Sync</em></p><p>7、为了避免出现该问题，使用下面的方法来解决这个问题：在服务器上停止 NTP 服务，使用 <code>ntpdate</code> 客户端工具加上 <code>-b</code> 参数指定外部 peer 地址来手动强制同步时间，如下图所示：</p><pre tabindex=0><code># systemctl stop ntp.service
# ntpdate -b 2.ro.pool.ntp.org  [你的 ntp peer]
# systemctl start ntp.service
# systemctl status ntp.service
</code></pre><p><img src=/data/attachment/album/201701/05/230151j7565yyjyzyl2x5j.png alt="Force NTP Time Synchronization"></p><p><em>强制 NTP 时间同步</em></p><p>8、当时间正确同步之后，启动服务器上的 NTP 服务，并且在客户端服务器上执行如下命令来验证 NTP 时间同步服务是否可用：</p><pre tabindex=0><code># ntpdate -du adc1.tecmint.lan    [你的 AD DC 服务器]
</code></pre><p><img src=/data/attachment/album/201701/05/230151sao5x3jds35joa5s.png alt="Verify NTP Time Synchronization"></p><p><em>验证 NTP 时间同步</em></p><p>至此， NTP 服务应该已经工作正常了。</p><h3 id=第三步把-windows-10-系统加入域环境>第三步：把 Windows 10 系统加入域环境</h3><p>9、从我们的前一篇文章可以看出，<a href=/article-8070-1.html>Samba4 活动目录可以使用 samba-tool 工具在命令行下管理</a>，可以直接在服务器上的 VTY 控制台或者通过 SSH 工具远程连接到服务器上进行管理。</p><p>另外，更直观更灵活的方式是使用已加入域的 Windows 电脑中的微软远程服务器管理工具（RSAT）来管理我们的 Samba4 AD 域控制器。这些工具在当前的大多数 Windows 系统中都可以使用。</p><p>把 Windows 10 或是之前版本的微软操作系统加入到 Samba4 AD DC 环境中的过程也是非常容易的。首先，确保你的 Windows 10 电脑已经设置了正确的 Samba4 DNS 服务器的 IP 地址，以查询出准确的域解析结果。</p><p>打开“控制面板 -> 网络和 Internet -> 网络和共享中心 -> 网卡设置 -> 属性 -> IPv4 -> 属性 -> 使用下面的 DNS 服务器地址”，并且手动输入 Samba4 AD 服务器的 IP 地址，如下图所示：</p><p><img src=/data/attachment/album/201701/05/230153sa44zwfwhibhrl92.png alt="join Windows to Samba4 AD"></p><p><em>把 Windows 10 加入到 Samba4 AD 环境</em></p><p><img src=/data/attachment/album/201701/05/230155g1jroovxq1b11vwi.png alt="Add DNS and Samba4 AD IP Address"></p><p><em>添加 DNS 和 Samba4 AD 服务器地址</em></p><p>这里的 <code>192.168.1.254</code> 是 Samba4 AD 域控服务器的地址，用于域名解析。相应替换该 IP 地址。</p><p>10、下一步，点击 OK 按钮以应用网络设置，打开 CMD 命令行窗口，通过 ping 域名和 Samba4 服务器的 FQDN 地址来测试通过 DNS 解析到域是否连通。</p><pre tabindex=0><code>ping tecmint.lan
ping adc1.tecmint.lan
</code></pre><p><img src=/data/attachment/album/201701/05/230157p01s58ushq1h1tsu.png alt="Check Network Connectivity Between Windows and Samba4 AD"></p><p><em>检查 Windows 和 Samb4 AD 服务器的网络连通性</em></p><p>11、如果 Windows 客户端 DNS 查询的结果解析正确，那么，你还需要确认客户端时间是否已跟域环境同步。</p><p>打开“控制面板 -> 时钟、语言和区域 -> 设置时间和日期 -> Internet 时间页 -> 更改设置”，输入你同步时间的域名和 Internet 时间服务器字段。</p><p>点击立即更新按钮来强制与域同步时间，点击 OK 关闭窗口。</p><p><img src=/data/attachment/album/201701/05/230159uki9xqm9elk99ppq.png alt="Synchronize Time with Internet Server"></p><p><em>与 Internet 服务器同步时间</em></p><p>12、最后，通过打开“系统属性 -> 更改 -> 域成员 -> 输入域名”，点击 OK，输入你的域管理员账号和密码，再次点击 OK。</p><p>应该弹出一个新的窗口通知你已经是一个域成员了。点击 OK 关闭弹出窗口，并且重启机器以应用域更改。</p><p>下面的截图将说明这些操作步骤。</p><p><img src=/data/attachment/album/201701/05/230201zsswddsmgisfmc5n.png alt="Join Windows Domain to Samba4 AD"></p><p><em>把 Windows 域加入到 Samba4 AD 环境</em></p><p><img src=/data/attachment/album/201701/05/230203s1fwccwcmw1wwcgz.png alt="Enter Domain Administration Login"></p><p><em>输入域管理员账号登录</em></p><p><img src=/data/attachment/album/201701/05/230204upxryvf1r8nmtjh3.png alt="Domain Joined to Samba4 AD Confirmation"></p><p><em>确认域已加入到 Samba4 AD 环境</em></p><p><img src=/data/attachment/album/201701/05/230204osq8exq9qszgh2st.png alt="Restart Windows Server for Changes"></p><p><em>重启 Windows 服务器以应用更改</em></p><p>13、重启之后，单击其它用户并且使用具有管理员权限的 Samba4 域账号登录到 Windows 系统，你已经准备好进入到后边几个步骤了。</p><p><img src=/data/attachment/album/201701/05/230206wktbpxookkbjw2wo.png alt="Login to Windows Using Samba4 AD Account"></p><p><em>使用 Samba4 AD 账号登录到 Windows</em></p><h3 id=第四步使用-rsat-工具来管理-samba4-ad-dc>第四步：使用 RSAT 工具来管理 Samba4 AD DC</h3><p>14、微软远程服务器管理工具（RSAT）被广泛地用来管理 Samba4 活动目录，你可以根据你的 Windows 系统版本从下面的地址来下载该工具：</p><ol><li>Windows 10: <a href="https://www.microsoft.com/en-us/download/details.aspx?id=45520">https://www.microsoft.com/en-us/download/details.aspx?id=45520</a></li><li>Windows 8.1: <a href="http://www.microsoft.com/en-us/download/details.aspx?id=39296">http://www.microsoft.com/en-us/download/details.aspx?id=39296</a></li><li>Windows 8: <a href="http://www.microsoft.com/en-us/download/details.aspx?id=28972">http://www.microsoft.com/en-us/download/details.aspx?id=28972</a></li><li>Windows 7: <a href="http://www.microsoft.com/en-us/download/details.aspx?id=7887">http://www.microsoft.com/en-us/download/details.aspx?id=7887</a></li></ol><p>一旦 Windows 10 独立安装包下载完成，运行安装包，等待安装完成并重启机器以应用所有更新。</p><p>重启之后，打开“控制面板 -> 程序（卸载程序） -> 启用或关闭 Windows 功能”，勾选所有的远程服务器管理工具。</p><p>点击 OK 开始安装，安装完成之后重启系统。</p><p><img src=/data/attachment/album/201701/05/230208iejuz6kh5egj5yuj.png alt="Administer Samba4 AD from Windows"></p><p><em>从 Windows 系统下管理 Samba4 AD</em></p><p>15、要进入 RSAT 工具集，打开“控制面板 -> 系统和安全 -> 管理工具”。</p><p>这些工具也可以在开始工菜单的管理工具菜单中找到。另外，你也可以打开 Windows MMC 工具和管理单元，从“文件 -> 添加/删除管理单元”菜单中访问它们。</p><p><img src=/data/attachment/album/201701/05/230209iuu8m8dil0z9ubuc.png alt="Access Remote Server Administration Tools"></p><p><em>访问远程服务器管理工具集</em></p><p>最常用的工具，比如 AD UC ，DNS 和组策略管理工具可以通过从右键菜单发送到功能来新建快捷方式到桌面直接运行。</p><p>16、你可以通过 AD UC 和列出域里的电脑（新加入的 Windows 机器应该出现在列表中）来验证 RSAT 功能，创建一个组织单元或组。</p><p>在 Samba4 服务器上使用 <code>wbinf</code> 命令来检查用户和组是否已经创建成功。</p><p><img src=/data/attachment/album/201701/05/230211k5zin5xiinen7rht.png alt="Active Directory Users and Computers"></p><p><em>活动目录用户和计算机</em></p><p><img src=/data/attachment/album/201701/05/230212o6rrhb31z1thgt1u.png alt="Create Organizational Units and New Users"></p><p><em>创建组织单元和新用户</em></p><p><img src=/data/attachment/album/201701/05/230213v41occbz4bcpcbcz.png alt="Confirm Samba4 AD Users"></p><p><em>确认 Samba4 AD 用户</em></p><p>就这些吧！该主题的下一篇文章将包含其它 Samba4 活动目录的重要内容，包括通过 RSAT 工具来管理 Samba4 活动目录，比如，如何管理 DNS 服务器，添加 DNS 记录和创建 DNS 解析查询区，如何管理及应用域策略以及域用户如何创建交互式登录提示信息。</p><hr><p>作者简介：我是一个电脑迷，开源软件及 Linux 系统爱好者，有近4年的 Linux 桌面和服务器系统及 bash 编程经验。</p><hr><p>via: <a href=http://www.tecmint.com/manage-samba4-ad-from-windows-via-rsat/>http://www.tecmint.com/manage-samba4-ad-from-windows-via-rsat/</a></p><p>作者：<a href=http://www.tecmint.com/author/cezarmatei/>Matei Cezar</a> 译者：<a href=https://github.com/rusking>rusking</a> 校对：<a href=https://github.com/wxy>wxy</a></p><p>本文由 <a href=https://github.com/LCTT/TranslateProject>LCTT</a> 原创编译，<a href=https://linux.cn/>Linux中国</a> 荣誉推出</p></div><footer class=post__footer><div class="post__tags tags clearfix"><svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5.0 11V3C0 1.5.8.8.8.8S1.5.0 3 0h8c1.5.0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 100-6 3 3 0 000 6z"/></svg><ul class=tags__list><li class=tags__item><a class="tags__link btn" href=/tags/samba/ rel=tag>Samba</a></li><li class=tags__item><a class="tags__link btn" href=/tags/%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95/ rel=tag>活动目录</a></li></ul></div></footer></article></main></div></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2025 Linux.cn Archive.
<span class=footer__copyright-credits>Generated with <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> and <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a> theme.</span></div></div></footer></div><script async defer src=/js/menu.js></script></body></html>