<!doctype html><html class=no-js lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>在 Fedora 中结合权能使用 Podman - Linux.cn Archive</title>
<script>(function(e,t){e[t]=e[t].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content><meta property="og:title" content="在 Fedora 中结合权能使用 Podman"><meta property="og:description" content="本文将演示如何使用 POSIX 权能Capability 来保护 Podman 容器的安全。Podman 是 RHEL8 中默认的容器管理工具。"><meta property="og:type" content="article"><meta property="og:url" content="/article-12859-1.html"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-11-25T22:06:57+00:00"><meta property="article:modified_time" content="2020-11-25T22:06:57+00:00"><meta itemprop=name content="在 Fedora 中结合权能使用 Podman"><meta itemprop=description content="本文将演示如何使用 POSIX 权能Capability 来保护 Podman 容器的安全。Podman 是 RHEL8 中默认的容器管理工具。"><meta itemprop=datePublished content="2020-11-25T22:06:57+00:00"><meta itemprop=dateModified content="2020-11-25T22:06:57+00:00"><meta itemprop=wordCount content="180"><meta itemprop=keywords content="Podman,权能,"><link rel=preconnect href=https://fonts.bunny.net crossorigin><link rel=dns-prefetch href=//fonts.bunny.net><link rel=dns-prefetch href=//fonts.bunny.net><link rel=stylesheet href="https://fonts.bunny.net/css?family=Open+Sans:400,400i,700"><link rel=stylesheet href=/css/style.css><link rel="shortcut icon" href=/favicon.ico></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class=logo><a class=logo__link href=/ title="Linux.cn Archive" rel=home><div class="logo__item logo__text"><div class=logo__title>Linux.cn Archive</div></div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>Menu</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/><span class=menu__text>Home</span></a></li><li class=menu__item><a class=menu__link href=/categories/><span class=menu__text>Categories</span></a></li><li class=menu__item><a class=menu__link href=/tags/><span class=menu__text>Tags</span></a></li><li class=menu__item><a class=menu__link href><span class=menu__text>RSS</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>在 Fedora 中结合权能使用 Podman</h1><div class="post__meta meta"><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class=meta__text datetime=2020-11-25T22:06:57Z>November 25, 2020</time></div></div></header><div class="content post__content clearfix"><p><img src=/data/attachment/album/202011/25/220701co4nmvtpkpjwzvno.jpg alt></p><p>容器化是一项蓬勃发展的技术。在不久的将来，多达百分之七十五的全球组织可能会运行某种类型的容器化技术。由于广泛使用的技术更容易成为黑客攻击的目标，因此保护容器的安全就显得尤为重要。本文将演示如何使用 POSIX 权能 Capability 来保护 Podman 容器的安全。Podman 是 RHEL8 中默认的容器管理工具。</p><h3 id=确定-podman-容器的权限模式>确定 Podman 容器的权限模式</h3><p>容器以特权模式或无特权模式运行。在特权模式下，<a href=https://linuxcontainers.org/lxc/security/#privileged-containers>容器的 uid 0 被映射到宿主机的 uid 0</a>。对于某些情况，无特权的容器<a href=https://github.com/containers/podman/blob/master/rootless.md>缺乏对宿主机资源的充分访问能力</a>。但不管其操作模式如何，包括 强制访问控制 Mandatory Access Control （MAC：如 apparmor、SELinux 等）、seccomp 过滤器、删除 权能 Capability 、命名空间等在内的技术有助于确保容器的安全。</p><p>要从容器外部确定特权模式：</p><pre tabindex=0><code>$ podman inspect --format=&#34;{{.HostConfig.Privileged}}&#34; &lt;container id&gt;
</code></pre><p>如果上面的命令返回 <code>true</code>，那么容器在特权模式下运行。如果返回 <code>false</code>，那么容器在非特权模式下运行。</p><p>要从容器内部确定特权模式：</p><pre tabindex=0><code>$ ip link add dummy0 type dummy
</code></pre><p>如果该命令允许你创建一个接口，那么你运行的是一个特权容器，否则你运行的是一个非特权容器。</p><h3 id=权能>权能</h3><p>命名空间隔离了容器的进程，使其无法任意访问宿主机的资源，也无法访问在同一宿主机上运行的其他容器的资源。然而，在<strong>特权</strong>容器内的进程仍然可以做一些事情，如改变 IP 路由表、跟踪任意进程和加载内核模块。 权能 Capability 允许人们对容器内的进程可以访问或更改的资源施加更细微的限制，即使容器在特权模式下运行也一样。权能还允许人们为无特权的容器分配它本来不会拥有的特权。</p><p>例如，如果要将 <code>NET_ADMIN</code> 功能添加到一个无特权的容器中，以便在容器内部创建一个网络接口，你可以用下面的参数运行 <code>podman</code>：</p><pre tabindex=0><code>[root@vm1 ~]# podman run -it --cap-add=NET_ADMIN centos
[root@b27fea33ccf1 /]# ip link add dummy0 type dummy
[root@b27fea33ccf1 /]# ip link
</code></pre><p>上面的命令演示了在一个无特权的容器中创建一个 <code>dummy0</code> 接口。如果没有 <code>NET_ADMIN</code> 权能，非特权容器将无法创建接口。上面的命令演示了如何将一个权能授予一个无特权的容器。</p><p>目前，大约有 <a href=https://man7.org/linux/man-pages/man7/capabilities.7.html>39 种权能</a>可以被授予或拒绝。特权容器默认会被授予许多权能。建议从特权容器中删除不需要的权能，以使其更加安全。</p><p>要从容器中删除所有权能：</p><pre tabindex=0><code>$ podman run -it -d --name mycontainer --cap-drop=all centos
</code></pre><p>列出一个容器的权能：</p><pre tabindex=0><code>$ podman exec -it 48f11d9fa512 capsh --print
</code></pre><p>上述命令显示没有向容器授予任何权能。</p><p>请参考 <code>capabilities</code> 手册页以获取完整的权能列表：</p><pre tabindex=0><code>$ man capabilities
</code></pre><p>可以使用 <code>capsh</code> 命令来列出目前拥有的权能：</p><pre tabindex=0><code>$ capsh --print
</code></pre><p>作为另一个例子，下面的命令演示了如何从容器中删除 <code>NET_RAW</code> 权能。如果没有 <code>NET_RAW</code> 权能，就不能从容器中 <code>ping</code> 互联网上的服务器。</p><pre tabindex=0><code>$ podman run -it --name mycontainer1 --cap-drop=net_raw centos
&gt;&gt;&gt; ping google.com (will output error, operation not permitted)
</code></pre><p>最后一个例子，如果你的容器只需要 <code>SETUID</code> 和 <code>SETGID</code> 权能，你可以删除所有权能，然后只重新添加这两个权能来实现这样的权限设置。</p><pre tabindex=0><code>$ podman run -d --cap-drop=all --cap-add=setuid --cap-add=setgid fedora sleep 5 &gt; /dev/null; pscap | grep sleep
</code></pre><p>上面的 <code>pscap</code> 命令会显示容器被授予的权能。</p><p>我希望你喜欢这个关于如何使用权能来保护 Podman 容器的简短探索。</p><p>谢谢！</p><hr><p>via: <a href=https://fedoramagazine.org/podman-with-capabilities-on-fedora/>https://fedoramagazine.org/podman-with-capabilities-on-fedora/</a></p><p>作者：<a href=https://fedoramagazine.org/author/shiwanibiradar/>shiwanibiradar</a> 选题：<a href=https://github.com/lujun9972>lujun9972</a> 译者：<a href=https://github.com/geekpi>geekpi</a> 校对：<a href=https://github.com/wxy>wxy</a></p><p>本文由 <a href=https://github.com/LCTT/TranslateProject>LCTT</a> 原创编译，<a href=https://linux.cn/>Linux中国</a> 荣誉推出</p></div><footer class=post__footer><div class="post__tags tags clearfix"><svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5.0 11V3C0 1.5.8.8.8.8S1.5.0 3 0h8c1.5.0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 100-6 3 3 0 000 6z"/></svg><ul class=tags__list><li class=tags__item><a class="tags__link btn" href=/tags/podman/ rel=tag>Podman</a></li><li class=tags__item><a class="tags__link btn" href=/tags/%E6%9D%83%E8%83%BD/ rel=tag>权能</a></li></ul></div></footer></article></main></div></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2025 Linux.cn Archive.
<span class=footer__copyright-credits>Generated with <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> and <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a> theme.</span></div></div></footer></div><script async defer src=/js/menu.js></script></body></html>