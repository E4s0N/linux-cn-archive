<!doctype html><html class=no-js lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>在 Linux 下使用 RAID（九）：如何使用 ‘Mdadm’ 工具管理软件 RAID - Linux.cn Archive</title>
<script>(function(e,t){e[t]=e[t].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content><meta property="og:title" content="在 Linux 下使用 RAID（九）：如何使用 ‘Mdadm’ 工具管理软件 RAID"><meta property="og:description" content="无论你以前有没有使用 RAID 阵列的经验，以及是否完成了 此 RAID 系列 的所有教程，一旦你在 Linux 中熟悉了 mdadm &ndash;manage 命令的使用，管理软件 RAID 将不是很复杂的任务。  在 Linux 中使用 mdadm 管理 RAID 设备 - 第9部分 在本教程中，我们会再介绍此工具提供的功能，这样当你需要它，就可以派上用场。 RAID 测试方案 在本系列的最后一篇文章中，我们将使用一个简单的 RAID 1（镜像）阵列，它由两个 8GB 的磁盘（/dev/sdb 和 /dev/sdc）和一个备用设备（/dev/sdd）来演示，但在此使用的方法也适用于其他类型的配置。也就是说，放心"><meta property="og:type" content="article"><meta property="og:url" content="/article-6463-1.html"><meta property="article:section" content="posts"><meta property="article:published_time" content="2015-10-24T10:15:00+00:00"><meta property="article:modified_time" content="2015-10-24T10:15:00+00:00"><meta itemprop=name content="在 Linux 下使用 RAID（九）：如何使用 ‘Mdadm’ 工具管理软件 RAID"><meta itemprop=description content="无论你以前有没有使用 RAID 阵列的经验，以及是否完成了 此 RAID 系列 的所有教程，一旦你在 Linux 中熟悉了 mdadm &ndash;manage 命令的使用，管理软件 RAID 将不是很复杂的任务。  在 Linux 中使用 mdadm 管理 RAID 设备 - 第9部分 在本教程中，我们会再介绍此工具提供的功能，这样当你需要它，就可以派上用场。 RAID 测试方案 在本系列的最后一篇文章中，我们将使用一个简单的 RAID 1（镜像）阵列，它由两个 8GB 的磁盘（/dev/sdb 和 /dev/sdc）和一个备用设备（/dev/sdd）来演示，但在此使用的方法也适用于其他类型的配置。也就是说，放心"><meta itemprop=datePublished content="2015-10-24T10:15:00+00:00"><meta itemprop=dateModified content="2015-10-24T10:15:00+00:00"><meta itemprop=wordCount content="280"><meta itemprop=keywords content="RAID,"><link rel=preconnect href=https://fonts.bunny.net crossorigin><link rel=dns-prefetch href=//fonts.bunny.net><link rel=dns-prefetch href=//fonts.bunny.net><link rel=stylesheet href="https://fonts.bunny.net/css?family=Open+Sans:400,400i,700"><link rel=stylesheet href=/css/style.css><link rel="shortcut icon" href=/favicon.ico></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class=logo><a class=logo__link href=/ title="Linux.cn Archive" rel=home><div class="logo__item logo__text"><div class=logo__title>Linux.cn Archive</div></div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>Menu</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/><span class=menu__text>Home</span></a></li><li class=menu__item><a class=menu__link href=/categories/><span class=menu__text>Categories</span></a></li><li class=menu__item><a class=menu__link href=/tags/><span class=menu__text>Tags</span></a></li><li class=menu__item><a class=menu__link href><span class=menu__text>RSS</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>在 Linux 下使用 RAID（九）：如何使用 ‘Mdadm’ 工具管理软件 RAID</h1><div class="post__meta meta"><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class=meta__text datetime=2015-10-24T10:15:00Z>October 24, 2015</time></div></div></header><div class="content post__content clearfix"><p>无论你以前有没有使用 RAID 阵列的经验，以及是否完成了 <a href=/article-6085-1.html>此 RAID 系列</a> 的所有教程，一旦你在 Linux 中熟悉了 <code>mdadm --manage</code> 命令的使用，管理软件 RAID 将不是很复杂的任务。</p><p><img src=/data/attachment/album/201510/25/201458vaugnvlr7gj5fa5v.png alt="在 Linux 中使用 mdadm 管理 RAID 设备 - 第9部分"></p><p><em>在 Linux 中使用 mdadm 管理 RAID 设备 - 第9部分</em></p><p>在本教程中，我们会再介绍此工具提供的功能，这样当你需要它，就可以派上用场。</p><h4 id=raid-测试方案>RAID 测试方案</h4><p>在本系列的最后一篇文章中，我们将使用一个简单的 RAID 1（镜像）阵列，它由两个 8GB 的磁盘（/dev/sdb 和 /dev/sdc）和一个备用设备（/dev/sdd）来演示，但在此使用的方法也适用于其他类型的配置。也就是说，放心去用吧，把这个页面添加到浏览器的书签，然后让我们开始吧。</p><h3 id=了解-mdadm-的选项和使用方法>了解 mdadm 的选项和使用方法</h3><p>幸运的是，mdadm 有一个内建的 <code>--help</code> 参数来对每个主要的选项提供说明文档。</p><p>因此，让我们开始输入：</p><pre tabindex=0><code># mdadm --manage --help
</code></pre><p>就会使我们看到 <code>mdadm --manage</code> 能够执行哪些任务：</p><p><img src=/data/attachment/album/201510/23/231705xffac8m8a1wdwa9z.png alt="Manage RAID with mdadm Tool"></p><p><em>使用 mdadm 工具来管理 RAID</em></p><p>正如我们在上面的图片看到，管理一个 RAID 阵列可以在任意时间执行以下任务：</p><ul><li>（重新）将设备添加到阵列中</li><li>把设备标记为故障</li><li>从阵列中删除故障设备</li><li>使用备用设备更换故障设备</li><li>先创建部分阵列</li><li>停止阵列</li><li>标记阵列为 ro（只读）或 rw（读写）</li></ul><h3 id=使用-mdadm-工具管理-raid-设备>使用 mdadm 工具管理 RAID 设备</h3><p>需要注意的是，如果用户忽略 <code>--manage</code> 选项，mdadm 默认使用管理模式。请记住这一点，以避免出现最坏的情况。</p><p>上图中的高亮文本显示了管理 RAID 的基本语法：</p><pre tabindex=0><code># mdadm --manage RAID options devices
</code></pre><p>让我们来演示几个例子。</p><h4 id=例1为-raid-阵列添加设备>​例1：为 RAID 阵列添加设备</h4><p>你通常会添加新设备来更换故障的设备，或者使用空闲的分区以便在出现故障时能及时替换：</p><pre tabindex=0><code># mdadm --manage /dev/md0 --add /dev/sdd1
</code></pre><p><img src=/data/attachment/album/201510/23/231707tq4hp5elzgz5msoh.png alt="Add Device to Raid Array"></p><p><em>添加设备到 Raid 阵列</em></p><h4 id=例2把一个-raid-设备标记为故障并从阵列中移除>​例2：把一个 RAID 设备标记为故障并从阵列中移除</h4><p>在从逻辑阵列中删除该设备前，这是强制性的步骤，然后才能从机器中取出它 - 注意顺序（如果弄错了这些步骤，最终可能会造成实际设备的损害）：</p><pre tabindex=0><code># mdadm --manage /dev/md0 --fail /dev/sdb1
</code></pre><p>请注意在前面的例子中，知道如何添加备用设备来自动更换出现故障的磁盘。在此之后，<a href=/article-6448-1.html>恢复和重建 raid 数据</a> 就开始了：</p><p><img src=/data/attachment/album/201510/23/231708kzclq63u006rtg6q.png alt="Recover and Rebuild Raid Data"></p><p><em>恢复和重建 raid 数据</em></p><p>一旦设备已被手动标记为故障，你就可以安全地从阵列中删除它：</p><pre tabindex=0><code># mdadm --manage /dev/md0 --remove /dev/sdb1
</code></pre><h4 id=例3重新添加设备来替代阵列中已经移除的设备>例3：重新添加设备，来替代阵列中已经移除的设备</h4><p>到现在为止，我们有一个工作的 RAID 1 阵列，它包含了2个活动的设备：/dev/sdc1 和 /dev/sdd1。现在让我们试试重新添加 /dev/sdb1 到/dev/md0：</p><pre tabindex=0><code># mdadm --manage /dev/md0 --re-add /dev/sdb1
</code></pre><p>我们会碰到一个错误:</p><pre tabindex=0><code># mdadm: --re-add for /dev/sdb1 to /dev/md0 is not possible
</code></pre><p>因为阵列中的磁盘已经达到了最大的数量。因此，我们有两个选择：a）将 /dev/sdb1 添加为备用的，如例1；或 b）从阵列中删除 /dev/sdd1 然后重新添加 /dev/sdb1。</p><p>我们选择选项 b），先停止阵列然后重新启动：</p><pre tabindex=0><code># mdadm --stop /dev/md0
# mdadm --assemble /dev/md0 /dev/sdb1 /dev/sdc1
</code></pre><p>如果上面的命令不能成功添加 /dev/sdb1 到阵列中，使用例1中的命令来完成。</p><p>mdadm 能检测到新添加的设备并将其作为备用设备，当添加完成后它会开始重建数据，它也被认为是 RAID 中的活动设备：</p><p><img src=/data/attachment/album/201510/23/231708v2azltciiahr2ejj.png alt="Raid Rebuild Status"></p><p><em>重建 Raid 的状态</em></p><h4 id=例4使用特定磁盘更换-raid-设备>例4：使用特定磁盘更换 RAID 设备</h4><p>在阵列中使用备用磁盘更换磁盘很简单：</p><pre tabindex=0><code># mdadm --manage /dev/md0 --replace /dev/sdb1 --with /dev/sdd1
</code></pre><p><img src=/data/attachment/album/201510/23/231708bw2b6k9wvzr9bkrj.png alt="Replace Raid Device"></p><p><em>更换 Raid 设备</em></p><p>这会导致 <code>--replace</code> 指定的设备被标记为故障，而 <code>--with</code>指定的设备添加到 RAID 中来替代它：</p><p><img src=/data/attachment/album/201510/23/231709h3bh88f8c8dfhnnm.png alt="Check Raid Rebuild Status"></p><p><em>检查 Raid 重建状态</em></p><h4 id=例5标记-raid-阵列为-ro-或-rw>​例5：标记 RAID 阵列为 ro 或 rw</h4><p>创建阵列后，你必须在它上面创建一个文件系统并将其挂载到一个目录下才能使用它。你可能不知道，RAID 也可以被设置为 ro，使其只读；或者设置为 rw，就可以同时写入了。</p><p>要标记该设备为 ro，首先需要将其卸载：</p><pre tabindex=0><code># umount /mnt/raid1
# mdadm --manage /dev/md0 --readonly
# mount /mnt/raid1
# touch /mnt/raid1/test1
</code></pre><p><img src=/data/attachment/album/201510/23/231709p7r4r2ehkjhkuk2k.png alt="Set Permissions on Raid Array"></p><p><em>在 RAID 阵列上设置权限</em></p><p>要配置阵列允许写入操作需要使用 <code>--readwrite</code> 选项。请注意，在设置 rw 标志前，你需要先卸载设备并停止它：</p><pre tabindex=0><code># umount /mnt/raid1
# mdadm --manage /dev/md0 --stop
# mdadm --assemble /dev/md0 /dev/sdc1 /dev/sdd1
# mdadm --manage /dev/md0 --readwrite
# touch /mnt/raid1/test2
</code></pre><p><img src=/data/attachment/album/201510/23/231710m88xdcxcf6o8r6ck.png alt="Allow Read Write Permission on Raid"></p><p><em>配置 Raid 允许读写操作</em></p><h3 id=总结>总结</h3><p>在本系列中，我们已经解释了如何建立一个在企业环境中使用的软件 RAID 阵列。如果你按照这些文章所提供的例子进行配置，在 Linux 中你会充分领会到软件 RAID 的价值。</p><p>如果你碰巧任何问题或有建议，请随时使用下面的方式与我们联系。</p><hr><p>via: <a href=http://www.tecmint.com/manage-software-raid-devices-in-linux-with-mdadm/>http://www.tecmint.com/manage-software-raid-devices-in-linux-with-mdadm/</a></p><p>作者：<a href=http://www.tecmint.com/author/gacanepa/>GABRIEL CÁNEPA</a> 译者：<a href=https://github.com/strugglingyouth>strugglingyouth</a> 校对：<a href=https://github.com/wxy>wxy</a></p><p>本文由 <a href=https://github.com/LCTT/TranslateProject>LCTT</a> 原创编译，<a href=https://linux.cn/>Linux中国</a> 荣誉推出</p></div><footer class=post__footer><div class="post__tags tags clearfix"><svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5.0 11V3C0 1.5.8.8.8.8S1.5.0 3 0h8c1.5.0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 100-6 3 3 0 000 6z"/></svg><ul class=tags__list><li class=tags__item><a class="tags__link btn" href=/tags/raid/ rel=tag>RAID</a></li></ul></div></footer></article></main></div></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2025 Linux.cn Archive.
<span class=footer__copyright-credits>Generated with <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> and <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a> theme.</span></div></div></footer></div><script async defer src=/js/menu.js></script></body></html>