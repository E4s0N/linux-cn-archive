<!doctype html><html class=no-js lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>LXD 2.0 系列（十）：LXD 和 Juju - Linux.cn Archive</title>
<script>(function(e,t){e[t]=e[t].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content><meta property="og:title" content="LXD 2.0 系列（十）：LXD 和 Juju"><meta property="og:description" content="Juju 与 LXD 是一个完美的解决方案，从一个小的 Web 服务到大规模的基础设施都可以简单开发，这些都在你自己的机器上，并且不会在你的系统上造成混乱！"><meta property="og:type" content="article"><meta property="og:url" content="/article-8273-1.html"><meta property="article:section" content="posts"><meta property="article:published_time" content="2017-03-07T06:04:00+00:00"><meta property="article:modified_time" content="2017-03-07T06:04:00+00:00"><meta itemprop=name content="LXD 2.0 系列（十）：LXD 和 Juju"><meta itemprop=description content="Juju 与 LXD 是一个完美的解决方案，从一个小的 Web 服务到大规模的基础设施都可以简单开发，这些都在你自己的机器上，并且不会在你的系统上造成混乱！"><meta itemprop=datePublished content="2017-03-07T06:04:00+00:00"><meta itemprop=dateModified content="2017-03-07T06:04:00+00:00"><meta itemprop=wordCount content="1258"><meta itemprop=keywords content="LXD,"><link rel=preconnect href=https://fonts.bunny.net crossorigin><link rel=dns-prefetch href=//fonts.bunny.net><link rel=dns-prefetch href=//fonts.bunny.net><link rel=stylesheet href="https://fonts.bunny.net/css?family=Open+Sans:400,400i,700"><link rel=stylesheet href=/css/style.css><link rel="shortcut icon" href=/favicon.ico></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class=logo><a class=logo__link href=/ title="Linux.cn Archive" rel=home><div class="logo__item logo__text"><div class=logo__title>Linux.cn Archive</div></div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>Menu</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/><span class=menu__text>Home</span></a></li><li class=menu__item><a class=menu__link href=/categories/><span class=menu__text>Categories</span></a></li><li class=menu__item><a class=menu__link href=/tags/><span class=menu__text>Tags</span></a></li><li class=menu__item><a class=menu__link href><span class=menu__text>RSS</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>LXD 2.0 系列（十）：LXD 和 Juju</h1><div class="post__meta meta"><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class=meta__text datetime=2017-03-07T06:04:00Z>March 07, 2017</time></div></div></header><div class="content post__content clearfix"><p>这是 LXD 2.0 系列介绍文章的第十篇。</p><ol><li><a href=/article-7618-1.html>LXD 入门</a></li><li><a href=/article-7687-1.html>安装与配置</a></li><li><a href=/article-7706-1.html>你的第一个 LXD 容器</a></li><li><a href=/article-8072-1.html>资源控制</a></li><li><a href=/article-8107-1.html>镜像管理</a></li><li><a href=/article-8169-1.html>远程主机及容器迁移</a></li><li><a href=/article-8235-1.html>LXD 中的 Docker</a></li><li><a href=/article-8257-1.html>LXD 中的 LXD</a></li><li><a href=/article-8263-1.html>实时迁移</a></li><li><a href=/article-8273-1.html>LXD 和 Juju</a></li><li><a href=/article-8274-1.html>LXD 和 OpenStack</a></li><li><a href=/article-8282-1.html>调试，及给 LXD 做贡献</a></li></ol><p><img src=/data/attachment/album/201703/07/060310l9zd4y4j4ud4q196.jpg alt></p><h3 id=介绍>介绍</h3><p>Juju 是 Canonical 的服务建模和部署工具。 它支持非常广泛的云服务提供商，使您能够轻松地在任何云上部署任何您想要的服务。</p><p>此外，Juju 2.0 还支持 LXD，既适用于本地部署，也适合开发，并且可以在云实例或物理机上共同协作。</p><p>本篇文章将关注本地使用，通过一个没有任何Juju经验的LXD用户来体验。</p><h3 id=要求>要求</h3><p>本篇文章假设你已经安装了 LXD 2.0 并且配置完毕（看前面的文章），并且是在 Ubuntu 16.04 LTS 上运行的。</p><h3 id=设置-juju>设置 Juju</h3><p>第一件事是在 Ubuntu 16.04 上安装 Juju 2.0。这个很简单：</p><pre tabindex=0><code>stgraber@dakara:~$ sudo apt install juju
Reading package lists... Done
Building dependency tree 
Reading state information... Done
The following additional packages will be installed:
 juju-2.0
Suggested packages:
 juju-core
The following NEW packages will be installed:
 juju juju-2.0
0 upgraded, 2 newly installed, 0 to remove and 0 not upgraded.
Need to get 39.7 MB of archives.
After this operation, 269 MB of additional disk space will be used.
Do you want to continue? [Y/n] 
Get:1 http://us.archive.ubuntu.com/ubuntu xenial-updates/main amd64 juju-2.0 amd64 2.0~beta7-0ubuntu1.16.04.1 [39.6 MB]
Get:2 http://us.archive.ubuntu.com/ubuntu xenial-updates/main amd64 juju all 2.0~beta7-0ubuntu1.16.04.1 [9,556 B]
Fetched 39.7 MB in 0s (53.4 MB/s)
Selecting previously unselected package juju-2.0.
(Reading database ... 255132 files and directories currently installed.)
Preparing to unpack .../juju-2.0_2.0~beta7-0ubuntu1.16.04.1_amd64.deb ...
Unpacking juju-2.0 (2.0~beta7-0ubuntu1.16.04.1) ...
Selecting previously unselected package juju.
Preparing to unpack .../juju_2.0~beta7-0ubuntu1.16.04.1_all.deb ...
Unpacking juju (2.0~beta7-0ubuntu1.16.04.1) ...
Processing triggers for man-db (2.7.5-1) ...
Setting up juju-2.0 (2.0~beta7-0ubuntu1.16.04.1) ...
Setting up juju (2.0~beta7-0ubuntu1.16.04.1) ...
</code></pre><p>安装完成后，我们可以使用 LXD 启动一个新的“控制器”。这意味着 Juju 不会修改你主机上的任何东西，它会在 LXD 容器中安装它的管理服务。</p><p>现在我们创建一个“test”控制器：</p><pre tabindex=0><code>stgraber@dakara:~$ juju bootstrap localhost test
Creating Juju controller &#34;local.test&#34; on localhost/localhost
Bootstrapping model &#34;admin&#34;
Starting new instance for initial controller
Launching instance
 - juju-745d1be3-e93d-41a2-80d4-fbe8714230dd-machine-0
Installing Juju agent on bootstrap instance
Preparing for Juju GUI 2.1.2 release installation
Waiting for address
Attempting to connect to 10.178.150.72:22
Logging to /var/log/cloud-init-output.log on remote host
Running apt-get update
Running apt-get upgrade
Installing package: curl
Installing package: cpu-checker
Installing package: bridge-utils
Installing package: cloud-utils
Installing package: cloud-image-utils
Installing package: tmux
Fetching tools: curl -sSfw &#39;tools from %{url_effective} downloaded: HTTP %{http_code}; time %{time_total}s; size %{size_download} bytes; speed %{speed_download} bytes/s &#39; --retry 10 -o $bin/tools.tar.gz &lt;[https://streams.canonical.com/juju/tools/agent/2.0-beta7/juju-2.0-beta7-xenial-amd64.tgz]&gt;
Bootstrapping Juju machine agent
Starting Juju machine agent (jujud-machine-0)
Bootstrap agent installed
Waiting for API to become available: upgrade in progress (upgrade in progress)
Waiting for API to become available: upgrade in progress (upgrade in progress)
Waiting for API to become available: upgrade in progress (upgrade in progress)
Bootstrap complete, local.test now available.
</code></pre><p>这会花费一点时间，这时你可以看到一个正在运行的一个新的 LXD 容器：</p><pre tabindex=0><code>stgraber@dakara:~$ lxc list juju-
+-----------------------------------------------------+---------+----------------------+------+------------+-----------+
|                         NAME                        |  STATE  |          IPV4        | IPV6 |    TYPE    | SNAPSHOTS |
+-----------------------------------------------------+---------+----------------------+------+------------+-----------+
| juju-745d1be3-e93d-41a2-80d4-fbe8714230dd-machine-0 | RUNNING | 10.178.150.72 (eth0) |      | PERSISTENT | 0         |
+-----------------------------------------------------+---------+----------------------+------+------------+-----------+
</code></pre><p>在 Juju 这边，你可以确认它是有响应的，并且还没有服务运行：</p><pre tabindex=0><code>stgraber@dakara:~$ juju status
[Services] 
NAME STATUS EXPOSED CHARM 

[Units] 
ID WORKLOAD-STATUS JUJU-STATUS VERSION MACHINE PORTS PUBLIC-ADDRESS MESSAGE 

[Machines] 
ID STATE DNS INS-ID SERIES AZ
</code></pre><p>你也可以在浏览器中访问 Juju 的 GUI 界面：</p><pre tabindex=0><code>stgraber@dakara:~$ juju gui
Opening the Juju GUI in your browser.
If it does not open, open this URL:
https://10.178.150.72:17070/gui/97fa390d-96ad-44df-8b59-e15fdcfc636b/
</code></pre><p><img src=/data/attachment/album/201703/07/060453zvvfe8qf1bk8vb8f.png alt="Juju web UI"></p><p>不过我更倾向使用命令行，因此我会在接下来使用。</p><h3 id=部署一个-minecraft-服务>部署一个 minecraft 服务</h3><p>让我们先来一个简单的，部署在一个容器中使用一个 Juju 单元的服务。</p><pre tabindex=0><code>stgraber@dakara:~$ juju deploy cs:trusty/minecraft
Added charm &#34;cs:trusty/minecraft-3&#34; to the model.
Deploying charm &#34;cs:trusty/minecraft-3&#34; with the charm series &#34;trusty&#34;.
</code></pre><p>命令返回会很快，然而这不意味着服务已经启动并运行了。你应该使用 <code>juju status</code> 来查看：</p><pre tabindex=0><code>stgraber@dakara:~$ juju status
[Services] 
NAME STATUS EXPOSED CHARM 
minecraft maintenance false cs:trusty/minecraft-3 

[Units] 
ID WORKLOAD-STATUS JUJU-STATUS VERSION MACHINE PORTS PUBLIC-ADDRESS MESSAGE 
minecraft/1 maintenance executing 2.0-beta7 1 10.178.150.74 (install) Installing java 

[Machines] 
ID STATE DNS INS-ID SERIES AZ 
1 started 10.178.150.74 juju-97fa390d-96ad-44df-8b59-e15fdcfc636b-machine-1 trusty 
</code></pre><p>我们可以看到它正在忙于在刚刚创建的 LXD 容器中安装 java。</p><pre tabindex=0><code>stgraber@dakara:~$ lxc list juju-
+-----------------------------------------------------+---------+----------------------+------+------------+-----------+
|                         NAME                        |  STATE  |          IPV4        | IPV6 |    TYPE    | SNAPSHOTS |
+-----------------------------------------------------+---------+----------------------+------+------------+-----------+
| juju-745d1be3-e93d-41a2-80d4-fbe8714230dd-machine-0 | RUNNING | 10.178.150.72 (eth0) |      | PERSISTENT | 0         |
+-----------------------------------------------------+---------+----------------------+------+------------+-----------+
| juju-97fa390d-96ad-44df-8b59-e15fdcfc636b-machine-1 | RUNNING | 10.178.150.74 (eth0) |      | PERSISTENT | 0         |
+-----------------------------------------------------+---------+----------------------+------+------------+-----------+
</code></pre><p>过一会之后，如我们所见服务就部署完毕了：</p><pre tabindex=0><code>stgraber@dakara:~$ juju status
[Services] 
NAME STATUS EXPOSED CHARM 
minecraft active false cs:trusty/minecraft-3 

[Units] 
ID WORKLOAD-STATUS JUJU-STATUS VERSION MACHINE PORTS PUBLIC-ADDRESS MESSAGE 
minecraft/1 active idle 2.0-beta7 1 25565/tcp 10.178.150.74 Ready 

[Machines] 
ID STATE DNS INS-ID SERIES AZ 
1 started 10.178.150.74 juju-97fa390d-96ad-44df-8b59-e15fdcfc636b-machine-1 trusty
</code></pre><p>这时你就可以启动你的 Minecraft 客户端了，将其指向 10.178.150.74，端口是 25565。现在可以在新的 minecraft 服务器上玩了！</p><p>当你不再需要它，只需运行：</p><pre tabindex=0><code>stgraber@dakara:~$ juju destroy-service minecraft
</code></pre><p>只要等待几秒就好了。</p><h3 id=部署一个更复杂的-web-应用>部署一个更复杂的 web 应用</h3><p>Juju 的主要工作是建模复杂的服务，并以可扩展的方式部署它们。</p><p>为了更好地展示，让我们部署一个 Juju “组合”。 这个组合是由网站，API，数据库，静态 Web 服务器和反向代理组成的基本 Web 服务。</p><p>所以这将扩展到 4 个互联的 LXD 容器。</p><pre tabindex=0><code>stgraber@dakara:~$ juju deploy cs:~charmers/bundle/web-infrastructure-in-a-box
added charm cs:~hp-discover/trusty/node-app-1
service api deployed (charm cs:~hp-discover/trusty/node-app-1 with the series &#34;trusty&#34; defined by the bundle)
annotations set for service api
added charm cs:trusty/mongodb-3
service mongodb deployed (charm cs:trusty/mongodb-3 with the series &#34;trusty&#34; defined by the bundle)
annotations set for service mongodb
added charm cs:~hp-discover/trusty/nginx-4
service nginx deployed (charm cs:~hp-discover/trusty/nginx-4 with the series &#34;trusty&#34; defined by the bundle)
annotations set for service nginx
added charm cs:~hp-discover/trusty/nginx-proxy-3
service nginx-proxy deployed (charm cs:~hp-discover/trusty/nginx-proxy-3 with the series &#34;trusty&#34; defined by the bundle)
annotations set for service nginx-proxy
added charm cs:~hp-discover/trusty/website-3
service website deployed (charm cs:~hp-discover/trusty/website-3 with the series &#34;trusty&#34; defined by the bundle)
annotations set for service website
related mongodb:database and api:mongodb
related website:nginx-engine and nginx:web-engine
related api:website and nginx-proxy:website
related nginx-proxy:website and website:website
added api/0 unit to new machine
added mongodb/0 unit to new machine
added nginx/0 unit to new machine
added nginx-proxy/0 unit to new machine
deployment of bundle &#34;cs:~charmers/bundle/web-infrastructure-in-a-box-10&#34; completed
</code></pre><p>几秒后，你会看到 LXD 容器在运行了：</p><pre tabindex=0><code>stgraber@dakara:~$ lxc list juju-
+-----------------------------------------------------+---------+-----------------------+------+------------+-----------+
|                         NAME                        |  STATE  |           IPV4        | IPV6 |    TYPE    | SNAPSHOTS |
+-----------------------------------------------------+---------+-----------------------+------+------------+-----------+
| juju-745d1be3-e93d-41a2-80d4-fbe8714230dd-machine-0 | RUNNING | 10.178.150.72 (eth0)  |      | PERSISTENT | 0         |
+-----------------------------------------------------+---------+-----------------------+------+------------+-----------+
| juju-97fa390d-96ad-44df-8b59-e15fdcfc636b-machine-2 | RUNNING | 10.178.150.98 (eth0)  |      | PERSISTENT | 0         |
+-----------------------------------------------------+---------+-----------------------+------+------------+-----------+
| juju-97fa390d-96ad-44df-8b59-e15fdcfc636b-machine-3 | RUNNING | 10.178.150.29 (eth0)  |      | PERSISTENT | 0         |
+-----------------------------------------------------+---------+-----------------------+------+------------+-----------+
| juju-97fa390d-96ad-44df-8b59-e15fdcfc636b-machine-4 | RUNNING | 10.178.150.202 (eth0) |      | PERSISTENT | 0         |
+-----------------------------------------------------+---------+-----------------------+------+------------+-----------+
| juju-97fa390d-96ad-44df-8b59-e15fdcfc636b-machine-5 | RUNNING | 10.178.150.214 (eth0) |      | PERSISTENT | 0         |
+-----------------------------------------------------+---------+-----------------------+------+------------+-----------+
</code></pre><p>几分钟后，所有的服务应该部署完毕并运行了：</p><pre tabindex=0><code>stgraber@dakara:~$ juju status
[Services] 
NAME STATUS EXPOSED CHARM 
api unknown false cs:~hp-discover/trusty/node-app-1 
mongodb unknown false cs:trusty/mongodb-3 
nginx unknown false cs:~hp-discover/trusty/nginx-4 
nginx-proxy unknown false cs:~hp-discover/trusty/nginx-proxy-3 
website false cs:~hp-discover/trusty/website-3 

[Relations] 
SERVICE1 SERVICE2 RELATION TYPE 
api mongodb database regular 
api nginx-proxy website regular 
mongodb mongodb replica-set peer 
nginx website nginx-engine subordinate 
nginx-proxy website website regular 

[Units] 
ID WORKLOAD-STATUS JUJU-STATUS VERSION MACHINE PORTS PUBLIC-ADDRESS MESSAGE 
api/0 unknown idle 2.0-beta7 2 8000/tcp 10.178.150.98 
mongodb/0 unknown idle 2.0-beta7 3 27017/tcp,27019/tcp,27021/tcp,28017/tcp 10.178.150.29 
nginx-proxy/0 unknown idle 2.0-beta7 5 80/tcp 10.178.150.214 
nginx/0 unknown idle 2.0-beta7 4 10.178.150.202 
 website/0 unknown idle 2.0-beta7 10.178.150.202 

[Machines] 
ID STATE DNS INS-ID SERIES AZ 
2 started 10.178.150.98 juju-97fa390d-96ad-44df-8b59-e15fdcfc636b-machine-2 trusty 
3 started 10.178.150.29 juju-97fa390d-96ad-44df-8b59-e15fdcfc636b-machine-3 trusty 
4 started 10.178.150.202 juju-97fa390d-96ad-44df-8b59-e15fdcfc636b-machine-4 trusty 
5 started 10.178.150.214 juju-97fa390d-96ad-44df-8b59-e15fdcfc636b-machine-5 trusty
</code></pre><p>这时你就可以在 80 端口访问 http://10.178.150.214，并且会看到一个 Juju 学院页面。</p><p><a href=https://www.stgraber.org/wp-content/uploads/2016/06/juju-academy.png><img src=/data/attachment/album/201703/07/060453f1rozxyr3asyszgf.png alt="Juju Academy web service"></a></p><h3 id=清理所有东西>清理所有东西</h3><p>如果你不需要 Juju 创建的容器并且不在乎下次需要再次启动，最简单的方法是：</p><pre tabindex=0><code>stgraber@dakara:~$ juju destroy-controller test --destroy-all-models
WARNING! This command will destroy the &#34;local.test&#34; controller.
This includes all machines, services, data and other resources.

Continue [y/N]? y
Destroying controller
Waiting for hosted model resources to be reclaimed
Waiting on 1 model, 4 machines, 5 services
Waiting on 1 model, 4 machines, 5 services
Waiting on 1 model, 4 machines, 5 services
Waiting on 1 model, 4 machines, 5 services
Waiting on 1 model, 4 machines, 5 services
Waiting on 1 model, 4 machines, 5 services
Waiting on 1 model, 4 machines
Waiting on 1 model, 4 machines
Waiting on 1 model, 4 machines
Waiting on 1 model, 4 machines
Waiting on 1 model, 4 machines
Waiting on 1 model, 4 machines
Waiting on 1 model, 2 machines
Waiting on 1 model
Waiting on 1 model
All hosted models reclaimed, cleaning up controller machines
</code></pre><p>我们用下面的方式确认：</p><pre tabindex=0><code>stgraber@dakara:~$ lxc list juju-
+------+-------+------+------+------+-----------+
| NAME | STATE | IPV4 | IPV6 | TYPE | SNAPSHOTS |
+------+-------+------+------+------+-----------+
</code></pre><h3 id=总结>总结</h3><p>Juju 2.0 内置的 LXD 支持使得可以用一种非常干净的方式来测试各种服务。</p><p>在 Juju charm store 中有很多预制的“组合”可以用来部署，甚至可以用多个“charm”来组合你想要的架构。</p><p>Juju 与 LXD 是一个完美的解决方案，从一个小的 Web 服务到大规模的基础设施都可以简单开发，这些都在你自己的机器上，并且不会在你的系统上造成混乱！</p><h3 id=额外信息>额外信息</h3><p>Juju 网站： <a href=http://www.ubuntu.com/cloud/juju>http://www.ubuntu.com/cloud/juju</a></p><p>Juju charm store ： <a href=https://jujucharms.com>https://jujucharms.com</a></p><p>LXD 的主站在： <a href=https://linuxcontainers.org/lxd>https://linuxcontainers.org/lxd</a></p><p>LXD 的 GitHub 仓库： <a href=https://github.com/lxc/lxd>https://github.com/lxc/lxd</a></p><p>LXD 的邮件列表： <a href=https://lists.linuxcontainers.org>https://lists.linuxcontainers.org</a></p><p>LXD 的 IRC 频道： #lxcontainers on irc.freenode.net</p><p>如果你不想或者不能在你的机器上安装 LXD ，你可以在 web 上试试<a href=https://linuxcontainers.org/lxd/try-it>在线版的 LXD</a>。</p><hr><p>作者简介：我是 Stéphane Graber。我是 LXC 和 LXD 项目的领导者，目前在加拿大魁北克蒙特利尔的家所在的Canonical 有限公司担任 LXD 的技术主管。</p><hr><p>via: <a href=https://www.stgraber.org/2016/06/06/lxd-2-0-lxd-and-juju-1012/>https://www.stgraber.org/2016/06/06/lxd-2-0-lxd-and-juju-1012/</a></p><p>作者：<a href=https://www.stgraber.org/author/stgraber/>Stéphane Graber</a> 译者：<a href=https://github.com/geekpi>geekpi</a> 校对：<a href=https://github.com/wxy>wxy</a></p><p>本文由 <a href=https://github.com/LCTT/TranslateProject>LCTT</a> 原创编译，<a href=https://linux.cn/>Linux中国</a> 荣誉推出</p></div><footer class=post__footer><div class="post__tags tags clearfix"><svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5.0 11V3C0 1.5.8.8.8.8S1.5.0 3 0h8c1.5.0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 100-6 3 3 0 000 6z"/></svg><ul class=tags__list><li class=tags__item><a class="tags__link btn" href=/tags/lxd/ rel=tag>LXD</a></li></ul></div></footer></article></main></div></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2025 Linux.cn Archive.
<span class=footer__copyright-credits>Generated with <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> and <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a> theme.</span></div></div></footer></div><script async defer src=/js/menu.js></script></body></html>