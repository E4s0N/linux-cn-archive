<!doctype html><html class=no-js lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>如何编译 Linux 内核 - Linux.cn Archive</title>
<script>(function(e,t){e[t]=e[t].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content><meta property="og:title" content="如何编译 Linux 内核"><meta property="og:description" content="Jack 将带你在 Ubuntu 16.04 服务器上走过内核编译之旅。"><meta property="og:type" content="article"><meta property="og:url" content="/article-9665-1.html"><meta property="article:section" content="posts"><meta property="article:published_time" content="2018-05-22T12:56:00+00:00"><meta property="article:modified_time" content="2018-05-22T12:56:00+00:00"><meta itemprop=name content="如何编译 Linux 内核"><meta itemprop=description content="Jack 将带你在 Ubuntu 16.04 服务器上走过内核编译之旅。"><meta itemprop=datePublished content="2018-05-22T12:56:00+00:00"><meta itemprop=dateModified content="2018-05-22T12:56:00+00:00"><meta itemprop=wordCount content="167"><meta itemprop=keywords content="内核,编译,"><link rel=preconnect href=https://fonts.bunny.net crossorigin><link rel=dns-prefetch href=//fonts.bunny.net><link rel=dns-prefetch href=//fonts.bunny.net><link rel=stylesheet href="https://fonts.bunny.net/css?family=Open+Sans:400,400i,700"><link rel=stylesheet href=/css/style.css><link rel="shortcut icon" href=/favicon.ico></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class=logo><a class=logo__link href=/ title="Linux.cn Archive" rel=home><div class="logo__item logo__text"><div class=logo__title>Linux.cn Archive</div></div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>Menu</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/><span class=menu__text>Home</span></a></li><li class=menu__item><a class=menu__link href=/categories/><span class=menu__text>Categories</span></a></li><li class=menu__item><a class=menu__link href=/tags/><span class=menu__text>Tags</span></a></li><li class=menu__item><a class=menu__link href><span class=menu__text>RSS</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>如何编译 Linux 内核</h1><div class="post__meta meta"><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class=meta__text datetime=2018-05-22T12:56:00Z>May 22, 2018</time></div></div></header><div class="content post__content clearfix"><blockquote><p>Jack 将带你在 Ubuntu 16.04 服务器上走过内核编译之旅。</p></blockquote><p><img src=/data/attachment/album/201805/22/125626duwkeqqh5l5103t5.jpg alt></p><p>曾经有一段时间，升级 Linux 内核让很多用户打心里有所畏惧。在那个时候，升级内核包含了很多步骤，也需要很多时间。现在，内核的安装可以轻易地通过像 <code>apt</code> 这样的包管理器来处理。通过添加特定的仓库，你能很轻易地安装实验版本的或者指定版本的内核（比如针对音频产品的实时内核）。</p><p>考虑一下，既然升级内核如此容易，为什么你不愿意自行编译一个呢？这里列举一些可能的原因：</p><ul><li>你想要简单了解编译内核的过程</li><li>你需要启用或者禁用内核中特定的选项，因为它们没有出现在标准选项里</li><li>你想要启用标准内核中可能没有添加的硬件支持</li><li>你使用的发行版需要你编译内核</li><li>你是一个学生，而编译内核是你的任务</li></ul><p>不管出于什么原因，懂得如何编译内核是非常有用的，而且可以被视作一个通行权。当我第一次编译一个新的 Linux 内核（那是很久以前了），然后尝试从它启动，我从中（系统马上就崩溃了，然后不断地尝试和失败）感受到一种特定的兴奋。</p><p>既然这样，让我们来实验一下编译内核的过程。我将使用 Ubuntu 16.04 Server 来进行演示。在运行了一次常规的 <code>sudo apt upgrade</code> 之后，当前安装的内核版本是 <code>4.4.0-121</code>。我想要升级内核版本到 <code>4.17</code>， 让我们小心地开始吧。</p><p>有一个警告：强烈建议你在虚拟机里实验这个过程。基于虚拟机，你总能创建一个快照，然后轻松地从任何问题中回退出来。不要在产品机器上使用这种方式升级内核，除非你知道你在做什么。</p><h3 id=下载内核>下载内核</h3><p>我们要做的第一件事是下载内核源码。在 <a href=https://www.kernel.org/>Kernel.org</a> 找到你要下载的所需内核的 URL。找到 URL 之后，使用如下命令（我以 <code>4.17 RC2</code> 内核为例） 来下载源码文件:</p><pre tabindex=0><code>wget https://git.kernel.org/torvalds/t/linux-4.17-rc2.tar.gz
</code></pre><p>在下载期间，有一些事需要去考虑。</p><h3 id=安装需要的环境>安装需要的环境</h3><p>为了编译内核，我们首先得安装一些需要的环境。这可以通过一个命令来完成：</p><pre tabindex=0><code>sudo apt-get install git fakeroot build-essential ncurses-dev xz-utils libssl-dev bc flex libelf-dev bison
</code></pre><p>务必注意：你将需要至少 12 GB 的本地可用磁盘空间来完成内核的编译过程。因此你必须确保有足够的空间。</p><h3 id=解压源码>解压源码</h3><p>在新下载的内核所在的文件夹下，使用该命令来解压内核：</p><pre tabindex=0><code>tar xvzf linux-4.17-rc2.tar.gz
</code></pre><p>使用命令 <code>cd linux-4.17-rc2</code> 进入新生成的文件夹。</p><h3 id=配置内核>配置内核</h3><p>在正式编译内核之前，我们首先必须配置需要包含哪些模块。实际上，有一些非常简单的方式来配置。使用一个命令，你能拷贝当前内核的配置文件，然后使用可靠的 <code>menuconfig</code> 命令来做任何必要的更改。使用如下命令来完成：</p><pre tabindex=0><code>cp /boot/config-$(uname -r) .config
</code></pre><p>现在你有一个配置文件了，输入命令 <code>make menuconfig</code>。该命令将打开一个配置工具（图 1），它可以让你遍历每个可用模块，然后启用或者禁用你需要或者不需要的模块。</p><p><img src=/data/attachment/album/201805/22/125627aprvhplr8fvhkmrk.jpg alt=menuconfig title=menuconfig></p><p><em>图 1: 运行中的 <code>make menuconfig</code></em></p><p>很有可能你会禁用掉内核中的一个重要部分，所以在 <code>menuconfig</code> 期间小心地一步步进行。如果你对某个选项不确定，不要去管它。或者更好的方法是使用我们拷贝的当前运行的内核的配置文件（因为我们知道它可以工作）。一旦你已经遍历了整个配置列表（它非常长），你就准备好开始编译了。</p><h3 id=编译和安装>编译和安装</h3><p>现在是时候去实际地编译内核了。第一步是使用 <code>make</code> 命令去编译。调用 <code>make</code> 命令然后回答必要的问题（图 2）。这些问题取决于你将升级的现有内核以及升级后的内核。相信我，将会有非常多的问题要回答，因此你得预留大量的时间。</p><p><img src=/data/attachment/album/201805/22/125627n1b6ttqb6ncbx16t.jpg alt=make title=make></p><p><em>图 2: 回答 <code>make</code> 命令的问题</em></p><p>回答了长篇累牍的问题之后，你就可以用如下的命令安装那些之前启用的模块：</p><pre tabindex=0><code>make modules_install
</code></pre><p>又来了，这个命令将耗费一些时间，所以要么坐下来看着编译输出，或者去做些其他事（因为编译期间不需要你的输入）。可能的情况是，你想要去进行别的任务（除非你真的喜欢看着终端界面上飞舞而过的输出）。</p><p>现在我们使用这个命令来安装内核：</p><pre tabindex=0><code>sudo make install
</code></pre><p>又一次，另一个将要耗费大量可观时间的命令。事实上，<code>make install</code> 命令将比 <code>make modules_install</code> 命令花费更多的时间。去享用午餐，配置一个路由器，将 Linux 安装在一些服务器上，或者小睡一会吧。</p><h3 id=启用内核作为引导>启用内核作为引导</h3><p>一旦 <code>make install</code> 命令完成了，就是时候将内核启用来作为引导。使用这个命令来实现：</p><pre tabindex=0><code>sudo update-initramfs -c -k 4.17-rc2
</code></pre><p>当然，你需要将上述内核版本号替换成你编译完的。当命令执行完毕后，使用如下命令来更新 grub：</p><pre tabindex=0><code>sudo update-grub
</code></pre><p>现在你可以重启系统并且选择新安装的内核了。</p><h3 id=恭喜>恭喜!</h3><p>你已经编译了一个 Linux 内核！它是一项耗费时间的活动；但是，最终你的 Linux 发行版将拥有一个定制的内核，同时你也将拥有一项被许多 Linux 管理员所倾向忽视的重要技能。</p><p>从 Linux 基金会和 edX 提供的免费 <a href=https://training.linuxfoundation.org/linux-courses/system-administration-training/introduction-to-linux>“Introduction to Linux”</a> 课程来学习更多的 Linux 知识。</p><hr><p>via: <a href=https://www.linux.com/learn/intro-to-linux/2018/4/how-compile-linux-kernel-0>https://www.linux.com/learn/intro-to-linux/2018/4/how-compile-linux-kernel-0</a></p><p>作者：<a href=https://www.linux.com/users/jlwallen>Jack Wallen</a> 选题：<a href=https://github.com/lujun9972>lujun9972</a> 译者：<a href=https://github.com/icecoobe>icecoobe</a> 校对：<a href=https://github.com/wxy>wxy</a></p><p>本文由 <a href=https://github.com/LCTT/TranslateProject>LCTT</a> 原创编译，<a href=https://linux.cn/>Linux中国</a> 荣誉推出</p></div><footer class=post__footer><div class="post__tags tags clearfix"><svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5.0 11V3C0 1.5.8.8.8.8S1.5.0 3 0h8c1.5.0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 100-6 3 3 0 000 6z"/></svg><ul class=tags__list><li class=tags__item><a class="tags__link btn" href=/tags/%E5%86%85%E6%A0%B8/ rel=tag>内核</a></li><li class=tags__item><a class="tags__link btn" href=/tags/%E7%BC%96%E8%AF%91/ rel=tag>编译</a></li></ul></div></footer></article></main></div></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2025 Linux.cn Archive.
<span class=footer__copyright-credits>Generated with <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> and <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a> theme.</span></div></div></footer></div><script async defer src=/js/menu.js></script></body></html>