<!doctype html><html class=no-js lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Samba 系列（四）：在 Windows 下管理 Samba4 AD 域管制器 DNS 和组策略 - Linux.cn Archive</title>
<script>(function(e,t){e[t]=e[t].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content><meta property="og:title" content="Samba 系列（四）：在 Windows 下管理 Samba4 AD 域管制器 DNS 和组策略"><meta property="og:description" content="在这篇文章中我们将学习如何使用微软 DNS 管理器远程管理我们的 Samba AD 域控制器的 DNS 服务器，如何创建 DNS 记录，如何创建反向查找区域以及如何通过组策略管理工具来创建域策略。"><meta property="og:type" content="article"><meta property="og:url" content="/article-8258-1.html"><meta property="article:section" content="posts"><meta property="article:published_time" content="2017-03-02T10:35:34+00:00"><meta property="article:modified_time" content="2017-03-02T10:35:34+00:00"><meta itemprop=name content="Samba 系列（四）：在 Windows 下管理 Samba4 AD 域管制器 DNS 和组策略"><meta itemprop=description content="在这篇文章中我们将学习如何使用微软 DNS 管理器远程管理我们的 Samba AD 域控制器的 DNS 服务器，如何创建 DNS 记录，如何创建反向查找区域以及如何通过组策略管理工具来创建域策略。"><meta itemprop=datePublished content="2017-03-02T10:35:34+00:00"><meta itemprop=dateModified content="2017-03-02T10:35:34+00:00"><meta itemprop=wordCount content="329"><meta itemprop=keywords content="Samba,DNS,"><link rel=preconnect href=https://fonts.bunny.net crossorigin><link rel=dns-prefetch href=//fonts.bunny.net><link rel=dns-prefetch href=//fonts.bunny.net><link rel=stylesheet href="https://fonts.bunny.net/css?family=Open+Sans:400,400i,700"><link rel=stylesheet href=/css/style.css><link rel="shortcut icon" href=/favicon.ico></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class=logo><a class=logo__link href=/ title="Linux.cn Archive" rel=home><div class="logo__item logo__text"><div class=logo__title>Linux.cn Archive</div></div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>Menu</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/><span class=menu__text>Home</span></a></li><li class=menu__item><a class=menu__link href=/categories/><span class=menu__text>Categories</span></a></li><li class=menu__item><a class=menu__link href=/tags/><span class=menu__text>Tags</span></a></li><li class=menu__item><a class=menu__link href><span class=menu__text>RSS</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>Samba 系列（四）：在 Windows 下管理 Samba4 AD 域管制器 DNS 和组策略</h1><div class="post__meta meta"><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class=meta__text datetime=2017-03-02T10:35:34Z>March 02, 2017</time></div></div></header><div class="content post__content clearfix"><p>接着前一篇教程写的关于<a href=/article-8097-1.html>使用 Windows 10 的 RSAT 工具来管理 Samba4 活动目录架构</a>，在这篇文章中我们将学习如何使用微软 DNS 管理器远程管理我们的 Samba AD 域控制器的 DNS 服务器，如何创建 DNS 记录，如何创建反向查找区域以及如何通过组策略管理工具来创建域策略。</p><p><img src=/data/attachment/album/201703/02/103407nb3hkxosffb4x34x.jpg alt></p><h4 id=要求>要求</h4><p>1、 <a href=/article-8065-1.html>在 Ubuntu 16.04 系统上使用 Samba4 软件来创建活动目录架构（一）</a></p><p>2、 <a href=/article-8070-1.html>在 Linux 命令行下管理 Samba4 AD 架构（二）</a></p><p>3、 <a href=/article-8097-1.html>使用 Windows 10 的 RSAT 工具来管理 Samba4 活动目录架构 （三）</a></p><h3 id=第-1-步管理-samba-dns-服务器>第 1 步：管理 Samba DNS 服务器</h3><p>Samba4 AD DC 使用内部的 DNS 解析器模块，该模块在初始化域提供的过程中创建（如果 BIND9 DLZ 模块未指定使用的情况下）。</p><p>Samba4 内部的 DNS 模块支持 AD 域控制器所必须的基本功能。有两种方式来管理域 DNS 服务器，直接在命令行下通过 samba-tool 接口来管理，或者使用已加入域的微软工作站中的 RSAT DNS 管理器远程进行管理。</p><p>在这篇文章中，我们使用第二种方式来进行管理，因为这种方式很直观，也不容易出错。</p><p>1、要使用 RSAT 工具来管理域控制器上的 DNS 服务器，在 Windows 机器上，打开控制面板 -> 系统和安全 -> 管理工具，然后运行 DNS 管理器工具。</p><p>当打开这个工具时，它会询问你将要连接到哪台正在运行的 DNS 服务器。选择“使用下面的计算机”，输入域名（IP 地址或 FQDN 地址都可以使用），勾选“现在连接到指定计算机”，然后单击 OK 按钮以开启 Samba DNS 服务。</p><p><img src=/data/attachment/album/201703/02/103536r9pv8h1rd9m99oc4.png alt="Connect Samba4 DNS on Windows"></p><p><em>在 Windows 系统上连接 Samba4 DNS 服务器</em></p><p>2、为了添加一条 DNS 记录（比如我们添加一条指向 LAN 网关的 A 记录），打开 DNS 管理器，找到域正向查找区，在右侧单击右键选择新的主机（A 或 AAAA）。</p><p><img src=/data/attachment/album/201703/02/103536qh1hces122yu0ly1.png alt="Add DNS A Record on Windows"></p><p><em>在 Windows 下添加一条 DNS 记录</em></p><p>3、在打开的新主机窗口界面，输入 DNS 服务器的主机名和 IP 地址。 DNS 管理器工具会自动填写完成 FQDN 地址。填写完成后，点击“添加主机”按钮，之后会弹出一个新的窗口提示你 DNS A 记录已经创建完成。</p><p>确保仅为你的网络中<a href=http://www.tecmint.com/set-add-static-ip-address-in-linux/>已配置静态 IP</a>的资源（设备）添加 DNS A 记录。不要为那些从 DHCP 服务器自动获取 IP 地址或者经常变换 IP 地址的主机添加 DNS A 记录。</p><p><img src=/data/attachment/album/201703/02/103537np0ol3qo908bl0lp.png alt="Configure Samba Host on Windows"></p><p><em>在 Windows 系统下配置 Samba 主机</em></p><p>要更新一条 DNS 记录只需要双击那条记录，然后输入更改即可。要删除一条记录时，只需要在这条记录上单击右键，选择从菜单删除即可。</p><p>同样的方式，你也可以为你的域添加其它类型的 DNS 记录，比如说 CNAME 记录（也称为 DNS 别名记录），MX 记录（在邮件服务器上非常有用）或者其它类型的记录（SPE、TXT、SRV 等类型）。</p><h3 id=第-2-步创建反向查找区域>第 2 步：创建反向查找区域</h3><p>默认情况下，Samba4 AD DC 不会自动为你的域添加一个反向查找区域和 PTR 记录，因为这些类型的记录对于域控制器的正常工作来说是无关紧要的。</p><p>相反，DNS 反向区和 PTR 记录在一些重要的网络服务中显得非常有用，比如邮件服务，因为这些类型的记录可以用于验证客户端请求服务的身份。</p><p>实际上， PTR 记录的功能与标准的 DNS 记录功能相反。客户端知道资源的 IP 地址，然后去查询 DNS 服务器来识别出已注册的 DNS 名字。</p><p>4、要创建 Samba AD DC 的反向查找区域，打开 DNS 管理器，在左侧反向查找区域目录上单击右键，然后选择菜单中的新区域。</p><p><img src=/data/attachment/album/201703/02/103538pv7r5aoqlvrvr7aa.png alt="Create Reverse Lookup DNS Zone"></p><p><em>创建 DNS 反向查找区域</em></p><p>5、下一步，单击下一步按钮，然后从区域类型向导中选择主区域（Primary）。</p><p><img src=/data/attachment/album/201703/02/103538aiv7uy90sfuhf9h7.png alt="Select DNS Zone Type"></p><p><em>选择 DNS 区域类型</em></p><p>6、下一步，在 “AD 区域复制范围”中选择复制到该域里运行在域控制器上的所有的 DNS 服务器，选择 “IPv4 反向查找区域”然后单击下一步继续。</p><p><img src=/data/attachment/album/201703/02/103539ktkt670z7a66tpsn.png alt="Select DNS for Samba Domain Controller"></p><p><em>为 Samba 域控制器选择 DNS 服务器</em></p><p><img src=/data/attachment/album/201703/02/103539q2lt28nzf8xggbqw.png alt="Add Reverse Lookup Zone Name"></p><p><em>添加反向查找区域名</em></p><p>7、下一步，在网络ID 框中输入你的 LAN IP 地址，然后单击下一步继续。</p><p>在这个区域内添加的所有资源（设备）的 PTR 记录仅能指向 192.168.1.0/24 网络段。如果你想要为一个不在该网段中的服务器创建一个 PTR 记录（比如邮件服务器位于 10.0.0.0/24 这个网段的时候），那么你还得为那个网段创建一个新的反向查找区域。</p><p><img src=/data/attachment/album/201703/02/103540p8an115sanq138qa.png alt="Add IP Address of Reverse Lookup DNS Zone"></p><p><em>添加 DNS 反向查找区域的 IP 地址</em></p><p>8、在下一个截图中选择“仅允许安全的动态更新”，单击下一步继续，最后单击完成按钮以完成反向查找区域的创建。</p><p><img src=/data/attachment/album/201703/02/103540v9094wdj7ha7sdso.png alt="Enable Secure Dynamic Updates"></p><p><em>启用安全动态更新</em></p><p><img src=/data/attachment/album/201703/02/103540a2szx67oaso4gigo.png alt="New DNS Zone Summary"></p><p><em>新 DNS 区域概览</em></p><p>9、此时，你已经为你的域环境创建完成了一个有效的 DNS 反向查找区域。为了在这个区域中添加一个 PTR 记录，在右侧右键单击，选择为网络资源创建一个 PTR 记录。</p><p>这个时候，我们已经为网关创建了一个指向。为了测试这条记录对于客户端是否添加正确和工作正常，打开命令行提示符执行 <code>nslookup</code> 查询资源名，再执行另外一条命令查询 IP 地址。</p><p>两个查询都应该为你的 DNS 资源返回正确的结果。</p><pre tabindex=0><code>nslookup gate.tecmint.lan
nslookup 192.168.1.1
ping gate
</code></pre><p><img src=/data/attachment/album/201703/02/103541fn2gw285fx8g22mn.png alt="Add DNS PTR Record and Query PTR"></p><p><em>添加及查询 PTR 记录</em></p><h3 id=第-3-步管理域控制策略>第 3 步：管理域控制策略</h3><p>10、域控制器最重要的作用就是集中控制系统资源及安全。使用域控制器的域组策略功能很容易实现这些类型的任务。</p><p>遗憾的是，在 Samba 域控制器上唯一用来编辑或管理组策略的方法是通过微软的 RSAT GPM 工具。</p><p>在下面的实例中，我们将看到通过组策略来实现在 Samba 域环境中为域用户创建一种交互式的登录提示是多么的简单。</p><p>要访问组策略控制台，打开控制面板 -> 系统和安全 -> 管理工具，然后打开组策略管理控制台。</p><p>展开你的域下面的目录，在默认组策略上右键，选择菜单中的编辑，将出现一个新的窗口。</p><p><img src=/data/attachment/album/201703/02/103541ke88gg2yt8dym1ry.png alt="Manage Samba Domain Group Policy"></p><p><em>管理 Samba 域组策略</em></p><p>11、在组策略管理编辑器窗口中，进入到计算机配置 -> 组策略 -> Windows 设置 -> 安全设置 -> 本地策略 -> 安全选项，你将在右侧看到一个新的选项列表。</p><p>在右侧查询并编辑你的定制化设置，参考下图中的两条设置内容。</p><p><img src=/data/attachment/album/201703/02/103542rszqkxazeanz1az4.png alt="Configure Samba Domain Group Policy"></p><p><em>配置 Samba 域组策略</em></p><p>12、这两个条目编辑完成后，关闭所有窗口，打开 CMD 窗口，执行以下命令来强制应用组策略。</p><pre tabindex=0><code>gpupdate /force
</code></pre><p><img src=/data/attachment/album/201703/02/103542y7718s7e8ss0eeed.png alt="Update Samba Domain Group Policy"></p><p><em>更新 Samba 域组策略</em></p><p>13、最后，重启你的电脑，当你准备登录进入系统的时候，你就会看到登录提示生效了。</p><p><img src=/data/attachment/album/201703/02/103542esajtahiennhoa8j.png alt="Samba4 AD Domain Controller Logon Banner"></p><p><em>Samba4 AD 域控制器登录提示</em></p><p>就写到这里吧！组策略是一个操作起来很繁琐和很谨慎的主题，在管理系统的过程中你得非常的小心。还有，注意你设置的组策略不会以任何方式应用到已加入域的 Linux 系统中。</p><hr><p>作者简介：我是一个电脑迷，开源软件及 Linux 系统爱好者，有近4年的 Linux 桌面和服务器系统及 bash 编程经验。</p><hr><p>via: <a href=http://www.tecmint.com/manage-samba4-dns-group-policy-from-windows/>http://www.tecmint.com/manage-samba4-dns-group-policy-from-windows/</a></p><p>作者：<a href=http://www.tecmint.com/author/cezarmatei/>Matei Cezar</a> 译者：<a href=https://github.com/rusking>rusking</a> 校对：<a href=https://github.com/wxy>wxy</a></p><p>本文由 <a href=https://github.com/LCTT/TranslateProject>LCTT</a> 原创编译，<a href=https://linux.cn/>Linux中国</a> 荣誉推出</p></div><footer class=post__footer><div class="post__tags tags clearfix"><svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5.0 11V3C0 1.5.8.8.8.8S1.5.0 3 0h8c1.5.0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 100-6 3 3 0 000 6z"/></svg><ul class=tags__list><li class=tags__item><a class="tags__link btn" href=/tags/samba/ rel=tag>Samba</a></li><li class=tags__item><a class="tags__link btn" href=/tags/dns/ rel=tag>DNS</a></li></ul></div></footer></article></main></div></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2025 Linux.cn Archive.
<span class=footer__copyright-credits>Generated with <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> and <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a> theme.</span></div></div></footer></div><script async defer src=/js/menu.js></script></body></html>