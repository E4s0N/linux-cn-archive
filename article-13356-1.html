<!doctype html><html class=no-js lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>使用 requests 访问 Python 包索引（PyPI）的 JSON API - Linux.cn Archive</title>
<script>(function(e,t){e[t]=e[t].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content><meta property="og:title" content="使用 requests 访问 Python 包索引（PyPI）的 JSON API"><meta property="og:description" content="PyPI 的 JSON API 是一种机器可直接使用的数据源，你可以访问和你浏览网站时相同类型的数据。"><meta property="og:type" content="article"><meta property="og:url" content="/article-13356-1.html"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-05-03T11:20:00+00:00"><meta property="article:modified_time" content="2021-05-03T11:20:00+00:00"><meta itemprop=name content="使用 requests 访问 Python 包索引（PyPI）的 JSON API"><meta itemprop=description content="PyPI 的 JSON API 是一种机器可直接使用的数据源，你可以访问和你浏览网站时相同类型的数据。"><meta itemprop=datePublished content="2021-05-03T11:20:00+00:00"><meta itemprop=dateModified content="2021-05-03T11:20:00+00:00"><meta itemprop=wordCount content="397"><meta itemprop=keywords content="Python,PyPI,"><link rel=preconnect href=https://fonts.bunny.net crossorigin><link rel=dns-prefetch href=//fonts.bunny.net><link rel=dns-prefetch href=//fonts.bunny.net><link rel=stylesheet href="https://fonts.bunny.net/css?family=Open+Sans:400,400i,700"><link rel=stylesheet href=/css/style.css><link rel="shortcut icon" href=/favicon.ico></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class=logo><a class=logo__link href=/ title="Linux.cn Archive" rel=home><div class="logo__item logo__text"><div class=logo__title>Linux.cn Archive</div></div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>Menu</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/><span class=menu__text>Home</span></a></li><li class=menu__item><a class=menu__link href=/categories/><span class=menu__text>Categories</span></a></li><li class=menu__item><a class=menu__link href=/tags/><span class=menu__text>Tags</span></a></li><li class=menu__item><a class=menu__link href><span class=menu__text>RSS</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>使用 requests 访问 Python 包索引（PyPI）的 JSON API</h1><div class="post__meta meta"><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class=meta__text datetime=2021-05-03T11:20:00Z>May 03, 2021</time></div></div></header><div class="content post__content clearfix"><blockquote><p>PyPI 的 JSON API 是一种机器可直接使用的数据源，你可以访问和你浏览网站时相同类型的数据。</p></blockquote><p><img src=https://img.linux.net.cn/data/attachment/album/202105/03/111943du0lgbjj6br6sruu.jpg alt title="Python programming language logo with question marks"></p><p>PyPI（Python 软件包索引）提供了有关其软件包信息的 JSON API。本质上，它是机器可以直接使用的数据源，与你在网站上直接访问是一样的的。例如，作为人类，我可以在浏览器中打开 <a href=https://pypi.org/project/numpy/>Numpy</a> 项目页面，点击左侧相关链接，查看有哪些版本，哪些文件可用以及发行日期和支持的 Python 版本等内容：</p><p><img src=https://img.linux.net.cn/data/attachment/album/202105/03/112014gwknqnfnauunun6w.png alt="NumPy project page" title="NumPy project page"></p><p>但是，如果我想编写一个程序来访问此数据，则可以使用 JSON API，而不必在这些页面上抓取和解析 HTML。</p><p>顺便说一句：在旧的 PyPI 网站上，还托管在 <code>pypi.python.org</code> 时，NumPy 的项目页面位于 <code>pypi.python.org/pypi/numpy</code>，访问其 JSON API 也很简单，只需要在最后面添加一个 <code>/json</code> ，即 <code>https://pypi.org/pypi/numpy/json</code>。现在，PyPI 网站托管在 <code>pypi.org</code>，NumPy 的项目页面是 <code>pypi.org/project/numpy</code>。新站点不会有单独的 JSON API URL，但它仍像以前一样工作。因此，你不必在 URL 后添加 <code>/json</code>，只要记住 URL 就够了。</p><p>你可以在浏览器中打开 NumPy 的 JSON API URL，Firefox 很好地渲染了数据：</p><p><img src=https://img.linux.net.cn/data/attachment/album/202105/03/112014ze99pm77pmerzpr8.png alt="JSON rendered in Firefox" title="JSON rendered in Firefox"></p><p>你可以查看 <code>info</code>，<code>release</code> 和 <code>urls</code> 其中的内容。或者，你可以将其加载到 Python Shell 中，以下是几行入门教程：</p><pre tabindex=0><code>import requests
url = &#34;https://pypi.org/pypi/numpy/json&#34;
r = requests.get(url)
data = r.json()
</code></pre><p>获得数据后（调用 <code>.json()</code> 提供了该数据的 <a href=https://docs.python.org/3/tutorial/datastructures.html#dictionaries>字典</a>），你可以对其进行查看：</p><p><img src=https://img.linux.net.cn/data/attachment/album/202105/03/112014zzr80jv8yj5vyx0r.png alt="Inspecting data" title="Inspecting data"></p><p>查看 <code>release</code> 中的键：</p><p><img src=https://img.linux.net.cn/data/attachment/album/202105/03/112014rcc5b8xc8vbscc6c.png alt="Inspecting keys in releases" title="Inspecting keys in releases"></p><p>这表明 <code>release</code> 是一个以版本号为键的字典。选择一个并查看以下内容：</p><p><img src=https://img.linux.net.cn/data/attachment/album/202105/03/112015g9a4mxgaxmfnnla9.png alt="Inspecting version" title="Inspecting version"></p><p>每个版本都包含一个列表，<code>release</code> 包含 24 项。但是每个项目是什么？由于它是一个列表，因此你可以索引第一项并进行查看：</p><p><img src=https://img.linux.net.cn/data/attachment/album/202105/03/112015u05ktukzcw16k0zc.png alt="Indexing an item" title="Indexing an item"></p><p>这是一个字典，其中包含有关特定文件的详细信息。因此，列表中的 24 个项目中的每一个都与此特定版本号关联的文件相关，即在 <a href=https://pypi.org/project/numpy/1.20.1/#files>https://pypi.org/project/numpy/1.20.1/#files</a> 列出的 24 个文件。</p><p>你可以编写一个脚本在可用数据中查找内容。例如，以下的循环查找带有 sdist（源代码包）的版本，它们指定了 <code>requires_python</code> 属性并进行打印：</p><pre tabindex=0><code>for version, files in data[&#39;releases&#39;].items():
    for f in files:
        if f.get(&#39;packagetype&#39;) == &#39;sdist&#39; and f.get(&#39;requires_python&#39;):
            print(version, f[&#39;requires_python&#39;])
</code></pre><p><img src=https://img.linux.net.cn/data/attachment/album/202105/03/112015lzuqnbu95ll52qlu.png alt="sdist files with requires_python attribute" title="sdist files with requires_python attribute "></p><h3 id=piwheels>piwheels</h3><p>去年，我在 piwheels 网站上<a href=https://blog.piwheels.org/requires-python-support-new-project-page-layout-and-a-new-json-api/>实现了类似的 API</a>。<a href=https://www.piwheels.org/>piwheels.org</a> 是一个 Python 软件包索引，为树莓派架构提供了 wheel（预编译的二进制软件包）。它本质上是 PyPI 软件包的镜像，但带有 Arm wheel，而不是软件包维护者上传到 PyPI 的文件。</p><p>由于 piwheels 模仿了 PyPI 的 URL 结构，因此你可以将项目页面 URL 的 <code>pypi.org</code> 部分更改为 <code>piwheels.org</code>。它将向你显示类似的项目页面，其中详细说明了构建的版本和可用的文件。由于我喜欢旧站点允许你在 URL 末尾添加 <code>/json</code> 的方式，所以我也支持这种方式。NumPy 在 PyPI 上的项目页面为 <a href=https://pypi.org/project/numpy>pypi.org/project/numpy</a>，在 piwheels 上，它是 <a href=https://www.piwheels.org/project/numpy>piwheels.org/project/numpy</a>，而 JSON API 是 <a href=https://www.piwheels.org/project/numpy/json>piwheels.org/project/numpy/json</a> 页面。</p><p>没有必要重复 PyPI API 的内容，所以我们提供了 piwheels 上可用内容的信息，包括所有已知发行版的列表，一些基本信息以及我们拥有的文件列表：</p><p><img src=https://img.linux.net.cn/data/attachment/album/202105/03/112016nfk00450ukq75kku.png alt="JSON files available in piwheels" title="JSON files available in piwheels"></p><p>与之前的 PyPI 例子类似，你可以创建一个脚本来分析 API 内容。例如，对于每个 NumPy 版本，其中有多少 piwheels 文件：</p><pre tabindex=0><code>import requests

url = &#34;https://www.piwheels.org/project/numpy/json&#34;
package = requests.get(url).json()

for version, info in package[&#39;releases&#39;].items():
    if info[&#39;files&#39;]:
        print(&#39;{}: {} files&#39;.format(version, len(info[&#39;files&#39;])))
    else:
        print(&#39;{}: No files&#39;.format(version))
</code></pre><p>此外，每个文件都包含一些元数据：</p><p><img src=https://img.linux.net.cn/data/attachment/album/202105/03/112016j2a9mo2io23xab6b.png alt="Metadata in JSON files in piwheels" title="Metadata in JSON files in piwheels"></p><p>方便的是 <code>apt_dependencies</code> 字段，它列出了使用该库所需的 Apt 软件包。本例中的 NumPy 文件，或者通过 <code>pip</code> 安装 Numpy，你还需要使用 Debian 的 <code>apt</code> 包管理器安装 <code>libatlas3-base</code> 和 <code>libgfortran</code>。</p><p>以下是一个示例脚本，显示了程序包的 Apt 依赖关系：</p><pre tabindex=0><code>import requests

def get_install(package, abi):
    url = &#39;https://piwheels.org/project/{}/json&#39;.format(package)
    r = requests.get(url)
    data = r.json()
    for version, release in sorted(data[&#39;releases&#39;].items(), reverse=True):
        for filename, file in release[&#39;files&#39;].items():
            if abi in filename:
                deps = &#39; &#39;.join(file[&#39;apt_dependencies&#39;])
                print(&#34;sudo apt install {}&#34;.format(deps))
                print(&#34;sudo pip3 install {}=={}&#34;.format(package, version))
                return

get_install(&#39;opencv-python&#39;, &#39;cp37m&#39;)
get_install(&#39;opencv-python&#39;, &#39;cp35m&#39;)
get_install(&#39;opencv-python-headless&#39;, &#39;cp37m&#39;)
get_install(&#39;opencv-python-headless&#39;, &#39;cp35m&#39;)
</code></pre><p>我们还为软件包列表提供了一个通用的 API 入口，其中包括每个软件包的下载统计：</p><pre tabindex=0><code>import requests

url = &#34;https://www.piwheels.org/packages.json&#34;
packages = requests.get(url).json()
packages = {
    pkg: (d_month, d_all)
    for pkg, d_month, d_all, \*_ in packages
}

package = &#39;numpy&#39;
d_month, d_all = packages[package]

print(package, &#34;has had&#34;, d_month, &#34;downloads in the last month&#34;)
print(package, &#34;has had&#34;, d_all, &#34;downloads in total&#34;)
</code></pre><h3 id=pip-search>pip search</h3><p><code>pip search</code> 因为其 XMLRPC 接口过载而被禁用，因此人们一直在寻找替代方法。你可以使用 piwheels 的 JSON API 来搜索软件包名称，因为软件包的集合是相同的：</p><pre tabindex=0><code>#!/usr/bin/python3
import sys

import requests

PIWHEELS_URL = &#39;https://www.piwheels.org/packages.json&#39;

r = requests.get(PIWHEELS_URL)
packages = {p[0] for p in r.json()}

def search(term):
    for pkg in packages:
        if term in pkg:
            yield pkg

if __name__ == &#39;__main__&#39;:
    if len(sys.argv) == 2:
        results = search(sys.argv[1].lower())
        for res in results:
            print(res)
    else:
        print(&#34;Usage: pip_search TERM&#34;)
</code></pre><p>有关更多信息，参考 piwheels 的 <a href=https://www.piwheels.org/json.html>JSON API 文档</a>.</p><hr><p><em>本文最初发表在 Ben Nuttall 的 <a href=https://tooling.bennuttall.com/accessing-python-package-index-json-apis-with-requests/>Tooling Tuesday 博客上</a>，经许可转载使用。</em></p><hr><p>via: <a href=https://opensource.com/article/21/3/python-package-index-json-apis-requests>https://opensource.com/article/21/3/python-package-index-json-apis-requests</a></p><p>作者：<a href=https://opensource.com/users/bennuttall>Ben Nuttall</a> 选题：<a href=https://github.com/lujun9972>lujun9972</a> 译者：<a href=https://github.com/MjSeven>MjSeven</a> 校对：<a href=https://github.com/wxy>wxy</a></p><p>本文由 <a href=https://github.com/LCTT/TranslateProject>LCTT</a> 原创编译，<a href=https://linux.cn/>Linux中国</a> 荣誉推出</p></div><footer class=post__footer><div class="post__tags tags clearfix"><svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5.0 11V3C0 1.5.8.8.8.8S1.5.0 3 0h8c1.5.0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 100-6 3 3 0 000 6z"/></svg><ul class=tags__list><li class=tags__item><a class="tags__link btn" href=/tags/python/ rel=tag>Python</a></li><li class=tags__item><a class="tags__link btn" href=/tags/pypi/ rel=tag>PyPI</a></li></ul></div></footer></article></main></div></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2025 Linux.cn Archive.
<span class=footer__copyright-credits>Generated with <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> and <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a> theme.</span></div></div></footer></div><script async defer src=/js/menu.js></script></body></html>