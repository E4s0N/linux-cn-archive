<!doctype html><html class=no-js lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>使用 OpenCV 识别图片中的猫咪 - Linux.cn Archive</title>
<script>(function(e,t){e[t]=e[t].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content><meta property="og:title" content="使用 OpenCV 识别图片中的猫咪"><meta property="og:description" content="你知道 OpenCV 可以识别在图片中小猫的脸吗？而且是拿来就能用，不需要其它的库之类的。
之前我也不知道。"><meta property="og:type" content="article"><meta property="og:url" content="/article-7601-1.html"><meta property="article:section" content="posts"><meta property="article:published_time" content="2016-07-21T10:38:00+00:00"><meta property="article:modified_time" content="2016-07-21T10:38:00+00:00"><meta itemprop=name content="使用 OpenCV 识别图片中的猫咪"><meta itemprop=description content="你知道 OpenCV 可以识别在图片中小猫的脸吗？而且是拿来就能用，不需要其它的库之类的。
之前我也不知道。"><meta itemprop=datePublished content="2016-07-21T10:38:00+00:00"><meta itemprop=dateModified content="2016-07-21T10:38:00+00:00"><meta itemprop=wordCount content="511"><meta itemprop=keywords content="OpenCV,计算机视觉,"><link rel=preconnect href=https://fonts.bunny.net crossorigin><link rel=dns-prefetch href=//fonts.bunny.net><link rel=dns-prefetch href=//fonts.bunny.net><link rel=stylesheet href="https://fonts.bunny.net/css?family=Open+Sans:400,400i,700"><link rel=stylesheet href=/css/style.css><link rel="shortcut icon" href=/favicon.ico></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class=logo><a class=logo__link href=/ title="Linux.cn Archive" rel=home><div class="logo__item logo__text"><div class=logo__title>Linux.cn Archive</div></div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>Menu</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/><span class=menu__text>Home</span></a></li><li class=menu__item><a class=menu__link href=/categories/><span class=menu__text>Categories</span></a></li><li class=menu__item><a class=menu__link href=/tags/><span class=menu__text>Tags</span></a></li><li class=menu__item><a class=menu__link href><span class=menu__text>RSS</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>使用 OpenCV 识别图片中的猫咪</h1><div class="post__meta meta"><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class=meta__text datetime=2016-07-21T10:38:00Z>July 21, 2016</time></div></div></header><div class="content post__content clearfix"><p><img src=https://img.linux.net.cn/data/attachment/album/201607/21/014359nggjvnaj0zivg5yc.jpg alt></p><p>你知道 OpenCV 可以识别在图片中小猫的脸吗？而且是拿来就能用，不需要其它的库之类的。</p><p>之前我也不知道。</p><p>但是在 <a href=http://kendricktan.github.io/find-cats-in-photos-using-computer-vision.html>Kendrick Tan 曝出这个功能</a>后，我需要亲自体验一下……去看看到 OpenCV 是如何在我没有察觉到的情况下，将这一个功能添加进了他的软件库（就像一只悄悄溜进空盒子的猫咪一样，等待别人发觉）。</p><p>下面，我将会展示如何使用 OpenCV 的猫咪检测器在图片中识别小猫的脸。同样的，该技术也可以用在视频流中。</p><h3 id=使用-opencv-在图片中检测猫咪>使用 OpenCV 在图片中检测猫咪</h3><p>如果你查找过 <a href=https://github.com/Itseez/opencv>OpenCV 的代码仓库</a>，尤其是在 <a href=https://github.com/Itseez/opencv/tree/master/data/haarcascades>haarcascades 目录</a>里（OpenCV 在这里保存处理它预先训练好的 Haar 分类器，以检测各种物体、身体部位等）， 你会看到这两个文件:</p><ul><li>haarcascade_frontalcatface.xml</li><li>haarcascade_frontalcatface_extended.xml</li></ul><p>这两个 Haar Cascade 文件都将被用来在图片中检测小猫的脸。实际上，我使用了相同的 cascades 分类器来生成这篇博文顶端的图片。</p><p>在做了一些调查工作之后，我发现这些 cascades 分类器是由鼎鼎大名的 <a href=http://nummist.com/>Joseph Howse</a> 训练和贡献给 OpenCV 仓库的，他写了很多很棒的教程和书籍，在计算机视觉领域有着很高的声望。</p><p>下面，我将会展示给你如何使用 Howse 的 Haar cascades 分类器来检测图片中的小猫。</p><h3 id=猫咪检测代码>猫咪检测代码</h3><p>让我们开始使用 OpenCV 来检测图片中的猫咪。新建一个叫 cat_detector.py 的文件，并且输入如下的代码:</p><pre tabindex=0><code># import the necessary packages
import argparse
import cv2

# construct the argument parse and parse the arguments
ap = argparse.ArgumentParser()
ap.add_argument(&#34;-i&#34;, &#34;--image&#34;, required=True,
    help=&#34;path to the input image&#34;)
ap.add_argument(&#34;-c&#34;, &#34;--cascade&#34;,
    default=&#34;haarcascade_frontalcatface.xml&#34;,
    help=&#34;path to cat detector haar cascade&#34;)
args = vars(ap.parse_args())
</code></pre><p>第 2 和第 3 行主要是导入了必要的 python 包。6-12 行用于解析我们的命令行参数。我们仅要求一个必需的参数 <code>--image</code> ，它是我们要使用 OpenCV 检测猫咪的图片。</p><p>我们也可以（可选的）通过 <code>--cascade</code> 参数指定我们的 Haar cascade 分类器的路径。默认使用 <code>haarcascades_frontalcatface.xml</code>，假定这个文件和你的 <code>cat_detector.py</code> 在同一目录下。</p><p>注意：我已经打包了猫咪的检测代码，还有在这个教程里的样本图片。你可以在博文原文的 “下载” 部分下载到。如果你是刚刚接触 Python+OpenCV（或者 Haar cascade），我建议你下载这个 zip 压缩包，这个会方便你跟着教程学习。</p><p>接下来，就是检测猫的时刻了：</p><pre tabindex=0><code># load the input image and convert it to grayscale
image = cv2.imread(args[&#34;image&#34;])
gray = cv2.cvtColor(image, cv2.COLOR_BGR2GRAY)

# load the cat detector Haar cascade, then detect cat faces
# in the input image
detector = cv2.CascadeClassifier(args[&#34;cascade&#34;])
rects = detector.detectMultiScale(gray, scaleFactor=1.3,
    minNeighbors=10, minSize=(75, 75))
</code></pre><p>在 15、16 行，我们从硬盘上读取了图片，并且进行灰度化（这是一个在将图片传给 Haar cascade 分类器之前的常用的图片预处理步骤，尽管不是必须的）</p><p>20 行，从硬盘加载 Haar casacade 分类器，即猫咪检测器，并且实例化 <code>cv2.CascadeClassifier</code> 对象。</p><p>在 21、22 行通过调用 <code>detector</code> 的 <code>detectMultiScale</code> 方法使用 OpenCV 完成猫脸检测。我们给 <code>detectMultiScale</code> 方法传递了四个参数。包括：</p><ol><li>图片 <code>gray</code>，我们要在该图片中检测猫脸。</li><li>检测猫脸时的<a href=http://www.pyimagesearch.com/2015/03/16/image-pyramids-with-python-and-opencv/>图片金字塔</a> 的检测粒度 <code>scaleFactor</code> 。更大的粒度将会加快检测的速度，但是会对检测 准确性 （ true-positive ） 产生影响。相反的，一个更小的粒度将会影响检测的时间，但是会增加 准确性 （ true-positive ） 。但是，细粒度也会增加 误报率 （ false-positive ） 。你可以看这篇博文的“ Haar cascades 注意事项”部分来获得更多的信息。</li><li><code>minNeighbors</code> 参数控制了检定框的最少数量，即在给定区域内被判断为猫脸的最少数量。这个参数可以很好的排除 误报 （ false-positive ） 结果。</li><li>最后，<code>minSize</code> 参数不言自明。这个值描述每个检定框的最小宽高尺寸（单位是像素），这个例子中就是 75*75</li></ol><p><code>detectMultiScale</code> 函数会返回 <code>rects</code>，这是一个 4 元组列表。这些元组包含了每个检测到的猫脸的 (x,y) 坐标值，还有宽度、高度。</p><p>最后，让我们在图片上画下这些矩形来标识猫脸：</p><pre tabindex=0><code># loop over the cat faces and draw a rectangle surrounding each
for (i, (x, y, w, h)) in enumerate(rects):
    cv2.rectangle(image, (x, y), (x + w, y + h), (0, 0, 255), 2)
    cv2.putText(image, &#34;Cat #{}&#34;.format(i + 1), (x, y - 10),
        cv2.FONT_HERSHEY_SIMPLEX, 0.55, (0, 0, 255), 2)

# show the detected cat faces
cv2.imshow(&#34;Cat Faces&#34;, image)
cv2.waitKey(0)
</code></pre><p>给我们这些框（比如，rects）的数据，我们在 25 行依次遍历它。</p><p>在 26 行，我们在每张猫脸的周围画上一个矩形。27、28 行展示了一个整数，即图片中猫咪的数量。</p><p>最后，31，32 行在屏幕上展示了输出的图片。</p><h3 id=猫咪检测结果>猫咪检测结果</h3><p>为了测试我们的 OpenCV 猫咪检测器，可以在原文的最后，下载教程的源码。</p><p>然后，在你解压缩之后，你将会得到如下的三个文件/目录:</p><ol><li>cat_detector.py：我们的主程序</li><li>haarcascade_frontalcatface.xml： 猫咪检测器 Haar cascade</li><li>images：我们将会使用的检测图片目录。</li></ol><p>到这一步，执行以下的命令：</p><pre tabindex=0><code>$ python cat_detector.py --image images/cat_01.jpg
</code></pre><p><img src=https://img.linux.net.cn/data/attachment/album/201607/21/014400ze2a5fjnnz5unfbu.jpg alt></p><p><em>图 1. 在图片中检测猫脸，甚至是猫咪部分被遮挡了。</em></p><p>注意，我们已经可以检测猫脸了，即使它的其余部分是被遮挡的。</p><p>试下另外的一张图片:</p><pre tabindex=0><code>python cat_detector.py --image images/cat_02.jpg
</code></pre><p><img src=https://img.linux.net.cn/data/attachment/album/201607/21/014403yfrcjzjvab2vjwwq.jpg alt></p><p><em>图 2. 使用 OpenCV 检测猫脸的第二个例子，这次猫脸稍有不同。</em></p><p>这次的猫脸和第一次的明显不同，因为它正在发出“喵呜”叫声的当中。这种情况下，我们依旧能检测到正确的猫脸。</p><p>在下面这张图片的结果也是正确的：</p><pre tabindex=0><code>$ python cat_detector.py --image images/cat_03.jpg
</code></pre><p><img src=https://img.linux.net.cn/data/attachment/album/201607/21/014405mghqpzu3sskza33u.jpg alt></p><p><em>图 3. 使用 OpenCV 和 python 检测猫脸</em></p><p>我们最后的一个样例就是在一张图中检测多张猫脸:</p><pre tabindex=0><code>$ python cat_detector.py --image images/cat_04.jpg
</code></pre><p><img src=https://img.linux.net.cn/data/attachment/album/201607/21/014359nggjvnaj0zivg5yc.jpg alt></p><p><em>图 4. 在同一张图片中使用 OpenCV 检测多只猫</em></p><p>注意，Haar cascade 返回的检定框不一定是以你预期的顺序。这种情况下，中间的那只猫会被标记成第三只。你可以通过判断他们的 (x, y) 坐标来自己排序这些检定框。</p><h4 id=关于精度的说明>关于精度的说明</h4><p>在这个 xml 文件中的注释非常重要，Joseph Hower 提到了这个猫脸检测器有可能会将人脸识别成猫脸。</p><p>这种情况下，他推荐使用两种检测器（人脸 & 猫脸），然后将出现在人脸识别结果中的结果剔除掉。</p><h4 id=haar-cascades-注意事项>Haar cascades 注意事项</h4><p>这个方法首先出现在 Paul Viola 和 Michael Jones 2001 年出版的 <a href=https://www.cs.cmu.edu/~efros/courses/LBMV07/Papers/viola-cvpr-01.pdf>Rapid Object Detection using a Boosted Cascade of Simple Features</a> 论文中。现在它已经成为了计算机识别领域引用最多的论文之一。</p><p>这个算法能够识别图片中的对象，无论它们的位置和比例。而且最令人感兴趣的或许是它能在现有的硬件条件下实现实时检测。</p><p>在他们的论文中，Viola 和 Jones 关注在训练人脸检测器；但是，这个框架也能用来检测各类事物，如汽车、香蕉、路标等等。</p><h4 id=问题是>问题是？</h4><p>Haar cascades 最大的问题就是如何确定 <code>detectMultiScale</code> 方法的参数正确。特别是 <code>scaleFactor</code> 和 <code>minNeighbors</code> 参数。你很容易陷入一张一张图片调参数的坑，这个就是该对象检测器很难被实用化的原因。</p><p>这个 <code>scaleFactor</code> 变量控制了用来检测对象的图片的各种比例的<a href=http://www.pyimagesearch.com/2015/03/16/image-pyramids-with-python-and-opencv/>图像金字塔</a>。如果 <code>scaleFactor</code> 参数过大，你就只需要检测图像金字塔中较少的层，这可能会导致你丢失一些在图像金字塔层之间缩放时少了的对象。</p><p>换句话说，如果 <code>scaleFactor</code> 参数过低，你会检测过多的金字塔图层。这虽然可以能帮助你检测到更多的对象。但是他会造成计算速度的降低，还会<strong>明显</strong>提高误报率。Haar cascades 分类器就是这样。</p><p>为了避免这个，我们通常使用 <a href=http://www.pyimagesearch.com/2014/11/10/histogram-oriented-gradients-object-detection/>Histogram of Oriented Gradients + 线性 SVM 检测</a> 替代。</p><p>上述的 HOG + 线性 SVM 框架的参数更容易调优。而且更好的误报率也更低，但是唯一不好的地方是无法实时运算。</p><h3 id=对对象识别感兴趣并且希望了解更多>对对象识别感兴趣？并且希望了解更多？</h3><p><img src=https://img.linux.net.cn/data/attachment/album/201607/21/014407ehzc6pffazf9zjn9.jpg alt></p><p><em>图 5. 在 PyImageSearch Gurus 课程中学习如何构建自定义的对象识别器。</em></p><p>如果你对学习如何训练自己的自定义对象识别器感兴趣，请务必要去了解下 PyImageSearch Gurus 课程。</p><p>在这个课程中，我提供了 15 节课，覆盖了超过 168 页的教程，来教你如何从 0 开始构建自定义的对象识别器。你会掌握如何应用 HOG + 线性 SVM 框架来构建自己的对象识别器来识别路标、面孔、汽车（以及附近的其它东西）。</p><p>要学习 PyImageSearch Gurus 课程（有 10 节示例免费课程），点此： <a href="https://www.pyimagesearch.com/pyimagesearch-gurus/?src=post-cat-detection">https://www.pyimagesearch.com/pyimagesearch-gurus/?src=post-cat-detection</a></p><h3 id=总结>总结</h3><p>在这篇博文里，我们学习了如何使用 OpenCV 默认就有的 Haar cascades 分类器来识别图片中的猫脸。这些 Haar casacades 是由 <a href=http://www.pyimagesearch.com/2014/11/10/histogram-oriented-gradients-object-detection/>Joseph Howse</a> 训练兵贡献给 OpenCV 项目的。我是在 Kendrick Tan 的<a href=http://kendricktan.github.io/find-cats-in-photos-using-computer-vision.html>这篇文章</a>中开始注意到这个。</p><p>尽管 Haar cascades 相当有用，但是我们也经常用 HOG + 线性 SVM 替代。因为后者相对而言更容易使用，并且可以有效地降低误报率。</p><p>我也会<a href=https://www.pyimagesearch.com/pyimagesearch-gurus/>在 PyImageSearch Gurus 课程中</a>详细的讲述如何构建定制的 HOG + 线性 SVM 对象识别器，来识别包括汽车、路标在内的各种事物。</p><p>不管怎样，我希望你喜欢这篇博文。</p><hr><p>via: <a href=http://www.pyimagesearch.com/2016/06/20/detecting-cats-in-images-with-opencv/>http://www.pyimagesearch.com/2016/06/20/detecting-cats-in-images-with-opencv/</a></p><p>作者：<a href=http://www.pyimagesearch.com/author/adrian/>Adrian Rosebrock</a> 译者：<a href=https://github.com/MikeCoder>MikeCoder</a> 校对：<a href=https://github.com/wxy>wxy</a></p><p>本文由 <a href=https://github.com/LCTT/TranslateProject>LCTT</a> 原创编译，<a href=https://linux.cn/>Linux中国</a> 荣誉推出</p></div><footer class=post__footer><div class="post__tags tags clearfix"><svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5.0 11V3C0 1.5.8.8.8.8S1.5.0 3 0h8c1.5.0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 100-6 3 3 0 000 6z"/></svg><ul class=tags__list><li class=tags__item><a class="tags__link btn" href=/tags/opencv/ rel=tag>OpenCV</a></li><li class=tags__item><a class="tags__link btn" href=/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%A7%86%E8%A7%89/ rel=tag>计算机视觉</a></li></ul></div></footer></article></main></div></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2025 Linux.cn Archive.
<span class=footer__copyright-credits>Generated with <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> and <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a> theme.</span></div></div></footer></div><script async defer src=/js/menu.js></script></body></html>