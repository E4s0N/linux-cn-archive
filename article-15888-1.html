<!doctype html><html class=no-js lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>用 Lua 控制你的树莓派 - Linux.cn Archive</title>
<script>(function(e,t){e[t]=e[t].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content><meta property="og:title" content="用 Lua 控制你的树莓派"><meta property="og:description" content="学习如何使用 Lua 编程语言为物联网（IoT）设备编程，并与树莓派上的通用输入/输出（GPIO）引脚互动。"><meta property="og:type" content="article"><meta property="og:url" content="/article-15888-1.html"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-06-08T17:05:15+00:00"><meta property="article:modified_time" content="2023-06-08T17:05:15+00:00"><meta itemprop=name content="用 Lua 控制你的树莓派"><meta itemprop=description content="学习如何使用 Lua 编程语言为物联网（IoT）设备编程，并与树莓派上的通用输入/输出（GPIO）引脚互动。"><meta itemprop=datePublished content="2023-06-08T17:05:15+00:00"><meta itemprop=dateModified content="2023-06-08T17:05:15+00:00"><meta itemprop=wordCount content="367"><meta itemprop=keywords content="Lua,树莓派,"><link rel=preconnect href=https://fonts.bunny.net crossorigin><link rel=dns-prefetch href=//fonts.bunny.net><link rel=dns-prefetch href=//fonts.bunny.net><link rel=stylesheet href="https://fonts.bunny.net/css?family=Open+Sans:400,400i,700"><link rel=stylesheet href=/css/style.css><link rel="shortcut icon" href=/favicon.ico></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class=logo><a class=logo__link href=/ title="Linux.cn Archive" rel=home><div class="logo__item logo__text"><div class=logo__title>Linux.cn Archive</div></div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>Menu</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/><span class=menu__text>Home</span></a></li><li class=menu__item><a class=menu__link href=/categories/><span class=menu__text>Categories</span></a></li><li class=menu__item><a class=menu__link href=/tags/><span class=menu__text>Tags</span></a></li><li class=menu__item><a class=menu__link href><span class=menu__text>RSS</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>用 Lua 控制你的树莓派</h1><div class="post__meta meta"><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class=meta__text datetime=2023-06-08T17:05:15Z>June 08, 2023</time></div></div></header><div class="content post__content clearfix"><p><img src=https://img.linux.net.cn/data/attachment/album/202306/08/170454p0tf2a6znfn2kzkf.jpg alt></p><blockquote><p>学习如何使用 Lua 编程语言为物联网（IoT）设备编程，并与树莓派上的通用输入/输出（GPIO）引脚互动。</p></blockquote><p>Lua 是一种有时会被误解的语言。它与 Python 等其他语言不同，但它是一种通用的扩展语言，广泛用于游戏引擎、框架等。总的来说，我发现 Lua 对开发人员来说是一个有价值的工具，可以让他们以一些强大的方式增强和扩展他们的项目。</p><p>你可以按照 Seth Kenlon 的文章《<a href=https://opensource.com/article/22/11/lua-worth-learning>Lua 值得学习吗？</a>》的介绍下载并运行常用的 Lua，该文章中还包括了简单的 Lua 代码示例。但是，要充分利用 Lua，最好将它与采用该语言的框架一起使用。在本教程中，我演示了如何使用名为 Mako Server 的框架，该框架旨在使 Lua 程序员能够轻松地编写 IoT 和 Web 应用代码。我还向你展示了如何使用 API 扩展此框架以使用树莓派的 GPIO 引脚。</p><h3 id=要求>要求</h3><p>在学习本教程之前，你需要一个可以登录的正在运行的树莓派。虽然我将在本教程中编译 C 代码，但你不需要任何 C 代码经验。但是，你需要一些使用 <a href=https://opensource.com/article/19/7/what-posix-richard-stallman-explains>POSIX</a> 终端的经验。</p><h3 id=安装>安装</h3><p>首先，在树莓派上打开一个终端窗口并安装以下工具，以使用 Git 下载代码和编译 C 代码：</p><pre tabindex=0><code>$ sudo apt install git unzip gcc make
</code></pre><p>接下来，通过运行以下命令编译开源 Mako Server 代码和 lua-periphery 库（树莓派的 GPIO 库）：</p><pre tabindex=0><code>$ wget -O Mako-Server-Build.sh \
  https://raw.githubusercontent.com/RealTimeLogic/BAS/main/RaspberryPiBuild.sh
</code></pre><p>查看脚本以了解它的作用，并在你觉得没问题后运行它：</p><pre tabindex=0><code>$ sh ./Mako-Server-Build.sh
</code></pre><p>编译过程可能需要一些时间，尤其是在较旧的树莓派上。编译完成后，脚本会要求你将 Mako Server 和 lua-periphery 模块安装到 <code>/usr/local/bin/</code>。我建议安装它以简化软件的使用。别担心，如果你不再需要它，你可以卸载它：</p><pre tabindex=0><code>$ cd /usr/local/bin/
$ sudo rm mako mako.zip periphery.so
</code></pre><p>要测试安装，请在终端中输入 <code>mako</code>。这将启动 Mako 服务器，并在你的终端中看到一些输出。你可以按 <code>CTRL+C</code> 停止服务器。</p><h3 id=iot-和-lua>IoT 和 Lua</h3><p>现在 Mako 服务器已在你的树莓派上设置好，你可以开始对 IoT 和 Web 应用进行编程，并使用 Lua 操作树莓派的 GPIO 引脚。Mako Server 框架为 Lua 开发人员提供了一个强大而简单的 API 来创建物联网应用，而 lua-periphery 模块让 Lua 开发人员可以与树莓派的 GPIO 引脚和其他外围设备进行交互。</p><p>首先创建一个应用目录和一个 <code>.preload</code> 脚本，其中插入用于测试 GPIO 的 Lua 代码。<code>.preload</code> 脚本是一个 Mako 服务器扩展，在应用启动时作为 Lua 脚本加载和运行。</p><pre tabindex=0><code>$ mkdir gpiotst
$ nano gpiotst/.preload
</code></pre><p>将以下内容复制到 <a href=https://opensource.com/article/20/12/gnu-nano>Nano 编辑器</a> 中并保存文件：</p><pre tabindex=0><code>-- Load periphery.so and access the LED interface
local LED = require(&#39;periphery&#39;).LED

local function doled()
  local led = LED(&#34;led0&#34;) -- Open LED led0
  trace&#34;Turn LED on&#34;
  led:write(true)   -- Turn on LED (set max brightness)
  ba.sleep(3000)    -- 3 seconds
  trace&#34;Turn LED off&#34;
  led:write(false)  -- Turn off LED (set zero brightness)
  led:close()
end

ba.thread.run(doled) -- Defer execution
                     -- to after Mako has started
</code></pre><p>上面的 Lua 代码使用你编译并包含在 Mako 服务器中的 Lua-periphery 库控制树莓派 LED。该脚本定义了一个名为 <code>doled</code> 的函数来控制 LED。该脚本首先使用 Lua <code>require</code> 函数加载 <code>periphery</code> 库（共享库 <a href=http://periphery.so>periphery.so</a>）。返回的数据是一个包含所有 GPIO API 函数的 <a href=https://opensource.com/article/22/11/iterate-over-tables-lua>Lua 表</a>。但是，你只需要 LED API，你可以通过在调用 <code>require</code> 后附加 <code>.LED</code> 来直接访问它。接下来，代码定义了一个名为 <code>doled</code> 的函数，它执行以下操作：</p><ul><li>通过调用 <code>periphery</code> 库中的 <code>LED</code> 函数，并将字符串 <code>led0</code> 传给它，打开树莓派主 LED，识别为 <code>led0</code>。</li><li>将消息 <code>Turn LED on</code> 打印到跟踪（控制台）。</li><li>通过调用 LED 对象上的 <code>write</code> 方法并将布尔值 <code>true</code> 传递给它来激活 LED，该值设置 LED 的最大亮度。</li><li>通过调用 <code>ba.sleep(3000)</code> 等待 3 秒。</li><li>将消息 <code>Turn LED off</code> 打印到跟踪。</li><li>通过调用 LED 对象上的 <code>write</code> 方法并将布尔值 <code>false</code> 传递给它来停用 LED，这会将 LED 的亮度设置为零。</li><li>通过调用 LED 对象上的 <code>close</code> 函数关闭 <code>LED</code>。</li></ul><p>在 <code>.preload</code> 脚本的末尾，<code>doled</code> 函数作为参数传递给 <code>ba.thread.run</code> 函数。这允许将 <code>doled</code> 函数的执行推迟到 Mako 服务器启动之后。</p><p>要启动 <code>gpiotst</code> 应用，请按如下方式运行 Mako 服务器：</p><pre tabindex=0><code>$ mako -l::gpiotst
</code></pre><p>控制台中打印以下文本：</p><pre tabindex=0><code>Opening LED:
opening &#39;brightness&#39;: Permission denied.
</code></pre><p>访问 GPIO 需要 root 访问权限，因此按 <code>CTRL+C</code> 停止服务器并重新启动 Mako 服务器，如下所示：</p><pre tabindex=0><code>$ sudo mako -l::gpiotst
</code></pre><p>现在树莓派 LED 亮起 3 秒。成功！</p><h3 id=lua-解锁-iot>Lua 解锁 IoT</h3><p>在本入门教程中，你学习了如何编译 Mako 服务器，包括 GPIO Lua 模块，以及如何编写用于打开和关闭树莓派 LED 的基本 Lua 脚本。在以后的文章中，我将在本文的基础上进一步介绍 IoT 功能。</p><p>同时，你可以通过阅读它的 <a href=https://github.com/vsergeev/lua-periphery/tree/master/docs>文档</a> 来更深入地研究 Lua-periphery GPIO 库，以了解有关功能以及如何将其与不同外设一起使用的更多信息。要充分利用本教程，请考虑关注 <a href=https://tutorial.realtimelogic.com/Introduction.lsp>交互式 Mako Server Lua 教程</a> 以更好地了解 Lua、Web 和 IoT。编码愉快！</p><p><em>（题图：MJ/4514210d-5697-4cd3-8c44-450bbe56be64）</em></p><hr><p>via: <a href=https://opensource.com/article/23/3/control-your-raspberry-pi-lua>https://opensource.com/article/23/3/control-your-raspberry-pi-lua</a></p><p>作者：<a href=https://opensource.com/users/alansmithee>Alan Smithee</a> 选题：<a href=https://github.com/lkxed/>lkxed</a> 译者：<a href=https://github.com/geekpi>geekpi</a> 校对：<a href=https://github.com/wxy>wxy</a></p><p>本文由 <a href=https://github.com/LCTT/TranslateProject>LCTT</a> 原创编译，<a href=https://linux.cn/>Linux中国</a> 荣誉推出</p></div><footer class=post__footer><div class="post__tags tags clearfix"><svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5.0 11V3C0 1.5.8.8.8.8S1.5.0 3 0h8c1.5.0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 100-6 3 3 0 000 6z"/></svg><ul class=tags__list><li class=tags__item><a class="tags__link btn" href=/tags/lua/ rel=tag>Lua</a></li><li class=tags__item><a class="tags__link btn" href=/tags/%E6%A0%91%E8%8E%93%E6%B4%BE/ rel=tag>树莓派</a></li></ul></div></footer></article></main></div></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2025 Linux.cn Archive.
<span class=footer__copyright-credits>Generated with <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> and <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a> theme.</span></div></div></footer></div><script async defer src=/js/menu.js></script></body></html>