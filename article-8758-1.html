<!doctype html><html class=no-js lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>在 Azure 中部署 Kubernetes 容器集群 - Linux.cn Archive</title>
<script>(function(e,t){e[t]=e[t].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content><meta property="og:title" content="在 Azure 中部署 Kubernetes 容器集群"><meta property="og:description" content="在这个快速入门教程中，我们使用 Azure CLI 创建一个 Kubernetes 集群，然后在集群上部署运行由 Web 前端和 Redis 实例组成的多容器应用程序。一旦部署完成，应用程序可以通过互联网访问。"><meta property="og:type" content="article"><meta property="og:url" content="/article-8758-1.html"><meta property="article:section" content="posts"><meta property="article:published_time" content="2017-08-07T21:27:53+00:00"><meta property="article:modified_time" content="2017-08-07T21:27:53+00:00"><meta itemprop=name content="在 Azure 中部署 Kubernetes 容器集群"><meta itemprop=description content="在这个快速入门教程中，我们使用 Azure CLI 创建一个 Kubernetes 集群，然后在集群上部署运行由 Web 前端和 Redis 实例组成的多容器应用程序。一旦部署完成，应用程序可以通过互联网访问。"><meta itemprop=datePublished content="2017-08-07T21:27:53+00:00"><meta itemprop=dateModified content="2017-08-07T21:27:53+00:00"><meta itemprop=wordCount content="410"><meta itemprop=keywords content="Kubernetes,Azure,"><link rel=preconnect href=https://fonts.bunny.net crossorigin><link rel=dns-prefetch href=//fonts.bunny.net><link rel=dns-prefetch href=//fonts.bunny.net><link rel=stylesheet href="https://fonts.bunny.net/css?family=Open+Sans:400,400i,700"><link rel=stylesheet href=/css/style.css><link rel="shortcut icon" href=/favicon.ico></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class=logo><a class=logo__link href=/ title="Linux.cn Archive" rel=home><div class="logo__item logo__text"><div class=logo__title>Linux.cn Archive</div></div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>Menu</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/><span class=menu__text>Home</span></a></li><li class=menu__item><a class=menu__link href=/categories/><span class=menu__text>Categories</span></a></li><li class=menu__item><a class=menu__link href=/tags/><span class=menu__text>Tags</span></a></li><li class=menu__item><a class=menu__link href><span class=menu__text>RSS</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>在 Azure 中部署 Kubernetes 容器集群</h1><div class="post__meta meta"><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class=meta__text datetime=2017-08-07T21:27:53Z>August 07, 2017</time></div></div></header><div class="content post__content clearfix"><p><img src=/data/attachment/album/201708/07/212710ujddonvcwyj459zw.jpg alt></p><p>在这个快速入门教程中，我们使用 Azure CLI 创建一个 Kubernetes 集群，然后在集群上部署运行由 Web 前端和 Redis 实例组成的多容器应用程序。一旦部署完成，应用程序可以通过互联网访问。</p><p><img src=/data/attachment/album/201708/07/212758xwuv7z8i56u5uuvv.png alt=示例应用截图></p><p>这个快速入门教程假设你已经基本了解了 Kubernetes 的概念，有关 Kubernetes 的详细信息，请参阅 <a href=https://kubernetes.io/docs/home/>Kubernetes 文档</a>。</p><p>如果您没有 Azure 账号，请在开始之前创建一个<a href="https://azure.microsoft.com/free/?WT.mc_id=A261C142F">免费帐户</a>。</p><h3 id=登录-azure-云控制台>登录 Azure 云控制台</h3><p>Azure 云控制台是一个免费的 Bash shell，你可以直接在 Azure 网站上运行。它已经在你的账户中预先配置好了， 单击 <a href=https://portal.azure.com/>Azure 门户</a>右上角菜单上的 “Cloud Shell” 按钮；</p><p><a href=https://portal.azure.com/><img src=/data/attachment/album/201708/07/212758kgpzcgvchgrv7g7v.png alt="Cloud Shell"></a></p><p>该按钮会启动一个交互式 shell，您可以使用它来运行本教程中的所有操作步骤。</p><p><a href=https://portal.azure.com/><img src=/data/attachment/album/201708/07/212803h6jj15aj6uvvbnz8.png alt=" Cloud Shell 截图"></a></p><p>此快速入门教程所用的 Azure CLI 的版本最低要求为 2.0.4。如果您选择在本地安装和使用 CLI 工具，请运行 <code>az --version</code> 来检查已安装的版本。 如果您需要安装或升级请参阅<a href=https://docs.microsoft.com/en-us/cli/azure/install-azure-cli>安装 Azure CLI 2.0</a> 。</p><h3 id=创建一个资源组>创建一个资源组</h3><p>使用 <a href=https://docs.microsoft.com/en-us/cli/azure/group#create>az group create</a> 命令创建一个资源组，一个 Azure 资源组是指 Azure 资源部署和管理的逻辑组。</p><p>以下示例在 <em>eastus</em> 区域中创建名为 <em>myResourceGroup</em> 的资源组。</p><pre tabindex=0><code>az group create --name myResourceGroup --location eastus
</code></pre><p>输出：</p><pre tabindex=0><code>{
  &#34;id&#34;: &#34;/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/myResourceGroup&#34;,
  &#34;location&#34;: &#34;eastus&#34;,
  &#34;managedBy&#34;: null,
  &#34;name&#34;: &#34;myResourceGroup&#34;,
  &#34;properties&#34;: {
    &#34;provisioningState&#34;: &#34;Succeeded&#34;
  },
  &#34;tags&#34;: null
}
</code></pre><h3 id=创建一个-kubernetes-集群>创建一个 Kubernetes 集群</h3><p>使用 <a href=https://docs.microsoft.com/en-us/cli/azure/acs#create>az acs create</a> 命令在 Azure 容器服务中创建 Kubernetes 集群。 以下示例使用一个 Linux 主节点和三个 Linux 代理节点创建一个名为 <em>myK8sCluster</em> 的集群。</p><pre tabindex=0><code>az acs create --orchestrator-type=kubernetes --resource-group myResourceGroup --name=myK8sCluster --generate-ssh-keys 
</code></pre><p>几分钟后，命令将完成并返回有关该集群的 json 格式的信息。</p><h3 id=连接到-kubernetes-集群>连接到 Kubernetes 集群</h3><p>要管理 Kubernetes 群集，可以使用 Kubernetes 命令行工具 <a href=https://kubernetes.io/docs/user-guide/kubectl/>kubectl</a>。</p><p>如果您使用 Azure CloudShell ，则已经安装了 kubectl 。如果要在本地安装，可以使用 <a href=https://docs.microsoft.com/en-us/cli/azure/acs/kubernetes#install-cli>az acs kubernetes install-cli</a> 命令。</p><p>要配置 kubectl 连接到您的 Kubernetes 群集，请运行 <a href=https://docs.microsoft.com/en-us/cli/azure/acs/kubernetes#get-credentials>az acs kubernetes get-credentials</a> 命令下载凭据并配置 Kubernetes CLI 以使用它们。</p><pre tabindex=0><code>az acs kubernetes get-credentials --resource-group=myResourceGroup --name=myK8sCluster
</code></pre><p>要验证与集群的连接，请使用 <a href=https://kubernetes.io/docs/user-guide/kubectl/v1.6/#get>kubectl get</a> 命令查看集群节点的列表。</p><pre tabindex=0><code>kubectl get nodes
</code></pre><p>输出：</p><pre tabindex=0><code>NAME                    STATUS                     AGE       VERSION
k8s-agent-14ad53a1-0    Ready                      10m       v1.6.6
k8s-agent-14ad53a1-1    Ready                      10m       v1.6.6
k8s-agent-14ad53a1-2    Ready                      10m       v1.6.6
k8s-master-14ad53a1-0   Ready,SchedulingDisabled   10m       v1.6.6
</code></pre><h3 id=运行应用程序>运行应用程序</h3><p>Kubernetes 清单文件为集群定义了一个所需的状态，包括了集群中应该运行什么样的容器镜像。 对于此示例，清单用于创建运行 Azure Vote 应用程序所需的所有对象。</p><p>创建一个名为 <code>azure-vote.yaml</code> ，将下面的内容拷贝到 YAML 中。</p><pre tabindex=0><code>apiVersion: apps/v1beta1
kind: Deployment
metadata:
  name: azure-vote-back
spec:
  replicas: 1
  template:
    metadata:
      labels:
        app: azure-vote-back
    spec:
      containers:
      - name: azure-vote-back
        image: redis
        ports:
        - containerPort: 6379
          name: redis
---
apiVersion: v1
kind: Service
metadata:
  name: azure-vote-back
spec:
  ports:
  - port: 6379
  selector:
    app: azure-vote-back
---
apiVersion: apps/v1beta1
kind: Deployment
metadata:
  name: azure-vote-front
spec:
  replicas: 1
  template:
    metadata:
      labels:
        app: azure-vote-front
    spec:
      containers:
      - name: azure-vote-front
        image: microsoft/azure-vote-front:redis-v1
        ports:
        - containerPort: 80
        env:
        - name: REDIS
          value: &#34;azure-vote-back&#34;
---
apiVersion: v1
kind: Service
metadata:
  name: azure-vote-front
spec:
  type: LoadBalancer
  ports:
  - port: 80
  selector:
    app: azure-vote-front
</code></pre><p>使用 <a href=https://kubernetes.io/docs/user-guide/kubectl/v1.6/#create>kubectl create</a> 命令来运行该应用程序。</p><pre tabindex=0><code>kubectl create -f azure-vote.yaml
</code></pre><p>输出：</p><pre tabindex=0><code>deployment &#34;azure-vote-back&#34; created
service &#34;azure-vote-back&#34; created
deployment &#34;azure-vote-front&#34; created
service &#34;azure-vote-front&#34; created
</code></pre><h3 id=测试应用程序>测试应用程序</h3><p>当应用程序的跑起来之后，需要创建一个 <a href=https://kubernetes.io/docs/concepts/services-networking/service/>Kubernetes 服务</a>，将应用程序前端暴露在互联网上。 此过程可能需要几分钟才能完成。</p><p>要监控这个进程，使用 <a href=https://kubernetes.io/docs/user-guide/kubectl/v1.6/#get>kubectl get service</a> 命令时加上 <code>--watch</code> 参数。</p><pre tabindex=0><code>kubectl get service azure-vote-front --watch
</code></pre><p>最初，<em>azure-vote-front</em> 服务的 EXTERNAL-IP 显示为 <em>pending</em> 。 一旦 EXTERNAL-IP 地址从 <em>pending</em> 变成一个具体的 IP 地址，请使用 “CTRL-C” 来停止 kubectl 监视进程。</p><pre tabindex=0><code>azure-vote-front   10.0.34.242   &lt;pending&gt;     80:30676/TCP   7s
azure-vote-front   10.0.34.242   52.179.23.131   80:30676/TCP   2m
</code></pre><p>现在你可以通过这个外网 IP 地址访问到 Azure Vote 这个应用了。</p><p><img src=/data/attachment/album/201708/07/212758xwuv7z8i56u5uuvv.png alt="浏览 Azure Vote 应用截图 "></p><h3 id=删除集群>删除集群</h3><p>当不再需要集群时，可以使用 <a href=https://docs.microsoft.com/en-us/cli/azure/group#delete>az group delete</a> 命令删除资源组，容器服务和所有相关资源。</p><pre tabindex=0><code>az group delete --name myResourceGroup --yes --no-wait
</code></pre><h3 id=获取示例代码>获取示例代码</h3><p>在这个快速入门教程中，预先创建的容器镜像已被用于部署 Kubernetes 。相关应用程序代码 Dockerfile 和 Kubernetes 清单文件可在 GitHub 中获得。Github 仓库地址是 <a href=https://github.com/Azure-Samples/azure-voting-app-redis.git>https://github.com/Azure-Samples/azure-voting-app-redis</a></p><h3 id=下一步>下一步</h3><p>在这个快速入门教程中，您部署了一个 Kubernetes 集群，并部署了一个多容器应用程序。</p><p>要了解有关 Azure 容器服务的更多信息，走完一个完整的从代码到部署的全流程，请继续阅读 Kubernetes 集群教程。</p><hr><p>via: <a href=https://docs.microsoft.com/en-us/azure/container-service/kubernetes/container-service-kubernetes-walkthrough>https://docs.microsoft.com/en-us/azure/container-service/kubernetes/container-service-kubernetes-walkthrough</a></p><p>作者：<a href=https://github.com/neilpeterson>neilpeterson</a>，<a href=https://github.com/mmacy>mmacy</a> 译者：<a href=https://github.com/rieonke>rieonke</a> 校对：<a href=https://github.com/wxy>wxy</a></p><p>本文由 <a href=https://github.com/LCTT/TranslateProject>LCTT</a> 原创编译，<a href=https://linux.cn/>Linux中国</a> 荣誉推出</p></div><footer class=post__footer><div class="post__tags tags clearfix"><svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5.0 11V3C0 1.5.8.8.8.8S1.5.0 3 0h8c1.5.0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 100-6 3 3 0 000 6z"/></svg><ul class=tags__list><li class=tags__item><a class="tags__link btn" href=/tags/kubernetes/ rel=tag>Kubernetes</a></li><li class=tags__item><a class="tags__link btn" href=/tags/azure/ rel=tag>Azure</a></li></ul></div></footer></article></main></div></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2025 Linux.cn Archive.
<span class=footer__copyright-credits>Generated with <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> and <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a> theme.</span></div></div></footer></div><script async defer src=/js/menu.js></script></body></html>