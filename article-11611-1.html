<!doctype html><html class=no-js lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>awk 中的字段、记录和变量 - Linux.cn Archive</title>
<script>(function(e,t){e[t]=e[t].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content><meta property="og:title" content="awk 中的字段、记录和变量"><meta property="og:description" content="这个系列的第二篇，我们会学习字段，记录和一些非常有用的 Awk 变量。"><meta property="og:type" content="article"><meta property="og:url" content="/article-11611-1.html"><meta property="article:section" content="posts"><meta property="article:published_time" content="2019-11-25T09:03:54+00:00"><meta property="article:modified_time" content="2019-11-25T09:03:54+00:00"><meta itemprop=name content="awk 中的字段、记录和变量"><meta itemprop=description content="这个系列的第二篇，我们会学习字段，记录和一些非常有用的 Awk 变量。"><meta itemprop=datePublished content="2019-11-25T09:03:54+00:00"><meta itemprop=dateModified content="2019-11-25T09:03:54+00:00"><meta itemprop=wordCount content="408"><meta itemprop=keywords content="awk,"><link rel=preconnect href=https://fonts.bunny.net crossorigin><link rel=dns-prefetch href=//fonts.bunny.net><link rel=dns-prefetch href=//fonts.bunny.net><link rel=stylesheet href="https://fonts.bunny.net/css?family=Open+Sans:400,400i,700"><link rel=stylesheet href=/css/style.css><link rel="shortcut icon" href=/favicon.ico></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class=logo><a class=logo__link href=/ title="Linux.cn Archive" rel=home><div class="logo__item logo__text"><div class=logo__title>Linux.cn Archive</div></div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>Menu</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/><span class=menu__text>Home</span></a></li><li class=menu__item><a class=menu__link href=/categories/><span class=menu__text>Categories</span></a></li><li class=menu__item><a class=menu__link href=/tags/><span class=menu__text>Tags</span></a></li><li class=menu__item><a class=menu__link href><span class=menu__text>RSS</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>awk 中的字段、记录和变量</h1><div class="post__meta meta"><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class=meta__text datetime=2019-11-25T09:03:54Z>November 25, 2019</time></div></div></header><div class="content post__content clearfix"><blockquote><p>这个系列的第二篇，我们会学习字段，记录和一些非常有用的 Awk 变量。</p></blockquote><p><img src=/data/attachment/album/201911/25/090333m34qx395vwtxx5vx.jpg alt></p><p>Awk 有好几个变种：最早的 <code>awk</code>，是 1977 年 AT&amp;T 贝尔实验室所创。它还有一些重构版本，例如 <code>mawk</code>、<code>nawk</code>。在大多数 Linux 发行版中能见到的，是 GNU awk，也叫 <code>gawk</code>。在大多数 Linux 发行版中，<code>awk</code> 和 <code>gawk</code> 都是指向 GNU awk 的软链接。输入 <code>awk</code>，调用的是同一个命令。<a href=https://www.gnu.org/software/gawk/manual/html_node/History.html#History>GNU awk 用户手册</a>中，能看到 <code>awk</code> 和 <code>gawk</code> 的全部历史。</p><p>这一系列的<a href=/article-11543-1.html>第一篇文章</a> 介绍了 <code>awk</code> 命令的基本格式：</p><pre tabindex=0><code>$ awk [选项] &#39;模式 {动作}&#39; 输入文件
</code></pre><p><code>awk</code> 是一个命令，后面要接选项 （比如用 <code>-F</code> 来定义字段分隔符）。想让 <code>awk</code> 执行的部分需要写在两个单引号之间，至少在终端中需要这么做。在 <code>awk</code> 命令中，为了进一步强调你想要执行的部分，可以用 <code>-e</code> 选项来突出显示（但这不是必须的）：</p><pre tabindex=0><code>$ awk -F, -e &#39;{print $2;}&#39; colours.txt
yellow
blue
green
[...]
</code></pre><h3 id=记录和字段>记录和字段</h3><p><code>awk</code> 将输入数据视为一系列<em>记录</em>，通常是按行分割的。换句话说，<code>awk</code> 将文本中的每一行视作一个记录。每一记录包含多个<em>字段</em>。一个字段由<em>字段分隔符</em>分隔开来，字段是记录的一部分。</p><p>默认情况下，<code>awk</code> 将各种空白符，如空格、制表符、换行符等视为分隔符。值得注意的是，在 <code>awk</code> 中，多个<em>空格</em>将被视为一个分隔符。所以下面这行文本有两个字段：</p><pre tabindex=0><code>raspberry red
</code></pre><p>这行也是：</p><pre tabindex=0><code>tuxedo                  black
</code></pre><p>其他分隔符，在程序中不是这么处理的。假设字段分隔符是逗号，如下所示的记录，就有三个字段。其中一个字段可能会是 0 个字节（假设这一字段中不包含隐藏字符）</p><pre tabindex=0><code>a,,b
</code></pre><h3 id=awk-程序>awk 程序</h3><p><code>awk</code> 命令的<em>程序部分</em>是由一系列规则组成的。通常来说，程序中每个规则占一行（尽管这不是必须的）。每个规则由一个模式，或一个或多个动作组成：</p><pre tabindex=0><code>模式 { 动作 }
</code></pre><p>在一个规则中，你可以通过定义模式，来确定动作是否会在记录中执行。模式可以是简单的比较条件、正则表达式，甚至两者结合等等。</p><p>这个例子中，程序<em>只会</em>显示包含单词 “raspberry” 的记录：</p><pre tabindex=0><code>$ awk &#39;/raspberry/ { print $0 }&#39; colours.txt
raspberry red 99
</code></pre><p>如果没有文本符合模式，该动作将会应用到所有记录上。</p><p>并且，在一条规则只包含模式时，相当于对整个记录执行 <code>{ print }</code>，全部打印出来。</p><p>Awk 程序本质上是<em>数据驱动</em>的，命令执行结果取决于数据。所以，与其他编程语言中的程序相比，它还是有些区别的。</p><h3 id=nf-变量>NF 变量</h3><p>每个字段都有指定变量，但针对字段和记录，也存在一些特殊变量。<code>NF</code> 变量，能存储 <code>awk</code> 在当前记录中找到的字段数量。其内容可在屏幕上显示，也可用于测试。下面例子中的数据，来自上篇文章<a href=/article-11543-1.html>文本</a>：</p><pre tabindex=0><code>$ awk &#39;{ print $0 &#34; (&#34; NF &#34;)&#34; }&#39; colours.txt
name       color  amount (3)
apple      red    4 (3)
banana     yellow 6 (3)
[...]
</code></pre><p><code>awk</code> 的 <code>print</code> 函数会接受一系列参数（可以是变量或者字符串），并将它们拼接起来。这就是为什么在这个例子里，每行结尾处，<code>awk</code> 会以一个被括号括起来的整数表示字段数量。</p><h3 id=nr-变量>NR 变量</h3><p>另外，除了统计每个记录中的字段数，<code>awk</code> 也统计输入记录数。记录数被存储在变量 <code>NR</code> 中，它的使用方法和其他变量没有任何区别。例如，为了在每一行开头显示行号：</p><pre tabindex=0><code>$ awk &#39;{ print NR &#34;: &#34; $0 }&#39; colours.txt
1: name       color  amount
2: apple      red    4
3: banana     yellow 6
4: raspberry  red    3
5: grape      purple 10
[...]
</code></pre><p>注意，写这个命令时可以不在 <code>print</code> 后的多个参数间添加空格，尽管这样会降低可读性：</p><pre tabindex=0><code>$ awk &#39;{print NR&#34;: &#34;$0}&#39; colours.txt
</code></pre><h3 id=printf-函数>printf() 函数</h3><p>为了让输出结果时格式更灵活，你可以使用 <code>awk</code> 的 <code>printf()</code> 函数。 它与 C、Lua、Bash 和其他语言中的 <code>printf</code> 相类似。它也接受以逗号分隔的<em>格式</em>参数。参数列表需要写在括号里。</p><pre tabindex=0><code>$ printf 格式, 项目1, 项目2, ...
</code></pre><p>格式这一参数（也叫<em>格式符</em>）定义了其他参数如何显示。这一功能是用<em>格式修饰符</em>实现的。<code>%s</code> 输出字符，<code>%d</code> 输出十进制数字。下面的 <code>printf</code> 语句，会在括号内显示字段数量：</p><pre tabindex=0><code>$ awk &#39;printf &#34;%s (%d)\n&#34;,$0,NF}&#39; colours.txt
name       color  amount (3)
raspberry  red    4 (3)
banana     yellow 6 (3)
[...]
</code></pre><p>在这个例子里，<code>%s (%d)</code> 确定了每一行的输出格式，<code>$0,NF</code> 定义了插入 <code>%s</code> 和 <code>%d</code> 位置的数据。注意，和 <code>print</code> 函数不同，在没有明确指令时，输出不会转到下一行。出现转义字符 <code>\n</code> 时才会换行。</p><h3 id=awk-脚本编程>Awk 脚本编程</h3><p>这篇文章中出现的所有 <code>awk</code> 代码，都在 Bash 终端中执行过。面对更复杂的程序，将命令放在文件（<em>脚本</em>）中会更容易。<code>-f FILE</code> 选项（不要和 <code>-F</code> 弄混了，那个选项用于字段分隔符），可用于指明包含可执行程序的文件。</p><p>举个例子，下面是一个简单的 awk 脚本。创建一个名为 <code>example1.awk</code> 的文件，包含以下内容：</p><pre tabindex=0><code>/^a/ {print &#34;A: &#34; $0}
/^b/ {print &#34;B: &#34; $0}
</code></pre><p>如果一个文件包含 <code>awk</code> 程序，那么在给文件命名时，最好写上 <code>.awk</code> 的扩展名。 这样命名不是强制的，但这么做，会给文件管理器、编辑器（和你）一个关于文件内容的很有用的提示。</p><p>执行这一脚本：</p><pre tabindex=0><code>$ awk -f example1.awk colours.txt
A: raspberry  red    4
B: banana     yellow 6
A: apple      green  8
</code></pre><p>一个包含 <code>awk</code> 命令的文件，在最开头一行加上释伴 <code>#!</code>，就能变成可执行脚本。创建一个名为 <code>example2.awk</code> 的文件，包含以下内容：</p><pre tabindex=0><code>#!/usr/bin/awk -f
#
# 除了第一行，在其他行前显示行号
#

NR &gt; 1 {
    printf &#34;%d: %s\n&#34;,NR,$0
}
</code></pre><p>可以说，脚本中只有一行，大多数情况下没什么用。但在某些情况下，执行一个脚本，比记住，然后打一条命令要容易的多。一个脚本文件，也提供了一个记录命令具体作用的好机会。以 <code>#</code> 号开头的行是注释，<code>awk</code> 会忽略它们。</p><p>给文件可执行权限：</p><pre tabindex=0><code>$ chmod u+x example2.awk
</code></pre><p>执行脚本：</p><pre tabindex=0><code>$ ./example2.awk colours.txt
2: apple      red    4
2: banana     yellow 6
4: raspberry red    3
5: grape      purple 10
[...]
</code></pre><p>将 <code>awk</code> 命令放在脚本文件中，有一个好处就是，修改和格式化输出会更容易。在终端中，如果能用一行执行多条 <code>awk</code> 命令，那么输入多行，才能达到同样效果，就显得有些多余了。</p><h3 id=试一试>试一试</h3><p>你现在已经足够了解，<code>awk</code> 是如何执行指令的了。现在你应该能编写复杂的 <code>awk</code> 程序了。试着编写一个 awk 脚本，它需要: 至少包括一个条件模式，以及多个规则。如果你想使用除 <code>print</code> 和 <code>printf</code> 以外的函数，可以参考在线 <a href=https://www.gnu.org/software/gawk/manual/>gawk 手册</a>。</p><p>下面这个例子是个很好的切入点：</p><pre tabindex=0><code>#!/usr/bin/awk -f
#
#  显示所有记录 除了出现以下情况
#  如果第一个记录 包含 “raspberry”
#  将 “red” 替换成 “pi”

$1 == &#34;raspberry&#34; {
        gsub(/red/,&#34;pi&#34;)
}

{ print }
</code></pre><p>试着执行这个脚本，看看输出是什么。接下来就看你自己的了。</p><p>这一系列的下一篇文章，将会介绍更多，能在更复杂(更有用!) 脚本中使用的函数。</p><p>这篇文章改编自 <a href="http://hackerpublicradio.org/eps.php?id=2129">Hacker Public Radio</a> 系列，一个技术社区博客。</p><hr><p>via: <a href=https://opensource.com/article/19/11/fields-records-variables-awk>https://opensource.com/article/19/11/fields-records-variables-awk</a></p><p>作者：<a href=https://opensource.com/users/seth>Seth Kenlon</a> 选题：<a href=https://github.com/lujun9972>lujun9972</a> 译者：<a href=https://github.com/wenwensnow>wenwensnow</a> 校对：<a href=https://github.com/wxy>wxy</a></p><p>本文由 <a href=https://github.com/LCTT/TranslateProject>LCTT</a> 原创编译，<a href=https://linux.cn/>Linux中国</a> 荣誉推出</p></div><footer class=post__footer><div class="post__tags tags clearfix"><svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5.0 11V3C0 1.5.8.8.8.8S1.5.0 3 0h8c1.5.0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 100-6 3 3 0 000 6z"/></svg><ul class=tags__list><li class=tags__item><a class="tags__link btn" href=/tags/awk/ rel=tag>awk</a></li></ul></div></footer></article></main></div></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2025 Linux.cn Archive.
<span class=footer__copyright-credits>Generated with <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> and <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a> theme.</span></div></div></footer></div><script async defer src=/js/menu.js></script></body></html>