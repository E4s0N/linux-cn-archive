<!doctype html><html class=no-js lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Linux 系统中 sudo 命令的 10 个技巧 - Linux.cn Archive</title>
<script>(function(e,t){e[t]=e[t].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content><meta property="og:title" content="Linux 系统中 sudo 命令的 10 个技巧"><meta property="og:description" content="sudo 表示 “superuser do”。 它允许已验证的用户以其他用户的身份来运行命令。其他用户可以是普通用户或者超级用户。然而，大部分时候我们用它来以提升的权限来运行命令。"><meta property="og:type" content="article"><meta property="og:url" content="/article-9559-1.html"><meta property="article:section" content="posts"><meta property="article:published_time" content="2018-04-19T14:34:00+00:00"><meta property="article:modified_time" content="2018-04-19T14:34:00+00:00"><meta itemprop=name content="Linux 系统中 sudo 命令的 10 个技巧"><meta itemprop=description content="sudo 表示 “superuser do”。 它允许已验证的用户以其他用户的身份来运行命令。其他用户可以是普通用户或者超级用户。然而，大部分时候我们用它来以提升的权限来运行命令。"><meta itemprop=datePublished content="2018-04-19T14:34:00+00:00"><meta itemprop=dateModified content="2018-04-19T14:34:00+00:00"><meta itemprop=wordCount content="339"><meta itemprop=keywords content="sudo,su,"><link rel=preconnect href=https://fonts.bunny.net crossorigin><link rel=dns-prefetch href=//fonts.bunny.net><link rel=dns-prefetch href=//fonts.bunny.net><link rel=stylesheet href="https://fonts.bunny.net/css?family=Open+Sans:400,400i,700"><link rel=stylesheet href=/css/style.css><link rel="shortcut icon" href=/favicon.ico></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class=logo><a class=logo__link href=/ title="Linux.cn Archive" rel=home><div class="logo__item logo__text"><div class=logo__title>Linux.cn Archive</div></div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>Menu</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/><span class=menu__text>Home</span></a></li><li class=menu__item><a class=menu__link href=/categories/><span class=menu__text>Categories</span></a></li><li class=menu__item><a class=menu__link href=/tags/><span class=menu__text>Tags</span></a></li><li class=menu__item><a class=menu__link href><span class=menu__text>RSS</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>Linux 系统中 sudo 命令的 10 个技巧</h1><div class="post__meta meta"><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class=meta__text datetime=2018-04-19T14:34:00Z>April 19, 2018</time></div></div></header><div class="content post__content clearfix"><p><img src=/data/attachment/album/201804/19/014018aaiy499x4ygca02x.jpg alt></p><h3 id=概览>概览</h3><p><code>sudo</code> 表示 “<strong>s</strong>uper<strong>u</strong>ser <strong>do</strong>”。 它允许已验证的用户以其他用户的身份来运行命令。其他用户可以是普通用户或者超级用户。然而，大部分时候我们用它来以提升的权限来运行命令。</p><p><code>sudo</code> 命令与安全策略配合使用，默认安全策略是 <code>sudoers</code>，可以通过文件 <code>/etc/sudoers</code> 来配置。其安全策略具有高度可拓展性。人们可以开发和分发他们自己的安全策略作为插件。</p><h3 id=与-su-的区别>与 su 的区别</h3><p>在 GNU/Linux 中，有两种方式可以用提升的权限来运行命令：</p><ul><li>使用 <code>su</code> 命令</li><li>使用 <code>sudo</code> 命令</li></ul><p><code>su</code> 表示 “<strong>s</strong>witch <strong>u</strong>ser”。使用 <code>su</code>，我们可以切换到 root 用户并且执行命令。但是这种方式存在一些缺点：</p><ul><li>我们需要与他人共享 root 的密码。</li><li>因为 root 用户为超级用户，我们不能授予受控的访问权限。</li><li>我们无法审查用户在做什么。</li></ul><p><code>sudo</code> 以独特的方式解决了这些问题。</p><ol><li>首先，我们不需要妥协来分享 root 用户的密码。普通用户使用他们自己的密码就可以用提升的权限来执行命令。</li><li>我们可以控制 <code>sudo</code> 用户的访问，这意味着我们可以限制用户只执行某些命令。</li><li>除此之外，<code>sudo</code> 用户的所有活动都会被记录下来，因此我们可以随时审查进行了哪些操作。在基于 Debian 的 GNU/Linux 中，所有活动都记录在 <code>/var/log/auth.log</code> 文件中。</li></ol><p>本教程后面的部分阐述了这些要点。</p><h3 id=实际动手操作-sudo>实际动手操作 sudo</h3><p>现在，我们对 sudo 有了大致的了解。让我们实际动手操作吧。为了演示，我使用 Ubuntu。但是，其它发行版本的操作应该是相同的。</p><h4 id=允许-sudo-权限>允许 sudo 权限</h4><p>让我们添加普通用户为 <code>sudo</code> 用户吧。在我的情形中，用户名为 <code>linuxtechi</code>。</p><ol><li>按如下所示编辑 <code>/etc/sudoers</code> 文件：</li></ol><pre tabindex=0><code>$ sudo visudo
</code></pre><ol start=2><li>添加以下行来允许用户 <code>linuxtechi</code> 有 sudo 权限：</li></ol><pre tabindex=0><code>linuxtechi ALL=(ALL) ALL
</code></pre><p>上述命令中：</p><ul><li><code>linuxtechi</code> 表示用户名</li><li>第一个 <code>ALL</code> 指示允许从任何终端、机器访问 <code>sudo</code></li><li>第二个 <code>(ALL)</code> 指示 <code>sudo</code> 命令被允许以任何用户身份执行</li><li>第三个 <code>ALL</code> 表示所有命令都可以作为 root 执行</li></ul><h4 id=以提升的权限执行命令>以提升的权限执行命令</h4><p>要用提升的权限执行命令，只需要在命令前加上 <code>sudo</code>，如下所示：</p><pre tabindex=0><code>$ sudo cat /etc/passwd
</code></pre><p>当你执行这个命令时，它会询问 <code>linuxtechi</code> 的密码，而不是 root 用户的密码。</p><h4 id=以其他用户执行命令>以其他用户执行命令</h4><p>除此之外，我们可以使用 <code>sudo</code> 以另一个用户身份执行命令。例如，在下面的命令中，用户 <code>linuxtechi</code> 以用户 <code>devesh</code> 的身份执行命令：</p><pre tabindex=0><code>$ sudo -u devesh whoami
[sudo] password for linuxtechi:
devesh
</code></pre><h4 id=内置命令行为>内置命令行为</h4><p><code>sudo</code> 的一个限制是 —— 它无法使用 Shell 的内置命令。例如， <code>history</code> 记录是内置命令，如果你试图用 <code>sudo</code> 执行这个命令，那么会提示如下的未找到命令的错误：</p><pre tabindex=0><code>$ sudo history
[sudo] password for linuxtechi:
sudo: history: command not found
</code></pre><p><strong>访问 root shell</strong></p><p>为了克服上述问题，我们可以访问 root shell，并在那里执行任何命令，包括 Shell 的内置命令。</p><p>要访问 root shell, 执行下面的命令:</p><pre tabindex=0><code>$ sudo bash
</code></pre><p>执行完这个命令后——您将观察到提示符变为井号（<code>#</code>）。</p><h3 id=技巧>技巧</h3><p>这节我们将讨论一些有用的技巧，这将有助于提高生产力。大多数命令可用于完成日常任务。</p><h4 id=以-sudo-用户执行之前的命令>以 sudo 用户执行之前的命令</h4><p>让我们假设你想用提升的权限执行之前的命令，那么下面的技巧将会很有用：</p><pre tabindex=0><code>$ sudo !4
</code></pre><p>上面的命令将使用提升的权限执行历史记录中的第 4 条命令。</p><h4 id=在-vim-里面使用-sudo-命令>在 Vim 里面使用 sudo 命令</h4><p>很多时候，我们编辑系统的配置文件时，在保存时才意识到我们需要 root 访问权限来执行此操作。因为这个可能让我们丢失我们对文件的改动。没有必要惊慌，我们可以在 Vim 中使用下面的命令来解决这种情况：</p><pre tabindex=0><code>:w !sudo tee %
</code></pre><p>上述命令中：</p><ul><li>冒号 (<code>:</code>) 表明我们处于 Vim 的退出模式</li><li>感叹号 (<code>!</code>) 表明我们正在运行 shell 命令</li><li><code>sudo</code> 和 <code>tee</code> 都是 shell 命令</li><li>百分号 (<code>%</code>) 表明从当前行开始的所有行</li></ul><h4 id=使用-sudo-执行多个命令>使用 sudo 执行多个命令</h4><p>至今我们用 <code>sudo</code> 只执行了单个命令，但我们可以用它执行多个命令。只需要用分号 (<code>;</code>) 隔开命令，如下所示：</p><pre tabindex=0><code>$ sudo -- bash -c &#39;pwd; hostname; whoami&#39;
</code></pre><p>上述命令中</p><ul><li>双连字符 (<code>--</code>) 停止命令行切换</li><li><code>bash</code> 表示要用于执行命令的 shell 名称</li><li><code>-c</code> 选项后面跟着要执行的命令</li></ul><h4 id=无密码运行-sudo-命令>无密码运行 sudo 命令</h4><p>当第一次执行 <code>sudo</code> 命令时，它会提示输入密码，默认情形下密码被缓存 15 分钟。但是，我们可以避免这个操作，并使用 <code>NOPASSWD</code> 关键字禁用密码认证，如下所示：</p><pre tabindex=0><code>linuxtechi ALL=(ALL) NOPASSWD: ALL
</code></pre><h4 id=限制用户执行某些命令>限制用户执行某些命令</h4><p>为了提供受控访问，我们可以限制 <code>sudo</code> 用户只执行某些命令。例如，下面的行只允许执行 <code>echo</code> 和 <code>ls</code> 命令 。</p><pre tabindex=0><code>linuxtechi ALL=(ALL) NOPASSWD: /bin/echo /bin/ls
</code></pre><h4 id=深入了解-sudo>深入了解 sudo</h4><p>让我们进一步深入了解 <code>sudo</code> 命令。</p><pre tabindex=0><code>$ ls -l /usr/bin/sudo
-rwsr-xr-x 1 root root 145040 Jun 13  2017 /usr/bin/sudo
</code></pre><p>如果仔细观察文件权限，则发现 <code>sudo</code> 上启用了 setuid 位。当任何用户运行这个二进制文件时，它将以拥有该文件的用户权限运行。在所示情形下，它是 root 用户。</p><p>为了演示这一点，我们可以使用 <code>id</code> 命令，如下所示：</p><pre tabindex=0><code>$ id
uid=1002(linuxtechi) gid=1002(linuxtechi) groups=1002(linuxtechi)
</code></pre><p>当我们不使用 <code>sudo</code> 执行 <code>id</code> 命令时，将显示用户 <code>linuxtechi</code> 的 id。</p><pre tabindex=0><code>$ sudo id
uid=0(root) gid=0(root) groups=0(root)
</code></pre><p>但是，如果我们使用 <code>sudo</code> 执行 <code>id</code> 命令时，则会显示 root 用户的 id。</p><h3 id=结论>结论</h3><p>从这篇文章可以看出 —— <code>sudo</code> 为普通用户提供了更多受控访问。使用这些技术，多用户可以用安全的方式与 GNU/Linux 进行交互。</p><hr><p>via: <a href=https://www.linuxtechi.com/quick-tips-sudo-command-linux-systems/>https://www.linuxtechi.com/quick-tips-sudo-command-linux-systems/</a></p><p>作者：<a href=https://www.linuxtechi.com/author/pradeep/>Pradeep Kumar</a> 译者：<a href=https://github.com/szcf-weiya>szcf-weiya</a> 校对：<a href=https://github.com/wxy>wxy</a></p><p>本文由 <a href=https://github.com/LCTT/TranslateProject>LCTT</a> 原创编译，<a href=https://linux.cn/>Linux中国</a> 荣誉推出</p></div><footer class=post__footer><div class="post__tags tags clearfix"><svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5.0 11V3C0 1.5.8.8.8.8S1.5.0 3 0h8c1.5.0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 100-6 3 3 0 000 6z"/></svg><ul class=tags__list><li class=tags__item><a class="tags__link btn" href=/tags/sudo/ rel=tag>sudo</a></li><li class=tags__item><a class="tags__link btn" href=/tags/su/ rel=tag>su</a></li></ul></div></footer></article></main></div></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2025 Linux.cn Archive.
<span class=footer__copyright-credits>Generated with <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> and <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a> theme.</span></div></div></footer></div><script async defer src=/js/menu.js></script></body></html>