<!doctype html><html class=no-js lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>开始 Vagrant 之旅 - Linux.cn Archive</title>
<script>(function(e,t){e[t]=e[t].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content><meta property="og:title" content="开始 Vagrant 之旅"><meta property="og:description" content="用管理虚拟机和容器的工具 Vagrant 清理你的开发环境和依赖。"><meta property="og:type" content="article"><meta property="og:url" content="/article-9671-1.html"><meta property="article:section" content="posts"><meta property="article:published_time" content="2018-05-23T11:43:34+00:00"><meta property="article:modified_time" content="2018-05-23T11:43:34+00:00"><meta itemprop=name content="开始 Vagrant 之旅"><meta itemprop=description content="用管理虚拟机和容器的工具 Vagrant 清理你的开发环境和依赖。"><meta itemprop=datePublished content="2018-05-23T11:43:34+00:00"><meta itemprop=dateModified content="2018-05-23T11:43:34+00:00"><meta itemprop=wordCount content="271"><meta itemprop=keywords content="Vagrant,"><link rel=preconnect href=https://fonts.bunny.net crossorigin><link rel=dns-prefetch href=//fonts.bunny.net><link rel=dns-prefetch href=//fonts.bunny.net><link rel=stylesheet href="https://fonts.bunny.net/css?family=Open+Sans:400,400i,700"><link rel=stylesheet href=/css/style.css><link rel="shortcut icon" href=/favicon.ico></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class=logo><a class=logo__link href=/ title="Linux.cn Archive" rel=home><div class="logo__item logo__text"><div class=logo__title>Linux.cn Archive</div></div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>Menu</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/><span class=menu__text>Home</span></a></li><li class=menu__item><a class=menu__link href=/categories/><span class=menu__text>Categories</span></a></li><li class=menu__item><a class=menu__link href=/tags/><span class=menu__text>Tags</span></a></li><li class=menu__item><a class=menu__link href><span class=menu__text>RSS</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>开始 Vagrant 之旅</h1><div class="post__meta meta"><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class=meta__text datetime=2018-05-23T11:43:34Z>May 23, 2018</time></div></div></header><div class="content post__content clearfix"><blockquote><p>用管理虚拟机和容器的工具 Vagrant 清理你的开发环境和依赖。</p></blockquote><p><img src=/data/attachment/album/201805/23/114315cw6iy7ak7yikb9w9.jpg alt></p><p>如果你和我一样，你可能在某一个地方有一个“沙盒”，你可以在那里进行你正在做的任何项目。随着时间的推移，沙盒会变得杂乱无章，充斥着各种想法、工具链元素、你不使用的代码模块，以及其他你不需要的东西。当你完成某件事情时，这会使你的部署变得复杂，因为你可能不确定项目的实际依赖关系 —— 随着时间推移你在沙盒中已经有了一些工具，但是你忘了必须安装它。你需要一个干净的环境，将所有的依赖关系放在一个地方，以便以后更方便。</p><p>或者你可能工作在 DevOps 中，你所服务的开发人员用模糊的依赖关系来编写代码，这使得测试变得更加困难。你需要一种方法来获得一个干净的盒子，将代码放入其中，并通过它运行代码，而且你希望这些环境是一次性的和可重复的。</p><p>那么选择 <a href=https://vagrantup.com>Vagrant</a> 吧。由 HashiCorp 在 <a href=https://opensource.org/licenses/MIT>MIT 许可证</a>下创建，Vagrant 可充当 VirtualBox、Microsoft Hyper-V 或 Docker 容器的包装器和前端，并且可以通过<a href=https://github.com/hashicorp/vagrant/wiki/Available-Vagrant-Plugins#providers>许多其他供应商</a>的插件进行扩展。你可以配置 Vagrant 以提供可重复的、干净的环境，并且已安装需要的基础架构。配置脚本是可移植的，因此，如果你的仓库和 Vagrant 配置脚本位于基于云存储上，那么你只需要很少的限制就可以启动并在多台机器机器上工作。让我们来看一看。</p><h3 id=安装>安装</h3><p>对于本次安装，我的环境是 Linux Mint 桌面，版本是 18.3 Cinnamon 64 位，在其他大多数 Debian 派生系统上安装非常类似。在大多数发行版中，对于基于 RPM 的系统也有类似的安装程序。Vagrant 的<a href=https://www.vagrantup.com/downloads.html>安装页面</a>为 Debian、 Windows、 CentOS、 MacOS 和 Arch Linux 都提供下载，但是我在我的软件包管理器中找到了它，所以我在那进行了安装。</p><p>最简单的安装使用了 VirtualBox 作为虚拟化提供者，所以我需要安装它：</p><pre tabindex=0><code>sudo apt-get install virtualbox vagrant
</code></pre><p>安装程序将会获取依赖项 —— 主要是 Ruby 的一些东西，安装它们。</p><h3 id=建立一个项目>建立一个项目</h3><p>在设置你的项目之前，你需要了解一些你想要运行它的环境。你可以在 <a href=https://app.vagrantup.com/boxes/search>Vagrant Boxes 仓库</a>中找到为许多虚拟化供应商提供的大量预配置的 系统 box 。许多会预先配置一些你可能需要的核心基础设置，比如 PHP、 MySQL 和 Apache，但是对于本次测试，我将安装一个 Debian 8 64 位 “Jessie” 裸机沙盒并手动安装一些东西，这样你就可以看到具体过程了。</p><pre tabindex=0><code>mkdir ~/myproject
cd ~/myproject
vagrant init debian/contrib-jessie64
vagrant up
</code></pre><p>最后一条命令将根据需要从仓库中获取或更新 VirtualBox 镜像，然后运行启动器，你的系统上会出现一个运行的系统！下次启动这个项目时，除非镜像已经在仓库中更新，否则不会花费太长时间。</p><p>要访问该沙盒，只需要输入 <code>vagrant ssh</code>，你将进入虚拟机的全功能 SSH 会话中，你将会是 <code>vagrant</code> 用户，但也是 <code>sudo</code> 组的成员，所以你可以切换到 root，并在这里做你想做的任何事情。</p><p>你会在沙盒中看到一个名为 <code>/vagrant</code> 目录，对这个目录小心点，因为它与你主机上的 <code>~/myproject</code> 文件夹保持同步。在虚拟机 <code>/vagrant</code> 下建立一个文件它会立即复制到主机上，反之亦然。注意，有些沙盒并没有安装 VirtualBox 的附加功能，所以拷贝只能在启动时才起作用。有一些用于手动同步的命令行工具，这可能是测试环境中非常有用的特性。我倾向于坚持使用那些有附加功能的沙盒，所以这个目录可以正常工作，不必考虑它。</p><p>这个方案的好处很快显现出来了： 如果你在主机上有一个代码编辑工具链，并处于某种原因不希望它出现在虚拟机上，那么这不是问题 —— 在主机上进行编辑，虚拟机会立刻更改。快速更改虚拟机，它也将其同步到主机上的“官方”副本 。</p><p>让我们关闭这个系统，这样我们就可以在这个系统里提供一些我们需要的东西：</p><pre tabindex=0><code>vagrant halt
</code></pre><h3 id=在虚拟机上安装额外的软件>在虚拟机上安装额外的软件</h3><p>对于这个例子，我将使用 <a href=https://httpd.apache.org/>Apache</a>、 <a href=https://postgresql.org>PostgreSQL</a> 和 Perl 的 <a href=https://perldancer.org>Dancer</a> web 框架进行项目开发。我将修改Vagrant 配置脚本，以便我需要的东西已经安装。 为了使之稍后更容易保持更新，我将在项目根目录下创建一个脚本<code>~/myproject/Vagrantfile</code>：</p><pre tabindex=0><code>$provision_script = &lt;&lt;SCRIPT
export DEBIAN_FRONTEND=noninteractive
apt-get update
apt-get -y install \
  apache2 \
  postgresql-client-9.4 \
  postgresql-9.4 \
  libdbd-pg-perl \
  libapache2-mod-fastcgi \
  libdata-validate-email-perl  \
  libexception-class-perl \
  libexception-class-trycatch-perl \
  libtemplate-perl \
  libtemplate-plugin-json-escape-perl \
  libdbix-class-perl \
  libyaml-tiny-perl \
  libcrypt-saltedhash-perl \
  libdancer2-perl \
  libtemplate-plugin-gravatar-perl  \
  libtext-csv-perl \
  libstring-tokenizer-perl \
  cpanminus
cpanm -f -n \
  Dancer2::Session::Cookie \
  Dancer2::Plugin::DBIC \
  Dancer2::Plugin::Auth::Extensible::Provider::DBIC \
  Dancer2::Plugin::Locale \
  Dancer2::Plugin::Growler
sudo a2enmod rewrite fastcgi
sudo apache2ctl restart
SCRIPT
</code></pre><p>在 Vagrantfile 结尾附近，你会发现一行 <code>config.vm.provision</code> 变量，正如你在示例中看到的那样，你可以在此处以内联方式进行操作，只需通过取消注释以下行：</p><pre tabindex=0><code>  # config.vm.provision &#34;shell&#34;, inline: &lt;&lt;-SHELL
  #   sudo apt-get update
  #   sudo apt-get install -y apache2
  # SHELL
</code></pre><p>相反，将那四行替换为使用你在文件顶部定义为变量的配置脚本：</p><pre tabindex=0><code>config.vm.provision &#34;shell&#34;, inline: $provision_script
</code></pre><p>你可能还希望将转发的端口设置为从主机访问虚拟机上的 Apache。寻找包含 <code>forwarded_port</code> 的行并取消注释它。如果你愿意，也可以将端口从 8080 更改为其他内容。我通常使用端口 5000，并在我的浏览器浏览 http://localhost:5000 就可以访问我虚拟机上的 Apache 服务器。</p><p>这里有一个设置提示：如果你的仓库位于云存储上，为了在多台机器上使用 Vagrant，你可能希望将不同机器上的 <code>VAGRANT_HOME</code> 环境变量设置为不同的东西。以 VirtualBox 的工作方式，你需要分别为这些系统存储状态信息，确保你的版本控制系统忽略了用于此的目录 —— 我将 <code>.vagrant.d*</code> 添加到仓库的 <code>.gitignore</code> 文件中。不过，我确实让 Vagrantfile 成为仓库的一部分！</p><h3 id=好了>好了！</h3><p>我输入 <code>vagrant up</code>，我准备开始写代码了。一旦你做了一两次，你可能会想到你可以循环利用很多的 Vagrantfile 模板文件（就像我刚刚那样），这就是 Vagrant 的优势之一。你可以更快地完成实际的编码工作，并将很少的时间花在基础设施上！</p><p>你可以使用 Vagrant 做更多事情。配置工具存在于许多工具链中，因此，无论你需要复制什么环境，它都是快速而简单的。</p><hr><p>via: <a href=https://opensource.com/article/18/4/getting-started-vagrant>https://opensource.com/article/18/4/getting-started-vagrant</a></p><p>作者：<a href=https://opensource.com/users/druthb>Ruth Holloway</a> 选题：<a href=https://github.com/lujun9972>lujun9972</a> 译者：<a href=https://github.com/MjSeven>MjSeven</a> 校对：<a href=https://github.com/wxy>wxy</a></p><p>本文由 <a href=https://github.com/LCTT/TranslateProject>LCTT</a> 原创编译，<a href=https://linux.cn/>Linux中国</a> 荣誉推出</p></div><footer class=post__footer><div class="post__tags tags clearfix"><svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5.0 11V3C0 1.5.8.8.8.8S1.5.0 3 0h8c1.5.0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 100-6 3 3 0 000 6z"/></svg><ul class=tags__list><li class=tags__item><a class="tags__link btn" href=/tags/vagrant/ rel=tag>Vagrant</a></li></ul></div></footer></article></main></div></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2025 Linux.cn Archive.
<span class=footer__copyright-credits>Generated with <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> and <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a> theme.</span></div></div></footer></div><script async defer src=/js/menu.js></script></body></html>