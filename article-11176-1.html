<!doctype html><html class=no-js lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Linux 内核的持续集成测试 - Linux.cn Archive</title>
<script>(function(e,t){e[t]=e[t].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content><meta property="og:title" content="Linux 内核的持续集成测试"><meta property="og:description" content="CKI 团队是如何防止 bug 被合并到 Linux 内核中。"><meta property="og:type" content="article"><meta property="og:url" content="/article-11176-1.html"><meta property="article:section" content="posts"><meta property="article:published_time" content="2019-08-02T11:26:28+00:00"><meta property="article:modified_time" content="2019-08-02T11:26:28+00:00"><meta itemprop=name content="Linux 内核的持续集成测试"><meta itemprop=description content="CKI 团队是如何防止 bug 被合并到 Linux 内核中。"><meta itemprop=datePublished content="2019-08-02T11:26:28+00:00"><meta itemprop=dateModified content="2019-08-02T11:26:28+00:00"><meta itemprop=wordCount content="127"><meta itemprop=keywords content="内核,CI,"><link rel=preconnect href=https://fonts.bunny.net crossorigin><link rel=dns-prefetch href=//fonts.bunny.net><link rel=dns-prefetch href=//fonts.bunny.net><link rel=stylesheet href="https://fonts.bunny.net/css?family=Open+Sans:400,400i,700"><link rel=stylesheet href=/css/style.css><link rel="shortcut icon" href=/favicon.ico></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class=logo><a class=logo__link href=/ title="Linux.cn Archive" rel=home><div class="logo__item logo__text"><div class=logo__title>Linux.cn Archive</div></div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>Menu</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/><span class=menu__text>Home</span></a></li><li class=menu__item><a class=menu__link href=/categories/><span class=menu__text>Categories</span></a></li><li class=menu__item><a class=menu__link href=/tags/><span class=menu__text>Tags</span></a></li><li class=menu__item><a class=menu__link href><span class=menu__text>RSS</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>Linux 内核的持续集成测试</h1><div class="post__meta meta"><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class=meta__text datetime=2019-08-02T11:26:28Z>August 02, 2019</time></div></div></header><div class="content post__content clearfix"><blockquote><p>CKI 团队是如何防止 bug 被合并到 Linux 内核中。</p></blockquote><p><img src=/data/attachment/album/201908/02/112520aidijdddo9wwvbiv.jpg alt></p><p>Linux 内核的每个发布版本包含了来自 1,700 个开发者产生的 14,000 个变更集，很显然，这使得 Linux 内核快速迭代的同时也产生了巨大的复杂性问题。内核上 Bug 有小麻烦也有大问题，有时是系统崩溃，有时是数据丢失。</p><p>随着越来越多的项目对于持续集成（CI）的呼声，<a href=https://cki-project.org/>内核持续集成（CKI）</a>小组秉承着一个任务目标：防止 Bug 被合并到内核当中。</p><h3 id=linux-测试问题>Linux 测试问题</h3><p>许多 Linux 发行版只在需要的时候对 Linux 内核进行测试。而这种测试往往只在版本发布时或者用户发现错误时进行。</p><p>有时候，出现玄学问题时，维护人员需要在包含了数万个补丁的变更中匆忙地寻找哪个补丁导致这个新的玄学 Bug。诊断 Bug 需要专业的硬件设备、一系列的触发器以及内核相关的专业知识。</p><h4 id=ci-和-linux>CI 和 Linux</h4><p>许多现代软件代码库都采用某种自动化 CI 测试机制，能够在提交进入代码存储库之前对其进行测试。这种自动化测试使得维护人员可以通过查看 CI 测试报告来发现软件质量问题以及大多数的错误。一些简单的项目，比如某个 Python 库，附带的大量工具使得整个检查过程更简单。</p><p>在任何测试之前都需要配置和编译 Linux。而这么做将耗费大量的时间和计算资源。此外，Linux 内核必需在虚拟机或者裸机上启动才能进行测试。而访问某些硬件架构需要额外的开销或者非常慢的仿真。因此，人们必须确定一组能够触发错误或者验证修复的测试集。</p><h4 id=cki-团队如何运作>CKI 团队如何运作？</h4><p>Red Hat 公司的 CKI 团队当前正追踪来自数个内部内核分支和上游的<a href=https://www.kernel.org/doc/html/latest/process/stable-kernel-rules.html>稳定内核分支树</a>等内核分支的更改。我们关注每个代码库的两类关键事件：</p><ol><li>当维护人员合并 PR 或者补丁时，代码库变化后的最终结果。</li><li>当开发人员通过拼凑或者稳定补丁队列发起变更合并时。</li></ol><p>当这些事件发生时，自动化工具开始执行，<a href=https://docs.gitlab.com/ee/ci/pipelines.html>GitLab CI 管道</a>开始进行测试。一旦管道开始执行 <a href=https://en.wikipedia.org/wiki/Lint_(software)>linting</a> 脚本、合并每一个补丁，并为多种硬件架构编译内核，真正的测试便开始了。我们会在六分钟内完成四种硬件架构的内核编译工作，并且通常会在两个小时或更短的时间内将反馈提交到稳定邮件列表中。（自 2019 年 1 月起）每月执行超过 100,000 次内核测试，并完成了超过 11,000 个 GitLab 管道。</p><p>每个内核都会在本地硬件架构上启动，其中包含：</p><ul><li><a href=https://en.wikipedia.org/wiki/ARM_architecture>aarch64</a>：64 位 <a href=https://www.arm.com/>ARM</a>，例如 <a href=https://www.marvell.com/server-processors/thunderx-arm-processors/>Cavium（当前是 Marvell）ThunderX</a>。</li><li><a href=https://en.wikipedia.org/wiki/Ppc64>ppc64/ppc64le</a>：大端和小端的 <a href=https://www.ibm.com/it-infrastructure/power>IBM POWER</a> 系统。</li><li><a href=https://en.wikipedia.org/wiki/Linux_on_z_Systems>s390x</a>：<a href=https://www.ibm.com/it-infrastructure/z>IBM Zseries</a> 大型机</li><li><a href=https://en.wikipedia.org/wiki/X86-64>x86_64</a>：<a href=https://www.intel.com/>Intel</a> 和 <a href=https://www.amd.com/>AMD</a> 工作站、笔记本和服务器。</li></ul><p>这些内核上运行了包括 <a href=https://github.com/linux-test-project/ltp>Linux 测试项目（LTP）</a>在内的多个测试，其中包括使用常用测试工具的大量测试。我们 CKI 团队开源了超过 44 个测试并将继续开源更多测试。</p><h3 id=参与其中>参与其中</h3><p>上游的内核测试工作日渐增多。包括 <a href=https://www.google.com/>Google</a>、Intel、<a href=https://www.linaro.org/>Linaro</a> 和 <a href=https://www.sony.com/>Sony</a> 在内的许多公司为各种内核提供了测试输出。每一项工作都专注于为上游内核以及每个公司的客户群带来价值。</p><p>如果你或者你的公司想要参与这一工作，请参加在 9 月份在葡萄牙里斯本举办的 <a href=https://www.linuxplumbersconf.org/>Linux Plumbers Conference 2019</a>。在会议结束后的两天加入我们的 Kernel CI hackfest 活动，并推动快速内核测试的发展。</p><p>更多详细信息，<a href="https://docs.google.com/presentation/d/1T0JaRA0wtDU0aTWTyASwwy_ugtzjUcw_ZDmC5KFzw-A/edit?usp=sharing">请见</a>我在 Texas Linux Fest 2019 上的演讲。</p><hr><p>via: <a href=https://opensource.com/article/19/6/continuous-kernel-integration-linux>https://opensource.com/article/19/6/continuous-kernel-integration-linux</a></p><p>作者：<a href=https://opensource.com/users/mhayden>Major Hayden</a> 选题：<a href=https://github.com/lujun9972>lujun9972</a> 译者：<a href=https://github.com/LazyWolfLin>LazyWolfLin</a> 校对：<a href=https://github.com/wxy>wxy</a></p><p>本文由 <a href=https://github.com/LCTT/TranslateProject>LCTT</a> 原创编译，<a href=https://linux.cn/>Linux中国</a> 荣誉推出</p></div><footer class=post__footer><div class="post__tags tags clearfix"><svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5.0 11V3C0 1.5.8.8.8.8S1.5.0 3 0h8c1.5.0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 100-6 3 3 0 000 6z"/></svg><ul class=tags__list><li class=tags__item><a class="tags__link btn" href=/tags/%E5%86%85%E6%A0%B8/ rel=tag>内核</a></li><li class=tags__item><a class="tags__link btn" href=/tags/ci/ rel=tag>CI</a></li></ul></div></footer></article></main></div></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2025 Linux.cn Archive.
<span class=footer__copyright-credits>Generated with <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> and <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a> theme.</span></div></div></footer></div><script async defer src=/js/menu.js></script></body></html>