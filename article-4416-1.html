<!doctype html><html class=no-js lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>如何在Linux上构建 RAID 10阵列 - Linux.cn Archive</title>
<script>(function(e,t){e[t]=e[t].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content><meta property="og:title" content="如何在Linux上构建 RAID 10阵列"><meta property="og:description" content="RAID 10阵列（又名RAID 1+0 或先镜像后分区）通过结合RAID 0 （读写操作在多个磁盘上同时并行执行）和RAID 1（数据被完全相同地写入到两个或更多的磁盘）两者的特点实现高性能和高容错性的磁盘I/O。 这篇文章会指导你如何使用五块相同的8GB磁盘来组成一个软件RAID 10阵列。因为组成一个RAID 10阵列至少需要4块磁盘（比如，两个镜像各有一对分区组合），而且需要添加一块额外的备用磁盘以防某块主要的磁盘出错。本文也会分享一些工具，在稍后用来分析RAID阵列的性能。 注意RAID 10的优缺点和其它分区方法（在不同大小的磁盘和文件系统上）"><meta property="og:type" content="article"><meta property="og:url" content="/article-4416-1.html"><meta property="article:section" content="posts"><meta property="article:published_time" content="2014-12-10T09:18:00+00:00"><meta property="article:modified_time" content="2014-12-10T09:18:00+00:00"><meta itemprop=name content="如何在Linux上构建 RAID 10阵列"><meta itemprop=description content="RAID 10阵列（又名RAID 1+0 或先镜像后分区）通过结合RAID 0 （读写操作在多个磁盘上同时并行执行）和RAID 1（数据被完全相同地写入到两个或更多的磁盘）两者的特点实现高性能和高容错性的磁盘I/O。 这篇文章会指导你如何使用五块相同的8GB磁盘来组成一个软件RAID 10阵列。因为组成一个RAID 10阵列至少需要4块磁盘（比如，两个镜像各有一对分区组合），而且需要添加一块额外的备用磁盘以防某块主要的磁盘出错。本文也会分享一些工具，在稍后用来分析RAID阵列的性能。 注意RAID 10的优缺点和其它分区方法（在不同大小的磁盘和文件系统上）"><meta itemprop=datePublished content="2014-12-10T09:18:00+00:00"><meta itemprop=dateModified content="2014-12-10T09:18:00+00:00"><meta itemprop=wordCount content="162"><meta itemprop=keywords content="RAID,RAID10,"><link rel=preconnect href=https://fonts.bunny.net crossorigin><link rel=dns-prefetch href=//fonts.bunny.net><link rel=dns-prefetch href=//fonts.bunny.net><link rel=stylesheet href="https://fonts.bunny.net/css?family=Open+Sans:400,400i,700"><link rel=stylesheet href=/css/style.css><link rel="shortcut icon" href=/favicon.ico></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class=logo><a class=logo__link href=/ title="Linux.cn Archive" rel=home><div class="logo__item logo__text"><div class=logo__title>Linux.cn Archive</div></div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>Menu</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/><span class=menu__text>Home</span></a></li><li class=menu__item><a class=menu__link href=/categories/><span class=menu__text>Categories</span></a></li><li class=menu__item><a class=menu__link href=/tags/><span class=menu__text>Tags</span></a></li><li class=menu__item><a class=menu__link href><span class=menu__text>RSS</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>如何在Linux上构建 RAID 10阵列</h1><div class="post__meta meta"><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class=meta__text datetime=2014-12-10T09:18:00Z>December 10, 2014</time></div></div></header><div class="content post__content clearfix"><p>RAID 10阵列（又名RAID 1+0 或先镜像后分区）通过结合RAID 0 （读写操作在多个磁盘上同时并行执行）和RAID 1（数据被完全相同地写入到两个或更多的磁盘）两者的特点实现高性能和高容错性的磁盘I/O。</p><p>这篇文章会指导你如何使用五块相同的8GB磁盘来组成一个软件RAID 10阵列。因为组成一个RAID 10阵列至少需要4块磁盘（比如，两个镜像各有一对分区组合），而且需要添加一块额外的备用磁盘以防某块主要的磁盘出错。本文也会分享一些工具，在稍后用来分析RAID阵列的性能。</p><p>注意RAID 10的优缺点和其它分区方法（在不同大小的磁盘和文件系统上）的内容不在本文讨论范围内。</p><p><img src=/data/attachment/album/201412/10/002555opmd7d77x3x7mdvk.png alt></p><h3 id=raid-10-阵列如何工作>Raid 10 阵列如何工作？</h3><p>如果你需要实现一种支持I/O密集操作（比如数据库、电子邮件或web服务器）的存储解决方案，RAID 10就是你需要的。来看看为什么这么说，请看下图。</p><p><img src=/data/attachment/album/201412/10/002559hh5a5fufu642xr59.png alt></p><p>上图中的文件由A、B、C、D、E和F六种块组成，每一个RAID 1镜像对（如镜像1和2）在两个磁盘上复制相同的块。在这样的配置下，写操作性能会因为每个块需要写入两次而下降，每个磁盘各一次；而读操作与从单块磁盘中读取相比并未发生改变。不过这种配置的好处是除非一个镜像中有超过一块的磁盘故障，否则都能保持冗余以维持正常的磁盘I/O操作。</p><p>RAID 0的分区通过将数据划分到不同的块，然后执行同时将块A写入镜像1、将块B写入镜像2（以此类推）的并行操作以提高整体的读写性能。在另一方面，没有任何一个镜像包含构成主存的数据片的全部信息。这就意味着如果其中一个镜像故障，那么整个RAID 0组件将无法正常工作，数据将遭受不可恢复的损失。</p><h3 id=建立raid-10阵列>建立RAID 10阵列</h3><p>有两种建立RAID 10阵列的可行方案：复杂法（一步完成）和嵌套法（先创建两个或更多的RAID 1阵列，然后使用它们组成RAID 0）。本文会讲述复杂法创建RAID 10阵列的过程，因为这种方法能够使用偶数或奇数个磁盘去创建阵列，而且能以单个RAID设备的形式被管理，而嵌套法则恰恰相反（只允许偶数个磁盘，必须以嵌套设备的形式被管理，即分开管理RAID 1和RAID 0）。</p><p>假设你的机器已经安装mdadm，并运行着相应的守护进程，细节参见<a href=http://xmodulo.com/create-software-raid1-array-mdadm-linux.html>这篇文章</a>。也假设每个磁盘上已经划分出一个主分区sd[bcdef]1 （LCTT 译注：共计五块磁盘，这里是从sdb - sdf）。使用命令：</p><pre tabindex=0><code>ls -l /dev | grep sd[bcdef]
</code></pre><p>查看到的输出应该如下所示：</p><p><img src=/data/attachment/album/201412/10/002602nf2zgee50prddzpp.jpg alt></p><p>然后使用下面的命令创建一个RAID 10阵列（LCTT 译注：使用了四块磁盘 bcde 创建）：</p><pre tabindex=0><code> # mdadm --create --verbose /dev/md0 --level=10 --raid-devices=4 /dev/sd[bcde]1 --spare-devices=1 /dev/sdf1 
</code></pre><p><img src=/data/attachment/album/201412/10/002604q22dde2222lhsoe2.jpg alt></p><p>当阵列创建完毕后（最多花费几分钟），执行命令</p><pre tabindex=0><code># mdadm --detail /dev/md0
</code></pre><p>的输出应如下所示：</p><p><img src=/data/attachment/album/201412/10/002606mqfa1cf5r5hfyy2r.png alt></p><p>在更进一步之前需要注意以下事项。</p><ol><li><strong>Used Dev Space</strong>表示阵列所使用的每一块磁盘的容量。</li><li><strong>Array Size</strong>表示阵列的整体大小。RAID 10阵列的大小通过(N*C)/M计算，其中N是活跃磁盘的数目，C是每个活跃磁盘的容量，M是每一个镜像中磁盘的数目。在本文的情形下，这个值等于（4*8GiB）/2 = 16GiB。</li><li><strong>Layout</strong>是整个数据布局的详细信息。可能的布局数值如下所示。</li></ol><hr><ul><li><strong>n</strong>(默认选项)：代表就近（near）拷贝。一个数据块的多个拷贝在不同磁盘里有相同的偏移量。这种布局提供和RAID 0阵列相似的读写性能。</li></ul><p><img src=/data/attachment/album/201412/10/002608meanweg2s0itmh20.png alt></p><ul><li><strong>o</strong>代表偏移量（offset）拷贝。块并不是在条带里面复制的，而是整个条带一起复制，但是循环会打乱，所以同一个分区中复制的块会出现在不同的磁盘。因此，一个块的后续拷贝会出现在下一个磁盘中，一个块接着一个块。为了在RAID 10阵列中使用这种布局，在创建阵列的命令中添加&ndash;layout=o2选项。</li></ul><p><img src=/data/attachment/album/201412/10/002610fd9ls0uc6w9r1s4d.png alt></p><ul><li><strong>f</strong>代表远端（far）拷贝（多个拷贝在不同的磁盘中具有不同的偏移量）。这种布局提供更好的读性能但带来更差的写性能。因此，对于读远远多于写的系统来说是最好的选择。为了在RAID 10阵列中使用这种布局，在创建阵列的命令中添加&ndash;layout=f2。</li></ul><p><img src=/data/attachment/album/201412/10/002612xpsihw4hbrh6syzb.png alt></p><p>跟在布局选项<strong>n</strong>、<strong>f</strong>和<strong>o</strong>后面的数字代表所需的每一个数据块的副本数目。默认值是2，但可以是2到阵列中磁盘数目之间的某个值。提供足够的副本数目可以最小化单个磁盘上的I/O影响。</p><ol><li><strong>Chunk Size</strong>，参考<a href=https://raid.wiki.kernel.org/>Linux RAID wiki</a>的说明，是写入磁盘的最小数据单元。最佳的chunk大小取决于I/O操作的速率和相关的文件大小。对于大量的写操作，通过设置相对较大的chunk可以得到更低的开销，但对于主要存储小文件的阵列来说更小的chunk性能更好。为了给RAID 10指定一个chunk大小，在创建阵列的命令中添加**&ndash;chunk=desired<em>chunk</em>size**。</li></ol><p>不幸的是，并没有设置一个大小就能适合全局的策略来提高性能，但可以参考下面的一些方案。</p><ul><li>文件系统：就整体而言，<a href=http://ask.xmodulo.com/create-mount-xfs-file-system-linux.html>XFS</a>据说是最好的，当然EXT4也是不错的选择。</li><li>最佳布局：远端布局能提高读性能，但会降低写性能。</li><li>副本数目：更多的副本能最小化I/O影响，但更多的磁盘需要更大的花费。</li><li>硬件：在相同的环境下，SSD比传统（机械旋转）磁盘更能带来出性能提升</li></ul><h3 id=使用dd进行raid性能测试>使用DD进行RAID性能测试</h3><p>下面的基准测试用于检测RAID 10阵列（/dev/md0）的性能。</p><h4 id=1-写操作>1. 写操作</h4><p>往磁盘中写入大小为256MB的单个文件：</p><pre tabindex=0><code># dd if=/dev/zero of=/dev/md0 bs=256M count=1 oflag=dsync 
</code></pre><p>写入1000次512字节：</p><pre tabindex=0><code># dd if=/dev/zero of=/dev/md0 bs=512 count=1000 oflag=dsync 
</code></pre><p>使用dsync标记，dd可以绕过文件系统缓存，在RAID阵列上执行同步写。这个选项用于减少RAID性能测试中缓存的影响。</p><h4 id=2-读操作>2. 读操作</h4><p>从阵列中拷贝256KiB*15000（3.9 GB）大小内容到/dev/null:</p><pre tabindex=0><code> # dd if=/dev/md0 of=/dev/null bs=256K count=15000 
</code></pre><h3 id=使用iozone进行raid性能测试>使用Iozone进行RAID性能测试</h3><p><a href=http://www.iozone.org/>Iozone</a>是一款文件系统基准测试工具，用来测试各种磁盘I/O操作，包括随机读写、顺序读写和重读重写。它支持将结果导出为微软的Excel或LibreOffice的Calc文件。</p><h4 id=在centosrhel-7上安装iozone>在CentOS/RHEL 7上安装Iozone</h4><p>先保证<a href=http://xmodulo.com/how-to-set-up-rpmforge-repoforge-repository-on-centos.html>Repoforge</a>可用，然后输入：</p><pre tabindex=0><code># yum install iozone 
</code></pre><h4 id=在debian-7上安装iozone>在Debian 7上安装Iozone</h4><pre tabindex=0><code># aptitude install iozone3 
</code></pre><p>下面的iozone命令会在RAID-10阵列中执行所有测试：</p><pre tabindex=0><code># iozone -Ra /dev/md0 -b /tmp/md0.xls 
</code></pre><ul><li><strong>-R</strong>：往标准输出生成兼容Excel的报告</li><li><strong>-a</strong>：以全自动模式运行所有的测试，并测试各种记录/文件大小。记录大小范围：4K-16M，文件大小范围：64K-512M。</li><li><strong>-b /tmp/md0.xls</strong>: 把测试结果存储到一个指定的文件中</li></ul><p>希望这篇文章对你有所帮助，如果想到任何想法或建议可能会提升RAID 10的性能，请讲出来。</p><hr><p>via: <a href=http://xmodulo.com/setup-raid10-linux.html>http://xmodulo.com/setup-raid10-linux.html</a></p><p>作者：<a href=http://xmodulo.com/author/gabriel>Gabriel Cánepa</a> 译者：<a href=https://github.com/KayGuoWhu>KayGuoWhu</a> 校对：<a href=https://github.com/wxy>wxy</a></p><p>本文由 <a href=https://github.com/LCTT/TranslateProject>LCTT</a> 原创翻译，<a href=http://linux.cn/>Linux中国</a> 荣誉推出</p></div><footer class=post__footer><div class="post__tags tags clearfix"><svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5.0 11V3C0 1.5.8.8.8.8S1.5.0 3 0h8c1.5.0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 100-6 3 3 0 000 6z"/></svg><ul class=tags__list><li class=tags__item><a class="tags__link btn" href=/tags/raid/ rel=tag>RAID</a></li><li class=tags__item><a class="tags__link btn" href=/tags/raid10/ rel=tag>RAID10</a></li></ul></div></footer></article></main></div></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2025 Linux.cn Archive.
<span class=footer__copyright-credits>Generated with <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> and <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a> theme.</span></div></div></footer></div><script async defer src=/js/menu.js></script></body></html>