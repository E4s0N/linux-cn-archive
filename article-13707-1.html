<!doctype html><html class=no-js lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>如何在免费 WiFi 中保护隐私（三） - Linux.cn Archive</title>
<script>(function(e,t){e[t]=e[t].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content><meta property="og:title" content="如何在免费 WiFi 中保护隐私（三）"><meta property="og:description" content="在你安装了 0penVPN 之后，是时候配置它了。"><meta property="og:type" content="article"><meta property="og:url" content="/article-13707-1.html"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-08-22T08:17:16+00:00"><meta property="article:modified_time" content="2021-08-22T08:17:16+00:00"><meta itemprop=name content="如何在免费 WiFi 中保护隐私（三）"><meta itemprop=description content="在你安装了 0penVPN 之后，是时候配置它了。"><meta itemprop=datePublished content="2021-08-22T08:17:16+00:00"><meta itemprop=dateModified content="2021-08-22T08:17:16+00:00"><meta itemprop=wordCount content="391"><meta itemprop=keywords content="VPN,"><link rel=preconnect href=https://fonts.bunny.net crossorigin><link rel=dns-prefetch href=//fonts.bunny.net><link rel=dns-prefetch href=//fonts.bunny.net><link rel=stylesheet href="https://fonts.bunny.net/css?family=Open+Sans:400,400i,700"><link rel=stylesheet href=/css/style.css><link rel="shortcut icon" href=/favicon.ico></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class=logo><a class=logo__link href=/ title="Linux.cn Archive" rel=home><div class="logo__item logo__text"><div class=logo__title>Linux.cn Archive</div></div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>Menu</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/><span class=menu__text>Home</span></a></li><li class=menu__item><a class=menu__link href=/categories/><span class=menu__text>Categories</span></a></li><li class=menu__item><a class=menu__link href=/tags/><span class=menu__text>Tags</span></a></li><li class=menu__item><a class=menu__link href><span class=menu__text>RSS</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>如何在免费 WiFi 中保护隐私（三）</h1><div class="post__meta meta"><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class=meta__text datetime=2021-08-22T08:17:16Z>August 22, 2021</time></div></div></header><div class="content post__content clearfix"><blockquote><p>在你安装了 0penVPN 之后，是时候配置它了。</p></blockquote><p><img src=https://img.linux.net.cn/data/attachment/album/202108/22/081708mvgwwzv8f58vgwqz.jpg alt title=Lock></p><p>0penVPN 在两点之间建立一条加密的隧道，阻止第三方访问你的网络流量。通过设置你的 “虚拟专用网络” 服务，你就成为你自己的 “虚拟专用网络” 供应商。许多流行的 “虚拟专用网络” 服务已支持 <a href=https://openvpn.net/>0penVPN</a>，所以当你可以掌控自己的网络时，为什么还要将你的网络连接绑定到特定的提供商呢？</p><p>本系列中的 <a href=/article-13680-1.html>第一篇</a> 展示了如何安装和配置一台作为你的 0penVPN 服务器的 Linux 计算机。，<a href=/article-13702-1.html>第二篇</a> 演示了如何安装和配置 0penVPN 服务器软件。这第三篇文章演示了如何在认证成功的情况下启动 0penVPN。</p><p>要设置一个 0penVPN 服务器，你必须：</p><ul><li>创建一个配置文件。</li><li>使用 <code>sysctl</code> 设置<code>net.ipv4.ip_forward = 1</code> 以启用路由。</li><li>为所有的配置和认证文件设置适当的所有权，以便使用非 root 账户运行 0penVPN 服务器守护程序。</li><li>设置 0penVPN 加载适当的配置文件启动。</li><li>配置你的防火墙。</li></ul><h3 id=配置文件>配置文件</h3><p>你必须在 <code>/etc/openvpn/server/</code> 中创建一个服务器配置文件。如果你想的话，你可以从头开始，0penVPN 包括了几个配置示例示例文件，可以以此作为开始。看看 <code>/usr/share/doc/openvpn/sample/sample-config-files/</code> 就知道了。</p><p>如果你想手工建立一个配置文件，可以从 <code>server.conf</code> 或 <code>roadwarrior-server.conf</code> 开始（视情况而定），并将你的配置文件放在 <code>/etc/openvpn/server</code> 中。这两个文件都有大量的注释，所以请阅读注释并根据你的情况作出决定。</p><p>你可以使用我预先建立的服务器和客户端配置文件模板和 <code>sysctl</code> 文件来打开网络路由，从而节省时间和麻烦。这个配置还包括自定义记录连接和断开的情况。它在 0penVPN 服务器的 <code>/etc/openvpn/server/logs</code> 中保存日志。</p><p>如果你使用我的模板，你需要使用你的 IP 地址和主机名编辑它们。</p><p>要使用我的预建配置模板、脚本和 <code>sysctl</code> 来打开 IP 转发，请下载我的脚本：</p><pre tabindex=0><code>$ curl \
  https://www.dgregscott.com/ovpn/OVPNdownloads.sh &gt; \
  OVPNdownloads.sh
</code></pre><p>阅读该脚本，了解它的工作内容。下面是它的运行概述：</p><ul><li>在你的 0penVPN 服务器上创建适当的目录</li><li>从我的网站下载服务器和客户端的配置文件模板</li><li>下载我的自定义脚本，并以正确的权限把它们放到正确的目录中</li><li>下载 <code>99-ipforward.conf</code> 并把它放到 <code>/etc/sysctl.d</code> 中，以便在下次启动时打开 IP 转发功能</li><li>为 <code>/etc/openvpn</code> 中的所有内容设置了所有权</li></ul><p>当你确定你理解了这个脚本的作用，就使它可执行并运行它：</p><pre tabindex=0><code>$ chmod +x OVPNdownloads.sh
$ sudo ./OVPNdownloads.sh
</code></pre><p>下面是它复制的文件（注意文件的所有权）：</p><pre tabindex=0><code>$ ls -al -R /etc/openvpn
/etc/openvpn:
total 12
drwxr-xr-x.  4 openvpn openvpn  34 Apr 6 20:35 .
drwxr-xr-x. 139 root  root  8192 Apr 6 20:35 ..
drwxr-xr-x.  2 openvpn openvpn  33 Apr 6 20:35 client
drwxr-xr-x.  4 openvpn openvpn  56 Apr 6 20:35 server

/etc/openvpn/client:
total 4
drwxr-xr-x. 2 openvpn openvpn  33 Apr 6 20:35 .
drwxr-xr-x. 4 openvpn openvpn  34 Apr 6 20:35 ..
-rw-r--r--. 1 openvpn openvpn 1764 Apr 6 20:35 OVPNclient2020.ovpn

/etc/openvpn/server:
total 4
drwxr-xr-x. 4 openvpn openvpn  56 Apr 6 20:35 .
drwxr-xr-x. 4 openvpn openvpn  34 Apr 6 20:35 ..
drwxr-xr-x. 2 openvpn openvpn  59 Apr 6 20:35 ccd
drwxr-xr-x. 2 openvpn openvpn  6 Apr 6 20:35 logs
-rw-r--r--. 1 openvpn openvpn 2588 Apr 6 20:35 OVPNserver2020.conf

/etc/openvpn/server/ccd:
total 8
drwxr-xr-x. 2 openvpn openvpn 59 Apr 6 20:35 .
drwxr-xr-x. 4 openvpn openvpn 56 Apr 6 20:35 ..
-rwxr-xr-x. 1 openvpn openvpn 917 Apr 6 20:35 client-connect.sh
-rwxr-xr-x. 1 openvpn openvpn 990 Apr 6 20:35 client-disconnect.sh

/etc/openvpn/server/logs:
total 0
drwxr-xr-x. 2 openvpn openvpn 6 Apr 6 20:35 .
drwxr-xr-x. 4 openvpn openvpn 56 Apr 6 20:35 ..
</code></pre><p>下面是 <code>99-ipforward.conf</code> 文件：</p><pre tabindex=0><code># Turn on IP forwarding. OpenVPN servers need to do routing
net.ipv4.ip_forward = 1
</code></pre><p>编辑 <code>OVPNserver2020.conf</code> 和 <code>OVPNclient2020.ovpn</code> 以包括你的 IP 地址。同时，编辑 <code>OVPNserver2020.conf</code> 以包括你先前的服务器证书名称。稍后，你将重新命名和编辑 <code>OVPNclient2020.ovpn</code> 的副本，以便在你的客户电脑上使用。以 <code>***?</code> 开头的块显示了你要编辑的地方。</p><h3 id=文件所有权>文件所有权</h3><p>如果你使用了我网站上的自动脚本，文件所有权就已经到位了。如果没有，你必须确保你的系统有一个叫 <code>openvpn</code> 的用户，并且是 <code>openvpn</code> 组的成员。你必须将 <code>/etc/openvpn</code> 中的所有内容的所有权设置为该用户和组。如果你不确定该用户和组是否已经存在，这样做也是安全的，因为 <code>useradd</code> 会拒绝创建一个与已经存在的用户同名的用户：</p><pre tabindex=0><code>$ sudo useradd openvpn
$ sudo chown -R openvpn.openvpn /etc/openvpn
</code></pre><h3 id=防火墙>防火墙</h3><p>如果你在步骤 1 中启用 firewalld 服务，那么你的服务器的防火墙服务可能默认不允许 “虚拟专用网络” 流量。使用 <a href=https://www.redhat.com/sysadmin/secure-linux-network-firewall-cmd>firewall-cmd 命令</a>，你可以启用 0penVPN 服务，它可以打开必要的端口并按需路由流量：</p><pre tabindex=0><code>$ sudo firewall-cmd --add-service openvpn --permanent
$ sudo firewall-cmd --reload
</code></pre><p>没有必要在 iptables 的迷宫中迷失方向!</p><h3 id=启动你的服务器>启动你的服务器</h3><p>现在你可以启动 0penVPN 服务器了。为了让它在重启后自动运行，使用 <code>systemctl</code> 的 <code>enable</code> 子命令：</p><pre tabindex=0><code>systemctl enable --now openvpn-server@OVPNserver2020.service
</code></pre><h3 id=最后的步骤>最后的步骤</h3><p>本文的第四篇也是最后一篇文章将演示如何设置客户端，以便远程连接到你的 0penVPN。</p><p><em>本文基于 D.Greg Scott 的<a href=https://www.dgregscott.com/how-to-build-a-vpn-in-four-easy-steps-without-spending-one-penny/>博客</a>，经许可后重新使用。</em></p><hr><p>via: <a href=https://opensource.com/article/21/7/openvpn-firewall>https://opensource.com/article/21/7/openvpn-firewall</a></p><p>作者：<a href=https://opensource.com/users/greg-scott>D. Greg Scott</a> 选题：<a href=https://github.com/lujun9972>lujun9972</a> 译者：<a href=https://github.com/geekpi>geekpi</a> 校对：<a href=https://github.com/turbokernel>turbokernel</a></p><p>本文由 <a href=https://github.com/LCTT/TranslateProject>LCTT</a> 原创编译，<a href=https://linux.cn/>Linux中国</a> 荣誉推出</p></div><footer class=post__footer><div class="post__tags tags clearfix"><svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5.0 11V3C0 1.5.8.8.8.8S1.5.0 3 0h8c1.5.0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 100-6 3 3 0 000 6z"/></svg><ul class=tags__list><li class=tags__item><a class="tags__link btn" href=/tags/vpn/ rel=tag>VPN</a></li></ul></div></footer></article></main></div></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2025 Linux.cn Archive.
<span class=footer__copyright-credits>Generated with <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> and <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a> theme.</span></div></div></footer></div><script async defer src=/js/menu.js></script></body></html>