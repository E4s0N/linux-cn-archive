<!doctype html><html class=no-js lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>cp 命令两个高效的用法 - Linux.cn Archive</title>
<script>(function(e,t){e[t]=e[t].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content><meta property="og:title" content="cp 命令两个高效的用法"><meta property="og:description" content="Linux 中高效的备份拷贝命令"><meta property="og:type" content="article"><meta property="og:url" content="/article-8766-1.html"><meta property="article:section" content="posts"><meta property="article:published_time" content="2017-08-10T13:45:29+00:00"><meta property="article:modified_time" content="2017-08-10T13:45:29+00:00"><meta itemprop=name content="cp 命令两个高效的用法"><meta itemprop=description content="Linux 中高效的备份拷贝命令"><meta itemprop=datePublished content="2017-08-10T13:45:29+00:00"><meta itemprop=dateModified content="2017-08-10T13:45:29+00:00"><meta itemprop=wordCount content="304"><meta itemprop=keywords content="cp,"><link rel=preconnect href=https://fonts.bunny.net crossorigin><link rel=dns-prefetch href=//fonts.bunny.net><link rel=dns-prefetch href=//fonts.bunny.net><link rel=stylesheet href="https://fonts.bunny.net/css?family=Open+Sans:400,400i,700"><link rel=stylesheet href=/css/style.css><link rel="shortcut icon" href=/favicon.ico></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class=logo><a class=logo__link href=/ title="Linux.cn Archive" rel=home><div class="logo__item logo__text"><div class=logo__title>Linux.cn Archive</div></div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>Menu</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/><span class=menu__text>Home</span></a></li><li class=menu__item><a class=menu__link href=/categories/><span class=menu__text>Categories</span></a></li><li class=menu__item><a class=menu__link href=/tags/><span class=menu__text>Tags</span></a></li><li class=menu__item><a class=menu__link href><span class=menu__text>RSS</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>cp 命令两个高效的用法</h1><div class="post__meta meta"><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class=meta__text datetime=2017-08-10T13:45:29Z>August 10, 2017</time></div></div></header><div class="content post__content clearfix"><blockquote><p>Linux 中高效的备份拷贝命令</p></blockquote><p><img src=/data/attachment/album/201708/10/134421aa0ht46dtviz6dz4.jpg alt></p><p>在 Linux 上能使用鼠标点来点去的图形化界面是一件很美妙的事……但是如果你喜欢的开发交互环境和编译器是终端窗口、Bash 和 Vim，那你应该像我一样<em>经常</em>和终端打交道。</p><p>即使是不经常使用终端的人，如果对终端环境深入了解也能获益良多。举个例子—— <code>cp</code> 命令，据 <a href=https://en.wikipedia.org/wiki/Cp_(Unix)>维基百科</a> 的解释，<code>cp</code> （意即 copy）命令是第一个版本的 <a href=https://en.wikipedia.org/wiki/Unix>Unix</a> 系统的一部分。连同一组其它的命令 <code>ls</code>、<code>mv</code>、<code>cd</code>、<code>pwd</code>、<code>mkdir</code>、<code>vi</code>、<code>sh</code>、<code>sed</code> 和 <code>awk</code> ，还有提到的 <code>cp</code> 都是我在 1984 年接触 System V Unix 系统时所学习的命令之一。<code>cp</code> 命令最常见的用法是制作文件副本。像这样：</p><pre tabindex=0><code>cp sourcefile destfile
</code></pre><p>在终端中执行此命令，上述命令将名为 <code>sourcefile</code> 的文件复制到名为 <code>destfile</code> 的文件中。如果在执行命令之前 <code>destfile</code> 文件不存在，那将会创建此文件，如果已经存在，那就会覆盖此文件。</p><p>这个命令我不知道自己用了多少次了（我也不想知道），但是我知道在我编写测试代码的时候，我经常用，为了保留当前正常的版本，而且又能继续修改，我会输入这个命令：</p><pre tabindex=0><code>cp test1.py test1.bak
</code></pre><p>在过去的30多年里，我使用了无数次这个命令。另外，当我决定编写我的第二个版本的测试程序时，我会输入这个命令：</p><pre tabindex=0><code>cp test1.py test2.py
</code></pre><p>这样就完成了修改程序的第一步。</p><p>我通常很少查看 <code>cp</code> 命令的参考文档，但是当我在备份我的图片文件夹的时候（在 GUI 环境下使用 “file” 应用），我开始思考“在 <code>cp</code> 命令中是否有个参数支持只复制新文件或者是修改过的文件。”果然，真的有！</p><h3 id=高效用法-1更新你的文件夹>高效用法 1：更新你的文件夹</h3><p>比如说在我的电脑上有一个存放各种文件的文件夹，另外我要不时的往里面添加一些新文件，而且我会不时地修改一些文件，例如我手机里下载的照片或者是音乐。</p><p>假设我收集的这些文件对我而言都很有价值，我有时候会想做个拷贝，就像是“快照”一样将文件保存在其它媒体。当然目前有很多程序都支持备份，但是我想更为精确的将目录结构复制到可移动设备中，方便于我经常使用这些离线设备或者连接到其它电脑上。</p><p><code>cp</code> 命令提供了一个易如反掌的方法。例子如下：</p><p>在我的 <code>Pictures</code> 文件夹下，我有这样一个文件夹名字为 <code>Misc</code>。为了方便说明，我把文件拷贝到 USB 存储设备上。让我们开始吧！</p><pre tabindex=0><code>me@desktop:~/Pictures$ cp -r Misc /media/clh/4388-D5FE
me@desktop:~/Pictures$
</code></pre><p>上面的命令是我从按照终端窗口中完整复制下来的。对于有些人来说不是很适应这种环境，在我们输入命令或者执行命令之前，需要注意的是 <code>me@mydesktop:~/Pictures</code> 这个前缀，<code>me</code> 这个是当前用户，<code>mydesktop</code> 这是电脑名称，<code>~/Pictures</code> 这个是当前工作目录，是 <code>/home/me/Pictures</code> 完整路径的缩写。</p><p>我输入这个命令 <code>cp -r Misc /media/clh/4388-D5FE</code> 并执行后 ，拷贝 <code>Misc</code> 目录下所有文件（这个 <code>-r</code> 参数，全称 “recursive”，递归处理，意思为本目录下所有文件及子目录一起处理）到我的 USB 设备的挂载目录 <code>/media/clh/4388-D5FE</code>。</p><p>执行命令后回到之前的提示，大多数命令继承了 Unix 的特性，在命令执行后，如果没有任何异常什么都不显示，在任务结束之前不会显示像 “execution succeeded” 这样的提示消息。如果想获取更多的反馈，就使用 <code>-v</code> 参数让执行结果更详细。</p><p>下图中是我的 USB 设备中刚刚拷贝过来的文件夹 <code>Misc</code> ，里面总共有 9 张图片。</p><p><img src=/data/attachment/album/201708/10/134531no1jwmcw8mfmw4k4.png alt="Image of the new copy of Misc on the USB drive" title="Image of the new copy of Misc on the USB drive"></p><p>假设我要在原始拷贝路径下 <code>~/Pictures/Misc</code> 下添加一些新文件，就像这样：</p><p><img src=/data/attachment/album/201708/10/134531uhe4siy48m1t4goo.png alt="New files added to the master directory" title="New files added to the master directory"></p><p>现在我想只拷贝新的文件到我的存储设备上，我就使用 <code>cp</code> 的“更新”和“详细”选项。</p><pre tabindex=0><code>me@desktop:~/Pictures$ cp -r -u -v Misc /media/clh/4388-D5FE
&#39;Misc/asunder.png&#39; -&gt; &#39;/media/clh/4388-D5FE/Misc/asunder.png&#39;
&#39;Misc/editing tags guayadeque.png&#39; -&gt; &#39;/media/clh/4388-D5FE/Misc/editing tags guayadeque.png&#39;
&#39;Misc/misc on usb.png&#39; -&gt; &#39;/media/clh/4388-D5FE/Misc/misc on usb.png&#39;
me@desktop:~/Pictures$
</code></pre><p>上面的第一行中是 <code>cp</code> 命令和具体的参数（<code>-r</code> 是“递归”， <code>-u</code> 是“更新”，<code>-v</code> 是“详细”）。接下来的三行显示被复制文件的信息，最后一行显示命令行提示符。</p><p>通常来说，参数 <code>-r</code> 也可用更详细的风格 <code>--recursive</code>。但是以简短的方式，也可以这么连用 <code>-ruv</code>。</p><h3 id=高效用法-2版本备份>高效用法 2：版本备份</h3><p>回到一开始的例子中，我在开发的时候定期给我的代码版本进行备份。然后我找到了另一种更好用的 <code>cp</code> 参数。</p><p>假设我正在编写一个非常有用的 Python 程序，作为一个喜欢不断修改代码的开发者，我会在一开始编写一个程序简单版本，然后不停的往里面添加各种功能直到它能成功的运行起来。比方说我的第一个版本就是用 Python 程序打印出 “hello world”。这只有一行代码的程序就像这样：</p><pre tabindex=0><code>print &#39;hello world&#39;
</code></pre><p>然后我将这个代码保存成文件命名为 <code>test1.py</code>。我可以这么运行它：</p><pre tabindex=0><code>me@desktop:~/Test$ python test1.py
hello world
me@desktop:~/Test$
</code></pre><p>现在程序可以运行了，我想在添加新的内容之前进行备份。我决定使用带编号的备份选项，如下：</p><pre tabindex=0><code>clh@vancouver:~/Test$ cp --force --backup=numbered test1.py test1.py
clh@vancouver:~/Test$ ls
test1.py &amp;nbsp;test1.py.~1~
clh@vancouver:~/Test$ 
</code></pre><p>所以，上面的做法是什么意思呢？</p><p>第一，这个 <code>--backup=numbered</code> 参数意思为“我要做个备份，而且是带编号的连续备份”。所以一个备份就是 1 号，第二个就是 2 号，等等。</p><p>第二，如果源文件和目标文件名字是一样的。通常我们使用 <code>cp</code> 命令去拷贝成自己，会得到这样的报错信息：</p><pre tabindex=0><code>cp: &#39;test1.py&#39; and &#39;test1.py&#39; are the same file
</code></pre><p>在特殊情况下，如果我们想备份的源文件和目标文件名字相同，我们使用 <code>--force</code> 参数。</p><p>第三，我使用 <code>ls</code> （意即 “list”）命令来显示现在目录下的文件，名字为 <code>test1.py</code> 的是原始文件，名字为 <code>test1.py.~1~</code> 的是备份文件</p><p>假如现在我要加上第二个功能，在程序里加上另一行代码，可以打印 “Kilroy was here.”。现在程序文件 <code>test1.py</code> 的内容如下：</p><pre tabindex=0><code>print &#39;hello world&#39;
print &#39;Kilroy was here&#39;
</code></pre><p>看到 Python 编程多么简单了吗？不管怎样，如果我再次执行备份的步骤，结果如下：</p><pre tabindex=0><code>clh@vancouver:~/Test$ cp --force --backup=numbered test1.py test1.py
clh@vancouver:~/Test$ ls
test1.py test1.py.~1~ test1.py.~2~
clh@vancouver:~/Test$
</code></pre><p>现在我有有两个备份文件： <code>test1.py.~1~</code> 包含了一行代码的程序，和 <code>test1.py.~2~</code> 包含两行代码的程序。</p><p>这个很好用的功能，我考虑做个 shell 函数让它变得更简单。</p><h3 id=最后总结>最后总结</h3><p>第一，Linux 手册页，它在大多数桌面和服务器发行版都默认安装了，它提供了更为详细的使用方法和例子，对于 <code>cp</code> 命令，在终端中输入如下命令：</p><pre tabindex=0><code>man cp
</code></pre><p>对于那些想学习如何使用这些命令，但不清楚如何使用的用户应该首先看一下这些说明，然后我建议创建一个测试目录和文件来尝试使用命令和选项。</p><p>第二，兴趣是最好的老师。在你最喜欢的搜索引擎中搜索 “linux shell tutorial”，你会获得很多有趣和有用的资源。</p><p>第三，你是不是在想，“为什么我要用这么麻烦的方法，图形化界面中有相同的功能，只用点击几下岂不是更简单？”，关于这个问题我有两个理由。首先，在我们工作中需要中断其他工作流程以及大量使用点击动作时，点击动作可就不简单了。其次，如果我们要完成流水线般的重复性工作，通过使用 shell 脚本和 shell 函数以及 shell 重命名等功能就能很轻松的实现。</p><p>你还知道关于 <code>cp</code> 命令其他更棒的使用方式吗？请在留言中积极回复哦～</p><p>（题图：stonemaiergames.com）</p><hr><p>作者简介：</p><p>Chris Hermansen - 1978 年毕业于英国哥伦比亚大学后一直从事计算机相关职业，我从 2005 年开始一直使用 Linux、Solaris、SunOS，在那之前我就是 Unix 系统管理员了，在技术方面，我的大量的职业生涯都是在做数据分析，尤其是空间数据分析，我有大量的编程经验与数据分析经验，熟练使用 awk、Python、PostgreSQL、PostGIS 和 Groovy。</p><hr><p>via: <a href=https://opensource.com/article/17/7/two-great-uses-cp-command>https://opensource.com/article/17/7/two-great-uses-cp-command</a></p><p>作者：<a href=https://opensource.com/users/clhermansen>Chris Hermansen</a> 译者：<a href=https://github.com/bigdimple>bigdimple</a> 校对：<a href=https://github.com/wxy>wxy</a></p><p>本文由 <a href=https://github.com/LCTT/TranslateProject>LCTT</a> 原创编译，<a href=https://linux.cn/>Linux中国</a> 荣誉推出</p></div><footer class=post__footer><div class="post__tags tags clearfix"><svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5.0 11V3C0 1.5.8.8.8.8S1.5.0 3 0h8c1.5.0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 100-6 3 3 0 000 6z"/></svg><ul class=tags__list><li class=tags__item><a class="tags__link btn" href=/tags/cp/ rel=tag>cp</a></li></ul></div></footer></article></main></div></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2025 Linux.cn Archive.
<span class=footer__copyright-credits>Generated with <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> and <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a> theme.</span></div></div></footer></div><script async defer src=/js/menu.js></script></body></html>