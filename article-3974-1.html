<!doctype html><html class=no-js lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>在Linux中扩展/缩减LVM（第二部分） - Linux.cn Archive</title>
<script>(function(e,t){e[t]=e[t].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content><meta property="og:title" content="在Linux中扩展/缩减LVM（第二部分）"><meta property="og:description" content="前面我们已经了解了怎样使用LVM创建弹性的磁盘存储。这里，我们将了解怎样来扩展卷组，扩展和缩减逻辑卷。在这里，我们可以缩减或者扩展逻辑卷管理（LVM）中的分区，LVM也可称之为弹性卷文件系统。   前置需求  使用LVM创建弹性磁盘存储第一部分  什么时候我们需要缩减卷？ 或许我们需要创建一个独立的分区用于其它用途，或者我们需要扩展任何空间低的分区。遇到这种情况时，使用 LVM我们可以很容易地缩减大尺寸的分区，以及扩展空间低的分区，只要按下面几个简易的步骤来即可。 我的服务器设置  需求  操作系统  安装有LVM的CentOS 6.5"><meta property="og:type" content="article"><meta property="og:url" content="/article-3974-1.html"><meta property="article:section" content="posts"><meta property="article:published_time" content="2014-10-09T08:26:00+00:00"><meta property="article:modified_time" content="2014-10-09T08:26:00+00:00"><meta itemprop=name content="在Linux中扩展/缩减LVM（第二部分）"><meta itemprop=description content="前面我们已经了解了怎样使用LVM创建弹性的磁盘存储。这里，我们将了解怎样来扩展卷组，扩展和缩减逻辑卷。在这里，我们可以缩减或者扩展逻辑卷管理（LVM）中的分区，LVM也可称之为弹性卷文件系统。   前置需求  使用LVM创建弹性磁盘存储第一部分  什么时候我们需要缩减卷？ 或许我们需要创建一个独立的分区用于其它用途，或者我们需要扩展任何空间低的分区。遇到这种情况时，使用 LVM我们可以很容易地缩减大尺寸的分区，以及扩展空间低的分区，只要按下面几个简易的步骤来即可。 我的服务器设置  需求  操作系统  安装有LVM的CentOS 6.5"><meta itemprop=datePublished content="2014-10-09T08:26:00+00:00"><meta itemprop=dateModified content="2014-10-09T08:26:00+00:00"><meta itemprop=wordCount content="226"><meta itemprop=keywords content="LVM,"><link rel=preconnect href=https://fonts.bunny.net crossorigin><link rel=dns-prefetch href=//fonts.bunny.net><link rel=dns-prefetch href=//fonts.bunny.net><link rel=stylesheet href="https://fonts.bunny.net/css?family=Open+Sans:400,400i,700"><link rel=stylesheet href=/css/style.css><link rel="shortcut icon" href=/favicon.ico></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class=logo><a class=logo__link href=/ title="Linux.cn Archive" rel=home><div class="logo__item logo__text"><div class=logo__title>Linux.cn Archive</div></div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>Menu</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/><span class=menu__text>Home</span></a></li><li class=menu__item><a class=menu__link href=/categories/><span class=menu__text>Categories</span></a></li><li class=menu__item><a class=menu__link href=/tags/><span class=menu__text>Tags</span></a></li><li class=menu__item><a class=menu__link href><span class=menu__text>RSS</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>在Linux中扩展/缩减LVM（第二部分）</h1><div class="post__meta meta"><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class=meta__text datetime=2014-10-09T08:26:00Z>October 09, 2014</time></div></div></header><div class="content post__content clearfix"><p>前面我们已经了解了怎样使用LVM创建弹性的磁盘存储。这里，我们将了解怎样来扩展卷组，扩展和缩减逻辑卷。在这里，我们可以缩减或者扩展逻辑卷管理（LVM）中的分区，LVM也可称之为弹性卷文件系统。</p><p><img src=/data/attachment/album/201410/08/214627it4e0ylmyw96yxl9.jpg alt></p><h3 id=前置需求>前置需求</h3><ul><li><a href=http://linux.cn/article-3965-1.html>使用LVM创建弹性磁盘存储——第一部分</a></li></ul><h4 id=什么时候我们需要缩减卷>什么时候我们需要缩减卷？</h4><p>或许我们需要创建一个独立的分区用于其它用途，或者我们需要扩展任何空间低的分区。遇到这种情况时，使用 LVM我们可以很容易地缩减大尺寸的分区，以及扩展空间低的分区，只要按下面几个简易的步骤来即可。</p><h4 id=我的服务器设置--需求>我的服务器设置 —— 需求</h4><ul><li>操作系统 – 安装有LVM的CentOS 6.5</li><li>服务器IP – 192.168.0.200</li></ul><h3 id=如何扩展卷组以及缩减逻辑卷>如何扩展卷组以及缩减逻辑卷</h3><h4 id=扩展逻辑卷>扩展逻辑卷</h4><p>目前，我们已经有一个PV，VG和2个LV。让我们用下面的命令来列出它们。</p><pre tabindex=0><code># pvs
# vgs
# lvs
</code></pre><p><img src=/data/attachment/album/201410/08/214630uhcx5uc2n9u5j7cg.jpg alt="Logical Volume Extending"></p><p><em>逻辑卷扩展</em></p><p>在物理卷和卷组中没有空闲空间可用了，所以，现在我们不能扩展逻辑卷的大小。要扩展，我们需要添加一个物理卷（<strong>PV</strong>），然后通过扩展<strong>vg</strong>来扩展卷组，这样我们就会得到足够大的空间来扩展逻辑卷大小了。所以，首先我们应该去添加一个物理卷。</p><p>要添加一个新<strong>PV</strong>，我们必须使用fdisk来创建一个LVM分区。</p><pre tabindex=0><code># fdisk -cu /dev/sda
</code></pre><ul><li>选择<strong>n</strong>来创建新分区。</li><li>选择<strong>p</strong>来创建主分区。</li><li>选择我们需要创建的分区号。</li><li>如果有其它可用磁盘，请按<strong>1</strong>。</li><li>使用<strong>t</strong>来修改分区类型。</li><li>输入<strong>8e</strong>来将分区类型修改为Linux LVM。</li><li>使用<strong>p</strong>来打印创建的分区（这里我们没有使用该选项）。</li><li>按<strong>w</strong>写入修改。</li></ul><p>完成后重启系统。</p><p><img src=/data/attachment/album/201410/08/214631kz7224t6y4tmyucz.jpg alt="Create LVM Partition"></p><p><em>创建LVM分区</em></p><p>使用fdisk列出并检查我们创建的分区。</p><pre tabindex=0><code># fdisk -l /dev/sda
</code></pre><p><img src=/data/attachment/album/201410/08/214633ykjvnxqly8n8vk35.jpg alt="Verify LVM Partition"></p><p><em>验证LVM分区</em></p><p>接下来，使用下列命令来创建新<strong>PV</strong>（物理卷）。</p><pre tabindex=0><code># pvcreate /dev/sda1
</code></pre><p>使用下面的命令来验证pv。</p><pre tabindex=0><code># pvs
</code></pre><p><img src=/data/attachment/album/201410/08/214635ss7yv5zz1zyiwil5.jpg alt="Create Physical Volume"></p><p><em>创建物理卷</em></p><h4 id=扩展卷组>扩展卷组</h4><p>添加该pv到<strong>vg_tecmint</strong>卷组来扩展卷组的大小，以获取更多空间来扩展<strong>lv</strong>。</p><pre tabindex=0><code># vgextend vg_tecmint /dev/sda1
</code></pre><p>让我们检查现在正在使用的卷组的大小。</p><pre tabindex=0><code># vgs
</code></pre><p><img src=/data/attachment/album/201410/08/214636a656wc56ytg8au6t.jpg alt="Extend Volume Group"></p><p><em>扩展卷组</em></p><p>我们甚至可以看到哪个<strong>PV</strong>用于创建使用中的特定卷组。</p><pre tabindex=0><code># pvscan
</code></pre><p><img src=/data/attachment/album/201410/08/214638cit0tdu77x9qx9rd.jpg alt="Check Volume Group"></p><p><em>检查卷组</em></p><p>这里，我们可以看到卷组所处的物理卷。我们已经添加了一个pv，而且它完全空着。在扩展逻辑卷之前，让我们先看看我们所拥有的各个卷组的大小。</p><p><img src=/data/attachment/album/201410/08/214640sg44iqgee9i439xq.jpg alt="Check All Logical Volume"></p><p><em>检查所有逻辑卷</em></p><ul><li>LogVol00用于Swap。</li><li>LogVol01用于/。</li><li>现在我们有16.50GB大小的空间用于/（root）。</li><li>当前有4226物理扩展（PE）可用。</li></ul><p>现在，我们打算去扩展/分区<strong>LogVol01</strong>。在扩展后，我们可以像上面那样列出它的大小以确认。我们能可以使用GB或PE来扩展，这一点我已经在LVM第一部分解释过了，这里我使用PE来扩展。</p><p>要获取可用的物理扩展大小，运行以下命令。</p><pre tabindex=0><code># vgdisplay
</code></pre><p><img src=/data/attachment/album/201410/08/214642t6c3oqcc63chcr6a.jpg alt="Check Available Physical Size"></p><p><em>检查可用的物理扩展</em></p><p>总共有<strong>4607</strong>空闲PE可用，亦即有<strong>18GB</strong>空间空间可用。因此，我们可以将我们的逻辑卷扩展到<strong>18GB</strong>这么大。让我们使用PE大小来扩展。</p><pre tabindex=0><code># lvextend -l +4607 /dev/vg_tecmint/LogVol01
</code></pre><p>使用**+**来添加更多空间。在扩展后，我们需要改变文件系统大小，使用以下命令。</p><pre tabindex=0><code># resize2fs /dev/vg_tecmint/LogVol01
</code></pre><p><img src=/data/attachment/album/201410/08/214644t3xbnjn3pb87j3b7.jpg alt="Expand Logical Volume"> <em>扩展逻辑卷</em></p><ul><li>用来使用物理扩展扩展逻辑卷的命令。</li><li>这里我们可以看到它从16.51GB扩展到了34GB。</li><li>如果文件系统已被挂载并处于使用中，改变文件系统大小。</li><li>要扩展逻辑卷，我们不需要卸载文件系统</li></ul><p>现在，让我们看看当前使用的改变大小后的逻辑卷。</p><pre tabindex=0><code># lvdisplay
</code></pre><p><img src=/data/attachment/album/201410/08/214646mpy1wfykpdg3133b.jpg alt="Resize Logical Volume"></p><p><em>改变逻辑卷大小</em></p><ul><li>LogVol01用于扩展的卷 /。</li><li>扩展后，从16.50GB上升到了34.50GB。</li><li>C当前扩展，在扩展前有4226，我们已经添加了4607个扩展，因此现在有8833。</li></ul><p>现在，如果我们检查可用的vg的话，空闲PE将会是0。</p><pre tabindex=0><code># vgdisplay
</code></pre><p>查看扩展的结果。</p><pre tabindex=0><code># pvs
# vgs
# lvs
</code></pre><p><img src=/data/attachment/album/201410/08/214648hkl5k0h2k0l9ks9k.jpg alt="Verify Resize Partition"></p><p><em>验证分区大小改变</em></p><ul><li>添加的新物理卷。</li><li>卷组vg_tecmint从17.51GB扩展到了35.50GB。</li><li>逻辑卷LogVol01从16.51GB扩展到了34.50GB。</li></ul><p>这里，我们已经完成扩展卷组和逻辑卷的过程。让我们一起迈向逻辑卷管理中一些有趣的部分。</p><h4 id=缩减逻辑卷lvm>缩减逻辑卷（LVM）</h4><p>这里，我们将了解如何缩减逻辑卷。人人都说它很危险，在缩减lvm的时候可能会导致灾难。缩减lvm在逻辑卷管理中比其它部分要来得确实有趣得多。</p><ul><li>在开始之前，备份好数据总是对的，这样如果出错，就不会头痛了。</li><li>要缩减逻辑卷，需要小心翼翼地完成5个步骤。</li><li>在扩展一个卷的时候，我们可以在该卷挂载时扩展它（在线），但对于缩减，我们必须在缩减前卸载文件系统。</li></ul><p>让我们来了解一下下面这5个步骤。</p><ul><li>卸载文件系统以便缩减。</li><li>在卸载后检查文件系统。</li><li>缩减文件系统。</li><li>5减少当前逻辑卷大小。</li><li>再检查文件系统以防出错。</li><li>将文件系统再次挂载回去。</li></ul><p>为了演示，我已经创建了独立的卷组和逻辑卷。这里，我将缩减逻辑卷<strong>tecmint<em>reduce</em>test</strong>。现在它有18GB大小，我们需要将它缩减到<strong>10GB</strong>而不丢失数据。也就是说，我们需要从<strong>18GB</strong>中减少<strong>8GB</strong>。卷中已经有<strong>4GB</strong>被使用。</p><pre tabindex=0><code>18GB ---&gt; 10GB
</code></pre><p>在缩减大小的时候，我们只需要缩减8GB，所以在缩减后它总计会有10GB。</p><pre tabindex=0><code># lvs
</code></pre><p><img src=/data/attachment/album/201410/08/214649u9gs0qq0dnguuu93.jpg alt="Reduce Logical Volume"></p><p><em>缩减逻辑卷</em></p><p>这里，我们可以看到文件系统信息。</p><pre tabindex=0><code># df -h
</code></pre><p><img src=/data/attachment/album/201410/08/214651hybr3x3zvbqworwr.jpg alt="Check File System Size"></p><p><em>检查文件系统大小</em></p><ul><li>卷大小是18GB。</li><li>它已经使用了3.9GB。</li><li>可用空间是13GB。</li></ul><p>首先，卸载挂载点。</p><pre tabindex=0><code># umount -v /mnt/tecmint_reduce_test/
</code></pre><p><img src=/data/attachment/album/201410/08/214652ap100j00496cugzp.jpg alt="Unmount Parition"></p><p><em>卸载分区</em></p><p>然后，使用以下命令来检查文件系统错误。</p><pre tabindex=0><code># e2fsck -ff /dev/vg_tecmint_extra/tecmint_reduce_test
</code></pre><p><img src=/data/attachment/album/201410/08/214654yly6fc6qq66lzl14.jpg alt="Scan Parition for Errors"></p><p><em>扫描分区错误</em></p><p><strong>注意</strong>：必须通过所有文件系统检查的5个步骤，若未完全通过，则你的文件系统可能存在问题。</p><p>接下来，缩减文件系统。</p><pre tabindex=0><code># resize2fs /dev/vg_tecmint_extra/tecmint_reduce_test 8GB
</code></pre><p><img src=/data/attachment/album/201410/08/214656mninglxd96nn864l.jpg alt="Reduce File System"></p><p><em>缩减文件系统</em></p><p>使用GB来缩减逻辑卷。</p><pre tabindex=0><code># lvreduce -L -8G /dev/vg_tecmint_extra/tecmint_reduce_test
</code></pre><p><img src=/data/attachment/album/201410/08/214657nhp2dkjdj8jhkdud.jpg alt="Reduce Logical Partition"></p><p><em>缩减逻辑分区</em></p><p>要使用PE来缩减逻辑卷，我们需要知道默认PE大小和卷组的总PE大小，以进行一次小小的计算来得出准确的缩减大小。</p><pre tabindex=0><code># lvdisplay vg_tecmint_extra
</code></pre><p>这里，我们需要使用bc命令来做一些小计算来获得10GB的PE大小。</p><pre tabindex=0><code>1024MB x 10GB = 10240MB or 10GB

10240MB / 4PE = 2048PE
</code></pre><p>按<strong>CTRL+D</strong>来退出BC。</p><p><img src=/data/attachment/album/201410/08/214659jftbisvbc5srrztr.jpg alt="Calculate PE Size"></p><p><em>计算PE大小</em></p><p>使用PE来缩减大小。</p><pre tabindex=0><code># lvreduce -l -2048 /dev/vg_tecmint_extra/tecmint_reduce_test
</code></pre><p><img src=/data/attachment/album/201410/08/214701dlerl805qehj2ai2.jpg alt="Reduce Size Using PE"></p><p><em>使用PE来缩减大小</em></p><p>将文件系统大小调整回去。在这一步中，如果发生任何错误，这就意味着我们已经将文件系统搞乱了。</p><pre tabindex=0><code># resize2fs /dev/vg_tecmint_extra/tecmint_reduce_test
</code></pre><p><img src=/data/attachment/album/201410/08/214702gqtzf87vr0tf3qf7.jpg alt="Resize File System"></p><p>将文件系统挂载回同样的挂载点。</p><pre tabindex=0><code># mount /dev/vg_tecmint_extra/tecmint_reduce_test /mnt/tecmint_reduce_test/
</code></pre><p><img src=/data/attachment/album/201410/08/214704wipsf3bne4ee9s63.jpg alt="Mount File System"></p><p><em>挂载文件系统</em></p><p>检查分区和文件的大小。</p><pre tabindex=0><code># lvdisplay vg_tecmint_extra
</code></pre><p>这里，我们可以看到最后的结果，逻辑已经被缩减到10GB。</p><p><img src=/data/attachment/album/201410/08/214706qwi5yptoh9b57osr.jpg alt="Verify Logical Volume Size"></p><p>在本文中，我们已经了解了如何来扩增卷组、逻辑卷以及缩减逻辑卷。在下一部分（第三部分）中，我们将了解如何为逻辑卷做快照并将它恢复到更早的状态。</p><hr><p>via: <a href=http://www.tecmint.com/extend-and-reduce-lvms-in-linux/>http://www.tecmint.com/extend-and-reduce-lvms-in-linux/</a></p><p>作者：<a href=http://www.tecmint.com/author/babinlonston/>Babin Lonston</a> 译者：<a href=https://github.com/GOLinux>GOLinux</a> 校对：<a href=https://github.com/wxy>wxy</a></p><p>本文由 <a href=https://github.com/LCTT/TranslateProject>LCTT</a> 原创翻译，<a href=http://linux.cn/>Linux中国</a> 荣誉推出</p></div><footer class=post__footer><div class="post__tags tags clearfix"><svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5.0 11V3C0 1.5.8.8.8.8S1.5.0 3 0h8c1.5.0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 100-6 3 3 0 000 6z"/></svg><ul class=tags__list><li class=tags__item><a class="tags__link btn" href=/tags/lvm/ rel=tag>LVM</a></li></ul></div></footer></article></main></div></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2025 Linux.cn Archive.
<span class=footer__copyright-credits>Generated with <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> and <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a> theme.</span></div></div></footer></div><script async defer src=/js/menu.js></script></body></html>