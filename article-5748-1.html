<!doctype html><html class=no-js lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Linux 服务器安全技巧 - Linux.cn Archive</title>
<script>(function(e,t){e[t]=e[t].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content><meta property="og:title" content="Linux 服务器安全技巧"><meta property="og:description" content="毋庸置疑，对于系统管理员，提高服务器的安全性是最重要的事情之一。因此，也就有了许多针对这个话题而生的文章、博客和论坛帖子。 一台服务器由大量功能各异的部件组成，这一点使得很难根据每个人的需求去提供定制的解决方案。这篇文章尽可能涵盖一些有所裨益的小技巧来帮助管理员保证服务器和用户安全。 有一些常识是每个系统管理员都应该烂熟于心的，所以下面的几点在本文将不会提及：  务必保证系统是最新的 经常更换密码 - 使用数字、字母和非字母的符号组合 给予用户最小的权限，满足他们日常使用所需即可 只安装那些真正需要的软件"><meta property="og:type" content="article"><meta property="og:url" content="/article-5748-1.html"><meta property="article:section" content="posts"><meta property="article:published_time" content="2015-07-03T10:04:00+00:00"><meta property="article:modified_time" content="2015-07-03T10:04:00+00:00"><meta itemprop=name content="Linux 服务器安全技巧"><meta itemprop=description content="毋庸置疑，对于系统管理员，提高服务器的安全性是最重要的事情之一。因此，也就有了许多针对这个话题而生的文章、博客和论坛帖子。 一台服务器由大量功能各异的部件组成，这一点使得很难根据每个人的需求去提供定制的解决方案。这篇文章尽可能涵盖一些有所裨益的小技巧来帮助管理员保证服务器和用户安全。 有一些常识是每个系统管理员都应该烂熟于心的，所以下面的几点在本文将不会提及：  务必保证系统是最新的 经常更换密码 - 使用数字、字母和非字母的符号组合 给予用户最小的权限，满足他们日常使用所需即可 只安装那些真正需要的软件"><meta itemprop=datePublished content="2015-07-03T10:04:00+00:00"><meta itemprop=dateModified content="2015-07-03T10:04:00+00:00"><meta itemprop=wordCount content="383"><meta itemprop=keywords content="服务器,安全,"><link rel=preconnect href=https://fonts.bunny.net crossorigin><link rel=dns-prefetch href=//fonts.bunny.net><link rel=dns-prefetch href=//fonts.bunny.net><link rel=stylesheet href="https://fonts.bunny.net/css?family=Open+Sans:400,400i,700"><link rel=stylesheet href=/css/style.css><link rel="shortcut icon" href=/favicon.ico></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class=logo><a class=logo__link href=/ title="Linux.cn Archive" rel=home><div class="logo__item logo__text"><div class=logo__title>Linux.cn Archive</div></div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>Menu</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/><span class=menu__text>Home</span></a></li><li class=menu__item><a class=menu__link href=/categories/><span class=menu__text>Categories</span></a></li><li class=menu__item><a class=menu__link href=/tags/><span class=menu__text>Tags</span></a></li><li class=menu__item><a class=menu__link href><span class=menu__text>RSS</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>Linux 服务器安全技巧</h1><div class="post__meta meta"><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class=meta__text datetime=2015-07-03T10:04:00Z>July 03, 2015</time></div></div></header><div class="content post__content clearfix"><p>毋庸置疑，对于系统管理员，提高服务器的安全性是最重要的事情之一。因此，也就有了许多针对这个话题而生的文章、博客和论坛帖子。</p><p>一台服务器由大量功能各异的部件组成，这一点使得很难根据每个人的需求去提供定制的解决方案。这篇文章尽可能涵盖一些有所裨益的小技巧来帮助管理员保证服务器和用户安全。</p><p>有一些常识是每个系统管理员都应该烂熟于心的，所以下面的几点在本文将不会提及：</p><ul><li>务必保证系统是<strong>最新的</strong></li><li>经常更换密码 - 使用数字、字母和非字母的符号组合</li><li>给予用户<strong>最小</strong>的权限，满足他们日常使用所需即可</li><li>只安装那些真正需要的软件包</li></ul><p><img src=/data/attachment/album/201507/03/100435cuo93k1715ekhvxo.jpg alt></p><p>下面是一些更有意思的内容：</p><h3 id=更改ssh默认端口>更改SSH默认端口</h3><p>在搭建好一台全新的服务器后要做的第一件事情就是更改SSH的默认端口。这个小小的改动能够使你的服务器避免受到成千上万的暴力攻击（LCTT 译注：不更改默认端口相当于黑客们知道你家的门牌号，这样他们只需要一把一把的试钥匙就可能打开你家的锁）。</p><p>要更改默认的SSH端口，先打开sshd_config文件：</p><pre tabindex=0><code>sudo vim /etc/ssh/sshd_config
</code></pre><p>找到下面这行：</p><pre tabindex=0><code>#Port 22
</code></pre><p>“#”号表示这行是注释。首先删除#号，然后把端口号改成目的端口。端口号不能超过65535，确保要指定的端口号没有被系统或其它服务占用。建议在[维基百科]上查看常用端口号列表。在本文中，使用这个端口号：</p><pre tabindex=0><code>Port 16543
</code></pre><p>然后保存并关闭文件。</p><p>接下来的一步是：</p><h3 id=使用ssh密钥认证>使用SSH密钥认证</h3><p>在通过SSH访问服务器时，使用SSH密钥进行认证是尤其重要的。这样做为服务器增加了额外的保护，确保只有那些拥有密钥的人才能访问服务器。</p><p>在本地机器上运行下面命令以生成SSH密钥：</p><pre tabindex=0><code>ssh-keygen -t rsa
</code></pre><p>你会看到下面的输出，询问要将密钥写到哪一个文件里，并且设置一个密码：</p><pre tabindex=0><code>Generating public/private rsa key pair.
Enter file in which to save the key (/root/.ssh/id_rsa): my_key
Enter passphrase (empty for no passphrase): 
Enter same passphrase again: 
Your identification has been saved in my_key.
Your public key has been saved in my_key.pub.
The key fingerprint is:
SHA256:MqD/pzzTRsCjZb6mpfjyrr5v1pJLBcgprR5tjNoI20A
</code></pre><p>完成之后，就得到两个文件：</p><p>my_key</p><p>my_key.pub</p><p>接下来把my_key.pub拷贝到~/.ssh/authorized_key中</p><pre tabindex=0><code>cp my_key.pub ~/.ssh/authorized_keys
</code></pre><p>然后使用下面命令将密钥上传到服务器：</p><pre tabindex=0><code>scp -P16543 authorized_keys user@yourserver-ip:/home/user/.ssh/
</code></pre><p>至此，你就可以从这台本地机器上无密码地访问服务器了。</p><h3 id=关闭ssh的密码认证>关闭SSH的密码认证</h3><p>既然已经有了SSH密钥，那么关闭SSH的密码认证就会更安全了。再次打开并编辑sshd_config，按如下设置：</p><pre tabindex=0><code>ChallengeResponseAuthentication no
PasswordAuthentication no
UsePAM no
</code></pre><h3 id=关闭root登录>关闭Root登录</h3><p>下面关键的一步是关闭root用户的直接访问，而使用sudo或su来执行管理员任务。首先需要添加一个有root权限的新用户，所以编辑这个路径下的sudoers文件：</p><pre tabindex=0><code>/etc/sudoers/
</code></pre><p>推荐使用如<strong>visudo</strong>这样的命令编辑该文件，因为它会在关闭文件之前检查任何可能出现的语法错误。当你在编辑文件时出错了，这就很有用了。</p><p>接下来赋予某个用户root权限。在本文中，使用用户<strong>sysadmin</strong>。确保在编辑后这个文件时使用的用户是系统已有的用户。找到下面这行：</p><pre tabindex=0><code>root ALL=(ALL) ALL
</code></pre><p>拷贝这行，然后粘贴在下一行，然后把root更改为“sysadmin”，如下所示：</p><pre tabindex=0><code>root ALL=(ALL) ALL
sysadmin ALL=(ALL) ALL
</code></pre><p>现在解释一下这行的每一个选项的含义：</p><pre tabindex=0><code>(1) root  (2)ALL=(3)(ALL) (4)ALL
</code></pre><p>(1) 指定用户</p><p>(2) 指定用户使用sudo的终端</p><p>(3) 指定用户可以担任的用户角色</p><p>(4) 这个用户可以使用的命令</p><p>（LCTT 译注：所以上面的配置是意思是：root 用户可以在任何终端担任任何用户，执行任何命令。）</p><p>使用这个配置可以给用户访问一些系统工具的权限。</p><p>这时，可以放心保存文件了。</p><p>为了关闭通过SSH直接访问root，需要再次打开<strong>sshd_config</strong>，找到下面这行：</p><pre tabindex=0><code>#PermitRootLogin yes
</code></pre><p>更改为：</p><pre tabindex=0><code>PermitRootLogin no
</code></pre><p>然后保存文件，重启sshd守护进程使改动生效。执行下面命令即可：</p><pre tabindex=0><code>sudo /etc/init.d/sshd restart
</code></pre><h3 id=设置防火墙>设置防火墙</h3><p>防火墙有助于过滤出入端口和阻止使用暴力法的登录尝试。我倾向于使用SCF(Config Server Firewall)这个强力防火墙。它使用了iptables，易于管理，而且对于不擅于输入命令的用户提供了web界面。</p><p>要安装CSF，先登录到服务器，切换到这个目录下：</p><pre tabindex=0><code>cd /usr/local/src/
</code></pre><p>然后以root权限执行下面命令：</p><pre tabindex=0><code>wget https://download.configserver.com/csf.tgz
tar -xzf csf.tgz
cd csf
sh install.sh
</code></pre><p>只需等待安装程序完成，然后编辑CSF的配置文件：</p><pre tabindex=0><code>/etc/csf/csf.conf
</code></pre><p>默认情况下CSF是以测试模式运行。通过将“TESTING”的值设置成0，切换到product模式。</p><pre tabindex=0><code>TESTING = &#34;0&#34;
</code></pre><p>下面要设置的就是服务器上允许通过的端口。在csf.conf中定位到下面的部分，根据需要修改端口：</p><pre tabindex=0><code># 允许入站的 TCP 端口
TCP_IN = &#34;20,21,25,53,80,110,143,443,465,587,993,995,16543&#34;
# 允许出站的 TCP 端口
TCP_OUT = &#34;20,21,22,25,53,80,110,113,443,587,993,995,16543&#34;
# 允许入站的 UDP 端口
UDP_IN = &#34;20,21,53&#34;
# 允许出站的 UDP 端口
# 要允许发出 traceroute 请求，请加 33434:33523 端口范围到该列表 
UDP_OUT = &#34;20,21,53,113,123&#34;
</code></pre><p>请根据需要逐一设置，推荐只使用那些需要的端口，避免设置对端口进行大范围设置。此外，也要避免使用不安全服务的不安全端口。比如只允许端口465和587来发送电子邮件，取代默认的SMTP端口25。（LCTT 译注：前提是你的邮件服务器支持 SMTPS）</p><p><strong>重要</strong>：千万不要忘记允许自定义的 ssh 端口。</p><p>允许你的IP地址通过防火墙，而绝不被屏蔽，这一点很重要。IP地址定义在下面的文件中：</p><pre tabindex=0><code>/etc/csf/csf.ignore
</code></pre><p>被屏蔽了的IP地址会出现在这个文件中：</p><pre tabindex=0><code>/etc/csf/csf.deny
</code></pre><p>一旦完成更改，使用这个命令重启csf：</p><pre tabindex=0><code>sudo /etc/init.d/csf restart
</code></pre><p>下面是在某台服务器上的csf.deny文件的部分内容，来说明CSF是很有用的：</p><pre tabindex=0><code>211.216.48.205 # lfd: (sshd) Failed SSH login from 211.216.48.205 (KR/Korea, Republic of/-): 5 in the last 3600 secs - Fri Mar 6 00:30:35 2015
103.41.124.53 # lfd: (sshd) Failed SSH login from 103.41.124.53 (HK/Hong Kong/-): 5 in the last 3600 secs - Fri Mar 6 01:06:46 2015
103.41.124.42 # lfd: (sshd) Failed SSH login from 103.41.124.42 (HK/Hong Kong/-): 5 in the last 3600 secs - Fri Mar 6 01:59:04 2015
103.41.124.26 # lfd: (sshd) Failed SSH login from 103.41.124.26 (HK/Hong Kong/-): 5 in the last 3600 secs - Fri Mar 6 02:48:26 2015
109.169.74.58 # lfd: (sshd) Failed SSH login from 109.169.74.58 (GB/United Kingdom/mail2.algeos.com): 5 in the last 3600 secs - Fri Mar 6 03:49:03 2015
</code></pre><p>可以看到，尝试通过暴力法登录的IP地址都被屏蔽了，真是眼不见心不烦啊！</p><h3 id=锁住账户>锁住账户</h3><p>如果某个账户在很长一段时间内都不会被使用了，那么可以将其锁住以防止其它人访问。使用如下命令：</p><pre tabindex=0><code>passwd -l accountName
</code></pre><p>当然，这个账户依然可以被root用户使用（LCTT 译注：可用 su 切换为该账号）。</p><h3 id=了解服务器上的服务>了解服务器上的服务</h3><p>服务器的本质是为各种服务提供访问功能。使服务器只运行所需的服务，关闭没有使用的服务。这样做不仅会释放一些系统资源，而且也会使服务器变得更加安全。比如，如果只是运行一个简单的服务器，显然不需要X显示或者桌面环境。如果不需要Windows网络共享功能，则可以放心关闭Samba。</p><p>使用下面的命令能查看伴随系统启动而启动的服务：</p><pre tabindex=0><code>chkconfig --list | grep &#34;3:on&#34;
</code></pre><p>如果系统运行了<strong>systemd</strong>，执行这条命令：</p><pre tabindex=0><code>systemctl list-unit-files --type=service | grep enabled
</code></pre><p>然后使用下面的命令关闭服务：</p><pre tabindex=0><code>chkconfig service off
或
systemctl disable service
</code></pre><p>在上面的例子中，把“service”替换成真正想要停止的服务名称。实例如下：</p><pre tabindex=0><code>chkconfig httpd off
或
systemctl disable httpd
</code></pre><h3 id=小结>小结</h3><p>这篇文章的目的是涵盖一些通用的安全步骤以便帮助你保护服务器。你可以采取更多方式去增强对服务器的保护。请记住保证服务器安全是你的责任，在维护服务器安全时尽量做出明智的选择，尽管并没有什么容易的方式去完成这件事情，而建立“完善的”安全需要花费大量的时间和测试直到达到想要的结果。</p><hr><p>via: <a href=http://www.linuxveda.com/2015/06/03/secure-linux-server/>http://www.linuxveda.com/2015/06/03/secure-linux-server/</a></p><p>作者：<a href=http://www.linuxveda.com/author/marin_todorov/>Marin Todorow</a> 译者：<a href=https://github.com/KayGuoWhu>KayGuoWhu</a> 校对：<a href=https://github.com/wxy>wxy</a></p><p>本文由 <a href=https://github.com/LCTT/TranslateProject>LCTT</a> 原创翻译，<a href=https://linux.cn/>Linux中国</a> 荣誉推出</p></div><footer class=post__footer><div class="post__tags tags clearfix"><svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5.0 11V3C0 1.5.8.8.8.8S1.5.0 3 0h8c1.5.0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 100-6 3 3 0 000 6z"/></svg><ul class=tags__list><li class=tags__item><a class="tags__link btn" href=/tags/%E6%9C%8D%E5%8A%A1%E5%99%A8/ rel=tag>服务器</a></li><li class=tags__item><a class="tags__link btn" href=/tags/%E5%AE%89%E5%85%A8/ rel=tag>安全</a></li></ul></div></footer></article></main></div></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2025 Linux.cn Archive.
<span class=footer__copyright-credits>Generated with <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> and <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a> theme.</span></div></div></footer></div><script async defer src=/js/menu.js></script></body></html>