<!doctype html><html class=no-js lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>如何修补和保护 Linux 内核堆栈冲突漏洞 CVE-2017-1000364 - Linux.cn Archive</title>
<script>(function(e,t){e[t]=e[t].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content><meta property="og:title" content="如何修补和保护 Linux 内核堆栈冲突漏洞 CVE-2017-1000364"><meta property="og:description" content="Qualys 研究实验室在 GNU C Library（CVE-2017-1000366）的动态链接器中发现了许多问题，它们通过与 Linux 内核内的堆栈冲突来允许本地特权升级。"><meta property="og:type" content="article"><meta property="og:url" content="/article-8687-1.html"><meta property="article:section" content="posts"><meta property="article:published_time" content="2017-07-12T07:34:00+00:00"><meta property="article:modified_time" content="2017-07-12T07:34:00+00:00"><meta itemprop=name content="如何修补和保护 Linux 内核堆栈冲突漏洞 CVE-2017-1000364"><meta itemprop=description content="Qualys 研究实验室在 GNU C Library（CVE-2017-1000366）的动态链接器中发现了许多问题，它们通过与 Linux 内核内的堆栈冲突来允许本地特权升级。"><meta itemprop=datePublished content="2017-07-12T07:34:00+00:00"><meta itemprop=dateModified content="2017-07-12T07:34:00+00:00"><meta itemprop=wordCount content="850"><meta itemprop=keywords content="安全漏洞,内核,堆栈,"><link rel=preconnect href=https://fonts.bunny.net crossorigin><link rel=dns-prefetch href=//fonts.bunny.net><link rel=dns-prefetch href=//fonts.bunny.net><link rel=stylesheet href="https://fonts.bunny.net/css?family=Open+Sans:400,400i,700"><link rel=stylesheet href=/css/style.css><link rel="shortcut icon" href=/favicon.ico></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class=logo><a class=logo__link href=/ title="Linux.cn Archive" rel=home><div class="logo__item logo__text"><div class=logo__title>Linux.cn Archive</div></div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>Menu</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/><span class=menu__text>Home</span></a></li><li class=menu__item><a class=menu__link href=/categories/><span class=menu__text>Categories</span></a></li><li class=menu__item><a class=menu__link href=/tags/><span class=menu__text>Tags</span></a></li><li class=menu__item><a class=menu__link href><span class=menu__text>RSS</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>如何修补和保护 Linux 内核堆栈冲突漏洞 CVE-2017-1000364</h1><div class="post__meta meta"><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class=meta__text datetime=2017-07-12T07:34:00Z>July 12, 2017</time></div></div></header><div class="content post__content clearfix"><p>在 Linux 内核中发现了一个名为 “Stack Clash” 的严重安全问题，攻击者能够利用它来破坏内存数据并执行任意代码。攻击者可以利用这个及另一个漏洞来执行任意代码并获得管理帐户（root）权限。</p><p>在 Linux 中该如何解决这个问题？</p><p><a href=https://www.cyberciti.biz/media/new/faq/2017/06/the-stack-clash-on-linux-openbsd-netbsd-freebsd-solaris.jpeg><img src=https://img.linux.net.cn/data/attachment/album/201707/11/223737o82bv8oxiew7i8ox.jpg alt=the-stack-clash-on-linux-openbsd-netbsd-freebsd-solaris></a></p><p>Qualys 研究实验室在 GNU C Library（CVE-2017-1000366）的动态链接器中发现了许多问题，它们通过与 Linux 内核内的堆栈冲突来允许本地特权升级。这个 bug 影响到了 i386 和 amd64 上的 Linux、OpenBSD、NetBSD、FreeBSD 和 Solaris。攻击者可以利用它来破坏内存数据并执行任意代码。</p><h3 id=什么是-cve-2017-1000364-bug>什么是 CVE-2017-1000364 bug？</h3><p><a href=https://access.redhat.com/security/cve/cve-2017-1000364>来自 RHN</a>：</p><blockquote><p>在用户空间二进制文件的堆栈中分配内存的方式发现了一个缺陷。如果堆（或不同的内存区域）和堆栈内存区域彼此相邻，则攻击者可以使用此缺陷跳过堆栈保护区域，从而导致进程堆栈或相邻内存区域的受控内存损坏，从而增加其系统权限。有一个在内核中减轻这个漏洞的方法，将堆栈保护区域大小从一页增加到 1 MiB，从而使成功利用这个功能变得困难。</p></blockquote><p><a href=https://blog.qualys.com/securitylabs/2017/06/19/the-stack-clash>据原研究文章</a>：</p><blockquote><p>计算机上运行的每个程序都使用一个称为堆栈的特殊内存区域。这个内存区域是特别的，因为当程序需要更多的堆栈内存时，它会自动增长。但是，如果它增长太多，并且与另一个内存区域太接近，程序可能会将堆栈与其他内存区域混淆。攻击者可以利用这种混乱来覆盖其他内存区域的堆栈，或者反过来。</p></blockquote><h3 id=受到影响的-linux-发行版>受到影响的 Linux 发行版</h3><ol><li>Red Hat Enterprise Linux Server 5.x</li><li>Red Hat Enterprise Linux Server 6.x</li><li>Red Hat Enterprise Linux Server 7.x</li><li>CentOS Linux Server 5.x</li><li>CentOS Linux Server 6.x</li><li>CentOS Linux Server 7.x</li><li>Oracle Enterprise Linux Server 5.x</li><li>Oracle Enterprise Linux Server 6.x</li><li>Oracle Enterprise Linux Server 7.x</li><li>Ubuntu 17.10</li><li>Ubuntu 17.04</li><li>Ubuntu 16.10</li><li>Ubuntu 16.04 LTS</li><li>Ubuntu 12.04 ESM (Precise Pangolin)</li><li>Debian 9 stretch</li><li>Debian 8 jessie</li><li>Debian 7 wheezy</li><li>Debian unstable</li><li>SUSE Linux Enterprise Desktop 12 SP2</li><li>SUSE Linux Enterprise High Availability 12 SP2</li><li>SUSE Linux Enterprise Live Patching 12</li><li>SUSE Linux Enterprise Module for Public Cloud 12</li><li>SUSE Linux Enterprise Build System Kit 12 SP2</li><li>SUSE Openstack Cloud Magnum Orchestration 7</li><li>SUSE Linux Enterprise Server 11 SP3-LTSS</li><li>SUSE Linux Enterprise Server 11 SP4</li><li>SUSE Linux Enterprise Server 12 SP1-LTSS</li><li>SUSE Linux Enterprise Server 12 SP2</li><li>SUSE Linux Enterprise Server for Raspberry Pi 12 SP2</li></ol><h3 id=我需要重启我的电脑么>我需要重启我的电脑么？</h3><p>是的，由于大多数服务依赖于 GNU C Library 的动态连接器，并且内核自身需要在内存中重新加载。</p><h3 id=我该如何在-linux-中修复-cve-2017-1000364>我该如何在 Linux 中修复 CVE-2017-1000364？</h3><p>根据你的 Linux 发行版来输入命令。你需要重启电脑。在应用补丁之前，记下你当前内核的版本：</p><pre tabindex=0><code>$ uname -a
$ uname -mrs
</code></pre><p>示例输出：</p><pre tabindex=0><code>Linux 4.4.0-78-generic x86_64
</code></pre><h3 id=debian-或者-ubuntu-linux>Debian 或者 Ubuntu Linux</h3><p>输入下面的 <a href=https://www.cyberciti.biz/faq/ubuntu-lts-debian-linux-apt-command-examples/>apt 命令</a> / <a href=https://www.cyberciti.biz/tips/linux-debian-package-management-cheat-sheet.html>apt-get 命令</a>来应用更新：</p><pre tabindex=0><code>$ sudo apt-get update &amp;&amp; sudo apt-get upgrade &amp;&amp; sudo apt-get dist-upgrade
</code></pre><p>示例输出：</p><pre tabindex=0><code>Reading package lists... Done
Building dependency tree       
Reading state information... Done
Calculating upgrade... Done
The following packages will be upgraded:
  libc-bin libc-dev-bin libc-l10n libc6 libc6-dev libc6-i386 linux-compiler-gcc-6-x86 linux-headers-4.9.0-3-amd64 linux-headers-4.9.0-3-common linux-image-4.9.0-3-amd64
  linux-kbuild-4.9 linux-libc-dev locales multiarch-support
14 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
Need to get 0 B/62.0 MB of archives.
After this operation, 4,096 B of additional disk space will be used.
Do you want to continue? [Y/n] y
Reading changelogs... Done
Preconfiguring packages ...
(Reading database ... 115123 files and directories currently installed.)
Preparing to unpack .../libc6-i386_2.24-11+deb9u1_amd64.deb ...
Unpacking libc6-i386 (2.24-11+deb9u1) over (2.24-11) ...
Preparing to unpack .../libc6-dev_2.24-11+deb9u1_amd64.deb ...
Unpacking libc6-dev:amd64 (2.24-11+deb9u1) over (2.24-11) ...
Preparing to unpack .../libc-dev-bin_2.24-11+deb9u1_amd64.deb ...
Unpacking libc-dev-bin (2.24-11+deb9u1) over (2.24-11) ...
Preparing to unpack .../linux-libc-dev_4.9.30-2+deb9u1_amd64.deb ...
Unpacking linux-libc-dev:amd64 (4.9.30-2+deb9u1) over (4.9.30-2) ...
Preparing to unpack .../libc6_2.24-11+deb9u1_amd64.deb ...
Unpacking libc6:amd64 (2.24-11+deb9u1) over (2.24-11) ...
Setting up libc6:amd64 (2.24-11+deb9u1) ...
(Reading database ... 115123 files and directories currently installed.)
Preparing to unpack .../libc-bin_2.24-11+deb9u1_amd64.deb ...
Unpacking libc-bin (2.24-11+deb9u1) over (2.24-11) ...
Setting up libc-bin (2.24-11+deb9u1) ...
(Reading database ... 115123 files and directories currently installed.)
Preparing to unpack .../multiarch-support_2.24-11+deb9u1_amd64.deb ...
Unpacking multiarch-support (2.24-11+deb9u1) over (2.24-11) ...
Setting up multiarch-support (2.24-11+deb9u1) ...
(Reading database ... 115123 files and directories currently installed.)
Preparing to unpack .../0-libc-l10n_2.24-11+deb9u1_all.deb ...
Unpacking libc-l10n (2.24-11+deb9u1) over (2.24-11) ...
Preparing to unpack .../1-locales_2.24-11+deb9u1_all.deb ...
Unpacking locales (2.24-11+deb9u1) over (2.24-11) ...
Preparing to unpack .../2-linux-compiler-gcc-6-x86_4.9.30-2+deb9u1_amd64.deb ...
Unpacking linux-compiler-gcc-6-x86 (4.9.30-2+deb9u1) over (4.9.30-2) ...
Preparing to unpack .../3-linux-headers-4.9.0-3-amd64_4.9.30-2+deb9u1_amd64.deb ...
Unpacking linux-headers-4.9.0-3-amd64 (4.9.30-2+deb9u1) over (4.9.30-2) ...
Preparing to unpack .../4-linux-headers-4.9.0-3-common_4.9.30-2+deb9u1_all.deb ...
Unpacking linux-headers-4.9.0-3-common (4.9.30-2+deb9u1) over (4.9.30-2) ...
Preparing to unpack .../5-linux-kbuild-4.9_4.9.30-2+deb9u1_amd64.deb ...
Unpacking linux-kbuild-4.9 (4.9.30-2+deb9u1) over (4.9.30-2) ...
Preparing to unpack .../6-linux-image-4.9.0-3-amd64_4.9.30-2+deb9u1_amd64.deb ...
Unpacking linux-image-4.9.0-3-amd64 (4.9.30-2+deb9u1) over (4.9.30-2) ...
Setting up linux-libc-dev:amd64 (4.9.30-2+deb9u1) ...
Setting up linux-headers-4.9.0-3-common (4.9.30-2+deb9u1) ...
Setting up libc6-i386 (2.24-11+deb9u1) ...
Setting up linux-compiler-gcc-6-x86 (4.9.30-2+deb9u1) ...
Setting up linux-kbuild-4.9 (4.9.30-2+deb9u1) ...
Setting up libc-l10n (2.24-11+deb9u1) ...
Processing triggers for man-db (2.7.6.1-2) ...
Setting up libc-dev-bin (2.24-11+deb9u1) ...
Setting up linux-image-4.9.0-3-amd64 (4.9.30-2+deb9u1) ...
/etc/kernel/postinst.d/initramfs-tools:
update-initramfs: Generating /boot/initrd.img-4.9.0-3-amd64
cryptsetup: WARNING: failed to detect canonical device of /dev/md0
cryptsetup: WARNING: could not determine root device from /etc/fstab
W: initramfs-tools configuration sets RESUME=UUID=054b217a-306b-4c18-b0bf-0ed85af6c6e1
W: but no matching swap device is available.
I: The initramfs will attempt to resume from /dev/md1p1
I: (UUID=bf72f3d4-3be4-4f68-8aae-4edfe5431670)
I: Set the RESUME variable to override this.
/etc/kernel/postinst.d/zz-update-grub:
Searching for GRUB installation directory ... found: /boot/grub
Searching for default file ... found: /boot/grub/default
Testing for an existing GRUB menu.lst file ... found: /boot/grub/menu.lst
Searching for splash image ... none found, skipping ...
Found kernel: /boot/vmlinuz-4.9.0-3-amd64
Found kernel: /boot/vmlinuz-3.16.0-4-amd64
Updating /boot/grub/menu.lst ... done

Setting up libc6-dev:amd64 (2.24-11+deb9u1) ...
Setting up locales (2.24-11+deb9u1) ...
Generating locales (this might take a while)...
  en_IN.UTF-8... done
Generation complete.
Setting up linux-headers-4.9.0-3-amd64 (4.9.30-2+deb9u1) ...
Processing triggers for libc-bin (2.24-11+deb9u1) ...
</code></pre><p>使用 <a href=https://www.cyberciti.biz/faq/linux-reboot-command/>reboot 命令</a>重启桌面/服务器：</p><pre tabindex=0><code>$ sudo reboot
</code></pre><h3 id=oraclerhelcentosscientific-linux>Oracle/RHEL/CentOS/Scientific Linux</h3><p>输入下面的 <a href=https://www.cyberciti.biz/faq/rhel-centos-fedora-linux-yum-command-howto/>yum 命令</a>：</p><pre tabindex=0><code>$ sudo yum update
$ sudo reboot
</code></pre><h3 id=fedora-linux>Fedora Linux</h3><p>输入下面的 dnf 命令：</p><pre tabindex=0><code>$ sudo dnf update
$ sudo reboot
</code></pre><h3 id=suse-enterprise-linux-或者-opensuse-linux>Suse Enterprise Linux 或者 Opensuse Linux</h3><p>输入下面的 zypper 命令：</p><pre tabindex=0><code>$ sudo zypper patch
$ sudo reboot
</code></pre><h3 id=suse-openstack-cloud-6>SUSE OpenStack Cloud 6</h3><pre tabindex=0><code>$ sudo zypper in -t patch SUSE-OpenStack-Cloud-6-2017-996=1
$ sudo reboot
</code></pre><h3 id=suse-linux-enterprise-server-for-sap-12-sp1>SUSE Linux Enterprise Server for SAP 12-SP1</h3><pre tabindex=0><code>$ sudo zypper in -t patch SUSE-SLE-SAP-12-SP1-2017-996=1
$ sudo reboot
</code></pre><h3 id=suse-linux-enterprise-server-12-sp1-ltss>SUSE Linux Enterprise Server 12-SP1-LTSS</h3><pre tabindex=0><code>$ sudo zypper in -t patch SUSE-SLE-SERVER-12-SP1-2017-996=1
$ sudo reboot
</code></pre><h3 id=suse-linux-enterprise-module-for-public-cloud-12>SUSE Linux Enterprise Module for Public Cloud 12</h3><pre tabindex=0><code>$ sudo zypper in -t patch SUSE-SLE-Module-Public-Cloud-12-2017-996=1
$ sudo reboot
</code></pre><h3 id=验证>验证</h3><p>你需要确认你的版本号在 <a href=https://www.cyberciti.biz/faq/linux-reboot-command/>reboot 命令</a>之后改变了。</p><pre tabindex=0><code>$ uname -a
$ uname -r
$ uname -mrs
</code></pre><p>示例输出：</p><pre tabindex=0><code>Linux 4.4.0-81-generic x86_64
</code></pre><h3 id=给-openbsd-用户的注意事项>给 OpenBSD 用户的注意事项</h3><p>见<a href=https://ftp.openbsd.org/pub/OpenBSD/patches/6.1/common/008_exec_subr.patch.sig>此页</a>获取更多信息。</p><h3 id=给-oracle-solaris-的注意事项>给 Oracle Solaris 的注意事项</h3><p><a href=https://ftp.openbsd.org/pub/OpenBSD/patches/6.1/common/008_exec_subr.patch.sig>见此页</a>获取更多信息。</p><h3 id=参考>参考</h3><ul><li><a href=https://blog.qualys.com/securitylabs/2017/06/19/the-stack-clash>堆栈冲突</a></li></ul><hr><p>作者简介:</p><p>Vivek Gite</p><p>作者是 nixCraft 的创始人，对于 Linux 操作系统/Unix shell脚本有经验丰富的系统管理员和培训师。他曾与全球客户及各行各业，包括 IT、教育、国防和空间研究以及非营利部门合作。在 <a href=https://twitter.com/nixcraft>Twitter</a>、<a href=https://facebook.com/nixcraft>Facebook</a>、<a href=https://plus.google.com/+CybercitiBiz>Google +</a> 上关注他。</p><hr><p>via: <a href=https://www.cyberciti.biz/faq/howto-patch-linux-kernel-stack-clash-vulnerability-cve-2017-1000364/>https://www.cyberciti.biz/faq/howto-patch-linux-kernel-stack-clash-vulnerability-cve-2017-1000364/</a></p><p>作者：<a href=https://plus.google.com/+CybercitiBiz>Vivek Gite</a> 译者：<a href=https://github.com/geekpi>geekpi</a> 校对：<a href=https://github.com/wxy>wxy</a></p><p>本文由 <a href=https://github.com/LCTT/TranslateProject>LCTT</a> 原创编译，<a href=https://linux.cn/>Linux中国</a> 荣誉推出</p></div><footer class=post__footer><div class="post__tags tags clearfix"><svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5.0 11V3C0 1.5.8.8.8.8S1.5.0 3 0h8c1.5.0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 100-6 3 3 0 000 6z"/></svg><ul class=tags__list><li class=tags__item><a class="tags__link btn" href=/tags/%E5%AE%89%E5%85%A8%E6%BC%8F%E6%B4%9E/ rel=tag>安全漏洞</a></li><li class=tags__item><a class="tags__link btn" href=/tags/%E5%86%85%E6%A0%B8/ rel=tag>内核</a></li><li class=tags__item><a class="tags__link btn" href=/tags/%E5%A0%86%E6%A0%88/ rel=tag>堆栈</a></li></ul></div></footer></article></main></div></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2025 Linux.cn Archive.
<span class=footer__copyright-credits>Generated with <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> and <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a> theme.</span></div></div></footer></div><script async defer src=/js/menu.js></script></body></html>