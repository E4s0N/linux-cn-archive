<!doctype html><html class=no-js lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Ansible 自动化工具安装、配置和快速入门指南 - Linux.cn Archive</title>
<script>(function(e,t){e[t]=e[t].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content><meta property="og:title" content="Ansible 自动化工具安装、配置和快速入门指南"><meta property="og:description" content="Ansible 是一个开源、易于使用的功能强大的 IT 自动化工具，通过 SSH 在客户端节点上执行任务。"><meta property="og:type" content="article"><meta property="og:url" content="/article-13142-1.html"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-02-22T12:48:20+00:00"><meta property="article:modified_time" content="2021-02-22T12:48:20+00:00"><meta itemprop=name content="Ansible 自动化工具安装、配置和快速入门指南"><meta itemprop=description content="Ansible 是一个开源、易于使用的功能强大的 IT 自动化工具，通过 SSH 在客户端节点上执行任务。"><meta itemprop=datePublished content="2021-02-22T12:48:20+00:00"><meta itemprop=dateModified content="2021-02-22T12:48:20+00:00"><meta itemprop=wordCount content="735"><meta itemprop=keywords content="Ansible,"><link rel=preconnect href=https://fonts.bunny.net crossorigin><link rel=dns-prefetch href=//fonts.bunny.net><link rel=dns-prefetch href=//fonts.bunny.net><link rel=stylesheet href="https://fonts.bunny.net/css?family=Open+Sans:400,400i,700"><link rel=stylesheet href=/css/style.css><link rel="shortcut icon" href=/favicon.ico></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class=logo><a class=logo__link href=/ title="Linux.cn Archive" rel=home><div class="logo__item logo__text"><div class=logo__title>Linux.cn Archive</div></div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>Menu</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/><span class=menu__text>Home</span></a></li><li class=menu__item><a class=menu__link href=/categories/><span class=menu__text>Categories</span></a></li><li class=menu__item><a class=menu__link href=/tags/><span class=menu__text>Tags</span></a></li><li class=menu__item><a class=menu__link href><span class=menu__text>RSS</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>Ansible 自动化工具安装、配置和快速入门指南</h1><div class="post__meta meta"><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class=meta__text datetime=2021-02-22T12:48:20Z>February 22, 2021</time></div></div></header><div class="content post__content clearfix"><p><img src=https://img.linux.net.cn/data/attachment/album/202102/22/124803cgryrgxqezjllfqg.jpg alt></p><p>市面上有很多自动化工具。我可以举几个例子，例如 Puppet、Chef、CFEngine、Foreman、Katello、Saltstock、Space Walk，它们被许多组织广泛使用。</p><h3 id=自动化工具可以做什么>自动化工具可以做什么？</h3><p>自动化工具可以自动执行例行任务，无需人工干预，从而使 Linux 管理员的工作变得更加轻松。这些工具允许用户执行配置管理，应用程序部署和资源调配。</p><h3 id=为什么喜欢-ansible>为什么喜欢 Ansible？</h3><p>Ansible 是一种无代理的自动化工具，使用 SSH 执行所有任务，但其它工具需要在客户端节点上安装代理。</p><h3 id=什么是-ansible>什么是 Ansible？</h3><p>Ansible 是一个开源、易于使用的功能强大的 IT 自动化工具，通过 SSH 在客户端节点上执行任务。</p><p>它是用 Python 构建的，这是当今世界上最流行、最强大的编程语言之一。两端都需要使用 Python 才能执行所有模块。</p><p>它可以配置系统、部署软件和安排高级 IT 任务，例如连续部署或零停机滚动更新。你可以通过 Ansible 轻松执行任何类型的自动化任务，包括简单和复杂的任务。</p><p>在开始之前，你需要了解一些 Ansible 术语，这些术语可以帮助你更好的创建任务。</p><h3 id=ansible-如何工作>Ansible 如何工作？</h3><p>Ansible 通过在客户端节点上推送称为 ansible 模块的小程序来工作，这些模块临时存储在客户端节点中，通过 JSON 协议与 Ansible 服务器进行通信。</p><p>Ansible 通过 SSH 运行这些模块，并在完成后将其删除。</p><p>模块是用 Python 或 Perl 等编写的一些脚本。</p><p><img src=https://img.linux.net.cn/data/attachment/album/202102/22/124822meej9lngyylly290.png alt></p><p><em>控制节点，用于控制剧本的全部功能，包括客户端节点（主机）。</em></p><ul><li>控制节点 Control node ：使用 Ansible 在受控节点上执行任务的主机。你可以有多个控制节点，但不能使用 Windows 系统主机当作控制节点。</li><li>受控节点 Managed node ：控制节点配置的主机列表。</li><li>清单 Inventory ：控制节点管理的一个主机列表，这些节点在 <code>/etc/ansible/hosts</code> 文件中配置。它包含每个节点的信息，比如 IP 地址或其主机名，还可以根据需要对这些节点进行分组。</li><li>模块 Module ：每个模块用于执行特定任务，目前有 3387 个模块。</li><li>点对点 ad-hoc ：它允许你一次性运行一个任务，它使用 <code>/usr/bin/ansible</code> 二进制文件。</li><li>任务 Task ：每个 动作 Play 都有一个任务列表。任务按顺序执行，在受控节点中一次执行一个任务。</li><li>剧本 Playbook ：你可以使用剧本同时执行多个任务，而使用点对点只能执行一个任务。剧本使用 YAML 编写，易于阅读。将来，我们将会写一篇有关剧本的文章，你可以用它来执行复杂的任务。</li></ul><h3 id=测试环境>测试环境</h3><p>此环境包含一个控制节点（<code>server.2g.lab</code>）和三个受控节点（<code>node1.2g.lab</code>、<code>node2.2g.lab</code>、<code>node3.2g.lab</code>），它们均在虚拟环境中运行，操作系统分别为：</p><table><thead><tr><th>System Purpose</th><th>Hostname</th><th>IP Address</th><th>OS</th></tr></thead><tbody><tr><td>Ansible Control Node</td><td>server.2g.lab</td><td>192.168.1.7</td><td>Manjaro 18</td></tr><tr><td>Managed Node1</td><td>node1.2g.lab</td><td>192.168.1.6</td><td>CentOS7</td></tr><tr><td>Managed Node2</td><td>node2.2g.lab</td><td>192.168.1.5</td><td>CentOS8</td></tr><tr><td>Managed Node3</td><td>node3.2g.lab</td><td>192.168.1.9</td><td>Ubuntu 18.04</td></tr><tr><td>User: daygeek</td><td></td><td></td><td></td></tr></tbody></table><h3 id=前置条件>前置条件</h3><ul><li>在 Ansible 控制节点和受控节点之间启用无密码身份验证。</li><li>控制节点必须是 Python 2（2.7 版本） 或 Python 3（3.5 或更高版本）。</li><li>受控节点必须是 Python 2（2.6 或更高版本） 或 Python 3（3.5 或更高版本）。</li><li>如果在远程节点上启用了 SELinux，则在 Ansible 中使用任何与复制、文件、模板相关的功能之前，还需要在它们上安装 <code>libselinux-python</code>。</li></ul><h3 id=如何在控制节点上安装-ansible>如何在控制节点上安装 Ansible</h3><p>对于 Fedora/RHEL 8/CentOS 8 系统，使用 <a href=https://www.2daygeek.com/linux-dnf-command-examples-manage-packages-fedora-centos-rhel-systems/>DNF 命令</a> 来安装 Ansible。</p><p>注意：你需要在 RHEL/CentOS 系统上启用 <a href=https://www.2daygeek.com/install-enable-epel-repository-on-rhel-centos-oracle-linux/>EPEL 仓库</a>，因为 Ansible 软件包在发行版官方仓库中不可用。</p><pre tabindex=0><code>$ sudo dnf install ansible
</code></pre><p>对于 Debian/Ubuntu 系统，使用 <a href=https://www.2daygeek.com/apt-get-apt-cache-command-examples-manage-packages-debian-ubuntu-systems/>APT-GET 命令</a> 或 <a href=https://www.2daygeek.com/apt-command-examples-manage-packages-debian-ubuntu-systems/>APT 命令</a> 来安装 Ansible。</p><p>配置下面的 PPA 以便在 Ubuntu 上安装最新稳定版本的 Ansible。</p><pre tabindex=0><code>$ sudo apt update
$ sudo apt install software-properties-common
$ sudo apt-add-repository --yes --update ppa:ansible/ansible
$ sudo apt install ansible
</code></pre><p>对于 Debian 系统，配置以下源列表：</p><pre tabindex=0><code>$ echo &#34;deb http://ppa.launchpad.net/ansible/ansible/ubuntu trusty main&#34; | sudo tee -a /etc/apt/sources.list.d/ansible.list
$ sudo apt-key adv --keyserver keyserver.ubuntu.com --recv-keys 93C4A3FD7BB9C367
$ sudo apt update
$ sudo apt install ansible
</code></pre><p>对于 Arch Linux 系统，使用 <a href=https://www.2daygeek.com/pacman-command-examples-manage-packages-arch-linux-system/>Pacman 命令</a> 来安装 Ansible：</p><pre tabindex=0><code>$ sudo pacman -S ansible
</code></pre><p>对于 RHEL/CentOS 系统，使用 <a href=https://www.2daygeek.com/yum-command-examples-manage-packages-rhel-centos-systems/>YUM 命令</a> 来安装 Ansible：</p><pre tabindex=0><code>$ sudo yum install ansible
</code></pre><p>对于 openSUSE 系统，使用 <a href=https://www.2daygeek.com/zypper-command-examples-manage-packages-opensuse-system/>Zypper 命令</a> 来安装 Ansible：</p><pre tabindex=0><code>$ sudo zypper install ansible
</code></pre><p>或者，你可以使用 <a href=https://www.2daygeek.com/install-pip-manage-python-packages-linux/>Python PIP 包管理工具</a> 来安装：</p><pre tabindex=0><code>$ curl https://bootstrap.pypa.io/get-pip.py -o get-pip.py
$ sudo python get-pip.py
$ sudo pip install ansible
</code></pre><p>在控制节点上检查安装的 Ansible 版本：</p><pre tabindex=0><code>$ ansible --version

ansible 2.9.2
  config file = /etc/ansible/ansible.cfg
  configured module search path = [&#39;/home/daygeek/.ansible/plugins/modules&#39;, &#39;/usr/share/ansible/plugins/modules&#39;]
  ansible python module location = /usr/lib/python3.8/site-packages/ansible
  executable location = /usr/bin/ansible
  python version = 3.8.1 (default, Jan  8 2020, 23:09:20) [GCC 9.2.0]
</code></pre><h3 id=如何在受控节点上安装-python>如何在受控节点上安装 Python？</h3><p>使用以下命令在受控节点上安装 python：</p><pre tabindex=0><code>$ sudo yum install -y python
$ sudo dnf install -y python
$ sudo zypper install -y python
$ sudo pacman -S python
$ sudo apt install -y python
</code></pre><h3 id=如何在-linux-设置-ssh-密钥身份验证无密码身份验证>如何在 Linux 设置 SSH 密钥身份验证（无密码身份验证）</h3><p>使用以下命令创建 ssh 密钥，然后将其复制到远程计算机。</p><pre tabindex=0><code>$ ssh-keygen
$ ssh-copy-id daygeek@node1.2g.lab
$ ssh-copy-id daygeek@node2.2g.lab
$ ssh-copy-id daygeek@node3.2g.lab
</code></pre><p>具体参考这篇文章《<a href=https://www.2daygeek.com/configure-setup-passwordless-ssh-key-based-authentication-linux/>在 Linux 上设置 SSH 密钥身份验证（无密码身份验证）</a>》。</p><h3 id=如何创建-ansible-主机清单>如何创建 Ansible 主机清单</h3><p>在 <code>/etc/ansible/hosts</code> 文件中添加要管理的节点列表。如果没有该文件，则可以创建一个新文件。以下是我的测试环境的主机清单文件：</p><pre tabindex=0><code>$ sudo vi /etc/ansible/hosts

[web]
node1.2g.lab
node2.2g.lab

[app]
node3.2g.lab
</code></pre><p>让我们看看是否可以使用以下命令查找所有主机。</p><pre tabindex=0><code>$ ansible all --list-hosts

 hosts (3):
   node1.2g.lab
   node2.2g.lab
   node3.2g.lab
</code></pre><p>对单个组运行以下命令：</p><pre tabindex=0><code>$ ansible web --list-hosts

 hosts (2):
   node1.2g.lab
   node2.2g.lab
</code></pre><h3 id=如何使用点对点命令执行任务>如何使用点对点命令执行任务</h3><p>一旦完成主机清单验证检查后，你就可以上路了。干的漂亮！</p><p><strong>语法：</strong></p><pre tabindex=0><code>ansible [pattern] -m [module] -a &#34;[module options]&#34;

Details:
========
ansible: A command
pattern: Enter the entire inventory or a specific group
-m [module]: Run the given module name
-a [module options]: Specify the module arguments
</code></pre><p>使用 Ping 模块对主机清单中的所有节点执行 ping 操作：</p><pre tabindex=0><code>$ ansible all -m ping

node3.2g.lab | SUCCESS =&gt; {
    &#34;ansible_facts&#34;: {
        &#34;discovered_interpreter_python&#34;: &#34;/usr/bin/python&#34;
    },
    &#34;changed&#34;: false,
    &#34;ping&#34;: &#34;pong&#34;
}
node1.2g.lab | SUCCESS =&gt; {
    &#34;ansible_facts&#34;: {
        &#34;discovered_interpreter_python&#34;: &#34;/usr/bin/python&#34;
    },
    &#34;changed&#34;: false,
    &#34;ping&#34;: &#34;pong&#34;
}
node2.2g.lab | SUCCESS =&gt; {
    &#34;ansible_facts&#34;: {
        &#34;discovered_interpreter_python&#34;: &#34;/usr/libexec/platform-python&#34;
    },
    &#34;changed&#34;: false,
    &#34;ping&#34;: &#34;pong&#34;
}
</code></pre><p>所有系统都返回了成功，但什么都没有改变，只返回了 <code>pong</code> 代表成功。</p><p>你可以使用以下命令获取可用模块的列表。</p><pre tabindex=0><code>$ ansible-doc -l
</code></pre><p>当前有 3387 个内置模块，它们会随着 Ansible 版本的递增而增加：</p><pre tabindex=0><code>$ ansible-doc -l | wc -l
3387
</code></pre><p>使用 command 模块对主机清单中的所有节点执行命令：</p><pre tabindex=0><code>$ ansible all -m command -a &#34;uptime&#34;

node3.2g.lab | CHANGED | rc=0 &gt;&gt;
 18:05:07 up  1:21,  3 users,  load average: 0.12, 0.06, 0.01
node1.2g.lab | CHANGED | rc=0 &gt;&gt;
 06:35:06 up  1:21,  4 users,  load average: 0.01, 0.03, 0.05
node2.2g.lab | CHANGED | rc=0 &gt;&gt;
 18:05:07 up  1:25,  3 users,  load average: 0.01, 0.01, 0.00
</code></pre><p>对指定组执行 command 模块。</p><p>检查 app 组主机的内存使用情况：</p><pre tabindex=0><code>$ ansible app -m command -a &#34;free -m&#34;

node3.2g.lab | CHANGED | rc=0 &gt;&gt;
              total        used        free      shared  buff/cache   available
Mem:           1993        1065          91           6         836         748
Swap:          1425           0        1424
</code></pre><p>要对 web 组运行 <code>hostnamectl</code> 命令，使用以下格式：</p><pre tabindex=0><code>$ ansible web -m command -a &#34;hostnamectl&#34;

node1.2g.lab | CHANGED | rc=0 &gt;&gt;
   Static hostname: CentOS7.2daygeek.com
         Icon name: computer-vm
           Chassis: vm
        Machine ID: 002f47b82af248f5be1d67b67e03514c
           Boot ID: dc38f9b8089d4b2d9304e526e00c6a8f
    Virtualization: kvm
  Operating System: CentOS Linux 7 (Core)
       CPE OS Name: cpe:/o:centos:centos:7
            Kernel: Linux 3.10.0-957.el7.x86_64
      Architecture: x86-64
node2.2g.lab | CHANGED | rc=0 &gt;&gt;
   Static hostname: node2.2g.lab
         Icon name: computer-vm
           Chassis: vm
        Machine ID: e39e3a27005d44d8bcbfcab201480b45
           Boot ID: 27b46a09dde546da95ace03420fe12cb
    Virtualization: oracle
  Operating System: CentOS Linux 8 (Core)
       CPE OS Name: cpe:/o:centos:centos:8
            Kernel: Linux 4.18.0-80.el8.x86_64
      Architecture: x86-64
</code></pre><p>参考：<a href=https://docs.ansible.com/ansible/latest/user_guide/index.html>Ansible 文档</a>。</p><hr><p>via: <a href=https://www.2daygeek.com/install-configure-ansible-automation-tool-linux-quick-start-guide/>https://www.2daygeek.com/install-configure-ansible-automation-tool-linux-quick-start-guide/</a></p><p>作者：<a href=https://www.2daygeek.com/author/magesh/>Magesh Maruthamuthu</a> 选题：<a href=https://github.com/lujun9972>lujun9972</a> 译者：<a href=https://github.com/MjSeven>MjSeven</a> 校对：<a href=https://github.com/wxy>wxy</a></p><p>本文由 <a href=https://github.com/LCTT/TranslateProject>LCTT</a> 原创编译，<a href=https://linux.cn/>Linux中国</a> 荣誉推出</p></div><footer class=post__footer><div class="post__tags tags clearfix"><svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5.0 11V3C0 1.5.8.8.8.8S1.5.0 3 0h8c1.5.0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 100-6 3 3 0 000 6z"/></svg><ul class=tags__list><li class=tags__item><a class="tags__link btn" href=/tags/ansible/ rel=tag>Ansible</a></li></ul></div></footer></article></main></div></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2025 Linux.cn Archive.
<span class=footer__copyright-credits>Generated with <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> and <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a> theme.</span></div></div></footer></div><script async defer src=/js/menu.js></script></body></html>