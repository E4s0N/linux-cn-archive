<!doctype html><html class=no-js lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>使用 Python 来可视化 COVID-19 预测 - Linux.cn Archive</title>
<script>(function(e,t){e[t]=e[t].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content><meta property="og:title" content="使用 Python 来可视化 COVID-19 预测"><meta property="og:description" content="我将演示如何利用提供的全球病毒传播的开放数据，使用开源库来创建两个可视效果。"><meta property="og:type" content="article"><meta property="og:url" content="/article-12172-1.html"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-05-01T19:37:00+00:00"><meta property="article:modified_time" content="2020-05-01T19:37:00+00:00"><meta itemprop=name content="使用 Python 来可视化 COVID-19 预测"><meta itemprop=description content="我将演示如何利用提供的全球病毒传播的开放数据，使用开源库来创建两个可视效果。"><meta itemprop=datePublished content="2020-05-01T19:37:00+00:00"><meta itemprop=dateModified content="2020-05-01T19:37:00+00:00"><meta itemprop=wordCount content="633"><meta itemprop=keywords content="可视化,"><link rel=preconnect href=https://fonts.bunny.net crossorigin><link rel=dns-prefetch href=//fonts.bunny.net><link rel=dns-prefetch href=//fonts.bunny.net><link rel=stylesheet href="https://fonts.bunny.net/css?family=Open+Sans:400,400i,700"><link rel=stylesheet href=/css/style.css><link rel="shortcut icon" href=/favicon.ico></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class=logo><a class=logo__link href=/ title="Linux.cn Archive" rel=home><div class="logo__item logo__text"><div class=logo__title>Linux.cn Archive</div></div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>Menu</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/><span class=menu__text>Home</span></a></li><li class=menu__item><a class=menu__link href=/categories/><span class=menu__text>Categories</span></a></li><li class=menu__item><a class=menu__link href=/tags/><span class=menu__text>Tags</span></a></li><li class=menu__item><a class=menu__link href><span class=menu__text>RSS</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>使用 Python 来可视化 COVID-19 预测</h1><div class="post__meta meta"><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class=meta__text datetime=2020-05-01T19:37:00Z>May 01, 2020</time></div></div></header><div class="content post__content clearfix"><blockquote><p>我将演示如何利用提供的全球病毒传播的开放数据，使用开源库来创建两个可视效果。</p></blockquote><p><img src=/data/attachment/album/202005/01/193624a2p2osojyf0yg4go.jpg alt></p><p>使用 <a href=https://opensource.com/resources/python>Python</a> 和一些图形库，你可以预测 COVID-19 确诊病例总数，也可以显示一个国家（本文以印度为例）在给定日期的死亡总数。人们有时需要帮助解释和处理数据的意义，所以本文还演示了如何为五个国家创建一个动画横条形图，以显示按日期显示病例的变化。</p><h3 id=印度的确诊病例和死亡人数预测>印度的确诊病例和死亡人数预测</h3><p>这要分三步来完成。</p><h4 id=1下载数据>1、下载数据</h4><p>科学数据并不总是开放的，但幸运的是，许多现代科学和医疗机构都乐于相互之间及与公众共享信息。关于 COVID-19 病例的数据可以在网上查到，并且经常更新。</p><p>要解析这些数据，首先必须先下载。 <a href=https://raw.githubusercontent.com/datasets/covid-19/master/data/countries-aggregated.csv>https://raw.githubusercontent.com/datasets/covid-19/master/data/countries-aggregated.csv</a>。</p><p>直接将数据加载到 Pandas <code>DataFrame</code> 中。Pandas 提供了一个函数 <code>read_csv()</code>，它可以获取一个 URL 并返回一个 <code>DataFrame</code> 对象，如下所示。</p><pre tabindex=0><code>import pycountry
import plotly.express as px
import pandas as pd
URL_DATASET = r&#39;https://raw.githubusercontent.com/datasets/covid-19/master/data/countries-aggregated.csv&#39;
df1 = pd.read_csv(URL_DATASET)
print(df1.head(3))  # 获取数据帧中的前 3 项
print(df1.tail(3))  # 获取数据帧中的后 3 项
</code></pre><p>数据集的顶行包含列名。</p><ol><li><code>Date</code></li><li><code>Country</code></li><li><code>Confirmed</code></li><li><code>Recovered</code></li><li><code>Deaths</code></li></ol><p><code>head</code> 查询的输出包括一个唯一的标识符（不作为列列出）和每个列的条目。</p><pre tabindex=0><code>0 2020-01-22 Afghanistan 0 0 0
1 2020-01-22 Albania 0 0 0
1 2020-01-22 Algeria 0 0 0
</code></pre><p><code>tail</code> 查询的输出类似，但包含数据集的尾端。</p><pre tabindex=0><code>12597 2020-03-31 West Bank and Gaza 119 18 1
12598 2020-03-31 Zambia 35 0 0
12599 2020-03-31 Zimbabwe 8 0 1
</code></pre><p>从输出中，可以看到 DataFrame（<code>df1</code>）有以下几个列：</p><ol><li>日期</li><li>国家</li><li>确诊</li><li>康复</li><li>死亡</li></ol><p>此外，你可以看到 <code>Date</code> 栏中的条目从 1 月 22 日开始到 3 月 31 日。这个数据库每天都会更新，所以你会有当前的值。</p><h4 id=2选择印度的数据>2、选择印度的数据</h4><p>在这一步中，我们将只选择 DataFrame 中包含印度的那些行。这在下面的脚本中可以看到。</p><pre tabindex=0><code>#### ----- Step 2 (Select data for India)----
df_india = df1[df1[&#39;Country&#39;] == &#39;India&#39;]
print(df_india.head(3))
</code></pre><h4 id=3数据绘图>3、数据绘图</h4><p>在这里，我们创建一个条形图。我们将把日期放在 X 轴上，把确诊的病例数和死亡人数放在 Y 轴上。这一部分的脚本有以下几个值得注意的地方。</p><ul><li><code>plt.rcParams["figure.figsize"]=20,20</code> 这一行代码只适用于 Jupyter。所以如果你使用其他 IDE，请删除它。</li><li>注意这行代码：<code>ax1 = plt.gca()</code>。为了确保两个图，即确诊病例和死亡病例的图都被绘制在同一个图上，我们需要给第二个图的 <code>ax</code> 对象。所以我们使用 <code>gca()</code> 来完成这个任务。（顺便说一下，<code>gca</code> 代表 “ 获取当前坐标轴 get current axis ”）</li></ul><p>完整的脚本如下所示。</p><pre tabindex=0><code>#  Author:- Anurag Gupta # email:- 999.anuraggupta@gmail.com
%matplotlib inline
import matplotlib.pyplot as plt
import pandas as pd

#### ----- Step 1 (Download data)----
URL_DATASET = r&#39;https://raw.githubusercontent.com/datasets/covid-19/master/data/countries-aggregated.csv&#39;
df1 = pd.read_csv(URL_DATASET)
# print(df1.head(3))  # Uncomment to see the dataframe

#### ----- Step 2 (Select data for India)----
df_india = df1[df1[&#39;Country&#39;] == &#39;India&#39;]
print(df_india.head(3))

#### ----- Step 3 (Plot data)----
# Increase size of plot
plt.rcParams[&#34;figure.figsize&#34;]=20,20  # Remove if not on Jupyter
# Plot column &#39;Confirmed&#39;
df_india.plot(kind = &#39;bar&#39;, x = &#39;Date&#39;, y = &#39;Confirmed&#39;, color = &#39;blue&#39;)

ax1 = plt.gca()
df_india.plot(kind = &#39;bar&#39;, x = &#39;Date&#39;, y = &#39;Deaths&#39;, color = &#39;red&#39;, ax = ax1)
plt.show()
</code></pre><p>整个脚本<a href=https://raw.githubusercontent.com/ag999git/jupyter_notebooks/master/corona_bar_india>可在 GitHub 上找到</a>。</p><h3 id=为五个国家创建一个动画水平条形图>为五个国家创建一个动画水平条形图</h3><p>关于 Jupyter 的注意事项：要在 Jupyter 中以动态动画的形式运行，而不是静态 png 的形式，你需要在单元格的开头添加一个神奇的命令，即: <code>%matplotlib notebook</code>。这将使图形保持动态，而不是显示为静态的 png 文件，因此也可以显示动画。如果你在其他 IDE 上，请删除这一行。</p><h4 id=1下载数据-1>1、下载数据</h4><p>这一步和前面的脚本完全一样，所以不需要重复。</p><h4 id=2创建一个所有日期的列表>2、创建一个所有日期的列表</h4><p>如果你检查你下载的数据，你会发现它有一列 <code>Date</code>。现在，这一列对每个国家都有一个日期值。因此，同一个日期会出现多次。我们需要创建一个只具有唯一值的日期列表。这会用在我们条形图的 X 轴上。我们有一行代码，如 <code>list_dates = df[‘Date’].unique()</code>。<code>unique()</code> 方法将只提取每个日期的唯一值。</p><h4 id=3挑选五个国家并创建一个-ax-对象>3、挑选五个国家并创建一个 <code>ax</code> 对象。</h4><p>做一个五个国家的名单。（你可以选择你喜欢的国家，也可以增加或减少国家的数量。）我也做了一个五个颜色的列表，每个国家的条形图的颜色对应一种。（如果你喜欢的话，也可以改一下。）这里有一行重要的代码是：<code>fig, ax = plt.subplots(figsize=(15, 8))</code>。这是创建一个 <code>ax</code> 对象所需要的。</p><h4 id=4编写回调函数>4、编写回调函数</h4><p>如果你想在 Matplotlib 中做动画，你需要创建一个名为 <code>matplotlib.animation.FuncAnimation</code> 的类的对象。这个类的签名可以在网上查到。这个类的构造函数，除了其他参数外，还需要一个叫 <code>func</code> 的参数，你必须给这个参数一个回调函数。所以在这一步中，我们会写个回调函数，这个回调函数会被反复调用，以渲染动画。</p><h4 id=5创建-funcanimation-对象>5、创建 <code>FuncAnimation</code> 对象</h4><p>这一步在上一步中已经部分说明了。</p><p>我们创建这个类的对象的代码是：</p><pre tabindex=0><code>my_anim = animation.FuncAnimation(fig = fig, func = plot_bar,
                    frames = list_dates, blit = True,
                    interval=20)
</code></pre><p>要给出的三个重要参数是：</p><ul><li><code>fig</code>，必须给出一个 fig 对象，也就是我们之前创建的 fig 对象。</li><li><code>func</code>，必须是回调函数。</li><li><code>frames</code>，必须包含要做动画的变量。在我们这里，它是我们之前创建的日期列表。</li></ul><h4 id=6将动画保存为-mp4-文件>6、将动画保存为 mp4 文件</h4><p>你可以将创建的动画保存为 mp4 文件。但是，你需要 <code>ffmpeg</code>。你可以用 <code>pip</code> 下载：<code>pip install ffmpeg-python</code>，或者用 conda（在 Jupyter 上）：<code>install -c conda-forge ffmpeg</code>。</p><p>最后，你可以使用 <code>plt.show()</code> 运行动画。请注意，在许多平台上，<code>ffmpeg</code> 可能无法正常工作，可能需要进一步“调整”。</p><pre tabindex=0><code>%matplotlib notebook
#  Author:- Anurag Gupta # email:- 999.anuraggupta@gmail.com
import pandas as pd
import matplotlib.pyplot as plt
import matplotlib.animation as animation
from time import sleep

#### ---- Step 1:- Download data
URL_DATASET = r&#39;https://raw.githubusercontent.com/datasets/covid-19/master/data/countries-aggregated.csv&#39;
df = pd.read_csv(URL_DATASET, usecols = [&#39;Date&#39;, &#39;Country&#39;, &#39;Confirmed&#39;])
# print(df.head(3)) # uncomment this to see output

#### ---- Step 2:- Create list of all dates
list_dates = df[&#39;Date&#39;].unique()
# print(list_dates) # Uncomment to see the dates

#### --- Step 3:- Pick 5 countries. Also create ax object
fig, ax = plt.subplots(figsize=(15, 8))
# We will animate for these 5 countries only
list_countries = [&#39;India&#39;, &#39;China&#39;, &#39;US&#39;, &#39;Italy&#39;, &#39;Spain&#39;]
# colors for the 5 horizontal bars
list_colors = [&#39;black&#39;, &#39;red&#39;, &#39;green&#39;, &#39;blue&#39;, &#39;yellow&#39;]

### --- Step 4:- Write the call back function
# plot_bar() is the call back function used in FuncAnimation class object
def plot_bar(some_date):
    df2 = df[df[&#39;Date&#39;].eq(some_date)]
    ax.clear()
    # Only take Confirmed column in descending order
    df3 = df2.sort_values(by = &#39;Confirmed&#39;, ascending = False)
    # Select the top 5 Confirmed countries
    df4 = df3[df3[&#39;Country&#39;].isin(list_countries)]
    # print(df4)  # Uncomment to see that dat is only for 5 countries
    sleep(0.2)  # To slow down the animation
    # ax.barh() makes a horizontal bar plot.
    return ax.barh(df4[&#39;Country&#39;], df4[&#39;Confirmed&#39;], color= list_colors)

###----Step 5:- Create FuncAnimation object---------
my_anim = animation.FuncAnimation(fig = fig, func = plot_bar,
                    frames= list_dates, blit=True,
                    interval=20)

### --- Step 6:- Save the animation to an mp4
# Place where to save the mp4. Give your file path instead
path_mp4 = r&#39;C:\Python-articles\population_covid2.mp4&#39;  
# my_anim.save(path_mp4, fps=30, extra_args=[&#39;-vcodec&#39;, &#39;libx264&#39;])
my_anim.save(filename = path_mp4, writer = &#39;ffmpeg&#39;,
             fps=30,
             extra_args= [&#39;-vcodec&#39;, &#39;libx264&#39;, &#39;-pix_fmt&#39;, &#39;yuv420p&#39;])
plt.show()
</code></pre><p>完整的脚本<a href=https://raw.githubusercontent.com/ag999git/jupyter_notebooks/master/corona_bar_animated>可以在 GitHub 上找到</a>。</p><hr><p>via: <a href=https://opensource.com/article/20/4/python-data-covid-19>https://opensource.com/article/20/4/python-data-covid-19</a></p><p>作者：<a href=https://opensource.com/users/999anuraggupta>AnuragGupta</a> 选题：<a href=https://github.com/lujun9972>lujun9972</a> 译者：<a href=https://github.com/wxy>wxy</a> 校对：<a href=https://github.com/wxy>wxy</a></p><p>本文由 <a href=https://github.com/LCTT/TranslateProject>LCTT</a> 原创编译，<a href=https://linux.cn/>Linux中国</a> 荣誉推出</p></div><footer class=post__footer><div class="post__tags tags clearfix"><svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5.0 11V3C0 1.5.8.8.8.8S1.5.0 3 0h8c1.5.0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 100-6 3 3 0 000 6z"/></svg><ul class=tags__list><li class=tags__item><a class="tags__link btn" href=/tags/%E5%8F%AF%E8%A7%86%E5%8C%96/ rel=tag>可视化</a></li></ul></div></footer></article></main></div></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2025 Linux.cn Archive.
<span class=footer__copyright-credits>Generated with <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> and <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a> theme.</span></div></div></footer></div><script async defer src=/js/menu.js></script></body></html>