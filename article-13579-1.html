<!doctype html><html class=no-js lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>使用这个 Python 模块输入不可见的密码 - Linux.cn Archive</title>
<script>(function(e,t){e[t]=e[t].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content><meta property="og:title" content="使用这个 Python 模块输入不可见的密码"><meta property="og:description" content="用 GPG 和 Python 的 getpass 模块给你的密码多一层安全保障。"><meta property="og:type" content="article"><meta property="og:url" content="/article-13579-1.html"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-07-14T10:16:00+00:00"><meta property="article:modified_time" content="2021-07-14T10:16:00+00:00"><meta itemprop=name content="使用这个 Python 模块输入不可见的密码"><meta itemprop=description content="用 GPG 和 Python 的 getpass 模块给你的密码多一层安全保障。"><meta itemprop=datePublished content="2021-07-14T10:16:00+00:00"><meta itemprop=dateModified content="2021-07-14T10:16:00+00:00"><meta itemprop=wordCount content="254"><meta itemprop=keywords content="密码,gpg,"><link rel=preconnect href=https://fonts.bunny.net crossorigin><link rel=dns-prefetch href=//fonts.bunny.net><link rel=dns-prefetch href=//fonts.bunny.net><link rel=stylesheet href="https://fonts.bunny.net/css?family=Open+Sans:400,400i,700"><link rel=stylesheet href=/css/style.css><link rel="shortcut icon" href=/favicon.ico></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class=logo><a class=logo__link href=/ title="Linux.cn Archive" rel=home><div class="logo__item logo__text"><div class=logo__title>Linux.cn Archive</div></div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>Menu</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/><span class=menu__text>Home</span></a></li><li class=menu__item><a class=menu__link href=/categories/><span class=menu__text>Categories</span></a></li><li class=menu__item><a class=menu__link href=/tags/><span class=menu__text>Tags</span></a></li><li class=menu__item><a class=menu__link href><span class=menu__text>RSS</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>使用这个 Python 模块输入不可见的密码</h1><div class="post__meta meta"><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class=meta__text datetime=2021-07-14T10:16:00Z>July 14, 2021</time></div></div></header><div class="content post__content clearfix"><blockquote><p>用 GPG 和 Python 的 getpass 模块给你的密码多一层安全保障。</p></blockquote><p><img src=https://img.linux.net.cn/data/attachment/album/202107/14/101543fy6up6imco65mi68.jpg alt title="Password lock"></p><p>密码对程序员来说尤其重要。你不应该在不加密的情况下存储它们，而且你也不应该在用户输入密码的时候显示出输入的内容。当我决定要提高我的笔记本电脑的安全性时，这对我来说变得特别重要。我对我的家目录进行了加密，但当我登录后，任何以纯文本形式存储在配置文件中的密码都有可能暴露在偷窥者面前。</p><p>具体来说，我使用一个名为 <a href=http://www.mutt.org/>Mutt</a> 的应用作为我的电子邮件客户端。它可以让我在我的 Linux 终端中阅读和撰写电子邮件，但通常它希望在其配置文件中有一个密码。我限制了我的 Mutt 配置文件的权限，以便只有我可以看到它，我是我的笔记本电脑的唯一用户，所以我并不真的担心经过认证的用户会无意中看到我的配置文件。相反，我想保护自己，无论是为了吹嘘还是为了版本控制，不至于心不在焉地把我的配置发布到网上，把我的密码暴露了。此外，虽然我不希望我的系统上有不受欢迎的客人，但我确实想确保入侵者不能通过对我的配置上运行 <code>cat</code> 就获得我的密码。</p><h3 id=python-gnupg>Python GnuPG</h3><p>Python 模块 <code>python-gnupg</code> 是 <code>gpg</code> 应用的一个 Python 封装。该模块的名字是 <code>python-gnupg</code>，你不要把它和一个叫做 <code>gnupg</code> 的模块混淆。</p><p><a href=https://gnupg.org/>GnuPG</a>（GPG） 是 Linux 的默认加密系统，我从 2009 年左右开始使用它。我对它很熟悉，对它的安全性有很高的信任。</p><p>我决定将我的密码输入 Mutt 的最好方法是将我的密码存储在一个加密的 GPG 文件中，创建一个提示我的 GPG 密码来解锁这个加密文件，然后将密码交给 Mutt（实际上是交给 <code>offlineimap</code> 命令，我用它来同步我的笔记本和电子邮件服务器）。</p><p><a href=https://opensource.com/article/20/12/learn-python>用 Python 获取用户输入</a> 是非常容易的。对 <code>input</code> 进行调用，无论用户输入什么，都会被存储为一个变量：</p><pre tabindex=0><code>print(&#34;Enter password: &#34;)
myinput = input()

print(&#34;You entered: &#34;, myinput)
</code></pre><p>我的问题是，当我根据密码提示在终端上输入密码时，我所输入的所有内容对任何从我肩膀上看过去或滚动我的终端历史的人来说都是可见的：</p><pre tabindex=0><code>$ ./test.py
Enter password: my-Complex-Passphrase
</code></pre><h3 id=用-getpass-输入不可见密码>用 getpass 输入不可见密码</h3><p>正如通常的情况一样，有一个 Python 模块已经解决了我的问题。这个模块是 <code>getpass4</code>，从用户的角度来看，它的行为和 <code>input</code> 完全一样，只是不显示用户输入的内容。</p><p>你可以用 <a href=https://opensource.com/article/19/11/python-pip-cheat-sheet>pip</a> 安装这两个模块：</p><pre tabindex=0><code>$ python -m pip install --user python-gnupg getpass4
</code></pre><p>下面是我的 Python 脚本，用于创建密码提示：</p><pre tabindex=0><code>#!/usr/bin/env python
# by Seth Kenlon
# GPLv3

# install deps:
# python3 -m pip install --user python-gnupg getpass4

import gnupg
import getpass
from pathlib import Path

def get_api_pass():
  homedir = str(Path.home())
  gpg = gnupg.GPG(gnupghome=os.path.join(homedir,&#34;.gnupg&#34;), use_agent=True)
  passwd = getpass.getpass(prompt=&#34;Enter your GnuPG password: &#34;, stream=None)

  with open(os.path.join(homedir,&#39;.mutt&#39;,&#39;pass.gpg&#39;), &#39;rb&#39;) as f:
    apipass = (gpg.decrypt_file(f, passphrase=passwd))

  f.close()

  return str(apipass)
 
if __name__ == &#34;__main__&#34;:
  apipass = get_api_pass()
  print(apipass)
</code></pre><p>如果你想试试，把文件保存为 <code>password_prompt.py</code>。如果你使用 <code>offlineimap</code> 并想在你自己的密码输入中使用这个方案，那么把它保存到某个你可以在 <code>.offlineimaprc</code> 文件中指向 <code>offlineimap</code> 的位置（我使用 <code>~/.mutt/password_prompt.py</code>）。</p><h3 id=测试密码提示>测试密码提示</h3><p>要查看脚本的运行情况，你首先必须创建一个加密文件（我假设你已经设置了 GPG）：</p><pre tabindex=0><code>$ echo &#34;hello world&#34; &amp;gt; pass
$ gpg --encrypt pass
$ mv pass.gpg ~/.mutt/pass.gpg
$ rm pass
</code></pre><p>现在运行 Python 脚本：</p><pre tabindex=0><code>$ python ~/.mutt/password_prompt.py
Enter your GPG password:
hello world
</code></pre><p>当你输入时没有任何显示，但只要你正确输入 GPG 口令，你就会看到该测试信息。</p><h3 id=将密码提示符与-offlineimap-整合起来>将密码提示符与 offlineimap 整合起来</h3><p>我需要将我的新提示与 <code>offlineimap</code> 命令结合起来。我为这个脚本选择了 Python，因为我知道 <code>offlineimap</code> 可以对 Python 程序进行调用。如果你是一个 <code>offlineimap</code> 用户，你会明白唯一需要的“整合”是在你的 <code>.offlineimaprc</code> 文件中改变两行。</p><p>首先，添加一行引用 Python 文件的内容:</p><pre tabindex=0><code>pythonfile = ~/.mutt/password_prompt.py
</code></pre><p>然后将 <code>.offlineimaprc</code>中的 <code>remotepasseval</code> 行改为调用 <code>password_prompt.py</code>中的 <code>get_api_pass()</code> 函数:</p><pre tabindex=0><code>remotepasseval = get_api_pass()
</code></pre><p>配置文件中不再有密码！</p><h3 id=安全问题>安全问题</h3><p>在你的个人电脑上考虑安全问题有时会让人觉得很偏执。你的 SSH 配置是否真的需要限制为 600？隐藏在名为 <code>.mutt</code> 的无关紧要的电子邮件密码真的重要吗？也许不重要。</p><p>然而，知道我没有把敏感数据悄悄地藏在我的配置文件里，使我更容易把文件提交到公共 Git 仓库，把片段复制和粘贴到支持论坛，并以真实好用的配置文件的形式分享我的知识。仅就这一点而言，安全性的提高使我的生活更加轻松。而且有这么多好的 Python 模块可以提供帮助，这很容易实现。</p><hr><p>via: <a href=https://opensource.com/article/21/7/invisible-passwords-python>https://opensource.com/article/21/7/invisible-passwords-python</a></p><p>作者：<a href=https://opensource.com/users/seth>Seth Kenlon</a> 选题：<a href=https://github.com/lujun9972>lujun9972</a> 译者：<a href=https://github.com/geekpi>geekpi</a> 校对：<a href=https://github.com/wxy>wxy</a></p><p>本文由 <a href=https://github.com/LCTT/TranslateProject>LCTT</a> 原创编译，<a href=https://linux.cn/>Linux中国</a> 荣誉推出</p></div><footer class=post__footer><div class="post__tags tags clearfix"><svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5.0 11V3C0 1.5.8.8.8.8S1.5.0 3 0h8c1.5.0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 100-6 3 3 0 000 6z"/></svg><ul class=tags__list><li class=tags__item><a class="tags__link btn" href=/tags/%E5%AF%86%E7%A0%81/ rel=tag>密码</a></li><li class=tags__item><a class="tags__link btn" href=/tags/gpg/ rel=tag>gpg</a></li></ul></div></footer></article></main></div></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2025 Linux.cn Archive.
<span class=footer__copyright-credits>Generated with <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> and <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a> theme.</span></div></div></footer></div><script async defer src=/js/menu.js></script></body></html>