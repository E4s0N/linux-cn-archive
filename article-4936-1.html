<!doctype html><html class=no-js lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>如何在 Ubuntu 14.04 里面配置 chroot 环境 - Linux.cn Archive</title>
<script>(function(e,t){e[t]=e[t].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content><meta property="og:title" content="如何在 Ubuntu 14.04 里面配置 chroot 环境"><meta property="og:description" content="你可能会有很多理由想要把一个应用、一个用户或者一个环境与你的 linux 系统隔离开来。不同的操作系统有不同的实现方式，而在 linux 中，一个典型的方式就是 chroot 环境。 在这份教程中，我会一步一步指导你怎么使用 chroot 命令去配置一个与真实系统分离出来的独立环境。这个功能主要可以用于测试项目，以下这些步骤都在 Ubuntu 14.04 虚拟专用服务器(VPS)上执行。 学会快速搭建一个简单的 chroot 环境是一项非常实用的技能，绝大多数系统管理员都能从中受益。 Chroot 环境 一个 chroot 环境就是通过系统调用，将一个本地目录临时变成根"><meta property="og:type" content="article"><meta property="og:url" content="/article-4936-1.html"><meta property="article:section" content="posts"><meta property="article:published_time" content="2015-02-25T11:00:00+00:00"><meta property="article:modified_time" content="2015-02-25T11:00:00+00:00"><meta itemprop=name content="如何在 Ubuntu 14.04 里面配置 chroot 环境"><meta itemprop=description content="你可能会有很多理由想要把一个应用、一个用户或者一个环境与你的 linux 系统隔离开来。不同的操作系统有不同的实现方式，而在 linux 中，一个典型的方式就是 chroot 环境。 在这份教程中，我会一步一步指导你怎么使用 chroot 命令去配置一个与真实系统分离出来的独立环境。这个功能主要可以用于测试项目，以下这些步骤都在 Ubuntu 14.04 虚拟专用服务器(VPS)上执行。 学会快速搭建一个简单的 chroot 环境是一项非常实用的技能，绝大多数系统管理员都能从中受益。 Chroot 环境 一个 chroot 环境就是通过系统调用，将一个本地目录临时变成根"><meta itemprop=datePublished content="2015-02-25T11:00:00+00:00"><meta itemprop=dateModified content="2015-02-25T11:00:00+00:00"><meta itemprop=wordCount content="307"><meta itemprop=keywords content="chroot,schroot,debootstrap,"><link rel=preconnect href=https://fonts.bunny.net crossorigin><link rel=dns-prefetch href=//fonts.bunny.net><link rel=dns-prefetch href=//fonts.bunny.net><link rel=stylesheet href="https://fonts.bunny.net/css?family=Open+Sans:400,400i,700"><link rel=stylesheet href=/css/style.css><link rel="shortcut icon" href=/favicon.ico></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class=logo><a class=logo__link href=/ title="Linux.cn Archive" rel=home><div class="logo__item logo__text"><div class=logo__title>Linux.cn Archive</div></div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>Menu</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/><span class=menu__text>Home</span></a></li><li class=menu__item><a class=menu__link href=/categories/><span class=menu__text>Categories</span></a></li><li class=menu__item><a class=menu__link href=/tags/><span class=menu__text>Tags</span></a></li><li class=menu__item><a class=menu__link href><span class=menu__text>RSS</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>如何在 Ubuntu 14.04 里面配置 chroot 环境</h1><div class="post__meta meta"><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class=meta__text datetime=2015-02-25T11:00:00Z>February 25, 2015</time></div></div></header><div class="content post__content clearfix"><p>你可能会有很多理由想要把一个应用、一个用户或者一个环境与你的 linux 系统隔离开来。不同的操作系统有不同的实现方式，而在 linux 中，一个典型的方式就是 chroot 环境。</p><p>在这份教程中，我会一步一步指导你怎么使用 chroot 命令去配置一个与真实系统分离出来的独立环境。这个功能主要可以用于测试项目，以下这些步骤都在 <strong>Ubuntu 14.04</strong> 虚拟专用服务器(VPS)上执行。</p><p>学会快速搭建一个简单的 chroot 环境是一项非常实用的技能，绝大多数系统管理员都能从中受益。</p><h3 id=chroot-环境>Chroot 环境</h3><p>一个 chroot 环境就是通过系统调用，将一个本地目录临时变成根目录。一般所说的系统根目录就是挂载点"/"，然而使用 chroot 命令后，你可以使用其它目录作为根目录。</p><p><img src=/data/attachment/album/201502/24/230540fbha1a16bj0vmz16.png alt></p><p>原则上，任何运行在 chroot 环境内的应用都不能访问系统中其他信息（LCTT译注：使用 chroot 把一个目录变成根目录，在里面运行的应用只能访问本目录内的文件，无法访问到目录外的文件。然而，运行在 chroot 环境的应用可以通过 sysfs 文件系统访问到环境外的信息，所以，这里有个“原则上”的修饰语）。</p><h3 id=chroot-环境的用处>Chroot 环境的用处</h3><blockquote><ul><li>测试一个不稳定的应用服务不会影响到整个主机系统。</li><li>就算使用 root 权限做了些不当的操作，把 chroot 环境搞得一塌糊涂，也不会影响到主机系统。</li><li>可以在你的系统中运行另外一个操作系统。</li></ul></blockquote><p>举个例子，你可以在 chroot 环境中编译、安装、测试软件，而不去动真实的系统。你也可以<strong>在64位环境下使用 chroot 创建一个32位环境，然后运行一个32位的程序</strong>（LCTT泽注：如果你的真实环境是32位的，那就不能 chroot 一个64位的环境了）。</p><p>但是为了安全考虑，chroot 环境为非特权用户设立了非常严格的限制，而不是提供完整的安全策略。如果你需要的是有完善的安全策略的隔离方案，可以考虑下 LXC、Docker、vservers等等。</p><h3 id=debootstrap-和-schroot>Debootstrap 和 Schroot</h3><p>使用 chroot 环境需要安装 <strong>debootstrap</strong> 和 <strong>schroot</strong>，这两个软件都在 Ubuntu 的镜像源中。其中 schroot 用于创建 chroot 环境。</p><p><strong>Debootstrap</strong> 可以让你通过镜像源安装任何 Debian（或基于 Debian 的）系统，装好的系统会包含最基本的命令。</p><p><strong>Schroot</strong> 命令允许用户使用相同的机制去创建 chroot 环境，但在访问 chroot 环境时会做些权限检查，并且会允许用户做些额外的自动设置，比如挂载一些文件系统。</p><p>在 Ubuntu 14.04 LTS 上，我们可以通过两步来实现这个功能：</p><h3 id=1-安装软件包>1. 安装软件包</h3><p>第一步，在Ubuntu 14.04 LTS 主机系统上安装 debootstrap 和 schroot：</p><pre tabindex=0><code>$ sudo apt-get install debootstrap 
$ sudo apt-get install schroot
</code></pre><h3 id=2-配置-schroot>2. 配置 Schroot</h3><p>现在我们有工具在手，需要指定一个目录作为我们的 chroot 环境。这里创建一个目录先：</p><pre tabindex=0><code>sudo mkdir /linoxide
</code></pre><p>编辑 schroot 的配置文件：</p><pre tabindex=0><code>sudo nano /etc/schroot/schroot.conf
</code></pre><p>再提醒一下，我们现在是在 Ubuntu 14.04 LTS 系统上。如果我们想测试一个软件包能不能在 Ubuntu 13.10（代号是“Saucy Salamander”） 上运行，就可以在配置文件中添加下面的内容：</p><pre tabindex=0><code>[saucy]
description=Ubuntu Saucy
location=/linoxide
priority=3
users=arun
root-groups=root
</code></pre><p><img src=/data/attachment/album/201502/24/230709b1qzbtq3bp740yzt.png alt></p><p>根据你的系统要求，调整上面的配置信息。</p><h3 id=3-使用-debootstrap-安装32位-ubuntu-系统>3. 使用 debootstrap 安装32位 Ubuntu 系统</h3><p>Debootstrap 命令会在你的 <strong>chroot 环境</strong>里面下载安装一个最小系统。只要你能访问镜像源，你就可以安装任何基于 Debian 的系统版本。</p><p>前面我们已经创建了 <strong>/linoxide</strong> 目录用于放置 chroot 环境，现在我们可以在这个目录里面运行 debootstrap 了：</p><pre tabindex=0><code>cd /linoxide
sudo debootstrap --variant=buildd --arch amd64 saucy /linoxide/ http://archive.ubuntu.com/ubuntu/
sudo chroot /linoxide /debootstrap/debootstrap --second-stage
</code></pre><p>你可以将 &ndash;arch 的参数换成 i386 或其他架构，只要存在这种架构的镜像源。你也可以把镜像源 <a href=http://archive.ubuntu.com/ubuntu/>http://archive.ubuntu.com/ubuntu/</a> 换成离你最近的镜像源，具体可参考 <a href=https://launchpad.net/ubuntu/+archivemirrors>Ubuntu 官方镜像主页</a>。</p><p><strong>注意：如果你是在64位系统中创建32位系统，你需要在上面第3行命令中加入 &ndash;foreign 选项，就像下面的命令：</strong></p><pre tabindex=0><code>sudo debootstrap --variant=buildd --foreign --arch i386 saucy /linoxide/ http://archive.ubuntu.com/ubuntu/
</code></pre><p>下载需要一段时间，看你网络带宽性能。最小系统大概有500M。</p><h3 id=4-完成-chroot-环境>4. 完成 chroot 环境</h3><p>安装完系统后，我们需要做一些收尾工作，确保系统运行正常。首先，保证主机的 fstab 程序能意识到 chroot 环境的存在：</p><pre tabindex=0><code>sudo nano /etc/fstab
</code></pre><p>在文件最后面添加下面的配置：</p><pre tabindex=0><code>proc /linoxide/proc proc defaults 0 0
sysfs /linoxide/sys sysfs defaults 0 0
</code></pre><p>保存并关闭文件。</p><p>挂载一些文件系统到 chroot 环境：</p><pre tabindex=0><code>$ sudo mount proc /linoxide/proc -t proc
$ sudo mount sysfs /linoxide/sys -t sysfs
</code></pre><p>复制 /etc/hosts 文件到 chroot 环境，这样 chroot 环境就可以使用网络了：</p><pre tabindex=0><code>$ sudo cp /etc/hosts /linoxide/etc/hosts
</code></pre><p>最后使用 schroot -l 命令列出系统上所有的 chroot 环境：</p><pre tabindex=0><code>$ schroot -l
</code></pre><p>使用下面的命令进入 chroot 环境：</p><pre tabindex=0><code>$ sudo chroot /linoxide/ /bin/bash
</code></pre><p>测试安装的版本：</p><pre tabindex=0><code># lsb_release -a
# uname -a
</code></pre><p>为了在 chroot 环境中使用图形界面，你需要设置 DISPLAY 环境变量：</p><pre tabindex=0><code>$ DISPLAY=:0.0 ./apps
</code></pre><p>目前为止，我已经成功地在 Ubuntu 14.04 LTS 上安装了 Ubuntu 13.10。</p><p>退出 chroot 环境：</p><pre tabindex=0><code># exit
</code></pre><p>清理一下，卸载文件系统：</p><pre tabindex=0><code>$ sudo umount /test/proc
$ sudo umount /test/sys
</code></pre><hr><p>via: <a href=http://linoxide.com/ubuntu-how-to/configure-chroot-environment-ubuntu-14-04/>http://linoxide.com/ubuntu-how-to/configure-chroot-environment-ubuntu-14-04/</a></p><p>作者：<a href=http://linoxide.com/author/arunp/>Arun Pyasi</a> 译者：<a href=https://github.com/bazz2>bazz2</a> 校对：<a href=https://github.com/wxy>wxy</a></p><p>本文由 <a href=https://github.com/LCTT/TranslateProject>LCTT</a> 原创翻译，<a href=http://linux.cn/>Linux中国</a> 荣誉推出</p></div><footer class=post__footer><div class="post__tags tags clearfix"><svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5.0 11V3C0 1.5.8.8.8.8S1.5.0 3 0h8c1.5.0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 100-6 3 3 0 000 6z"/></svg><ul class=tags__list><li class=tags__item><a class="tags__link btn" href=/tags/chroot/ rel=tag>chroot</a></li><li class=tags__item><a class="tags__link btn" href=/tags/schroot/ rel=tag>schroot</a></li><li class=tags__item><a class="tags__link btn" href=/tags/debootstrap/ rel=tag>debootstrap</a></li></ul></div></footer></article></main></div></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2025 Linux.cn Archive.
<span class=footer__copyright-credits>Generated with <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> and <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a> theme.</span></div></div></footer></div><script async defer src=/js/menu.js></script></body></html>