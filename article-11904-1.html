<!doctype html><html class=no-js lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>3 种使用 PostgreSQL 命令的方式 - Linux.cn Archive</title>
<script>(function(e,t){e[t]=e[t].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content><meta property="og:title" content="3 种使用 PostgreSQL 命令的方式"><meta property="og:description" content="无论你需要的东西简单（如一个购物清单）亦或复杂（如色卡生成器） ，PostgreSQL 命令都能使它变得容易起来。"><meta property="og:type" content="article"><meta property="og:url" content="/article-11904-1.html"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-02-18T12:40:32+00:00"><meta property="article:modified_time" content="2020-02-18T12:40:32+00:00"><meta itemprop=name content="3 种使用 PostgreSQL 命令的方式"><meta itemprop=description content="无论你需要的东西简单（如一个购物清单）亦或复杂（如色卡生成器） ，PostgreSQL 命令都能使它变得容易起来。"><meta itemprop=datePublished content="2020-02-18T12:40:32+00:00"><meta itemprop=dateModified content="2020-02-18T12:40:32+00:00"><meta itemprop=wordCount content="506"><meta itemprop=keywords content="PostgreSQL,"><link rel=preconnect href=https://fonts.bunny.net crossorigin><link rel=dns-prefetch href=//fonts.bunny.net><link rel=dns-prefetch href=//fonts.bunny.net><link rel=stylesheet href="https://fonts.bunny.net/css?family=Open+Sans:400,400i,700"><link rel=stylesheet href=/css/style.css><link rel="shortcut icon" href=/favicon.ico></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class=logo><a class=logo__link href=/ title="Linux.cn Archive" rel=home><div class="logo__item logo__text"><div class=logo__title>Linux.cn Archive</div></div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>Menu</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/><span class=menu__text>Home</span></a></li><li class=menu__item><a class=menu__link href=/categories/><span class=menu__text>Categories</span></a></li><li class=menu__item><a class=menu__link href=/tags/><span class=menu__text>Tags</span></a></li><li class=menu__item><a class=menu__link href><span class=menu__text>RSS</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>3 种使用 PostgreSQL 命令的方式</h1><div class="post__meta meta"><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class=meta__text datetime=2020-02-18T12:40:32Z>February 18, 2020</time></div></div></header><div class="content post__content clearfix"><blockquote><p>无论你需要的东西简单（如一个购物清单）亦或复杂（如色卡生成器） ，PostgreSQL 命令都能使它变得容易起来。</p></blockquote><p><img src=/data/attachment/album/202002/18/124003twk7fryz2krw2r39.jpg alt></p><p>在 <a href=/article-11593-1.html>PostgreSQL 入门</a>一文中, 我解释了如何安装、设置和开始使用这个开源数据库软件。不过，使用 <a href=https://www.postgresql.org/>PostgreSQL</a> 中的命令可以做更多事情。</p><p>例如，我使用 Postgres 来跟踪我的杂货店购物清单。我的大多数杂货店购物是在家里进行的，而且每周进行一次大批量的采购。我去几个不同的地方购买清单上的东西，因为每家商店都提供特定的选品或质量，亦或更好的价格。最初，我制作了一个 HTML 表单页面来管理我的购物清单，但这样无法保存我的输入内容。因此，在想到要购买的物品时我必须马上列出全部清单，然后到采购时我常常会忘记一些我需要或想要的东西。</p><p>相反，使用 PostgreSQL，当我想到需要的物品时，我可以随时输入，并在购物前打印出来。你也可以这样做。</p><h3 id=创建一个简单的购物清单>创建一个简单的购物清单</h3><p>首先，输入 <code>psql</code> 命令进入数据库，然后用下面的命令创建一个表：</p><pre tabindex=0><code>Create table groc (item varchar(20), comment varchar(10));
</code></pre><p>输入如下命令在清单中加入商品：</p><pre tabindex=0><code>insert into groc values (&#39;milk&#39;, &#39;K&#39;);
insert into groc values (&#39;bananas&#39;, &#39;KW&#39;);
</code></pre><p>括号中有两个信息（逗号隔开）：前面是你需要买的东西，后面字母代表你要购买的地点以及哪些东西是你每周通常都要买的（<code>W</code>）。</p><p>因为 <code>psql</code> 有历史记录，你可以按向上键在括号内编辑信息，而无需输入商品的整行信息。</p><p>在输入一小部分商品后，输入下面命令来检查前面的输入内容。</p><pre tabindex=0><code>Select * from groc order by comment;

      item      | comment
----------------+---------
 ground coffee  | H
 butter         | K
 chips          | K
 steak          | K
 milk           | K
 bananas        | KW
 raisin bran    | KW
 raclette       | L
 goat cheese    | L
 onion          | P
 oranges        | P
 potatoes       | P
 spinach        | PW
 broccoli       | PW
 asparagus      | PW
 cucumber       | PW
 sugarsnap peas | PW
 salmon         | S
(18 rows)
</code></pre><p>此命令按 <code>comment</code> 列对结果进行排序，以便按购买地点对商品进行分组，从而使你的购物更加方便。</p><p>使用 <code>W</code> 来指明你每周要买的东西，当你要清除表单为下周的列表做准备时，你可以将每周的商品保留在购物清单上。输入：</p><pre tabindex=0><code>delete from groc where comment not like &#39;%W&#39;;
</code></pre><p>注意，在 PostgreSQL 中 <code>%</code> 表示通配符（而非星号）。所以，要保存输入内容，需要输入：</p><pre tabindex=0><code>delete from groc where item like &#39;goat%&#39;;
</code></pre><p>不能使用 <code>item = 'goat%'</code>，这样没用。</p><p>在购物时，用以下命令输出清单并打印或发送到你的手机：</p><pre tabindex=0><code>\o groclist.txt
select * from groc order by comment;
\o
</code></pre><p>最后一个命令 <code>\o</code> 后面没有任何内容，将重置输出到命令行。否则，所有的输出会继续输出到你创建的杂货店购物文件 <code>groclist.txt</code> 中。</p><h3 id=分析复杂的表>分析复杂的表</h3><p>这个逐项列表对于数据量小的表来说没有问题，但是对于数据量大的表呢？几年前，我帮 <a href=http://freiefarbe.de>FreieFarbe.de</a> 的团队从 HLC 调色板中创建一个自由色的色样册。事实上，任何能想象到的打印色都可按色调、亮度、浓度（饱和度）来规定。最终结果是 <a href=https://www.freiefarbe.de/en/thema-farbe/hlc-colour-atlas/>HLC Color Atlas</a>，下面是我们如何实现的。</p><p>该团队向我发送了具有颜色规范的文件，因此我可以编写可与 Scribus 配合使用的 Python 脚本，以轻松生成色样册。一个例子像这样开始：</p><pre tabindex=0><code>HLC, C, M, Y, K
H010_L15_C010, 0.5, 49.1, 0.1, 84.5
H010_L15_C020, 0.0, 79.7, 15.1, 78.9
H010_L25_C010, 6.1, 38.3, 0.0, 72.5
H010_L25_C020, 0.0, 61.8, 10.6, 67.9
H010_L25_C030, 0.0, 79.5, 18.5, 62.7
H010_L25_C040, 0.4, 94.2, 17.3, 56.5
H010_L25_C050, 0.0, 100.0, 15.1, 50.6
H010_L35_C010, 6.1, 32.1, 0.0, 61.8
H010_L35_C020, 0.0, 51.7, 8.4, 57.5
H010_L35_C030, 0.0, 68.5, 17.1, 52.5
H010_L35_C040, 0.0, 81.2, 22.0, 46.2
H010_L35_C050, 0.0, 91.9, 20.4, 39.3
H010_L35_C060, 0.1, 100.0, 17.3, 31.5
H010_L45_C010, 4.3, 27.4, 0.1, 51.3
</code></pre><p>这与原始数据相比，稍有修改，原始数据用制表符分隔。我将其转换成 CSV 格式（用逗号分割值），我更喜欢其与 Python 一起使用（CSV 文也很有用，因为它可轻松导入到电子表格程序中）。</p><p>在每一行中，第一项是颜色名称，其后是其 C、M、Y 和 K 颜色值。 该文件包含 1,793 种颜色，我想要一种分析信息的方法，以了解这些值的范围。这就是 PostgreSQL 发挥作用的地方。我不想手动输入所有数据 —— 我认为输入过程中我不可能不出错，而且令人头痛。幸运的是，PostgreSQL 为此提供了一个命令。</p><p>首先用以下命令创建数据库：</p><pre tabindex=0><code>Create table hlc_cmyk (color varchar(40), c decimal, m decimal, y decimal, k decimal);
</code></pre><p>然后通过以下命令引入数据：</p><pre tabindex=0><code>\copy  hlc_cmyk from &#39;/home/gregp/HLC_Atlas_CMYK_SampleData.csv&#39; with (header, format CSV);
</code></pre><p>开头有反斜杠，是因为使用纯 <code>copy</code> 命令的权限仅限于 root 用户和 Postgres 的超级用户。在括号中，<code>header</code> 表示第一行包含标题，应忽略，<code>CSV</code> 表示文件格式为 CSV。请注意，在此方法中，颜色名称不需要用括号括起来。</p><p>如果操作成功，会看到 <code>COPY NNNN</code>，其中 N 表示插入到表中的行数。</p><p>最后，可以用下列命令查询：</p><pre tabindex=0><code>select * from hlc_cmyk;

     color     |   c   |   m   |   y   |  k  
---------------+-------+-------+-------+------
 H010_L15_C010 |   0.5 |  49.1 |   0.1 | 84.5
 H010_L15_C020 |   0.0 |  79.7 |  15.1 | 78.9
 H010_L25_C010 |   6.1 |  38.3 |   0.0 | 72.5
 H010_L25_C020 |   0.0 |  61.8 |  10.6 | 67.9
 H010_L25_C030 |   0.0 |  79.5 |  18.5 | 62.7
 H010_L25_C040 |   0.4 |  94.2 |  17.3 | 56.5
 H010_L25_C050 |   0.0 | 100.0 |  15.1 | 50.6
 H010_L35_C010 |   6.1 |  32.1 |   0.0 | 61.8
 H010_L35_C020 |   0.0 |  51.7 |   8.4 | 57.5
 H010_L35_C030 |   0.0 |  68.5 |  17.1 | 52.5
</code></pre><p>所有的 1,793 行数据都是这样的。回想起来，我不能说此查询对于 HLC 和 Scribus 任务是绝对必要的，但是它减轻了我对该项目的一些担忧。</p><p>为了生成 HLC 色谱，我使用 Scribus 为色板页面中的 13,000 多种颜色自动创建了颜色图表。</p><p>我可以使用 <code>copy</code> 命令输出数据：</p><pre tabindex=0><code>\copy hlc_cmyk to &#39;/home/gregp/hlc_cmyk_backup.csv&#39; with (header, format CSV);
</code></pre><p>我还可以使用 <code>where</code> 子句根据某些值来限制输出。</p><p>例如，以下命令将仅发送以 <code>H10</code> 开头的色调值。</p><pre tabindex=0><code>\copy hlc_cmyk to &#39;/home/gregp/hlc_cmyk_backup.csv&#39; with (header, format CSV) where color like &#39;H10%&#39;;
</code></pre><h3 id=备份或传输数据库或表>备份或传输数据库或表</h3><p>我在此要提到的最后一个命令是 <code>pg_dump</code>，它用于备份 PostgreSQL 数据库，并在 <code>psql</code> 控制台之外运行。 例如：</p><pre tabindex=0><code>pg_dump gregp -t hlc_cmyk &gt; hlc.out
pg_dump gregp &gt; dball.out
</code></pre><p>第一行是导出 <code>hlc_cmyk</code> 表及其结构。第二行将转储 <code>gregp</code> 数据库中的所有表。这对于备份或传输数据库或表非常有用。</p><p>要将数据库或表传输到另一台电脑（查看 <a href=/article-11593-1.html>PostgreSQL 入门</a>那篇文章获取详细信息），首先在要转入的电脑上创建一个数据库，然后执行相反的操作。</p><pre tabindex=0><code>psql -d gregp -f dball.out
</code></pre><p>一步创建所有表并输入数据。</p><h3 id=总结>总结</h3><p>在本文中，我们了解了如何使用 <code>WHERE</code> 参数限制操作，以及如何使用 PostgreSQL 通配符 <code>％</code>。我们还了解了如何将大批量数据加载到表中，然后将部分或全部表数据输出到文件，甚至是将整个数据库及其所有单个表输出。</p><hr><p>via: <a href=https://opensource.com/article/20/2/postgresql-commands>https://opensource.com/article/20/2/postgresql-commands</a></p><p>作者：<a href=https://opensource.com/users/greg-p>Greg Pittman</a> 选题：<a href=https://github.com/lujun9972>lujun9972</a> 译者：<a href=https://github.com/Morisun029>Morisun029</a> 校对：<a href=https://github.com/wxy>wxy</a></p><p>本文由 <a href=https://github.com/LCTT/TranslateProject>LCTT</a> 原创编译，<a href=https://linux.cn/>Linux中国</a> 荣誉推出</p></div><footer class=post__footer><div class="post__tags tags clearfix"><svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5.0 11V3C0 1.5.8.8.8.8S1.5.0 3 0h8c1.5.0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 100-6 3 3 0 000 6z"/></svg><ul class=tags__list><li class=tags__item><a class="tags__link btn" href=/tags/postgresql/ rel=tag>PostgreSQL</a></li></ul></div></footer></article></main></div></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2025 Linux.cn Archive.
<span class=footer__copyright-credits>Generated with <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> and <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a> theme.</span></div></div></footer></div><script async defer src=/js/menu.js></script></body></html>