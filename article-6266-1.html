<!doctype html><html class=no-js lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>RHCSA 系列（八）: 加固 SSH，设定主机名及启用网络服务 - Linux.cn Archive</title>
<script>(function(e,t){e[t]=e[t].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content><meta property="og:title" content="RHCSA 系列（八）: 加固 SSH，设定主机名及启用网络服务"><meta property="og:description" content="作为一名系统管理员，你将经常使用一个终端模拟器来登录到一个远程的系统中，执行一系列的管理任务。你将很少有机会坐在一个真实的（物理）终端前，所以你需要设定好一种方法来使得你可以登录到你需要去管理的那台远程主机上。 事实上，当你必须坐在一台物理终端前的时候，就可能是你登录到该主机的最后一种方法了。基于安全原因，使用 Telnet 来达到以上目的并不是一个好主意，因为穿行在线缆上的流量并没有被加密，它们以明文方式在传送。 另外，在这篇文章中，我们也将复习如何配置网络服务来使得它在开机时被自动开启，并学习如何设置"><meta property="og:type" content="article"><meta property="og:url" content="/article-6266-1.html"><meta property="article:section" content="posts"><meta property="article:published_time" content="2015-09-23T08:01:00+00:00"><meta property="article:modified_time" content="2015-09-23T08:01:00+00:00"><meta itemprop=name content="RHCSA 系列（八）: 加固 SSH，设定主机名及启用网络服务"><meta itemprop=description content="作为一名系统管理员，你将经常使用一个终端模拟器来登录到一个远程的系统中，执行一系列的管理任务。你将很少有机会坐在一个真实的（物理）终端前，所以你需要设定好一种方法来使得你可以登录到你需要去管理的那台远程主机上。 事实上，当你必须坐在一台物理终端前的时候，就可能是你登录到该主机的最后一种方法了。基于安全原因，使用 Telnet 来达到以上目的并不是一个好主意，因为穿行在线缆上的流量并没有被加密，它们以明文方式在传送。 另外，在这篇文章中，我们也将复习如何配置网络服务来使得它在开机时被自动开启，并学习如何设置"><meta itemprop=datePublished content="2015-09-23T08:01:00+00:00"><meta itemprop=dateModified content="2015-09-23T08:01:00+00:00"><meta itemprop=wordCount content="332"><meta itemprop=keywords content="RHCSA,"><link rel=preconnect href=https://fonts.bunny.net crossorigin><link rel=dns-prefetch href=//fonts.bunny.net><link rel=dns-prefetch href=//fonts.bunny.net><link rel=stylesheet href="https://fonts.bunny.net/css?family=Open+Sans:400,400i,700"><link rel=stylesheet href=/css/style.css><link rel="shortcut icon" href=/favicon.ico></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class=logo><a class=logo__link href=/ title="Linux.cn Archive" rel=home><div class="logo__item logo__text"><div class=logo__title>Linux.cn Archive</div></div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>Menu</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/><span class=menu__text>Home</span></a></li><li class=menu__item><a class=menu__link href=/categories/><span class=menu__text>Categories</span></a></li><li class=menu__item><a class=menu__link href=/tags/><span class=menu__text>Tags</span></a></li><li class=menu__item><a class=menu__link href><span class=menu__text>RSS</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>RHCSA 系列（八）: 加固 SSH，设定主机名及启用网络服务</h1><div class="post__meta meta"><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class=meta__text datetime=2015-09-23T08:01:00Z>September 23, 2015</time></div></div></header><div class="content post__content clearfix"><p>作为一名系统管理员，你将经常使用一个终端模拟器来登录到一个远程的系统中，执行一系列的管理任务。你将很少有机会坐在一个真实的（物理）终端前，所以你需要设定好一种方法来使得你可以登录到你需要去管理的那台远程主机上。</p><p>事实上，当你必须坐在一台物理终端前的时候，就可能是你登录到该主机的最后一种方法了。基于安全原因，使用 Telnet 来达到以上目的并不是一个好主意，因为穿行在线缆上的流量并没有被加密，它们以明文方式在传送。</p><p>另外，在这篇文章中，我们也将复习如何配置网络服务来使得它在开机时被自动开启，并学习如何设置网络和静态或动态地解析主机名。</p><p><img src=/data/attachment/album/201509/22/080346ezw2hkarhhzjjhiy.png alt="RHCSA: 安全 SSH 和开启网络服务"></p><p><em>RHCSA: 安全 SSH 和开启网络服务 – Part 8</em></p><h3 id=安装并确保-ssh-通信安全>安装并确保 SSH 通信安全</h3><p>对于你来说，要能够使用 SSH 远程登录到一个 RHEL 7 机子，你必须安装 <code>openssh</code>，<code>openssh-clients</code> 和 <code>openssh-servers</code> 软件包。下面的命令不仅将安装远程登录程序，也会安装安全的文件传输工具以及远程文件复制程序：</p><pre tabindex=0><code># yum update &amp;&amp; yum install openssh openssh-clients openssh-servers
</code></pre><p>注意，也安装上服务器所需的相应软件包是一个不错的主意，因为或许在某个时刻，你想使用同一个机子来作为客户端和服务器。</p><p>在安装完成后，如若你想安全地访问你的 SSH 服务器，你还需要考虑一些基本的事情。下面的设定应该出现在文件 <code>/etc/ssh/sshd_config</code> 中。</p><p>1、 更改 sshd 守护进程的监听端口，从 22（默认的端口值）改为一个更高的端口值（2000 或更大），但首先要确保所选的端口没有被占用。</p><p>例如，让我们假设你选择了端口 2500 。使用 <a href=http://www.tecmint.com/20-netstat-commands-for-linux-network-management/>netstat</a> 来检查所选的端口是否被占用：</p><pre tabindex=0><code># netstat -npltu | grep 2500
</code></pre><p>假如 netstat 没有返回任何信息，则你可以安全地为 sshd 使用端口 2500，并且你应该在上面的配置文件中更改端口的设定，具体如下：</p><pre tabindex=0><code>Port 2500
</code></pre><p>2、 只允许协议 2（LCTT 译注：SSHv1 已经被证明不安全，默认情况下 SSHv1 和 SSHv2 都支持，所以应该显示去掉如下配置行的注释，并只支持 SSHv2。）：</p><pre tabindex=0><code>Protocol 2
</code></pre><p>3、 配置验证超时的时间为 2 分钟，不允许以 root 身份登录，并将允许通过 ssh 登录的人数限制到最小：</p><pre tabindex=0><code>LoginGraceTime 2m
PermitRootLogin no
AllowUsers gacanepa
</code></pre><p>4、 假如可能，使用基于公钥的验证方式而不是使用密码：</p><pre tabindex=0><code>PasswordAuthentication no
RSAAuthentication yes
PubkeyAuthentication yes
</code></pre><p>这假设了你已经在你的客户端机子上创建了带有你的用户名的一个密钥对，并将公钥复制到了你的服务器上。</p><ul><li><a href=/article-5444-1.html>开启 SSH 无密码登录</a></li></ul><h3 id=配置网络和名称的解析>配置网络和名称的解析</h3><p>1、 每个系统管理员都应该对下面这个系统配置文件非常熟悉：</p><ul><li>/etc/hosts 被用来在小型网络中解析“名称” &lt;&mdash;> “IP 地址”。</li></ul><p>文件 <code>/etc/hosts</code> 中的每一行拥有如下的结构：</p><pre tabindex=0><code>IP address - Hostname - FQDN
</code></pre><p>例如，</p><pre tabindex=0><code>192.168.0.10    laptop  laptop.gabrielcanepa.com.ar
</code></pre><p>2、 <code>/etc/resolv.conf</code> 特别指定 DNS 服务器的 IP 地址和搜索域，它被用来在没有提供域名后缀时，将一个给定的查询名称对应为一个全称域名。</p><p>在正常情况下，你不必编辑这个文件，因为它是由系统管理的。然而，若你非要改变 DNS 服务器的 IP 地址，建议你在该文件的每一行中，都应该遵循下面的结构：</p><pre tabindex=0><code>nameserver - IP address
</code></pre><p>例如，</p><pre tabindex=0><code>nameserver 8.8.8.8
</code></pre><p>3、 <code>/etc/host.conf</code> 特别指定在一个网络中主机名被解析的方法和顺序。换句话说，告诉名称解析器使用哪个服务，并以什么顺序来使用。</p><p>尽管这个文件由几个选项，但最为常见和基本的设置包含如下的一行：</p><pre tabindex=0><code>order bind,hosts
</code></pre><p>它意味着解析器应该首先查看 <code>resolv.conf</code> 中特别指定的域名服务器，然后到 <code>/etc/hosts</code> 文件中查找解析的名称。</p><p>4、 <code>/etc/sysconfig/network</code> 包含了所有网络接口的路由和全局主机信息。下面的值可能会被使用：</p><pre tabindex=0><code>NETWORKING=yes|no
HOSTNAME=value
</code></pre><p>其中的 value 应该是 全称域名 （ FQDN ） 。</p><pre tabindex=0><code>GATEWAY=XXX.XXX.XXX.XXX
</code></pre><p>其中的 XXX.XXX.XXX.XXX 是网关的 IP 地址。</p><pre tabindex=0><code>GATEWAYDEV=value
</code></pre><p>在一个带有多个网卡的机器中， value 为网关设备名，例如 enp0s3。</p><p>5、 位于 <code>/etc/sysconfig/network-scripts</code> 中的文件（网络适配器配置文件）。</p><p>在上面提到的目录中，你将找到几个被命名为如下格式的文本文件。</p><pre tabindex=0><code>ifcfg-name
</code></pre><p>其中 name 为网卡的名称，由 <code>ip link show</code> 返回：</p><p><img src=/data/attachment/album/201509/22/080346rfzgjv0agcp7zops.png alt=检查网络连接状态></p><p><em>检查网络连接状态</em></p><p>例如：</p><p><img src=/data/attachment/album/201509/22/080347r999lwl995sq66rs.png alt=网络文件></p><p><em>网络文件</em></p><p>除了环回接口（loopback），你还可以为你的网卡指定相似的配置。注意，假如设定了某些变量，它们将为这个指定的接口覆盖掉 <code>/etc/sysconfig/network</code> 中定义的默认值。在这篇文章中，为了能够解释清楚，每行都被加上了注释，但在实际的文件中，你应该避免加上注释：</p><pre tabindex=0><code>HWADDR=08:00:27:4E:59:37 ### 网卡的 MAC 地址
TYPE=Ethernet ### 连接类型
BOOTPROTO=static ### 这代表着该网卡指定了一个静态地址。
                      ### 如果这个值指定为 dhcp，这个网卡会从 DHCP 服务器获取 IP 地址，并且就不应该出现以下两行。
IPADDR=192.168.0.18
NETMASK=255.255.255.0
GATEWAY=192.168.0.1
NM_CONTROLLED=no ### 应该给以太网卡设置，以便可以让 NetworkManager 可以修改这个文件。
NAME=enp0s3
UUID=14033805-98ef-4049-bc7b-d4bea76ed2eb
ONBOOT=yes ### 操作系统会在启动时打开这个网卡。
</code></pre><h3 id=设定主机名>设定主机名</h3><p>在 RHEL 7 中， <code>hostnamectl</code> 命令被同时用来查询和设定系统的主机名。</p><p>要展示当前的主机名，输入：</p><pre tabindex=0><code># hostnamectl status
</code></pre><p><img src=/data/attachment/album/201509/22/080347d62jszxfwuff9wuu.png alt="在RHEL 7 中检查系统的主机名"></p><p><em>检查系统的主机名</em></p><p>要更改主机名，使用</p><pre tabindex=0><code># hostnamectl set-hostname [new hostname]
</code></pre><p>例如，</p><pre tabindex=0><code># hostnamectl set-hostname cinderella
</code></pre><p>要想使得更改生效，你需要重启 hostnamed 守护进程（这样你就不必因为要应用更改而登出并再登录系统）：</p><pre tabindex=0><code># systemctl restart systemd-hostnamed
</code></pre><p><img src=/data/attachment/album/201509/22/080347d9at1m3phlt6mr9r.png alt="在 RHEL7 中设定系统主机名"></p><p><em>设定系统主机名</em></p><p>另外， RHEL 7 还包含 <code>nmcli</code> 工具，它可被用来达到相同的目的。要展示主机名，运行：</p><pre tabindex=0><code># nmcli general hostname
</code></pre><p>且要改变主机名，则运行：</p><pre tabindex=0><code># nmcli general hostname [new hostname]
</code></pre><p>例如，</p><pre tabindex=0><code># nmcli general hostname rhel7
</code></pre><p><img src=/data/attachment/album/201509/22/080348ebm5oimpp5gih0uh.png alt="使用 nmcli 命令来设定主机名"></p><p><em>使用 nmcli 命令来设定主机名</em></p><h3 id=在开机时开启网络服务>在开机时开启网络服务</h3><p>作为本文的最后部分，就让我们看看如何确保网络服务在开机时被自动开启。简单来说，这个可通过创建符号链接到某些由服务的配置文件中的 <code>[Install]</code> 小节中指定的文件来实现。</p><p>以 firewalld（/usr/lib/systemd/system/firewalld.service） 为例：</p><pre tabindex=0><code>[Install]
WantedBy=basic.target
Alias=dbus-org.fedoraproject.FirewallD1.service
</code></pre><p>要开启该服务，运行：</p><pre tabindex=0><code># systemctl enable firewalld
</code></pre><p>另一方面，要禁用 firewalld，则需要移除符号链接：</p><pre tabindex=0><code># systemctl disable firewalld
</code></pre><p><img src=/data/attachment/album/201509/22/080348uddj1188qji01qfd.png alt=在开机时开启服务></p><p><em>在开机时开启服务</em></p><h3 id=总结>总结</h3><p>在这篇文章中，我们总结了如何安装 SSH 及使用它安全地连接到一个 RHEL 服务器；如何改变主机名，并在最后如何确保在系统启动时开启服务。假如你注意到某个服务启动失败，你可以使用 <code>systemctl status -l [service]</code> 和 <code>journalctl -xn</code> 来进行排错。</p><p>请随意使用下面的评论框来让我们知晓你对本文的看法。提问也同样欢迎。我们期待着你的反馈！</p><hr><p>via: <a href=http://www.tecmint.com/rhcsa-series-secure-ssh-set-hostname-enable-network-services-in-rhel-7/>http://www.tecmint.com/rhcsa-series-secure-ssh-set-hostname-enable-network-services-in-rhel-7/</a></p><p>作者：<a href=http://www.tecmint.com/author/gacanepa/>Gabriel Cánepa</a> 译者：<a href=https://github.com/FSSlc>FSSlc</a> 校对：<a href=https://github.com/wxy>wxy</a></p><p>本文由 <a href=https://github.com/LCTT/TranslateProject>LCTT</a> 原创翻译，<a href=https://linux.cn/>Linux中国</a> 荣誉推出</p></div><footer class=post__footer><div class="post__tags tags clearfix"><svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5.0 11V3C0 1.5.8.8.8.8S1.5.0 3 0h8c1.5.0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 100-6 3 3 0 000 6z"/></svg><ul class=tags__list><li class=tags__item><a class="tags__link btn" href=/tags/rhcsa/ rel=tag>RHCSA</a></li></ul></div></footer></article></main></div></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2025 Linux.cn Archive.
<span class=footer__copyright-credits>Generated with <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> and <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a> theme.</span></div></div></footer></div><script async defer src=/js/menu.js></script></body></html>