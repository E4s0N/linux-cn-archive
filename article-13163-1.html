<!doctype html><html class=no-js lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Ansible 点对点命令快速入门指南示例 - Linux.cn Archive</title>
<script>(function(e,t){e[t]=e[t].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content><meta property="og:title" content="Ansible 点对点命令快速入门指南示例"><meta property="og:description" content="点对点命令用于在一个或多个受控节点上自动执行任务。它非常简单，但是不可重用。"><meta property="og:type" content="article"><meta property="og:url" content="/article-13163-1.html"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-02-28T22:16:00+00:00"><meta property="article:modified_time" content="2021-02-28T22:16:00+00:00"><meta itemprop=name content="Ansible 点对点命令快速入门指南示例"><meta itemprop=description content="点对点命令用于在一个或多个受控节点上自动执行任务。它非常简单，但是不可重用。"><meta itemprop=datePublished content="2021-02-28T22:16:00+00:00"><meta itemprop=dateModified content="2021-02-28T22:16:00+00:00"><meta itemprop=wordCount content="702"><meta itemprop=keywords content="Ansible,"><link rel=preconnect href=https://fonts.bunny.net crossorigin><link rel=dns-prefetch href=//fonts.bunny.net><link rel=dns-prefetch href=//fonts.bunny.net><link rel=stylesheet href="https://fonts.bunny.net/css?family=Open+Sans:400,400i,700"><link rel=stylesheet href=/css/style.css><link rel="shortcut icon" href=/favicon.ico></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class=logo><a class=logo__link href=/ title="Linux.cn Archive" rel=home><div class="logo__item logo__text"><div class=logo__title>Linux.cn Archive</div></div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>Menu</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/><span class=menu__text>Home</span></a></li><li class=menu__item><a class=menu__link href=/categories/><span class=menu__text>Categories</span></a></li><li class=menu__item><a class=menu__link href=/tags/><span class=menu__text>Tags</span></a></li><li class=menu__item><a class=menu__link href><span class=menu__text>RSS</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>Ansible 点对点命令快速入门指南示例</h1><div class="post__meta meta"><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class=meta__text datetime=2021-02-28T22:16:00Z>February 28, 2021</time></div></div></header><div class="content post__content clearfix"><p><img src=https://img.linux.net.cn/data/attachment/album/202102/28/221449b8ldh7v4ll8dw774.jpg alt></p><p>之前，我们写了一篇有关 <a href=/article-13142-1.html>Ansible 安装和配置</a> 的文章。在那个教程中只包含了一些使用方法的示例。如果你是 Ansible 新手，建议你阅读上篇文章。一旦你熟悉了，就可以继续阅读本文了。</p><p>默认情况下，Ansible 仅使用 5 个并行进程。如果要在多个主机上执行任务，需要通过添加 <code>-f [进程数]</code> 选项来手动设置进程数。</p><h3 id=什么是ruby-点对点-rt--ad-hoc-rtruby命令>什么是 点对点 ad-hoc 命令？</h3><p>点对点命令用于在一个或多个受控节点上自动执行任务。它非常简单，但是不可重用。它使用 <code>/usr/bin/ansible</code> 二进制文件执行所有操作。</p><p>点对点命令最适合运行一次的任务。例如，如果要检查指定用户是否可用，你可以使用一行命令而无需编写剧本。</p><h4 id=为什么你要了解点对点命令>为什么你要了解点对点命令？</h4><p>点对点命令证明了 Ansible 的简单性和强大功能。从 2.9 版本开始，它支持 3389 个模块，因此你需要了解和学习要定期使用的 Ansible 模块列表。</p><p>如果你是一个 Ansible 新手，可以借助点对点命令轻松地练习这些模块及参数。</p><p>你在这里学习到的概念将直接移植到剧本中。</p><p><strong>点对点命令的一般语法：</strong></p><pre tabindex=0><code>ansible [模式] -m [模块] -a &#34;[模块选项]&#34;
</code></pre><p>点对点命令包含四个部分，详细信息如下：</p><table><thead><tr><th>部分</th><th>描述</th></tr></thead><tbody><tr><td><code>ansible</code></td><td>命令</td></tr><tr><td>模式</td><td>输入清单或指定组</td></tr><tr><td>模块</td><td>运行指定的模块名称</td></tr><tr><td>模块选项</td><td>指定模块参数</td></tr></tbody></table><h4 id=如何使用-ansible-清单文件>如何使用 Ansible 清单文件</h4><p>如果使用 Ansible 的默认清单文件 <code>/etc/ansible/hosts</code>，你可以直接调用它。否则你可以使用 <code>-i</code> 选项指定 Ansible 清单文件的路径。</p><h4 id=什么是模式以及如何使用它>什么是模式以及如何使用它？</h4><p>Ansible 模式可以代指某个主机、IP 地址、清单组、一组主机或者清单中的所有主机。它允许你对它们运行命令和剧本。模式非常灵活，你可以根据需要使用它们。</p><p>例如，你可以排除主机、使用通配符或正则表达式等等。</p><p>下表描述了常见的模式以及用法。但是，如果它不能满足你的需求，你可以在 <code>ansible-playbook</code> 中使用带有 <code>-e</code> 参数的模式中的变量。</p><table><thead><tr><th>描述</th><th>模式</th><th>目标</th></tr></thead><tbody><tr><td>所有主机</td><td><code>all</code>（或 <code>*</code>）</td><td>对清单中的所有服务器运行 Ansible</td></tr><tr><td>一台主机</td><td><code>host1</code></td><td>只针对给定主机运行 Ansible</td></tr><tr><td>多台主机</td><td><code>host1:host2</code>（或 <code>host1,host2</code>）</td><td>对上述多台主机运行 Ansible</td></tr><tr><td>一组</td><td><code>webservers</code></td><td>在 <code>webservers</code> 群组中运行 Ansible</td></tr><tr><td>多组</td><td><code>webservers:dbservers</code></td><td><code>webservers</code> 中的所有主机加上 <code>dbservers</code> 中的所有主机</td></tr><tr><td>排除组</td><td><code>webservers:!atlanta</code></td><td><code>webservers</code> 中除 <code>atlanta</code> 以外的所有主机</td></tr><tr><td>组之间的交集</td><td><code>webservers:&amp;staging</code></td><td><code>webservers</code> 中也在 <code>staging</code> 的任何主机</td></tr></tbody></table><h4 id=什么是-ansible-模块它干了什么>什么是 Ansible 模块，它干了什么？</h4><p>模块，也称为“任务插件”或“库插件”，它是一组代码单元，可以直接或通过剧本在远程主机上执行指定任务。</p><p>Ansible 在远程目标节点上执行指定模块并收集其返回值。</p><p>每个模块都支持多个参数，可以满足用户的需求。除少数模块外，几乎所有模块都采用 <code>key=value</code> 参数。你可以一次添加带有空格的多个参数，而 <code>command</code> 或 <code>shell</code> 模块会直接运行你输入的字符串。</p><p>我们将添加一个包含最常用的“模块选项”参数的表。</p><p>列出所有可用的模块，运行以下命令：</p><pre tabindex=0><code>$ ansible-doc -l
</code></pre><p>运行以下命令来阅读指定模块的文档：</p><pre tabindex=0><code>$ ansible-doc [模块]
</code></pre><h3 id=1如何在-linux-上使用-ansible-列出目录的内容>1）如何在 Linux 上使用 Ansible 列出目录的内容</h3><p>可以使用 Ansible <code>command</code> 模块来完成这项操作，如下所示。我们列出了 <code>node1.2g.lab</code> 和 <code>nod2.2g.lab</code>* 远程服务器上 <code>daygeek</code> 用户主目录的内容。</p><pre tabindex=0><code>$ ansible web -m command -a &#34;ls -lh /home/daygeek&#34;

node1.2g.lab | CHANGED | rc=0 &gt;&gt;
total 12K
drwxr-xr-x. 2 daygeek daygeek   6 Feb 15  2019 Desktop
drwxr-xr-x. 2 daygeek daygeek   6 Feb 15  2019 Documents
drwxr-xr-x. 2 daygeek daygeek   6 Feb 15  2019 Downloads
drwxr-xr-x. 2 daygeek daygeek   6 Feb 15  2019 Music
-rwxr-xr-x. 1 daygeek daygeek 159 Mar  4  2019 passwd-up.sh
drwxr-xr-x. 2 daygeek daygeek   6 Feb 15  2019 Pictures
drwxr-xr-x. 2 daygeek daygeek   6 Feb 15  2019 Public
drwxr-xr-x. 2 daygeek daygeek   6 Feb 15  2019 Templates
-rwxrwxr-x. 1 daygeek daygeek 138 Mar 10  2019 user-add.sh
-rw-rw-r--. 1 daygeek daygeek  18 Mar 10  2019 user-list1.txt
drwxr-xr-x. 2 daygeek daygeek   6 Feb 15  2019 Videos

node2.2g.lab | CHANGED | rc=0 &gt;&gt;
total 0
drwxr-xr-x. 2 daygeek daygeek 6 Nov  9 09:55 Desktop
drwxr-xr-x. 2 daygeek daygeek 6 Nov  9 09:55 Documents
drwxr-xr-x. 2 daygeek daygeek 6 Nov  9 09:55 Downloads
drwxr-xr-x. 2 daygeek daygeek 6 Nov  9 09:55 Music
drwxr-xr-x. 2 daygeek daygeek 6 Nov  9 09:55 Pictures
drwxr-xr-x. 2 daygeek daygeek 6 Nov  9 09:55 Public
drwxr-xr-x. 2 daygeek daygeek 6 Nov  9 09:55 Templates
drwxr-xr-x. 2 daygeek daygeek 6 Nov  9 09:55 Videos
</code></pre><h3 id=2如何在-linux-使用-ansible-管理文件>2）如何在 Linux 使用 Ansible 管理文件</h3><p>Ansible 的 <code>copy</code> 模块将文件从本地系统复制到远程系统。使用 Ansible <code>command</code> 模块将文件移动或复制到远程计算机。</p><pre tabindex=0><code>$ ansible web -m copy -a &#34;src=/home/daygeek/backup/CentOS7.2daygeek.com-20191025.tar dest=/home/u1&#34; --become

node1.2g.lab | CHANGED =&gt; {
    &#34;ansible_facts&#34;: {
        &#34;discovered_interpreter_python&#34;: &#34;/usr/bin/python&#34;
    },
    &#34;changed&#34;: true,
    &#34;checksum&#34;: &#34;ad8aadc0542028676b5fe34c94347829f0485a8c&#34;,
    &#34;dest&#34;: &#34;/home/u1/CentOS7.2daygeek.com-20191025.tar&#34;,
    &#34;gid&#34;: 0,
    &#34;group&#34;: &#34;root&#34;,
    &#34;md5sum&#34;: &#34;ee8e778646e00456a4cedd5fd6458cf5&#34;,
    &#34;mode&#34;: &#34;0644&#34;,
    &#34;owner&#34;: &#34;root&#34;,
    &#34;secontext&#34;: &#34;unconfined_u:object_r:user_home_t:s0&#34;,
    &#34;size&#34;: 30720,
    &#34;src&#34;: &#34;/home/daygeek/.ansible/tmp/ansible-tmp-1579726582.474042-118186643704900/source&#34;,
    &#34;state&#34;: &#34;file&#34;,
    &#34;uid&#34;: 0
}

node2.2g.lab | CHANGED =&gt; {
    &#34;ansible_facts&#34;: {
        &#34;discovered_interpreter_python&#34;: &#34;/usr/libexec/platform-python&#34;
    },
    &#34;changed&#34;: true,
    &#34;checksum&#34;: &#34;ad8aadc0542028676b5fe34c94347829f0485a8c&#34;,
    &#34;dest&#34;: &#34;/home/u1/CentOS7.2daygeek.com-20191025.tar&#34;,
    &#34;gid&#34;: 0,
    &#34;group&#34;: &#34;root&#34;,
    &#34;md5sum&#34;: &#34;ee8e778646e00456a4cedd5fd6458cf5&#34;,
    &#34;mode&#34;: &#34;0644&#34;,
    &#34;owner&#34;: &#34;root&#34;,
    &#34;secontext&#34;: &#34;unconfined_u:object_r:user_home_t:s0&#34;,
    &#34;size&#34;: 30720,
    &#34;src&#34;: &#34;/home/daygeek/.ansible/tmp/ansible-tmp-1579726582.4793239-237229399335623/source&#34;,
    &#34;state&#34;: &#34;file&#34;,
    &#34;uid&#34;: 0
}
</code></pre><p>我们可以运行以下命令进行验证：</p><pre tabindex=0><code>$ ansible web -m command -a &#34;ls -lh /home/u1&#34; --become

node1.2g.lab | CHANGED | rc=0 &gt;&gt;
total 36K
-rw-r--r--. 1 root root 30K Jan 22 14:56 CentOS7.2daygeek.com-20191025.tar
-rw-r--r--. 1 root root  25 Dec  9 03:31 user-add.sh

node2.2g.lab | CHANGED | rc=0 &gt;&gt;
total 36K
-rw-r--r--. 1 root root 30K Jan 23 02:26 CentOS7.2daygeek.com-20191025.tar
-rw-rw-r--. 1 u1   u1    18 Jan 23 02:21 magi.txt
</code></pre><p>要将文件从一个位置复制到远程计算机上的另一个位置，使用以下命令：</p><pre tabindex=0><code>$ ansible web -m command -a &#34;cp /home/u2/magi/ansible-1.txt /home/u2/magi/2g&#34; --become
</code></pre><p>移动文件，使用以下命令：</p><pre tabindex=0><code>$ ansible web -m command -a &#34;mv /home/u2/magi/ansible.txt /home/u2/magi/2g&#34; --become
</code></pre><p>在 <code>u1</code> 用户目录下创建一个名为 <code>ansible.txt</code> 的新文件，运行以下命令：</p><pre tabindex=0><code>$ ansible web -m file -a &#34;dest=/home/u1/ansible.txt owner=u1 group=u1 state=touch&#34; --become
</code></pre><p>在 <code>u1</code> 用户目录下创建一个名为 <code>magi</code> 的新目录，运行以下命令：</p><pre tabindex=0><code>$ ansible web -m file -a &#34;dest=/home/u1/magi mode=755 owner=u2 group=u2 state=directory&#34; --become
</code></pre><p>将 <code>u1</code> 用户目录下的 <code>ansible.txt</code>* 文件权限更改为 <code>777</code>，运行以下命令：</p><pre tabindex=0><code>$ ansible web -m file -a &#34;dest=/home/u1/ansible.txt mode=777&#34; --become
</code></pre><p>删除 <code>u1</code> 用户目录下的 <code>ansible.txt</code> 文件，运行以下命令：</p><pre tabindex=0><code>$ ansible web -m file -a &#34;dest=/home/u2/magi/ansible-1.txt state=absent&#34; --become
</code></pre><p>使用以下命令删除目录，它将递归删除指定目录：</p><pre tabindex=0><code>$ ansible web -m file -a &#34;dest=/home/u2/magi/2g state=absent&#34; --become
</code></pre><h3 id=3用户管理>3）用户管理</h3><p>你可以使用 Ansible 轻松执行用户管理活动。例如创建、删除用户以及向一个组添加用户。</p><pre tabindex=0><code>$ ansible all -m user -a &#34;name=foo password=[crypted password here]&#34;
</code></pre><p>运行以下命令删除用户：</p><pre tabindex=0><code>$ ansible all -m user -a &#34;name=foo state=absent&#34;
</code></pre><h3 id=4管理包>4）管理包</h3><p>使用合适的 Ansible 包管理器模块可以轻松地管理安装包。例如，我们将使用 <code>yum</code> 模块来管理 CentOS 系统上的软件包。</p><p>安装最新的 Apache（httpd）：</p><pre tabindex=0><code>$ ansible web -m yum -a &#34;name=httpd state=latest&#34;
</code></pre><p>卸载 Apache（httpd） 包：</p><pre tabindex=0><code>$ ansible web -m yum -a &#34;name=httpd state=absent&#34;
</code></pre><h3 id=5管理服务>5）管理服务</h3><p>使用以下 Ansible 模块命令可以在 Linux 上管理任何服务。</p><p>停止 httpd 服务：</p><pre tabindex=0><code>$ ansible web -m service -a &#34;name=httpd state=stopped&#34;
</code></pre><p>启动 httpd 服务：</p><pre tabindex=0><code>$ ansible web -m service -a &#34;name=httpd state=started&#34;
</code></pre><p>重启 httpd 服务：</p><pre tabindex=0><code>$ ansible web -m service -a &#34;name=httpd state=restarted&#34;
</code></pre><hr><p>via: <a href=https://www.2daygeek.com/ansible-ad-hoc-command-quick-start-guide-with-examples/>https://www.2daygeek.com/ansible-ad-hoc-command-quick-start-guide-with-examples/</a></p><p>作者：<a href=https://www.2daygeek.com/author/magesh/>Magesh Maruthamuthu</a> 选题：<a href=https://github.com/lujun9972>lujun9972</a> 译者：<a href=https://github.com/MjSeven>MjSeven</a> 校对：<a href=https://github.com/wxy>wxy</a></p><p>本文由 <a href=https://github.com/LCTT/TranslateProject>LCTT</a> 原创编译，<a href=https://linux.cn/>Linux中国</a> 荣誉推出</p></div><footer class=post__footer><div class="post__tags tags clearfix"><svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5.0 11V3C0 1.5.8.8.8.8S1.5.0 3 0h8c1.5.0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 100-6 3 3 0 000 6z"/></svg><ul class=tags__list><li class=tags__item><a class="tags__link btn" href=/tags/ansible/ rel=tag>Ansible</a></li></ul></div></footer></article></main></div></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2025 Linux.cn Archive.
<span class=footer__copyright-credits>Generated with <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> and <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a> theme.</span></div></div></footer></div><script async defer src=/js/menu.js></script></body></html>