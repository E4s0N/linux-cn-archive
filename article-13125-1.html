<!doctype html><html class=no-js lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>用 Podman Compose 管理容器 - Linux.cn Archive</title>
<script>(function(e,t){e[t]=e[t].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content><meta property="og:title" content="用 Podman Compose 管理容器"><meta property="og:description" content="Docker 的一个缺点是它有一个中央守护进程，它以 root 用户的身份运行，这对安全有影响。但这正是 Podman 的用武之地。"><meta property="og:type" content="article"><meta property="og:url" content="/article-13125-1.html"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-02-16T22:21:41+00:00"><meta property="article:modified_time" content="2021-02-16T22:21:41+00:00"><meta itemprop=name content="用 Podman Compose 管理容器"><meta itemprop=description content="Docker 的一个缺点是它有一个中央守护进程，它以 root 用户的身份运行，这对安全有影响。但这正是 Podman 的用武之地。"><meta itemprop=datePublished content="2021-02-16T22:21:41+00:00"><meta itemprop=dateModified content="2021-02-16T22:21:41+00:00"><meta itemprop=wordCount content="344"><meta itemprop=keywords content="Podman,容器,"><link rel=preconnect href=https://fonts.bunny.net crossorigin><link rel=dns-prefetch href=//fonts.bunny.net><link rel=dns-prefetch href=//fonts.bunny.net><link rel=stylesheet href="https://fonts.bunny.net/css?family=Open+Sans:400,400i,700"><link rel=stylesheet href=/css/style.css><link rel="shortcut icon" href=/favicon.ico></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class=logo><a class=logo__link href=/ title="Linux.cn Archive" rel=home><div class="logo__item logo__text"><div class=logo__title>Linux.cn Archive</div></div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>Menu</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/><span class=menu__text>Home</span></a></li><li class=menu__item><a class=menu__link href=/categories/><span class=menu__text>Categories</span></a></li><li class=menu__item><a class=menu__link href=/tags/><span class=menu__text>Tags</span></a></li><li class=menu__item><a class=menu__link href><span class=menu__text>RSS</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>用 Podman Compose 管理容器</h1><div class="post__meta meta"><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class=meta__text datetime=2021-02-16T22:21:41Z>February 16, 2021</time></div></div></header><div class="content post__content clearfix"><p><img src=https://img.linux.net.cn/data/attachment/album/202102/16/222143wch1jx781x4ec47w.jpg alt></p><p>容器很棒，让你可以将你的应用连同其依赖项一起打包，并在任何地方运行。从 2013 年的 Docker 开始，容器已经让软件开发者的生活变得更加轻松。</p><p>Docker 的一个缺点是它有一个中央守护进程，它以 root 用户的身份运行，这对安全有影响。但这正是 Podman 的用武之地。Podman 是一个 <a href=https://podman.io>无守护进程容器引擎</a>，用于开发、管理和在你的 Linux 系统上以 root 或无 root 模式运行 OCI 容器。</p><p>下面这些文章可以用来了解更多关于 Podman 的信息：</p><ul><li><a href=/article-10156-1.html>使用 Podman 以非 root 用户身份运行 Linux 容器</a></li><li><a href=https://fedoramagazine.org/podman-pods-fedora-containers/>在 Fedora 上使用 Podman 的 Pod</a></li><li><a href=/article-12859-1.html>在 Fedora 中结合权能使用 Podman</a></li></ul><p>如果你使用过 Docker，你很可能也知道 Docker Compose，它是一个用于编排多个可能相互依赖的容器的工具。要了解更多关于 Docker Compose 的信息，请看它的<a href=https://docs.docker.com/compose/>文档</a>。</p><h3 id=什么是-podman-compose>什么是 Podman Compose？</h3><p><a href=https://github.com/containers/podman-compose>Podman Compose</a> 项目的目标是作为 Docker Compose 的替代品，而不需要对 docker-compose.yaml 文件进行任何修改。由于 Podman Compose 使用 吊舱 pod 工作，所以最好看下“吊舱”的最新定义。</p><blockquote><p>一个“ 吊舱 pod ”（如一群鲸鱼或豌豆荚）是由一个或多个<a href=https://kubernetes.io/docs/concepts/containers/>容器</a>组成的组，具有共享的存储/网络资源，以及如何运行容器的规范。</p><p><a href=https://kubernetes.io/docs/concepts/workloads/pods/>Pods - Kubernetes 文档</a></p></blockquote><p>（LCTT 译注：容器技术领域大量使用了航海比喻，pod 一词，意为“豆荚”，在航海领域指“吊舱” —— 均指盛装多个物品的容器。常不翻译，考虑前后文，可译做“吊舱”。）</p><p>Podman Compose 的基本思想是，它选中 <code>docker-compose.yaml</code> 文件里面定义的服务，为每个服务创建一个容器。Docker Compose 和 Podman Compose 的一个主要区别是，Podman Compose 将整个项目的容器添加到一个单一的吊舱中，而且所有的容器共享同一个网络。如你在例子中看到的，在创建容器时使用 <code>--add-host</code> 标志，它甚至用和 Docker Compose 一样的方式命名容器。</p><h3 id=安装>安装</h3><p>Podman Compose 的完整安装说明可以在<a href=https://github.com/containers/podman-compose>项目页面</a>上找到，它有几种方法。要安装最新的开发版本，使用以下命令：</p><pre tabindex=0><code>pip3 install https://github.com/containers/podman-compose/archive/devel.tar.gz
</code></pre><p>确保你也安装了 <a href=https://podman.io/getting-started/installation>Podman</a>，因为你也需要它。在 Fedora 上，使用下面的命令来安装Podman：</p><pre tabindex=0><code>sudo dnf install podman
</code></pre><h3 id=例子用-podman-compose-启动一个-wordpress-网站>例子：用 Podman Compose 启动一个 WordPress 网站</h3><p>想象一下，你的 <code>docker-compose.yaml</code> 文件在一个叫 <code>wpsite</code> 的文件夹里。一个典型的 WordPress 网站的 <code>docker-compose.yaml</code> （或 <code>docker-compose.yml</code>） 文件是这样的：</p><pre tabindex=0><code>version: &#34;3.8&#34;
services:
  web:
    image: wordpress
    restart: always
    volumes:
      - wordpress:/var/www/html
    ports:
      - 8080:80
    environment:
      WORDPRESS_DB_HOST: db
      WORDPRESS_DB_USER: magazine
      WORDPRESS_DB_NAME: magazine
      WORDPRESS_DB_PASSWORD: 1maGazine!
      WORDPRESS_TABLE_PREFIX: cz
      WORDPRESS_DEBUG: 0
    depends_on:
      - db
    networks:
      - wpnet
  db:
    image: mariadb:10.5
    restart: always
    ports:
      - 6603:3306

    volumes:
      - wpdbvol:/var/lib/mysql

    environment:
      MYSQL_DATABASE: magazine
      MYSQL_USER: magazine
      MYSQL_PASSWORD: 1maGazine!
      MYSQL_ROOT_PASSWORD: 1maGazine!
    networks:
      - wpnet
volumes:
  wordpress: {}
  wpdbvol: {}

networks:
  wpnet: {}
</code></pre><p>如果你用过 Docker，你就会知道你可运行 <code>docker-compose up</code> 来启动这些服务。Docker Compose 会创建两个名为 <code>wpsite_web_1</code> 和 <code>wpsite_db_1</code> 的容器，并将它们连接到一个名为 <code>wpsite_wpnet</code> 的网络。</p><p>现在，看看当你在项目目录下运行 <code>podman-compose up</code> 时会发生什么。首先，一个以执行命令的目录命名的吊舱被创建。接下来，它寻找 YAML 文件中定义的任何名称的卷，如果它们不存在，就创建卷。然后，在 YAML 文件的 <code>services</code> 部分列出的每个服务都会创建一个容器，并添加到吊舱中。</p><p>容器的命名与 Docker Compose 类似。例如，为你的 web 服务创建一个名为 <code>wpsite_web_1</code> 的容器。Podman Compose 还为每个命名的容器添加了 <code>localhost</code> 别名。之后，容器仍然可以通过名字互相解析，尽管它们并不像 Docker 那样在一个桥接网络上。要做到这一点，使用选项 <code>-add-host</code>。例如，<code>-add-host web:localhost</code>。</p><p>请注意，<code>docker-compose.yaml</code> 包含了一个从主机 8080 端口到容器 80 端口的 Web 服务的端口转发。现在你应该可以通过浏览器访问新 WordPress 实例，地址为 <code>http://localhost:8080</code>。</p><p><img src=https://img.linux.net.cn/data/attachment/album/202102/16/222143atcbb6hh8e77h7cl.png alt="WordPress Dashboard"></p><h3 id=控制-pod-和容器>控制 pod 和容器</h3><p>要查看正在运行的容器，使用 <code>podman ps</code>，它可以显示 web 和数据库容器以及吊舱中的基础设施容器。</p><pre tabindex=0><code>CONTAINER ID  IMAGE                               COMMAND               CREATED      STATUS          PORTS                                         NAMES
a364a8d7cec7  docker.io/library/wordpress:latest  apache2-foregroun...  2 hours ago  Up 2 hours ago  0.0.0.0:8080-&amp;amp;gt;80/tcp, 0.0.0.0:6603-&amp;amp;gt;3306/tcp  wpsite_web_1
c447024aa104  docker.io/library/mariadb:10.5      mysqld                2 hours ago  Up 2 hours ago  0.0.0.0:8080-&amp;amp;gt;80/tcp, 0.0.0.0:6603-&amp;amp;gt;3306/tcp  wpsite_db_1
12b1e3418e3e  k8s.gcr.io/pause:3.2
</code></pre><p>你也可以验证 Podman 已经为这个项目创建了一个吊舱，以你执行命令的文件夹命名。</p><pre tabindex=0><code>POD ID        NAME             STATUS    CREATED      INFRA ID      # OF CONTAINERS
8a08a3a7773e  wpsite           Degraded  2 hours ago  12b1e3418e3e  3
</code></pre><p>要停止容器，在另一个命令窗口中输入以下命令：</p><pre tabindex=0><code>podman-compose down
</code></pre><p>你也可以通过停止和删除吊舱来实现。这实质上是停止并移除所有的容器，然后再删除包含的吊舱。所以，同样的事情也可以通过这些命令来实现：</p><pre tabindex=0><code>podman pod stop podname
podman pod rm podname
</code></pre><p>请注意，这不会删除你在 <code>docker-compose.yaml</code> 中定义的卷。所以，你的 WordPress 网站的状态被保存下来了，你可以通过运行这个命令来恢复它。</p><pre tabindex=0><code>podman-compose up
</code></pre><p>总之，如果你是一个 Podman 粉丝，并且用 Podman 做容器工作，你可以使用 Podman Compose 来管理你的开发和生产中的容器。</p><hr><p>via: <a href=https://fedoramagazine.org/manage-containers-with-podman-compose/>https://fedoramagazine.org/manage-containers-with-podman-compose/</a></p><p>作者：<a href=https://fedoramagazine.org/author/powergame/>Mehdi Haghgoo</a> 选题：<a href=https://github.com/lujun9972>lujun9972</a> 译者：<a href=https://github.com/geekpi>geekpi</a> 校对：<a href=https://github.com/wxy>wxy</a></p><p>本文由 <a href=https://github.com/LCTT/TranslateProject>LCTT</a> 原创编译，<a href=https://linux.cn/>Linux中国</a> 荣誉推出</p></div><footer class=post__footer><div class="post__tags tags clearfix"><svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5.0 11V3C0 1.5.8.8.8.8S1.5.0 3 0h8c1.5.0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 100-6 3 3 0 000 6z"/></svg><ul class=tags__list><li class=tags__item><a class="tags__link btn" href=/tags/podman/ rel=tag>Podman</a></li><li class=tags__item><a class="tags__link btn" href=/tags/%E5%AE%B9%E5%99%A8/ rel=tag>容器</a></li></ul></div></footer></article></main></div></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2025 Linux.cn Archive.
<span class=footer__copyright-credits>Generated with <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> and <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a> theme.</span></div></div></footer></div><script async defer src=/js/menu.js></script></body></html>