<!doctype html><html class=no-js lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>为树莓派 3 构建 64 位内核 - Linux.cn Archive</title>
<script>(function(e,t){e[t]=e[t].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content><meta property="og:title" content="为树莓派 3 构建 64 位内核"><meta property="og:description" content="因为树莓派基金会还没有为官方的树莓派系统 Raspbian 提供 64 位版本。然而你可以构建一个，多亏了 Electron752 提供的许多补丁。"><meta property="og:type" content="article"><meta property="og:url" content="/article-8662-1.html"><meta property="article:section" content="posts"><meta property="article:published_time" content="2017-07-03T08:53:00+00:00"><meta property="article:modified_time" content="2017-07-03T08:53:00+00:00"><meta itemprop=name content="为树莓派 3 构建 64 位内核"><meta itemprop=description content="因为树莓派基金会还没有为官方的树莓派系统 Raspbian 提供 64 位版本。然而你可以构建一个，多亏了 Electron752 提供的许多补丁。"><meta itemprop=datePublished content="2017-07-03T08:53:00+00:00"><meta itemprop=dateModified content="2017-07-03T08:53:00+00:00"><meta itemprop=wordCount content="332"><meta itemprop=keywords content="树莓派,64位,"><link rel=preconnect href=https://fonts.bunny.net crossorigin><link rel=dns-prefetch href=//fonts.bunny.net><link rel=dns-prefetch href=//fonts.bunny.net><link rel=stylesheet href="https://fonts.bunny.net/css?family=Open+Sans:400,400i,700"><link rel=stylesheet href=/css/style.css><link rel="shortcut icon" href=/favicon.ico></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class=logo><a class=logo__link href=/ title="Linux.cn Archive" rel=home><div class="logo__item logo__text"><div class=logo__title>Linux.cn Archive</div></div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>Menu</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/><span class=menu__text>Home</span></a></li><li class=menu__item><a class=menu__link href=/categories/><span class=menu__text>Categories</span></a></li><li class=menu__item><a class=menu__link href=/tags/><span class=menu__text>Tags</span></a></li><li class=menu__item><a class=menu__link href><span class=menu__text>RSS</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>为树莓派 3 构建 64 位内核</h1><div class="post__meta meta"><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class=meta__text datetime=2017-07-03T08:53:00Z>July 03, 2017</time></div></div></header><div class="content post__content clearfix"><blockquote><p>编辑：在写完这个这篇文章之后，我在树莓派 3 上基于 Debian 开始打造 64 位的系统。你可以<a href=https://github.com/bamarni/pi64>在这里找到</a>。</p></blockquote><p><strong><img src=https://img.linux.net.cn/data/attachment/album/201707/02/225856ciizhnzt6l42hhok.jpg alt></strong></p><p><strong>树莓派 3</strong> 配有 Broadcom BCM2837 64 位 ARMv8 四核 Cortex A53 处理器，它是一个 <strong>64 位 CPU</strong>。如果你有一块，运行以下命令可能会让你感到惊讶：</p><pre tabindex=0><code>uname -a
Linux raspberrypi 4.4.34-v7+ #930 SMP Wed Nov 23 15:20:41 GMT 2016 armv7l GNU/Linux
</code></pre><p>是的，这是一个 <strong>32 位内核</strong>。这是因为树莓派基金会还没有为官方的树莓派系统 Raspbian 提供 64 位版本。然而你可以构建一个，多亏了 <a href=https://github.com/Electron752>Electron752</a> 提供的许多补丁。</p><h3 id=构建内核>构建内核</h3><p>树莓派基金会维护着<a href=https://github.com/raspberrypi/linux>它们自己的 Linux 内核分支</a>，它为它们的设备特别裁剪过，同时定期地从上游合并。</p><p>我们将会遵照<a href=https://www.raspberrypi.org/documentation/linux/kernel/building.md>这个页面</a>的指导来<strong>构建一个 64 位内核</strong>。</p><p>我们不能使用“本地构建”的方法，因为它需要一块 64 位的树莓派，这个我们明显还没有。因此我们需要<strong>交叉编译</strong>它，<strong>Ubuntu</strong> 是推荐的系统。我个人没有 Ubuntu，因此我在一个有 2 个 CPU 的 Ubuntu 16.04 Digital Ocean 实例上构建，这应该花费我 $0.03。如果你也想这么做，你可以通过<a href=https://m.do.co/c/8ef9c5832a9c>这个链接</a>得到 $10 的免费额度。或者你可以通过使用 Virtualbox 中的 Ubuntu VM 作为实例。</p><p>首先，我们需要一些<strong>构建工具</strong>以及** aarch64 交叉编译器**：</p><pre tabindex=0><code>apt-get update
apt-get install -y bc build-essential gcc-aarch64-linux-gnu git unzip
</code></pre><p>接着我们可以下载 <strong>Linux 内核源码</strong>：</p><pre tabindex=0><code>git clone –depth=1 -b rpi-4.8.y https://github.com/raspberrypi/linux.git
</code></pre><p>进入到创建的 git 目录。另外你可以为你的内核添加额外的版本标签，可以通过编辑 <code>Makefile</code> 的开始几行完成：</p><pre tabindex=0><code>VERSION = 4
PATCHLEVEL = 8
SUBLEVEL = 13
EXTRAVERSION = +bilal
</code></pre><p>为了<strong>构建它</strong>，运行下面的命令：</p><pre tabindex=0><code>make ARCH=arm64 CROSS_COMPILE=aarch64-linux-gnu- bcmrpi3_defconfig
make -j 3 ARCH=arm64 CROSS_COMPILE=aarch64-linux-gnu-
</code></pre><p>第一个应该很快。第二个则会完全不同，我没有精确计时，但是对我来说大概要半个小时。根据你的 CPU 数（nproc * 1.5）调整 <code>-j</code> 标志。</p><h3 id=选择一个-linux-发行版>选择一个 Linux 发行版</h3><p>在内核编译的时候，我们可以开始准备它的 Linux 发行版了。在本教程中为了简单我使用 <strong>Raspbian</strong>，即使这是一个只有 32 位的发行版。</p><blockquote><p>如果你想要一直用 64 位系统，你应该选一个有 aarch64 支持的发行版，Debian 有一个健壮的 <a href=https://wiki.debian.org/Arm64Port>ARM64 移植版</a>。得到它基本有三种方式：</p><ul><li>下载一个预构建的根文件系统，这很可能会如页面中提到的那样给你一个过期的版本。</li><li>如果你熟悉 debootstrap，用它构建你自己的（这回比较棘手，因为它需要一些手工调整，它最初的目的是在已经运行的主机上进行 chroot，而不是为其他机器构建根文件系统）</li><li>我建议使用 multistrap，这里有一个很好的教程：<a href=http://free-electrons.com/blog/embdebian-with-multistrap/>http://free-electrons.com/blog/embdebian-with-multistrap/</a></li></ul></blockquote><p>回到 Raspbian，我们现在可以下载官方系统，并开始准备了。</p><p>打开一个新的 shell 会话并运行下面的命令：</p><pre tabindex=0><code>wget -O raspbian.zip https://downloads.raspberrypi.org/raspbian_lite_latest
unzip raspbian.zip
</code></pre><p>我们用下面的命令审查：</p><pre tabindex=0><code>fdisk -l 2016-11-25-raspbian-jessie-lite.img
Disk 2016-11-25-raspbian-jessie-lite.img: 1.3 GiB, 1390411776 bytes, 2715648 sectors
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disklabel type: dos
Disk identifier: 0x244b8248

Device Boot Start End Sectors Size Id Type
2016-11-25-raspbian-jessie-lite.img1 8192 137215 129024 63M c W95 FAT32 (LBA)
2016-11-25-raspbian-jessie-lite.img2 137216 2715647 2578432 1.2G 83 Linux
</code></pre><p>我们可以看到它有<strong>两个分区</strong>。第一个是<strong>启动分区</strong>，它主要包含了 bootloader、Linux 内核以及少量配置文件。第二个是<strong>根分区</strong>。</p><p>我们可以在我们的文件系统上<strong>挂载这些分区</strong>，从<strong>根分区</strong>开始：</p><pre tabindex=0><code>mount -o loop,offset=70254592 2016-11-25-raspbian-jessie-lite.img /mnt
</code></pre><p><code>offset</code> 取决于扇区大小（512）：70254592 = 512 * 137216</p><p>接着是<strong>启动分区</strong>：</p><pre tabindex=0><code>mount -o loop,offset=4194304,sizelimit=66060288 2016-11-25-raspbian-jessie-lite.img /mnt/boot
</code></pre><p><code>offset</code> ：4194304 = 512 * 8192，<code>sizelimit</code>：66060288 = 512 * 129024 。</p><p>树莓派系统现在应该可以在 <code>/mnt</code> 中看到了。我们基本要完成了。</p><h3 id=打包内核>打包内核</h3><p>内核编译完成后，最后一步包括<strong>复制 Linux 内核</strong>以及<strong>设备树</strong>到启动分区中：</p><pre tabindex=0><code>cp arch/arm64/boot/Image /mnt/boot/kernel8.img
cp arch/arm64/boot/dts/broadcom/bcm2710-rpi-3-b.dtb /mnt/boot/
</code></pre><p>调整 <code>config.txt</code> :</p><pre tabindex=0><code>echo “kernel=kernel8.img” &gt;&gt; /mnt/boot/config.txt
</code></pre><p>安装<strong>内核模块</strong> :</p><pre tabindex=0><code>make ARCH=arm64 CROSS_COMPILE=aarch64-linux-gnu INSTALL_MOD_PATH=/mnt modules_install
umount /mnt/boot
umount /mnt
</code></pre><p>就是这样了，用于树莓派 3 的** ARM64 Linux 内核**诞生了！</p><p>现在你可以压缩镜像，通过 scp 下载下来，并按照标准的步骤放到你的 SD 卡中。</p><p>最后你会得到：</p><pre tabindex=0><code>uname -a
Linux raspberrypi 4.8.13+bilal-v8+ #1 SMP Wed Dec 14 14:09:38 UTC 2016 aarch64 GNU/Linux
</code></pre><hr><p>via: <a href=https://devsidestory.com/build-a-64-bit-kernel-for-your-raspberry-pi-3/>https://devsidestory.com/build-a-64-bit-kernel-for-your-raspberry-pi-3/</a></p><p>作者：<a href=http://devsidestory.com/about-me>Bilal Amarni</a> 译者：<a href=https://github.com/geekpi>geekpi</a> 校对：<a href=https://github.com/wxy>wxy</a></p><p>本文由 <a href=https://github.com/LCTT/TranslateProject>LCTT</a> 原创编译，<a href=https://linux.cn/>Linux中国</a> 荣誉推出</p></div><footer class=post__footer><div class="post__tags tags clearfix"><svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5.0 11V3C0 1.5.8.8.8.8S1.5.0 3 0h8c1.5.0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 100-6 3 3 0 000 6z"/></svg><ul class=tags__list><li class=tags__item><a class="tags__link btn" href=/tags/%E6%A0%91%E8%8E%93%E6%B4%BE/ rel=tag>树莓派</a></li><li class=tags__item><a class="tags__link btn" href=/tags/64%E4%BD%8D/ rel=tag>64位</a></li></ul></div></footer></article></main></div></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2025 Linux.cn Archive.
<span class=footer__copyright-credits>Generated with <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> and <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a> theme.</span></div></div></footer></div><script async defer src=/js/menu.js></script></body></html>