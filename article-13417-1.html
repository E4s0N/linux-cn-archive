<!doctype html><html class=no-js lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>使用 sed 命令进行复制、剪切和粘贴 - Linux.cn Archive</title>
<script>(function(e,t){e[t]=e[t].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content><meta property="og:title" content="使用 sed 命令进行复制、剪切和粘贴"><meta property="og:description" content="你可以将保留空间当作剪贴板，实际上，这正是本文所演示的内容：如何使用 sed 复制/剪切和粘贴。"><meta property="og:type" content="article"><meta property="og:url" content="/article-13417-1.html"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-05-23T18:16:43+00:00"><meta property="article:modified_time" content="2021-05-23T18:16:43+00:00"><meta itemprop=name content="使用 sed 命令进行复制、剪切和粘贴"><meta itemprop=description content="你可以将保留空间当作剪贴板，实际上，这正是本文所演示的内容：如何使用 sed 复制/剪切和粘贴。"><meta itemprop=datePublished content="2021-05-23T18:16:43+00:00"><meta itemprop=dateModified content="2021-05-23T18:16:43+00:00"><meta itemprop=wordCount content="347"><meta itemprop=keywords content="sed,复制,粘贴,"><link rel=preconnect href=https://fonts.bunny.net crossorigin><link rel=dns-prefetch href=//fonts.bunny.net><link rel=dns-prefetch href=//fonts.bunny.net><link rel=stylesheet href="https://fonts.bunny.net/css?family=Open+Sans:400,400i,700"><link rel=stylesheet href=/css/style.css><link rel="shortcut icon" href=/favicon.ico></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class=logo><a class=logo__link href=/ title="Linux.cn Archive" rel=home><div class="logo__item logo__text"><div class=logo__title>Linux.cn Archive</div></div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>Menu</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/><span class=menu__text>Home</span></a></li><li class=menu__item><a class=menu__link href=/categories/><span class=menu__text>Categories</span></a></li><li class=menu__item><a class=menu__link href=/tags/><span class=menu__text>Tags</span></a></li><li class=menu__item><a class=menu__link href><span class=menu__text>RSS</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>使用 sed 命令进行复制、剪切和粘贴</h1><div class="post__meta meta"><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class=meta__text datetime=2021-05-23T18:16:43Z>May 23, 2021</time></div></div></header><div class="content post__content clearfix"><blockquote><p>了解 sed 的基本用法，然后下载我们的备忘单，方便快速地参考 Linux 流编辑器。</p></blockquote><p><img src=https://img.linux.net.cn/data/attachment/album/202105/23/181625abgrg4dsbw4y4fue.jpg alt title="Penguin with green background"></p><p>很少有 Unix 命令像 <code>sed</code>、<a href=https://opensource.com/article/21/3/grep-cheat-sheet>grep</a> 和 <a href=https://opensource.com/article/20/9/awk-ebook>awk</a> 一样出名，它们经常组合在一起，可能是因为它们具有奇怪的名称和强大的文本解析能力。它们还在一些语法和逻辑上有相似之处。虽然它们都能用于文本解析，但都有其特殊性。本文研究 <code>sed</code> 命令，它是一个 流编辑器 stream editor 。</p><p>我之前写过关于 <a href=https://opensource.com/article/20/12/sed>sed</a> 以及它的远亲 <a href=https://opensource.com/article/20/12/gnu-ed>ed</a> 的文章。要熟悉 <code>sed</code>，对 <code>ed</code> 有一点了解是有帮助的，因为这有助于你熟悉缓冲区的概念。本文假定你熟悉 <code>sed</code> 的基本知识，这意味着你至少已经运行过经典的 <code>s/foo/bar</code> 风格的查找和替换命令。</p><ul><li>下载我们的免费 <a href=https://opensource.com/downloads/sed-cheat-sheet>sed 备忘录</a></li></ul><h3 id=安装-sed>安装 sed</h3><p>如果你使用的是 Linux、BSD 或 macOS，那么它们已经安装了 GNU 的或 BSD 的 sed。这些是原始 <code>sed</code> 命令的独特重新实现。虽然它们很相似，但也有一些细微的差别。本文已经在 Linux 和 NetBSD 版本上进行了测试，所以你可以使用你的计算机上找到的任何 sed，但是对于 BSD sed，你必须使用短选项（例如 <code>-n</code> 而不是 <code>--quiet</code>）。</p><p>GNU sed 通常被认为是功能最丰富的 sed，因此无论你是否运行 Linux，你可能都想要尝试一下。如果在 Ports 树中找不到 GNU sed（在非 Linux 系统上通常称为 gsed），你可以从 GNU 网站 <a href=http://www.gnu.org/software/sed/>下载源代码</a>。 安装 GNU sed 的好处是，你可以使用它的额外功能，但是如果需要可移植性，还可以限制它以遵守 sed 的 <a href=https://opensource.com/article/19/7/what-posix-richard-stallman-explains>POSIX</a> 规范。</p><p>MacOS 用户可以在 <a href=https://opensource.com/article/20/11/macports>MacPorts</a> 或 <a href=https://opensource.com/article/20/6/homebrew-mac>Homebrew</a> 上找到 GNU sed。</p><p>在 Windows 上，你可以通过 <a href=https://opensource.com/article/20/3/chocolatey>Chocolatey</a> 来 <a href=https://chocolatey.org/packages/sed>安装 GNU sed</a>。</p><h3 id=了解模式空间和保留空间>了解模式空间和保留空间</h3><p>sed 一次只能处理一行。因为它没有可视化模式，所以会创建一个 模式空间 pattern space ，这是一个内存空间，其中包含来自输入流的当前行（删除了尾部的任何换行符）。填充模式空间后，sed 将执行你的指令。当命令执行完时，sed 将模式空间中的内容打印到输出流，默认是 <strong>标准输出</strong>，但是可以将输出重定向到文件，甚至使用 <code>--in-place=.bak</code> 选项重定向到同一文件。</p><p>然后，循环从下一个输入行再次开始。</p><p>为了在遍历文件时提供一点灵活性，sed 还提供了 保留空间 hold space （有时也称为 保留缓冲区 hold buffer ），即 sed 内存中为临时数据存储保留的空间。你可以将保留空间当作剪贴板，实际上，这正是本文所演示的内容：如何使用 sed 复制/剪切和粘贴。</p><p>首先，创建一个示例文本文件，其内容如下：</p><pre tabindex=0><code>Line one
Line three
Line two
</code></pre><h3 id=复制数据到保留空间>复制数据到保留空间</h3><p>要将内容放置在 sed 的保留空间，使用 <code>h</code> 或 <code>H</code> 命令。小写的 <code>h</code> 告诉 sed 覆盖保留空间中的当前内容，而大写的 <code>H</code> 告诉 sed 将数据追加到保留空间中已经存在的内容之后。</p><p>单独使用，什么都看不到：</p><pre tabindex=0><code>$ sed --quiet -e &#39;/three/ h&#39; example.txt
$
</code></pre><p><code>--quiet</code>（缩写为 <code>-n</code>）选项禁止显示所有输出，但 sed 执行了我的搜索需求。在这种情况下，sed 选择包含字符串 <code>three</code> 的任何行，并将其复制到保留空间。我没有告诉 sed 打印任何东西，所以没有输出。</p><h3 id=从保留空间复制数据>从保留空间复制数据</h3><p>要了解保留空间，你可以从保留空间复制内容，然后使用 <code>g</code> 命令将其放入模式空间，观察会发生什么：</p><pre tabindex=0><code>$ sed -n -e &#39;/three/h&#39; -e &#39;g;p&#39; example.txt

Line three
Line three
</code></pre><p>第一个空白行是因为当 sed 第一次复制内容到模式空间时，保留空间为空。</p><p>接下来的两行包含 <code>Line three</code> 是因为这是从第二行开始的保留空间。</p><p>该命令使用两个唯一的脚本（<code>-e</code>）纯粹是为了帮助提高可读性和组织性。将步骤划分为单独的脚本可能会很有用，但是从技术上讲，以下命令与一个脚本语句一样有效：</p><pre tabindex=0><code>$ sed -n -e &#39;/three/h ; g ; p&#39; example.txt

Line three
Line three
</code></pre><h3 id=将数据追加到模式空间>将数据追加到模式空间</h3><p><code>G</code> 命令会将一个换行符和保留空间的内容添加到模式空间。</p><pre tabindex=0><code>$ sed -n -e &#39;/three/h&#39; -e &#39;G;p&#39; example.txt
Line one

Line three
Line three
Line two
Line three
</code></pre><p>此输出的前两行同时包含模式空间（<code>Line one</code>）的内容和空的保留空间。接下来的两行与搜索文本（<code>three</code>）匹配，因此它既包含模式空间又包含保留空间。第三行的保留空间没有变化，因此在模式空间（<code>Line two</code>）的末尾是保留空间（仍然是 <code>Line three</code>）。</p><h3 id=用-sed-剪切和粘贴>用 sed 剪切和粘贴</h3><p>现在你知道了如何将字符串从模式空间转到保留空间并再次返回，你可以设计一个 sed 脚本来复制、删除，然后在文档中粘贴一行。例如，将示例文件的 <code>Line three</code> 挪至第三行，sed 可以解决这个问题：</p><pre tabindex=0><code>$ sed -n -e &#39;/three/ h&#39; -e &#39;/three/ d&#39; \
-e &#39;/two/ G;p&#39; example.txt
Line one
Line two
Line three
</code></pre><ul><li>第一个脚本找到包含字符串 <code>three</code> 的行，并将其从模式空间复制到保留空间，替换当前保留空间中的任何内容。</li><li>第二个脚本删除包含字符串 <code>three</code> 的任何行。这样就完成了与文字处理器或文本编辑器中的 <em>剪切</em> 动作等效的功能。</li><li>最后一个脚本找到包含字符串 <code>two</code> 的行，并将保留空间的内容_追加_到模式空间，然后打印模式空间。</li></ul><p>任务完成。</p><h3 id=使用-sed-编写脚本>使用 sed 编写脚本</h3><p>再说一次，使用单独的脚本语句纯粹是为了视觉和心理上的简单。剪切和粘贴命令作为一个脚本同样有效：</p><pre tabindex=0><code>$ sed -n -e &#39;/three/ h ; /three/ d ; /two/ G ; p&#39; example.txt
Line one
Line two
Line three
</code></pre><p>它甚至可以写在一个专门的脚本文件中：</p><pre tabindex=0><code>#!/usr/bin/sed -nf

/three/h
/three/d
/two/ G
p
</code></pre><p>要运行该脚本，将其加入可执行权限，然后用示例文件尝试：</p><pre tabindex=0><code>$ chmod +x myscript.sed
$ ./myscript.sed example.txt
Line one
Line two
Line three
</code></pre><p>当然，你需要解析的文本越可预测，则使用 sed 解决问题越容易。发明 sed 操作（例如复制和粘贴）的“配方”通常是不切实际的，因为触发操作的条件可能因文件而异。但是，你对 sed 命令的使用越熟练，就越容易根据需要解析的输入来设计复杂的动作。</p><p>重要的事情是识别不同的操作，了解 sed 何时移至下一行，并预测模式和保留空间包含的内容。</p><h3 id=下载备忘单>下载备忘单</h3><p>sed 很复杂。虽然它只有十几个命令，但它灵活的语法和原生功能意味着它充满了无限的潜力。为了充分利用 sed，我曾经参考过一些巧妙的单行命令，但是直到我开始发明（有时是重新发明）自己的解决方案时，我才觉得自己真正开始学习 sed 了 。如果你正在寻找命令提示和语法方面的有用技巧，<a href=https://opensource.com/downloads/sed-cheat-sheet>下载我们的 sed 备忘单</a>，然后开始一劳永逸地学习 sed！</p><hr><p>via: <a href=https://opensource.com/article/21/3/sed-cheat-sheet>https://opensource.com/article/21/3/sed-cheat-sheet</a></p><p>作者：<a href=https://opensource.com/users/seth>Seth Kenlon</a> 选题：<a href=https://github.com/lujun9972>lujun9972</a> 译者：<a href=https://github.com/MjSeven>MjSeven</a> 校对：<a href=https://github.com/wxy>wxy</a></p><p>本文由 <a href=https://github.com/LCTT/TranslateProject>LCTT</a> 原创编译，<a href=https://linux.cn/>Linux中国</a> 荣誉推出</p></div><footer class=post__footer><div class="post__tags tags clearfix"><svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5.0 11V3C0 1.5.8.8.8.8S1.5.0 3 0h8c1.5.0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 100-6 3 3 0 000 6z"/></svg><ul class=tags__list><li class=tags__item><a class="tags__link btn" href=/tags/sed/ rel=tag>sed</a></li><li class=tags__item><a class="tags__link btn" href=/tags/%E5%A4%8D%E5%88%B6/ rel=tag>复制</a></li><li class=tags__item><a class="tags__link btn" href=/tags/%E7%B2%98%E8%B4%B4/ rel=tag>粘贴</a></li></ul></div></footer></article></main></div></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2025 Linux.cn Archive.
<span class=footer__copyright-credits>Generated with <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> and <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a> theme.</span></div></div></footer></div><script async defer src=/js/menu.js></script></body></html>