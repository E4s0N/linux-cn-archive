<!doctype html><html class=no-js lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>使用 GIT 备份 linux 上的网页文件 - Linux.cn Archive</title>
<script>(function(e,t){e[t]=e[t].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content><meta property="og:title" content="使用 GIT 备份 linux 上的网页文件"><meta property="og:description" content="BUP 并不单纯是 Git, 而是一款基于 Git 的软件. 一般情况下, 我使用 rsync 来备份我的文件, 而且迄今为止一直工作的很好. 唯一的不足就是无法把文件恢复到某个特定的时间点. 因此, 我开始寻找替代品, 结果发现了 BUP, 一款基于 git 的软件, 它将数据存储在一个仓库中, 并且有将数据恢复到特定时间点的选项."><meta property="og:type" content="article"><meta property="og:url" content="/article-4002-1.html"><meta property="article:section" content="posts"><meta property="article:published_time" content="2014-10-13T17:44:00+00:00"><meta property="article:modified_time" content="2014-10-13T17:44:00+00:00"><meta itemprop=name content="使用 GIT 备份 linux 上的网页文件"><meta itemprop=description content="BUP 并不单纯是 Git, 而是一款基于 Git 的软件. 一般情况下, 我使用 rsync 来备份我的文件, 而且迄今为止一直工作的很好. 唯一的不足就是无法把文件恢复到某个特定的时间点. 因此, 我开始寻找替代品, 结果发现了 BUP, 一款基于 git 的软件, 它将数据存储在一个仓库中, 并且有将数据恢复到特定时间点的选项."><meta itemprop=datePublished content="2014-10-13T17:44:00+00:00"><meta itemprop=dateModified content="2014-10-13T17:44:00+00:00"><meta itemprop=wordCount content="405"><meta itemprop=keywords content="git,备份,"><link rel=preconnect href=https://fonts.bunny.net crossorigin><link rel=dns-prefetch href=//fonts.bunny.net><link rel=dns-prefetch href=//fonts.bunny.net><link rel=stylesheet href="https://fonts.bunny.net/css?family=Open+Sans:400,400i,700"><link rel=stylesheet href=/css/style.css><link rel="shortcut icon" href=/favicon.ico></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class=logo><a class=logo__link href=/ title="Linux.cn Archive" rel=home><div class="logo__item logo__text"><div class=logo__title>Linux.cn Archive</div></div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>Menu</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/><span class=menu__text>Home</span></a></li><li class=menu__item><a class=menu__link href=/categories/><span class=menu__text>Categories</span></a></li><li class=menu__item><a class=menu__link href=/tags/><span class=menu__text>Tags</span></a></li><li class=menu__item><a class=menu__link href><span class=menu__text>RSS</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>使用 GIT 备份 linux 上的网页文件</h1><div class="post__meta meta"><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class=meta__text datetime=2014-10-13T17:44:00Z>October 13, 2014</time></div></div></header><div class="content post__content clearfix"><p><img src=/data/attachment/album/201410/13/174421ad1aqg349jzozpow.png alt></p><p>BUP 并不单纯是 Git, 而是一款基于 Git 的软件. 一般情况下, 我使用 rsync 来备份我的文件, 而且迄今为止一直工作的很好. 唯一的不足就是无法把文件恢复到某个特定的时间点. 因此, 我开始寻找替代品, 结果发现了 BUP, 一款基于 git 的软件, 它将数据存储在一个仓库中, 并且有将数据恢复到特定时间点的选项.</p><p>要使用 BUP, 你先要初始化一个空的仓库, 然后备份所有文件. 当 BUP 完成一次备份是, 它会创建一个还原点, 你可以过后还原到这里. 它还会创建所有文件的索引, 包括文件的属性和验校和. 当要进行下一个备份时, BUP 会对比文件的属性和验校和, 只保存发生变化的数据. 这样可以节省很多空间.</p><h3 id=安装-bup-在-centos-6--7-上测试通过>安装 BUP (在 Centos 6 & 7 上测试通过)</h3><p>首先确保你已经安装了 RPMFORGE 和 EPEL 仓库</p><pre tabindex=0><code>[techarena51@vps ~]$ sudo yum groupinstall &#34;Development Tools&#34;
[techarena51@vps ~]$ sudo yum install python python-devel
[techarena51@vps ~]$ sudo yum install fuse-python pyxattr pylibacl
[techarena51@vps ~]$ sudo yum install perl-Time-HiRes
[techarena51@vps ~]$ git clone git://github.com/bup/bup
[techarena51@vps ~]$ cd bup
[techarena51@vps ~]$ make
[techarena51@vps ~]$ make test
[techarena51@vps ~]$ sudo make install
</code></pre><p>对于 debian/ubuntu 用户, 你可以使用 &ldquo;apt-get build-dep bup&rdquo;. 要获得更多的信息, 可以查看 <a href=https://github.com/bup/bup>https://github.com/bup/bup</a></p><p>在 CentOS 7 上, 当你运行 &ldquo;make test&rdquo; 时可能会出错, 但你可以继续运行 &ldquo;make install&rdquo;.</p><p>第一步时初始化一个空的仓库, 就像 git 一样.</p><pre tabindex=0><code>[techarena51@vps ~]$ bup init
</code></pre><p>默认情况下, bup 会把仓库存储在 &ldquo;~/.bup&rdquo; 中, 但你可以通过设置环境变量 &ldquo;export BUP_DIR=/mnt/user/bup&rdquo; 来改变设置.</p><p>然后, 创建所有文件的索引. 这个索引, 就像之前讲过的那样, 存储了一系列文件和它们的属性及 git 目标 id (sha1 哈希表). (属性包括了软链接, 权限和不可改变字节)</p><pre tabindex=0><code>bup index /path/to/file
bup save -n nameofbackup /path/to/file

#Example
[techarena51@vps ~]$ bup index /var/www/html
Indexing: 7973, done (4398 paths/s).
bup: merging indexes (7980/7980), done.

[techarena51@vps ~]$ bup save -n techarena51 /var/www/html

Reading index: 28, done.
Saving: 100.00% (4/4k, 28/28 files), done.
bloom: adding 1 file (7 objects).
Receiving index from server: 1268/1268, done.
bloom: adding 1 file (7 objects).
</code></pre><p>&ldquo;BUP save&rdquo; 会把所有内容分块, 然后把它们作为对象储存. &ldquo;-n&rdquo; 选项指定备份名.</p><p>你可以查看备份列表和已备份文件.</p><pre tabindex=0><code>[techarena51@vps ~]$ bup ls
local-etc    techarena51  test
#Check for a list of backups available for my site
[techarena51@vps ~]$ bup ls techarena51
2014-09-24-064416  2014-09-24-071814  latest
#Check for the files available in these backups
[techarena51@vps ~]$ bup ls techarena51/2014-09-24-064416/var/www/html
apc.php                      techarena51.com              wp-config-sample.php         wp-load.php
</code></pre><p>在同一个服务器上备份文件从来不是一个好的选择. BUP 允许你远程备份网页文件, 但你必须保证你的 SSH 密钥和 BUP 都已经安装在远程服务器上.</p><pre tabindex=0><code>bup index path/to/dir
bup save-r remote-vps.com -n backupname path/to/dir
</code></pre><h3 id=例子-备份-varwwwhtml-文件夹>例子: 备份 &ldquo;/var/www/html&rdquo; 文件夹</h3><pre tabindex=0><code>[techarena51@vps ~]$bup index /var/www/html
[techarena51@vps ~]$ bup save -r user@remotelinuxvps.com: -n techarena51 /var/www/html
Reading index: 28, done.
Saving: 100.00% (4/4k, 28/28 files), done.
bloom: adding 1 file (7 objects).
Receiving index from server: 1268/1268, done.
bloom: adding 1 file (7 objects).
</code></pre><h3 id=恢复备份>恢复备份</h3><p>登入远程服务器并输入下面的命令</p><pre tabindex=0><code>[techarena51@vps ~]$bup restore -C ./backup techarena51/latest

#Restore an older version of the entire working dir elsewhere
[techarena51@vps ~]$bup restore -C /tmp/bup-out /testrepo/2013-09-29-195827
#Restore one individual file from an old backup
[techarena51@vps ~]$bup restore -C /tmp/bup-out /testrepo/2013-09-29-201328/root/testbup/binfile1.bin
</code></pre><p>唯一的缺点是你不能把文件恢复到另一个服务器, 你必须通过 SCP 或者 rsync 手动复制文件.</p><p>通过集成的 web 服务器查看备份.</p><pre tabindex=0><code>bup web
#specific port
bup web :8181
</code></pre><p>你可以使用 shell 脚本来运行 bup, 并建立一个每日运行的定时任务.</p><pre tabindex=0><code>#!/bin/bash

bup index /var/www/html 
bup save -r user@remote-vps.com: -n techarena51 /var/www/html 
</code></pre><p>BUP 并不完美, 但它的确能够很好地完成任务. 我当然非常愿意看到这个项目的进一步开发, 希望以后能够增加远程恢复的功能.</p><p>你也许喜欢阅读这篇——使用<a href=http://techarena51.com/index.php/inotify-tools-example/>inotify-tools</a>实时文件同步.</p><hr><p>via: <a href=http://techarena51.com/index.php/using-git-backup-website-files-on-linux/>http://techarena51.com/index.php/using-git-backup-website-files-on-linux/</a></p><p>作者：<a href=http://techarena51.com/>Leo G</a> 译者：<a href=https://github.com/wangjiezhe>wangjiezhe</a> 校对：<a href=https://github.com/carolinewuyan>Caroline</a></p><p>本文由 <a href=https://github.com/LCTT/TranslateProject>LCTT</a> 原创翻译，<a href=http://linux.cn/>Linux中国</a> 荣誉推出</p></div><footer class=post__footer><div class="post__tags tags clearfix"><svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5.0 11V3C0 1.5.8.8.8.8S1.5.0 3 0h8c1.5.0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 100-6 3 3 0 000 6z"/></svg><ul class=tags__list><li class=tags__item><a class="tags__link btn" href=/tags/git/ rel=tag>git</a></li><li class=tags__item><a class="tags__link btn" href=/tags/%E5%A4%87%E4%BB%BD/ rel=tag>备份</a></li></ul></div></footer></article></main></div></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2025 Linux.cn Archive.
<span class=footer__copyright-credits>Generated with <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> and <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a> theme.</span></div></div></footer></div><script async defer src=/js/menu.js></script></body></html>