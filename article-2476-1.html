<!doctype html><html class=no-js lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>教你在 Debian 和 Ubuntu 上升级 MySQL - Linux.cn Archive</title>
<script>(function(e,t){e[t]=e[t].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content><meta property="og:title" content="教你在 Debian 和 Ubuntu 上升级 MySQL"><meta property="og:description" content="系统管理员的日常工作之一就是升级服务，为服务打上补丁包或升级一些花哨的功能。2013年初，最新的 MySQL 5.6发布，目标是提供更好的性能和扩展能力。如果你对此有点兴趣，倒是可以看看我写的这篇 如何在 Debian 和  &mldr;"><meta property="og:type" content="article"><meta property="og:url" content="/article-2476-1.html"><meta property="article:section" content="posts"><meta property="article:published_time" content="2014-01-14T16:15:00+00:00"><meta property="article:modified_time" content="2014-01-14T16:15:00+00:00"><meta itemprop=name content="教你在 Debian 和 Ubuntu 上升级 MySQL"><meta itemprop=description content="系统管理员的日常工作之一就是升级服务，为服务打上补丁包或升级一些花哨的功能。2013年初，最新的 MySQL 5.6发布，目标是提供更好的性能和扩展能力。如果你对此有点兴趣，倒是可以看看我写的这篇 如何在 Debian 和  &mldr;"><meta itemprop=datePublished content="2014-01-14T16:15:00+00:00"><meta itemprop=dateModified content="2014-01-14T16:15:00+00:00"><meta itemprop=wordCount content="312"><meta itemprop=keywords content="Linux,Debian,Ubuntu,MySQL,升级,技巧,教程,"><link rel=preconnect href=https://fonts.bunny.net crossorigin><link rel=dns-prefetch href=//fonts.bunny.net><link rel=dns-prefetch href=//fonts.bunny.net><link rel=stylesheet href="https://fonts.bunny.net/css?family=Open+Sans:400,400i,700"><link rel=stylesheet href=/css/style.css><link rel="shortcut icon" href=/favicon.ico></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class=logo><a class=logo__link href=/ title="Linux.cn Archive" rel=home><div class="logo__item logo__text"><div class=logo__title>Linux.cn Archive</div></div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>Menu</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/><span class=menu__text>Home</span></a></li><li class=menu__item><a class=menu__link href=/categories/><span class=menu__text>Categories</span></a></li><li class=menu__item><a class=menu__link href=/tags/><span class=menu__text>Tags</span></a></li><li class=menu__item><a class=menu__link href><span class=menu__text>RSS</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>教你在 Debian 和 Ubuntu 上升级 MySQL</h1><div class="post__meta meta"><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class=meta__text datetime=2014-01-14T16:15:00Z>January 14, 2014</time></div></div></header><div class="content post__content clearfix"><p>系统管理员的日常工作之一就是升级服务，为服务打上补丁包或升级一些花哨的功能。2013年初，最新的 MySQL 5.6发布，目标是提供<a href=http://dev.mysql.com/tech-resources/articles/whats-new-in-mysql-5.6.html>更好的性能和扩展能力</a>。如果你对此有点兴趣，倒是可以看看我写的这篇 <strong>如何在 Debian 和 Ubuntu 上升级 MySQL</strong>。</p><p>在这篇教程中，我会假设你已经<a href=http://xmodulo.com/2013/06/how-to-install-mysql-server-and-client-on-linux.html>通过 apt-get 安装了 MySQL</a>。写这篇文章的时候，大部分 Linux 发行版上部署的都是 MySQL 5.5。这里我将向你们介绍如何从 MySQL 5.5升级到5.6。</p><p><img src=/data/attachment/album/201401/14/160839hdnhrggphh4jzhhr.png alt></p><h3 id=步骤1备份-mysql-配置文件>步骤1：备份 MySQL 配置文件。</h3><pre tabindex=0><code>$ sudo mkdir /backup
$ sudo tar cvfvz /backup/mysql_conf.tgz /etc/mysql
</code></pre><h3 id=步骤2把数据库导出到一个-sql-文件并且把数据存放路径下面的数据也备份起来>步骤2：把数据库导出到一个 .sql 文件，并且把数据存放路径下面的数据也备份起来。</h3><pre tabindex=0><code>$ sudo sh -c &#39;mysqldump -u root -p -A --events &gt; /backup/backup_db.sql
$ sudo tar cvfvz /backup/mysql_data.tgz /var/lib/mysql
</code></pre><p>注意：如果你为你的在线 MySQL 系统提供了持续备份，强烈建议你在执行上面步骤时使用单事务选项，或显式使用锁（以保证数据一致性 —— 译注），详见<a href=http://xmodulo.com/2012/10/how-to-backup-mysql-server.html>这个教程</a>。</p><h3 id=步骤3停止-mysql-服务>步骤3：停止 MySQL 服务</h3><pre tabindex=0><code>$ sudo service mysql stop
</code></pre><h3 id=步骤4卸载-mysql-软件包>步骤4：卸载 MySQL 软件包</h3><pre tabindex=0><code>$ sudo apt-get remove mysql-server mysql-client mysql-common
$ sudo apt-get autoremove
$ sudo apt-get autoclean
</code></pre><p>使用 apt-get 卸载时不要用 purge 选项，这会删除 MySQL 配置文件和其它一些以后要用到的数据。</p><h3 id=步骤5-安装-mysql-依赖包内核异步-io-访问库mysql-55以及之后的版本都依赖它>步骤5： 安装 MySQL 依赖包（内核异步 IO 访问库），MySQL 5.5以及之后的版本都依赖它。</h3><pre tabindex=0><code>$ sudo apt-get install libaio1
</code></pre><h3 id=步骤6从官网下载-debian-版的-mysql-软件包>步骤6：从官网下载 Debian 版的 MySQL 软件包</h3><p>32位系统：</p><pre tabindex=0><code>$ wget http://dev.mysql.com/get/Downloads/MySQL-5.6/mysql-5.6.15-debian6.0-i686.deb
</code></pre><p>64位系统：</p><pre tabindex=0><code>$ wget http://dev.mysql.com/get/Downloads/MySQL-5.6/mysql-5.6.15-debian6.0-x86_64.deb
</code></pre><h3 id=步骤7安装-mysql-软件包>步骤7：安装 MySQL 软件包</h3><pre tabindex=0><code>$ sudo dpkg -i mysql-5.6.15-debian6.0-*.deb
</code></pre><p>这个软件包会被安装在 /opt/mysql 目录下面。</p><h3 id=步骤8将-mysql-命令所在的路径添加到系统环境变量-path-内>步骤8：将 MySQL 命令所在的路径添加到系统环境变量 PATH 内。</h3><p>Debian 上：</p><pre tabindex=0><code>$ sudo sh -c &#39;echo &#34;PATH=$PATH:/opt/mysql/server-5.6/bin&#34; &gt;&gt; /etc/profile&#39;
$ source /etc/profile
</code></pre><p>Ubuntu 或 Linux Mint 上：</p><pre tabindex=0><code>$ sudo sh -c &#39;echo &#34;PATH=${PATH}:/opt/mysql/server-5.6/bin&#34; &gt;&gt; /etc/environment&#39;
$ source /etc/environment
</code></pre><h3 id=步骤9进入-mysql-配置文件修改下面两行配置>步骤9：进入 MySQL 配置文件，修改下面两行配置。</h3><pre tabindex=0><code>$ sudo vi /etc/mysql/my.cnf
</code></pre><ul><li></li></ul><blockquote><p>basedir = /opt/mysql/server-5.6</p><p>lc-messages-dir = /opt/mysql/server-5.6/share</p></blockquote><h3 id=步骤10设置启动脚本>步骤10：设置启动脚本</h3><p>复制 MySQL 启动脚本到 /etc/init.d 目录下，并且将脚本设置为开机启动，这样一来 MySQL 就能在系统启动的时候自动启动了。</p><pre tabindex=0><code>$ sudo cp /opt/mysql/server-5.6/support-files/mysql.server /etc/init.d/mysql
$ sudo update-rc.d mysql defaults
</code></pre><h3 id=步骤11仅限-ubuntu-编辑apparmor配置>步骤11：（仅限 Ubuntu） 编辑AppArmor配置</h3><p>MySQL 的上个版本安装时会为 AppArmor 服务创建一个配置文件，这个文件在 MySQL 卸载后会保留在系统中，但是它与现在安装好的 MySQL 版本不兼容。你需要重新编辑下这个配置文件，然后 MySQL 服务才能正常启动。</p><p>首先，建一个软链接。</p><pre tabindex=0><code>$ sudo ln -s /opt/mysql/server-5.6/bin/mysqld /usr/sbin/mysqld
</code></pre><p>然后编辑 MySQL AppArmor 配置文件。</p><pre tabindex=0><code>$ sudo vi /etc/apparmor.d/usr.sbin.mysqld
</code></pre><blockquote><p>/opt/mysql/server-5.6/lib/plugin/ r,</p><p>/opt/mysql/server-5.6/lib/plugin/<em>.so</em> mr,</p><p>/opt/mysql/server-5.6/share/** r,</p></blockquote><p>最后重启 AppArmor 服务。</p><pre tabindex=0><code>$ sudo service apparmor restart
</code></pre><h3 id=步骤12还是仅限-ubuntu删除上个-mysql-版本留下的自启动配置文件>步骤12：（还是仅限 Ubuntu）删除上个 MySQL 版本留下的自启动配置文件。</h3><p>这个版本的 MySQL 使用 SysVinit （就是 /etc/init.d/mysql）来代替。</p><pre tabindex=0><code>$ sudo rm /etc/init/mysql.conf
</code></pre><h3 id=步骤13启动-mysql-服务>步骤13：启动 MySQL 服务。</h3><pre tabindex=0><code>$ sudo service mysql start
</code></pre><h3 id=步骤14恢复-mysql-数据库>步骤14：恢复 MySQL 数据库。</h3><pre tabindex=0><code>$ sudo mysql -u root -p &lt; /backup/backup_db.sql
</code></pre><h3 id=步骤15最后升级-mysql-系统表>步骤15：最后，升级 MySQL 系统表。</h3><pre tabindex=0><code>$ sudo /opt/mysql/server-5.6/bin/mysql_upgrade -v -u root -p
</code></pre><h3 id=解决-mysql-升级过程中产生的问题>解决 MySQL 升级过程中产生的问题</h3><p>如果 Ubuntu 下的 MySQL 服务启动时出现如下错误，就是由于旧版 MySQL AppArmor 配置文件禁止其运行而引起。你需要参考步骤11来更新 AppArmor 的配置文件。</p><pre tabindex=0><code>Dec 20 19:57:48 ubuntu kernel: [ 5856.960592] type=1400 audit(1387598268.807:39): apparmor=&#34;STATUS&#34; operation=&#34;profile_replace&#34; name=&#34;/usr/sbin/mysqld&#34; pid=25216 comm=&#34;apparmor_parser&#34;
</code></pre><hr><p>via: <a href=http://xmodulo.com/2013/12/upgrade-mysql-server-debian-ubuntu.html>http://xmodulo.com/2013/12/upgrade-mysql-server-debian-ubuntu.html</a></p><p>译者：<a href=https://github.com/bazz2>bazz2</a> 校对：<a href=https://github.com/carolinewuyan>Caroline</a></p><p>本文由 <a href=https://github.com/LCTT/TranslateProject>LCTT</a> 原创翻译，<a href=http://linux.cn/>Linux中国</a> 荣誉推出</p></div><footer class=post__footer><div class="post__tags tags clearfix"><svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5.0 11V3C0 1.5.8.8.8.8S1.5.0 3 0h8c1.5.0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 100-6 3 3 0 000 6z"/></svg><ul class=tags__list><li class=tags__item><a class="tags__link btn" href=/tags/linux/ rel=tag>Linux</a></li><li class=tags__item><a class="tags__link btn" href=/tags/debian/ rel=tag>Debian</a></li><li class=tags__item><a class="tags__link btn" href=/tags/ubuntu/ rel=tag>Ubuntu</a></li><li class=tags__item><a class="tags__link btn" href=/tags/mysql/ rel=tag>MySQL</a></li><li class=tags__item><a class="tags__link btn" href=/tags/%E5%8D%87%E7%BA%A7/ rel=tag>升级</a></li><li class=tags__item><a class="tags__link btn" href=/tags/%E6%8A%80%E5%B7%A7/ rel=tag>技巧</a></li><li class=tags__item><a class="tags__link btn" href=/tags/%E6%95%99%E7%A8%8B/ rel=tag>教程</a></li></ul></div></footer></article></main></div></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2025 Linux.cn Archive.
<span class=footer__copyright-credits>Generated with <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> and <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a> theme.</span></div></div></footer></div><script async defer src=/js/menu.js></script></body></html>