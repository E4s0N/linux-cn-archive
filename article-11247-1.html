<!doctype html><html class=no-js lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>SSLH：让 HTTPS 和 SSH 共享同一个端口 - Linux.cn Archive</title>
<script>(function(e,t){e[t]=e[t].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content><meta property="og:title" content="SSLH：让 HTTPS 和 SSH 共享同一个端口"><meta property="og:description" content="如果你遇到大多数端口被防火墙阻止的情况，你可以使用 SSLH 访问远程服务器。这个简短的教程描述了如何在类 Unix 操作系统中使用 SSLH 让 https、ssh 共享相同的端口。"><meta property="og:type" content="article"><meta property="og:url" content="/article-11247-1.html"><meta property="article:section" content="posts"><meta property="article:published_time" content="2019-08-19T20:14:29+00:00"><meta property="article:modified_time" content="2019-08-19T20:14:29+00:00"><meta itemprop=name content="SSLH：让 HTTPS 和 SSH 共享同一个端口"><meta itemprop=description content="如果你遇到大多数端口被防火墙阻止的情况，你可以使用 SSLH 访问远程服务器。这个简短的教程描述了如何在类 Unix 操作系统中使用 SSLH 让 https、ssh 共享相同的端口。"><meta itemprop=datePublished content="2019-08-19T20:14:29+00:00"><meta itemprop=dateModified content="2019-08-19T20:14:29+00:00"><meta itemprop=wordCount content="420"><meta itemprop=keywords content="ssh,https,"><link rel=preconnect href=https://fonts.bunny.net crossorigin><link rel=dns-prefetch href=//fonts.bunny.net><link rel=dns-prefetch href=//fonts.bunny.net><link rel=stylesheet href="https://fonts.bunny.net/css?family=Open+Sans:400,400i,700"><link rel=stylesheet href=/css/style.css><link rel="shortcut icon" href=/favicon.ico></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class=logo><a class=logo__link href=/ title="Linux.cn Archive" rel=home><div class="logo__item logo__text"><div class=logo__title>Linux.cn Archive</div></div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>Menu</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/><span class=menu__text>Home</span></a></li><li class=menu__item><a class=menu__link href=/categories/><span class=menu__text>Categories</span></a></li><li class=menu__item><a class=menu__link href=/tags/><span class=menu__text>Tags</span></a></li><li class=menu__item><a class=menu__link href><span class=menu__text>RSS</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>SSLH：让 HTTPS 和 SSH 共享同一个端口</h1><div class="post__meta meta"><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class=meta__text datetime=2019-08-19T20:14:29Z>August 19, 2019</time></div></div></header><div class="content post__content clearfix"><p><img src=/data/attachment/album/201908/19/201432csw4aewysmmhayse.jpg alt="SSLH - Share A Same Port For HTTPS And SSH"></p><p>一些 ISP 和公司可能已经阻止了大多数端口，并且只允许少数特定端口（如端口 80 和 443）访问来加强其安全性。在这种情况下，我们别无选择，但同一个端口可以用于多个程序，比如 HTTPS 端口 443，很少被阻止。通过 SSL/SSH 多路复用器 SSLH 的帮助，它可以侦听端口 443 上的传入连接。更简单地说，SSLH 允许我们在 Linux 系统上的端口 443 上运行多个程序/服务。因此，你可以同时通过同一个端口同时使用 SSL 和 SSH。如果你遇到大多数端口被防火墙阻止的情况，你可以使用 SSLH 访问远程服务器。这个简短的教程描述了如何在类 Unix 操作系统中使用 SSLH 让 https、ssh 共享相同的端口。</p><h3 id=sslh让-httpsssh-共享端口>SSLH：让 HTTPS、SSH 共享端口</h3><h4 id=安装-sslh>安装 SSLH</h4><p>大多数 Linux 发行版上 SSLH 都有软件包，因此你可以使用默认包管理器进行安装。</p><p>在 Debian、Ubuntu 及其衍生品上运行：</p><pre tabindex=0><code>$ sudo apt-get install sslh
</code></pre><p>安装 SSLH 时，将提示你是要将 sslh 作为从 inetd 运行的服务，还是作为独立服务器运行。每种选择都有其自身的优点。如果每天只有少量连接，最好从 inetd 运行 sslh 以节省资源。另一方面，如果有很多连接，sslh 应作为独立服务器运行，以避免为每个传入连接生成新进程。</p><p><img src=/data/attachment/album/201908/19/201433isti0tpp0p1drem0.png alt></p><p><em>安装 sslh</em></p><p>在 Arch Linux 和 Antergos、Manjaro Linux 等衍生品上，使用 Pacman 进行安装，如下所示：</p><pre tabindex=0><code>$ sudo pacman -S sslh
</code></pre><p>在 RHEL、CentOS 上，你需要添加 EPEL 存储库，然后安装 SSLH，如下所示：</p><pre tabindex=0><code>$ sudo yum install epel-release
$ sudo yum install sslh
</code></pre><p>在 Fedora：</p><pre tabindex=0><code>$ sudo dnf install sslh
</code></pre><p>如果它在默认存储库中不可用，你可以如<a href=https://github.com/yrutschle/sslh/blob/master/doc/INSTALL.md>这里</a>所述手动编译和安装 SSLH。</p><h4 id=配置-apache-或-nginx-web-服务器>配置 Apache 或 Nginx Web 服务器</h4><p>如你所知，Apache 和 Nginx Web 服务器默认会监听所有网络接口（即 <code>0.0.0.0:443</code>）。我们需要更改此设置以告知 Web 服务器仅侦听 <code>localhost</code> 接口（即 <code>127.0.0.1:443</code> 或 <code>localhost:443</code>）。</p><p>为此，请编辑 Web 服务器（nginx 或 apache）配置文件并找到以下行：</p><pre tabindex=0><code>listen 443 ssl;
</code></pre><p>将其修改为：</p><pre tabindex=0><code>listen 127.0.0.1:443 ssl;
</code></pre><p>如果你在 Apache 中使用虚拟主机，请确保你也修改了它。</p><pre tabindex=0><code>VirtualHost 127.0.0.1:443
</code></pre><p>保存并关闭配置文件。不要重新启动该服务。我们还没有完成。</p><h4 id=配置-sslh>配置 SSLH</h4><p>使 Web 服务器仅在本地接口上侦听后，编辑 SSLH 配置文件：</p><pre tabindex=0><code>$ sudo vi /etc/default/sslh
</code></pre><p>找到下列行：</p><pre tabindex=0><code>Run=no
</code></pre><p>将其修改为：</p><pre tabindex=0><code>Run=yes
</code></pre><p>然后，向下滚动一点并修改以下行以允许 SSLH 在所有可用接口上侦听端口 443（例如 <code>0.0.0.0:443</code>）。</p><pre tabindex=0><code>DAEMON_OPTS=&#34;--user sslh --listen 0.0.0.0:443 --ssh 127.0.0.1:22 --ssl 127.0.0.1:443 --pidfile /var/run/sslh/sslh.pid&#34;
</code></pre><p>这里，</p><ul><li><code>–user sslh</code>：要求在这个特定的用户身份下运行。</li><li><code>–listen 0.0.0.0:443</code>：SSLH 监听于所有可用接口的 443 端口。</li><li><code>–sshs 127.0.0.1:22</code> : 将 SSH 流量路由到本地的 22 端口。</li><li><code>–ssl 127.0.0.1:443</code> : 将 HTTPS/SSL 流量路由到本地的 443 端口。</li></ul><p>保存并关闭文件。</p><p>最后，启用并启动 <code>sslh</code> 服务以更新更改。</p><pre tabindex=0><code>$ sudo systemctl enable sslh
$ sudo systemctl start sslh
</code></pre><h4 id=测试>测试</h4><p>检查 SSLH 守护程序是否正在监听 443。</p><pre tabindex=0><code>$ ps -ef | grep sslh
sslh 2746 1 0 15:51 ? 00:00:00 /usr/sbin/sslh --foreground --user sslh --listen 0.0.0.0 443 --ssh 127.0.0.1 22 --ssl 127.0.0.1 443 --pidfile /var/run/sslh/sslh.pid
sslh 2747 2746 0 15:51 ? 00:00:00 /usr/sbin/sslh --foreground --user sslh --listen 0.0.0.0 443 --ssh 127.0.0.1 22 --ssl 127.0.0.1 443 --pidfile /var/run/sslh/sslh.pid
sk 2754 1432 0 15:51 pts/0 00:00:00 grep --color=auto sslh
</code></pre><p>现在，你可以使用端口 443 通过 SSH 访问远程服务器：</p><pre tabindex=0><code>$ ssh -p 443 [email protected]
</code></pre><p>示例输出：</p><pre tabindex=0><code>[email protected]&#39;s password:
Welcome to Ubuntu 18.04.2 LTS (GNU/Linux 4.15.0-55-generic x86_64)

* Documentation: https://help.ubuntu.com
* Management: https://landscape.canonical.com
* Support: https://ubuntu.com/advantage

System information as of Wed Aug 14 13:11:04 IST 2019

System load: 0.23 Processes: 101
Usage of /: 53.5% of 19.56GB Users logged in: 0
Memory usage: 9% IP address for enp0s3: 192.168.225.50
Swap usage: 0% IP address for enp0s8: 192.168.225.51

* Keen to learn Istio? It&#39;s included in the single-package MicroK8s.

https://snapcraft.io/microk8s

61 packages can be updated.
22 updates are security updates.


Last login: Wed Aug 14 13:10:33 2019 from 127.0.0.1
</code></pre><p><img src=/data/attachment/album/201908/19/201435x73rmjrmlyzw41lm.png alt></p><p><em>通过 SSH 使用 443 端口访问远程系统</em></p><p>看见了吗？即使默认的 SSH 端口 22 被阻止，我现在也可以通过 SSH 访问远程服务器。正如你在上面的示例中所看到的，我使用 https 端口 443 进行 SSH 连接。</p><p>我在我的 Ubuntu 18.04 LTS 服务器上测试了 SSLH，它如上所述工作得很好。我在受保护的局域网中测试了 SSLH，所以我不知道是否有安全问题。如果你在生产环境中使用它，请在下面的评论部分中告诉我们使用 SSLH 的优缺点。</p><p>有关更多详细信息，请查看下面给出的官方 GitHub 页面。</p><p>资源：</p><ul><li><a href=https://github.com/yrutschle/sslh>SSLH GitHub 仓库</a></li></ul><hr><p>via: <a href=https://www.ostechnix.com/sslh-share-port-https-ssh/>https://www.ostechnix.com/sslh-share-port-https-ssh/</a></p><p>作者：<a href=https://www.ostechnix.com/author/sk/>sk</a> 选题：<a href=https://github.com/lujun9972>lujun9972</a> 译者：<a href=https://github.com/wxy>wxy</a> 校对：<a href=https://github.com/wxy>wxy</a></p><p>本文由 <a href=https://github.com/LCTT/TranslateProject>LCTT</a> 原创编译，<a href=https://linux.cn/>Linux中国</a> 荣誉推出</p></div><footer class=post__footer><div class="post__tags tags clearfix"><svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5.0 11V3C0 1.5.8.8.8.8S1.5.0 3 0h8c1.5.0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 100-6 3 3 0 000 6z"/></svg><ul class=tags__list><li class=tags__item><a class="tags__link btn" href=/tags/ssh/ rel=tag>ssh</a></li><li class=tags__item><a class="tags__link btn" href=/tags/https/ rel=tag>https</a></li></ul></div></footer></article></main></div></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2025 Linux.cn Archive.
<span class=footer__copyright-credits>Generated with <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> and <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a> theme.</span></div></div></footer></div><script async defer src=/js/menu.js></script></body></html>