<!doctype html><html class=no-js lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>使用iSCSI Target创建集中式安全存储（一） - Linux.cn Archive</title>
<script>(function(e,t){e[t]=e[t].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content><meta property="og:title" content="使用iSCSI Target创建集中式安全存储（一）"><meta property="og:description" content="iSCSI 是一种块级别的协议，用于通过TCP/IP网络共享原始存储设备，可以用已经存在的IP和以太网如网卡、交换机、路由器等通过iSCSI协议共享和访问存储。iSCSI target是一种由远程iSCSI服务器（target）提供的远程硬盘。  在Linux中安装iSCSI Target 我们不需要占用很大的资源就可以为客户端提供稳定的连接和性能。iSCSI服务器称为Target（目标器），它提供服务器上的存储共享。iSCSI客户端称为Initiator（发起程序），它访问Target服务器共享的存储。市场中有卖的用于大型存储服务如SAN的iSCSI适配器。 我们为什么要在大型存储领域中使用iS"><meta property="og:type" content="article"><meta property="og:url" content="/article-4971-1.html"><meta property="article:section" content="posts"><meta property="article:published_time" content="2015-03-02T14:24:00+00:00"><meta property="article:modified_time" content="2015-03-02T14:24:00+00:00"><meta itemprop=name content="使用iSCSI Target创建集中式安全存储（一）"><meta itemprop=description content="iSCSI 是一种块级别的协议，用于通过TCP/IP网络共享原始存储设备，可以用已经存在的IP和以太网如网卡、交换机、路由器等通过iSCSI协议共享和访问存储。iSCSI target是一种由远程iSCSI服务器（target）提供的远程硬盘。  在Linux中安装iSCSI Target 我们不需要占用很大的资源就可以为客户端提供稳定的连接和性能。iSCSI服务器称为Target（目标器），它提供服务器上的存储共享。iSCSI客户端称为Initiator（发起程序），它访问Target服务器共享的存储。市场中有卖的用于大型存储服务如SAN的iSCSI适配器。 我们为什么要在大型存储领域中使用iS"><meta itemprop=datePublished content="2015-03-02T14:24:00+00:00"><meta itemprop=dateModified content="2015-03-02T14:24:00+00:00"><meta itemprop=wordCount content="206"><meta itemprop=keywords content="存储,iSCSI,"><link rel=preconnect href=https://fonts.bunny.net crossorigin><link rel=dns-prefetch href=//fonts.bunny.net><link rel=dns-prefetch href=//fonts.bunny.net><link rel=stylesheet href="https://fonts.bunny.net/css?family=Open+Sans:400,400i,700"><link rel=stylesheet href=/css/style.css><link rel="shortcut icon" href=/favicon.ico></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class=logo><a class=logo__link href=/ title="Linux.cn Archive" rel=home><div class="logo__item logo__text"><div class=logo__title>Linux.cn Archive</div></div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>Menu</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/><span class=menu__text>Home</span></a></li><li class=menu__item><a class=menu__link href=/categories/><span class=menu__text>Categories</span></a></li><li class=menu__item><a class=menu__link href=/tags/><span class=menu__text>Tags</span></a></li><li class=menu__item><a class=menu__link href><span class=menu__text>RSS</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>使用iSCSI Target创建集中式安全存储（一）</h1><div class="post__meta meta"><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class=meta__text datetime=2015-03-02T14:24:00Z>March 02, 2015</time></div></div></header><div class="content post__content clearfix"><p><strong>iSCSI</strong> 是一种块级别的协议，用于通过TCP/IP网络共享<strong>原始存储设备</strong>，可以用已经存在的IP和以太网如网卡、交换机、路由器等通过iSCSI协议共享和访问存储。iSCSI target是一种由远程iSCSI服务器（target）提供的远程硬盘。</p><p><img src=/data/attachment/album/201503/02/142405cn0z3sr7bbbu77i3.jpg alt="Install iSCSI Target in Linux"></p><p><em>在Linux中安装iSCSI Target</em></p><p>我们不需要占用很大的资源就可以为客户端提供稳定的连接和性能。iSCSI服务器称为“Target（目标器）”，它提供服务器上的存储共享。iSCSI客户端称为“Initiator（发起程序）”，它访问目标器共享的存储。市场中有卖的用于大型存储服务如SAN的iSCSI适配器。</p><p><strong>我们为什么要在大型存储领域中使用iSCSI适配器</strong></p><p>以太网适配器（NIC）被设计用于在系统、服务器和存储设备如NAS间传输分组数据，它不适合在Internet中传输块级数据。</p><h3 id=iscsi-target的功能>iSCSI Target的功能</h3><ul><li>可以在一台机器上运行几个iSCSI 目标器</li><li>一台机器可以提供多个iSCSI 目标器用于iSCSI SAN访问</li><li>一个目标器就是一块存储，并且可以通过网络被发起程序（客户端）访问</li><li>把这些存储汇聚在一起让它们在网络中可以访问的是iSCSI LUN（逻辑单元号）</li><li>iSCSI支持在同一个会话中使用多个连接</li><li>iSCSI发起程序在网络中发现目标接着用LUN验证并登录，这样就可以本地访问远程存储。</li><li>我们可以在本地挂载的LUN上安装任何操作系统，就像我们安装我们本地的操作系统一样。</li></ul><h3 id=为什么需要iscsi>为什么需要iSCSI？</h3><p>在虚拟化中，我们需要存储拥有高度的冗余性、稳定性，iSCSI以低成本的方式提供了这些特性。与使用光纤通道的SAN比起来，我们可以使用已经存在的设备比如NIC、以太网交换机等建造一个低成本的SAN。</p><p>现在我开始使用iSCSI 目标器安装并配置安全存储。本篇中，我们遵循下面的步骤：</p><ul><li>我们需要隔离一个系统来设置iSCSI 目标器和发起程序（客户端）。</li><li>在大型存储环境中可以添加多个硬盘，但是这里我们除了基本的安装盘之外只使用了一个额外的驱动器。</li><li>这里我们只使用了2块硬盘，一个用于基本的服务器安装，另外一个用于存储（LUN），这个我们会在这个系列的第二篇描述。</li></ul><h4 id=主服务器设置>主服务器设置</h4><ul><li>操作系统 – CentOS 6.5 (Final)</li><li>iSCSI 目标器 IP – 192.168.0.200</li><li>使用的端口 : TCP 860, 3260</li><li>配置文件 : /etc/tgt/targets.conf</li></ul><h3 id=安装-iscsi-target>安装 iSCSI Target</h3><p>打开终端并使用yum命令来搜索需要在iscsi 目标器上安装的包名。</p><pre tabindex=0><code># yum search iscsi
</code></pre><p>输出示例</p><pre tabindex=0><code>========================== N/S matched: iscsi =======================
iscsi-initiator-utils.x86_64 : iSCSI daemon and utility programs
iscsi-initiator-utils-devel.x86_64 : Development files for iscsi-initiator-utils
lsscsi.x86_64 : List SCSI devices (or hosts) and associated information
scsi-target-utils.x86_64 : The SCSI target daemon and utility programs
</code></pre><p>你会的到上面的那些结果，选择<strong>Target</strong>包来安装。</p><pre tabindex=0><code># yum install scsi-target-utils -y
</code></pre><p><img src=/data/attachment/album/201503/02/142406e4vexvl2aqxayjja.jpg alt="Install iSCSI Utils"></p><p><em>安装iSCSI工具</em></p><p>列出安装的包里面的内容来了解默认的配置、服务和man页面的位置。</p><pre tabindex=0><code># rpm -ql scsi-target-utils.x86_64
</code></pre><p><img src=/data/attachment/album/201503/02/142407rkv6v1ev168k12kk.jpg alt="List All iSCSI Files"></p><p><em>列出所有的iSCSI包里面的文件</em></p><p>让我们启动iSCSI服务，并检查服务运行的状态，iSCSI的服务名是<strong>tgtd</strong>。</p><pre tabindex=0><code># /etc/init.d/tgtd start
# /etc/init.d/tgtd status
</code></pre><p><img src=/data/attachment/album/201503/02/142408vl04o120l2cyzz50.jpg alt="Start iSCSI Service"></p><p><em>启动iSCSI服务</em></p><p>现在我们需要配置开机自动启动。</p><pre tabindex=0><code># chkconfig tgtd on
</code></pre><p>现在验证tgtd服务的运行级别是否配置正确。</p><pre tabindex=0><code># chkconfig --list tgtd
</code></pre><p><img src=/data/attachment/album/201503/02/142408ddsnl4zdq433aqzl.jpg alt="Enable iSCSI on Startup"></p><p><em>开机启动iSCSI</em></p><p>现在使用<strong>tgtadm</strong>来列出在我们的服务器上已经配置了哪些target和LUN。</p><pre tabindex=0><code># tgtadm --mode target --op show
</code></pre><p><strong>tgtd</strong>已经安装并在运行了，但是上面的命令没有<strong>输出</strong>因为我们还没有在Target服务器上定义LUN。要查看手册，可以运行‘<strong>man</strong>‘命令。</p><pre tabindex=0><code># man tgtadm
</code></pre><p><img src=/data/attachment/album/201503/02/142409ulsul7w2djtu9fsl.jpg alt="iSCSI Man Pages"></p><p><em>iSCSI Man 页面</em></p><p>如果你的目标器上有iptable的话，那么我们需要为iSCSI添加iptable规则。首先使用netstat命令找出iscsi target的端口号，目标器总是监听TCP端口3260。</p><pre tabindex=0><code># netstat -tulnp | grep tgtd
</code></pre><p><img src=/data/attachment/album/201503/02/142410g11xzpx9bdx1zzdr.jpg alt="Find iSCSI Port"></p><p><em>找出iSCSI端口</em></p><p>下面加入如下规则让iptable允许广播iSCSI 目标器发现包。</p><pre tabindex=0><code># iptables -A INPUT -i eth0 -p tcp --dport 860 -m state --state NEW,ESTABLISHED -j ACCEPT
# iptables -A INPUT -i eth0 -p tcp --dport 3260 -m state --state NEW,ESTABLISHED -j ACCEPT
</code></pre><p><img src=/data/attachment/album/201503/02/142411flaadxtavta4tlzh.jpg alt="Open iSCSI Ports"></p><p><em>打开iSCSI端口</em></p><p><img src=/data/attachment/album/201503/02/142412j5xb76t79n6x9n56.jpg alt="Add iSCSI Ports to Iptables"></p><p><em>添加iSCSI端口到iptable中</em></p><p><strong>注意</strong>： 规则可能根据你的<strong>默认链策略</strong>而不同。接着保存iptable并重启该服务。</p><pre tabindex=0><code># iptables-save
# /etc/init.d/iptables restart
</code></pre><p><img src=/data/attachment/album/201503/02/142413azw542xmq3rwfek4.jpg alt="Restart iptables"></p><p><em>重启iptable</em></p><p>现在我们已经部署了一个目标器来共享LUN给通过TCP/IP认证的发起程序。这也适用于从小到大规模的生产环境。</p><p>在我的下篇文章中，我会展示如何<a href=http://www.tecmint.com/create-luns-using-lvm-in-iscsi-target/>在目标器中使用LVM创建LUN</a>，并且如何在客户端中共享LUN，不要忘记留下有价值的评论。</p><hr><p>via: <a href=http://www.tecmint.com/create-centralized-secure-storage-using-iscsi-targetin-linux/>http://www.tecmint.com/create-centralized-secure-storage-using-iscsi-targetin-linux/</a></p><p>作者：<a href=http://www.tecmint.com/author/babinlonston/>Babin Lonston</a> 译者：<a href=https://github.com/geekpi>geekpi</a> 校对：<a href=https://github.com/wxy>wxy</a></p><p>本文由 <a href=https://github.com/LCTT/TranslateProject>LCTT</a> 原创翻译，<a href=http://linux.cn/>Linux中国</a> 荣誉推出</p></div><footer class=post__footer><div class="post__tags tags clearfix"><svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5.0 11V3C0 1.5.8.8.8.8S1.5.0 3 0h8c1.5.0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 100-6 3 3 0 000 6z"/></svg><ul class=tags__list><li class=tags__item><a class="tags__link btn" href=/tags/%E5%AD%98%E5%82%A8/ rel=tag>存储</a></li><li class=tags__item><a class="tags__link btn" href=/tags/iscsi/ rel=tag>iSCSI</a></li></ul></div></footer></article></main></div></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2025 Linux.cn Archive.
<span class=footer__copyright-credits>Generated with <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> and <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a> theme.</span></div></div></footer></div><script async defer src=/js/menu.js></script></body></html>