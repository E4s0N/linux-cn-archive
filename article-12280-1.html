<!doctype html><html class=no-js lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>使用 Python FastAPI 构建 Web 服务 - Linux.cn Archive</title>
<script>(function(e,t){e[t]=e[t].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content><meta property="og:title" content="使用 Python FastAPI 构建 Web 服务"><meta property="og:description" content="FastAPI 是一个使用 Python 编写的 Web 框架，还应用了 Python asyncio 库中最新的优化。本文将会介绍如何搭建基于容器的开发环境，还会展示如何使用 FastAPI 实现一个小型 Web 服务。"><meta property="og:type" content="article"><meta property="og:url" content="/article-12280-1.html"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-06-04T11:00:04+00:00"><meta property="article:modified_time" content="2020-06-04T11:00:04+00:00"><meta itemprop=name content="使用 Python FastAPI 构建 Web 服务"><meta itemprop=description content="FastAPI 是一个使用 Python 编写的 Web 框架，还应用了 Python asyncio 库中最新的优化。本文将会介绍如何搭建基于容器的开发环境，还会展示如何使用 FastAPI 实现一个小型 Web 服务。"><meta itemprop=datePublished content="2020-06-04T11:00:04+00:00"><meta itemprop=dateModified content="2020-06-04T11:00:04+00:00"><meta itemprop=wordCount content="333"><meta itemprop=keywords content="FastAPI,"><link rel=preconnect href=https://fonts.bunny.net crossorigin><link rel=dns-prefetch href=//fonts.bunny.net><link rel=dns-prefetch href=//fonts.bunny.net><link rel=stylesheet href="https://fonts.bunny.net/css?family=Open+Sans:400,400i,700"><link rel=stylesheet href=/css/style.css><link rel="shortcut icon" href=/favicon.ico></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class=logo><a class=logo__link href=/ title="Linux.cn Archive" rel=home><div class="logo__item logo__text"><div class=logo__title>Linux.cn Archive</div></div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>Menu</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/><span class=menu__text>Home</span></a></li><li class=menu__item><a class=menu__link href=/categories/><span class=menu__text>Categories</span></a></li><li class=menu__item><a class=menu__link href=/tags/><span class=menu__text>Tags</span></a></li><li class=menu__item><a class=menu__link href><span class=menu__text>RSS</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>使用 Python FastAPI 构建 Web 服务</h1><div class="post__meta meta"><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class=meta__text datetime=2020-06-04T11:00:04Z>June 04, 2020</time></div></div></header><div class="content post__content clearfix"><p><img src=/data/attachment/album/202006/04/105930wr333sx3erz3k2ur.jpg alt></p><p><a href=https://fastapi.tiangolo.com/>FastAPI</a> 是一个使用 Python 编写的 Web 框架，还应用了 Python asyncio 库中最新的优化。本文将会介绍如何搭建基于容器的开发环境，还会展示如何使用 FastAPI 实现一个小型 Web 服务。</p><h3 id=起步>起步</h3><p>我们将使用 Fedora 作为基础镜像来搭建开发环境，并使用 Dockerfile 为镜像注入 FastAPI、<a href=https://www.uvicorn.org/>Uvicorn</a> 和 <a href=https://github.com/Tinche/aiofiles>aiofiles</a> 这几个包。</p><pre tabindex=0><code>FROM fedora:32
RUN dnf install -y python-pip \
    &amp;&amp; dnf clean all \
    &amp;&amp; pip install fastapi uvicorn aiofiles
WORKDIR /srv
CMD [&#34;uvicorn&#34;, &#34;main:app&#34;, &#34;--reload&#34;]
</code></pre><p>在工作目录下保存 <code>Dockerfile</code> 之后，执行 <code>podman</code> 命令构建容器镜像。</p><pre tabindex=0><code>$ podman build -t fastapi .
$ podman images
REPOSITORY TAG IMAGE ID CREATED SIZE
localhost/fastapi latest 01e974cabe8b 18 seconds ago 326 MB
</code></pre><p>下面我们可以开始创建一个简单的 FastAPI 应用程序，并通过容器镜像运行。</p><pre tabindex=0><code>from fastapi import FastAPI

app = FastAPI()

@app.get(&#34;/&#34;)
async def root():
    return {&#34;message&#34;: &#34;Hello Fedora Magazine!&#34;}
</code></pre><p>将上面的代码保存到 <code>main.py</code> 文件中，然后执行以下命令开始运行：</p><pre tabindex=0><code>$ podman run --rm -v $PWD:/srv:z -p 8000:8000 --name fastapi -d fastapi
$ curl http://127.0.0.1:8000
{&#34;message&#34;:&#34;Hello Fedora Magazine!&#34;
</code></pre><p>这样，一个基于 FastAPI 的 Web 服务就跑起来了。由于指定了 <code>--reload</code> 参数，一旦 <code>main.py</code> 文件发生了改变，整个应用都会自动重新加载。你可以尝试将返回信息 <code>"Hello Fedora Magazine!"</code> 修改为其它内容，然后观察效果。</p><p>可以使用以下命令停止应用程序：</p><pre tabindex=0><code>$ podman stop fastapi
</code></pre><h3 id=构建一个小型-web-服务>构建一个小型 Web 服务</h3><p>接下来我们会构建一个需要 I/O 操作的应用程序，通过这个应用程序，我们可以看到 FastAPI 自身的特点，以及它在性能上有什么优势（可以在<a href="https://www.techempower.com/benchmarks/#section=test&amp;runid=7464e520-0dc2-473d-bd34-dbdfd7e85911&amp;hw=ph&amp;test=composite&amp;l=z8kflr-v&amp;a=2&amp;f=jz8cg-0-3s-0-3k-6bo-0-0-18y74-8s5c-0">这里</a>参考 FastAPI 和其它 Python Web 框架的对比）。为简单起见，我们直接使用 <code>dnf history</code> 命令的输出来作为这个应用程序使用的数据。</p><p>首先将 <code>dnf history</code> 命令的输出保存到文件。</p><pre tabindex=0><code>$ dnf history | tail --lines=+3 &gt; history.txt
</code></pre><p>在上面的命令中，我们使用 <code>tail</code> 去除了 <code>dnf history</code> 输出内容中无用的表头信息。剩余的每一条 <code>dnf</code> 事务都包括了以下信息：</p><ul><li><code>id</code>：事务编号（每次运行一条新事务时该编号都会递增）</li><li><code>command</code>：事务中运行的 <code>dnf</code> 命令</li><li><code>date</code>：执行事务的日期和时间</li></ul><p>然后修改 <code>main.py</code> 文件将相关的数据结构添加进去。</p><pre tabindex=0><code>from fastapi import FastAPI
from pydantic import BaseModel

app = FastAPI()

class DnfTransaction(BaseModel):
    id: int
    command: str
    date: str
</code></pre><p>FastAPI 自带的 <a href=https://pydantic-docs.helpmanual.io/>pydantic</a> 库让你可以轻松定义一个数据类，其中的类型注释对数据的验证也提供了方便。</p><p>再增加一个函数，用于从 <code>history.txt</code> 文件中读取数据。</p><pre tabindex=0><code>import aiofiles

from fastapi import FastAPI
from pydantic import BaseModel

app = FastAPI()

class DnfTransaction(BaseModel):
    id: int
    command: str
    date: str


async def read_history():
    transactions = []
    async with aiofiles.open(&#34;history.txt&#34;) as f:
        async for line in f:
            transactions.append(DnfTransaction(
                id=line.split(&#34;|&#34;)[0].strip(&#34; &#34;),
                command=line.split(&#34;|&#34;)[1].strip(&#34; &#34;),
                date=line.split(&#34;|&#34;)[2].strip(&#34; &#34;)))
    return transactions
</code></pre><p>这个函数中使用了 <code>aiofiles</code> 库，这个库提供了一个异步 API 来处理 Python 中的文件，因此打开文件或读取文件的时候不会阻塞其它对服务器的请求。</p><p>最后，修改 <code>root</code> 函数，让它返回事务列表中的数据。</p><pre tabindex=0><code>@app.get(&#34;/&#34;)
async def read_root():
    return await read_history()
</code></pre><p>执行以下命令就可以看到应用程序的输出内容了。</p><pre tabindex=0><code>$ curl http://127.0.0.1:8000 | python -m json.tool
[
{
&#34;id&#34;: 103,
&#34;command&#34;: &#34;update&#34;,
&#34;date&#34;: &#34;2020-05-25 08:35&#34;
},
{
&#34;id&#34;: 102,
&#34;command&#34;: &#34;update&#34;,
&#34;date&#34;: &#34;2020-05-23 15:46&#34;
},
{
&#34;id&#34;: 101,
&#34;command&#34;: &#34;update&#34;,
&#34;date&#34;: &#34;2020-05-22 11:32&#34;
},
....
]
</code></pre><h3 id=总结>总结</h3><p>FastAPI 提供了一种使用 asyncio 构建 Web 服务的简单方法，因此它在 Python Web 框架的生态中日趋流行。要了解 FastAPI 的更多信息，欢迎查阅 <a href=https://fastapi.tiangolo.com/>FastAPI 文档</a>。</p><p>本文中的代码可以在 <a href=https://github.com/cverna/fastapi_app>GitHub</a> 上找到。</p><hr><p>via: <a href=https://fedoramagazine.org/use-fastapi-to-build-web-services-in-python/>https://fedoramagazine.org/use-fastapi-to-build-web-services-in-python/</a></p><p>作者：<a href=https://fedoramagazine.org/author/cverna/>Clément Verna</a> 选题：<a href=https://github.com/lujun9972>lujun9972</a> 译者：<a href=https://github.com/HankChow>HankChow</a> 校对：<a href=https://github.com/wxy>wxy</a></p><p>本文由 <a href=https://github.com/LCTT/TranslateProject>LCTT</a> 原创编译，<a href=https://linux.cn/>Linux中国</a> 荣誉推出</p></div><footer class=post__footer><div class="post__tags tags clearfix"><svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5.0 11V3C0 1.5.8.8.8.8S1.5.0 3 0h8c1.5.0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 100-6 3 3 0 000 6z"/></svg><ul class=tags__list><li class=tags__item><a class="tags__link btn" href=/tags/fastapi/ rel=tag>FastAPI</a></li></ul></div></footer></article></main></div></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2025 Linux.cn Archive.
<span class=footer__copyright-credits>Generated with <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> and <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a> theme.</span></div></div></footer></div><script async defer src=/js/menu.js></script></body></html>