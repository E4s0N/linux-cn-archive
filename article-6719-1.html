<!doctype html><html class=no-js lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>如何在 CentOS 7 上安装 Redis 服务器 - Linux.cn Archive</title>
<script>(function(e,t){e[t]=e[t].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content><meta property="og:title" content="如何在 CentOS 7 上安装 Redis 服务器"><meta property="og:description" content="大家好，本文的主题是 Redis，我们将要在 CentOS 7 上安装它。编译源代码，安装二进制文件，创建、安装文件。在安装了它的组件之后，我们还会配置 redis ，就像配置操作系统参数一样，目标就是让 redis 运行的更加可靠和快速。  Redis 服务器 Redis 是一个开源的多平台数据存储软件，使用 ANSI C 编写，直接在内存使用数据集，这使得它得以实现非常高的效率。Redis 支持多种编程语言，包括 Lua, C, Java, Python, Perl, PHP 和其他很多语言。redis 的代码量很小，只有约3万行，它只做很少的事，但是做的很好。尽管是在内存里工作，但是数"><meta property="og:type" content="article"><meta property="og:url" content="/article-6719-1.html"><meta property="article:section" content="posts"><meta property="article:published_time" content="2015-12-10T13:45:00+00:00"><meta property="article:modified_time" content="2015-12-10T13:45:00+00:00"><meta itemprop=name content="如何在 CentOS 7 上安装 Redis 服务器"><meta itemprop=description content="大家好，本文的主题是 Redis，我们将要在 CentOS 7 上安装它。编译源代码，安装二进制文件，创建、安装文件。在安装了它的组件之后，我们还会配置 redis ，就像配置操作系统参数一样，目标就是让 redis 运行的更加可靠和快速。  Redis 服务器 Redis 是一个开源的多平台数据存储软件，使用 ANSI C 编写，直接在内存使用数据集，这使得它得以实现非常高的效率。Redis 支持多种编程语言，包括 Lua, C, Java, Python, Perl, PHP 和其他很多语言。redis 的代码量很小，只有约3万行，它只做很少的事，但是做的很好。尽管是在内存里工作，但是数"><meta itemprop=datePublished content="2015-12-10T13:45:00+00:00"><meta itemprop=dateModified content="2015-12-10T13:45:00+00:00"><meta itemprop=wordCount content="341"><meta itemprop=keywords content="redis,"><link rel=preconnect href=https://fonts.bunny.net crossorigin><link rel=dns-prefetch href=//fonts.bunny.net><link rel=dns-prefetch href=//fonts.bunny.net><link rel=stylesheet href="https://fonts.bunny.net/css?family=Open+Sans:400,400i,700"><link rel=stylesheet href=/css/style.css><link rel="shortcut icon" href=/favicon.ico></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class=logo><a class=logo__link href=/ title="Linux.cn Archive" rel=home><div class="logo__item logo__text"><div class=logo__title>Linux.cn Archive</div></div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>Menu</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/><span class=menu__text>Home</span></a></li><li class=menu__item><a class=menu__link href=/categories/><span class=menu__text>Categories</span></a></li><li class=menu__item><a class=menu__link href=/tags/><span class=menu__text>Tags</span></a></li><li class=menu__item><a class=menu__link href><span class=menu__text>RSS</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>如何在 CentOS 7 上安装 Redis 服务器</h1><div class="post__meta meta"><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class=meta__text datetime=2015-12-10T13:45:00Z>December 10, 2015</time></div></div></header><div class="content post__content clearfix"><p>大家好，本文的主题是 Redis，我们将要在 CentOS 7 上安装它。编译源代码，安装二进制文件，创建、安装文件。在安装了它的组件之后，我们还会配置 redis ，就像配置操作系统参数一样，目标就是让 redis 运行的更加可靠和快速。</p><p><img src=/data/attachment/album/201512/09/224958pimc2elz4f88ikzt.jpg alt="Runnins Redis"></p><p><em>Redis 服务器</em></p><p>Redis 是一个开源的多平台数据存储软件，使用 ANSI C 编写，直接在内存使用数据集，这使得它得以实现非常高的效率。Redis 支持多种编程语言，包括 Lua, C, Java, Python, Perl, PHP 和其他很多语言。redis 的代码量很小，只有约3万行，它只做“很少”的事，但是做的很好。尽管是在内存里工作，但是数据持久化的保存还是有的，而redis 的可靠性就很高，同时也支持集群，这些可以很好的保证你的数据安全。</p><h3 id=构建-redis>构建 Redis</h3><p>redis 目前没有官方 RPM 安装包，我们需要从源代码编译，而为了要编译就需要安装 Make 和 GCC。</p><p>如果没有安装过 GCC 和 Make，那么就使用 yum 安装。</p><pre tabindex=0><code>yum install gcc make
</code></pre><p>从<a href=http://redis.io/download>官网</a>下载 tar 压缩包。</p><pre tabindex=0><code>curl http://download.redis.io/releases/redis-3.0.4.tar.gz -o redis-3.0.4.tar.gz
</code></pre><p>解压缩。</p><pre tabindex=0><code>tar zxvf redis-3.0.4.tar.gz
</code></pre><p>进入解压后的目录。</p><pre tabindex=0><code>cd redis-3.0.4
</code></pre><p>使用Make 编译源文件。</p><pre tabindex=0><code>make
</code></pre><h3 id=安装>安装</h3><p>进入源文件的目录。</p><pre tabindex=0><code>cd src
</code></pre><p>复制 Redis 的服务器和客户端到 /usr/local/bin。</p><pre tabindex=0><code>cp redis-server redis-cli /usr/local/bin
</code></pre><p>最好也把 sentinel，benchmark 和 check 复制过去。</p><pre tabindex=0><code>cp redis-sentinel redis-benchmark redis-check-aof redis-check-dump /usr/local/bin
</code></pre><p>创建redis 配置文件夹。</p><pre tabindex=0><code>mkdir /etc/redis
</code></pre><p>在<code>/var/lib/redis</code> 下创建有效的保存数据的目录</p><pre tabindex=0><code>mkdir -p /var/lib/redis/6379
</code></pre><h4 id=系统参数>系统参数</h4><p>为了让 redis 正常工作需要配置一些内核参数。</p><p>配置 <code>vm.overcommit_memory</code> 为1，这可以避免数据被截断，详情<a href=https://www.kernel.org/doc/Documentation/vm/overcommit-accounting>见此</a>。</p><pre tabindex=0><code>sysctl -w vm.overcommit_memory=1
</code></pre><p>修改 backlog 连接数的最大值超过 redis.conf 中的 <code>tcp-backlog</code> 值，即默认值511。你可以在<a href=https://www.kernel.org/doc/Documentation/networking/ip-sysctl.txt>kernel.org</a> 找到更多有关基于 sysctl 的 ip 网络隧道的信息。</p><pre tabindex=0><code>sysctl -w net.core.somaxconn=512
</code></pre><p>取消对透明巨页内存（transparent huge pages）的支持，因为这会造成 redis 使用过程产生延时和内存访问问题。</p><pre tabindex=0><code>echo never &gt; /sys/kernel/mm/transparent_hugepage/enabled
</code></pre><h3 id=redisconf>redis.conf</h3><p>redis.conf 是 redis 的配置文件，然而你会看到这个文件的名字是 6379.conf ，而这个数字就是 redis 监听的网络端口。如果你想要运行超过一个的 redis 实例，推荐用这样的名字。</p><p>复制示例的 redis.conf 到 <strong>/etc/redis/6379.conf</strong>。</p><pre tabindex=0><code>cp redis.conf /etc/redis/6379.conf
</code></pre><p>现在编辑这个文件并且配置参数。</p><pre tabindex=0><code>vi /etc/redis/6379.conf
</code></pre><h4 id=daemonize>daemonize</h4><p>设置 <code>daemonize</code> 为 no，systemd 需要它运行在前台，否则 redis 会突然挂掉。</p><pre tabindex=0><code>daemonize no
</code></pre><h4 id=pidfile>pidfile</h4><p>设置 <code>pidfile</code> 为 <code>/var/run/redis_6379.pid</code>。</p><pre tabindex=0><code>pidfile /var/run/redis_6379.pid
</code></pre><h4 id=port>port</h4><p>如果不准备用默认端口，可以修改。</p><pre tabindex=0><code>port 6379
</code></pre><h4 id=loglevel>loglevel</h4><p>设置日志级别。</p><pre tabindex=0><code>loglevel notice
</code></pre><h4 id=logfile>logfile</h4><p>修改日志文件路径。</p><pre tabindex=0><code>logfile /var/log/redis_6379.log
</code></pre><h4 id=dir>dir</h4><p>设置目录为 /var/lib/redis/6379</p><pre tabindex=0><code>dir /var/lib/redis/6379
</code></pre><h3 id=安全>安全</h3><p>下面有几个可以提高安全性的操作。</p><h4 id=unix-sockets>Unix sockets</h4><p>在很多情况下，客户端程序和服务器端程序运行在同一个机器上，所以不需要监听网络上的 socket。如果这和你的使用情况类似，你就可以使用 unix socket 替代网络 socket，为此你需要配置 <code>port</code> 为0，然后配置下面的选项来启用 unix socket。</p><p>设置 unix socket 的套接字文件。</p><pre tabindex=0><code> unixsocket /tmp/redis.sock
</code></pre><p>限制 socket 文件的权限。</p><pre tabindex=0><code>unixsocketperm 700
</code></pre><p>现在为了让 redis-cli 可以访问，应该使用 -s 参数指向该 socket 文件。</p><pre tabindex=0><code>redis-cli -s /tmp/redis.sock
</code></pre><h4 id=requirepass>requirepass</h4><p>你可能需要远程访问，如果是，那么你应该设置密码，这样子每次操作之前要求输入密码。</p><pre tabindex=0><code>requirepass &#34;bTFBx1NYYWRMTUEyNHhsCg&#34;
</code></pre><h4 id=rename-command>rename-command</h4><p>想象一下如下指令的输出。是的，这会输出服务器的配置，所以你应该在任何可能的情况下拒绝这种访问。</p><pre tabindex=0><code>CONFIG GET *
</code></pre><p>为了限制甚至禁止这条或者其他指令可以使用 <code>rename-command</code> 命令。你必须提供一个命令名和替代的名字。要禁止的话需要设置替代的名字为空字符串，这样禁止任何人猜测命令的名字会比较安全。</p><pre tabindex=0><code>rename-command FLUSHDB &#34;FLUSHDB_MY_SALT_G0ES_HERE09u09u&#34;
rename-command FLUSHALL &#34;&#34;
rename-command CONFIG &#34;CONFIG_MY_S4LT_GO3S_HERE09u09u&#34;
</code></pre><p><img src=/data/attachment/album/201512/09/225002ylmz8o4s41s86kq6.jpg alt="Access Redis through unix with password and command changes"></p><p><em>使用密码通过 unix socket 访问，和修改命令</em></p><h4 id=快照>快照</h4><p>默认情况下，redis 会周期性的将数据集转储到我们设置的目录下的 <strong>dump.rdb</strong> 文件。你可以使用 <code>save</code> 命令配置转储的频率，它的第一个参数是以秒为单位的时间帧，第二个参数是在数据文件上进行修改的数量。</p><p>每隔15分钟并且最少修改过一次键。</p><pre tabindex=0><code>save 900 1
</code></pre><p>每隔5分钟并且最少修改过10次键。</p><pre tabindex=0><code>save 300 10
</code></pre><p>每隔1分钟并且最少修改过10000次键。</p><pre tabindex=0><code>save 60 10000
</code></pre><p>文件 <code>/var/lib/redis/6379/dump.rdb</code> 包含了从上次保存以来内存里数据集的转储数据。因为它先创建临时文件然后替换之前的转储文件，这里不存在数据破坏的问题，你不用担心，可以直接复制这个文件。</p><h3 id=开机时启动>开机时启动</h3><p>你可以使用 systemd 将 redis 添加到系统开机启动列表。</p><p>复制示例的 init_script 文件到 <code>/etc/init.d</code>，注意脚本名所代表的端口号。</p><pre tabindex=0><code>cp utils/redis_init_script /etc/init.d/redis_6379
</code></pre><p>现在我们要使用 systemd，所以在 <code>/etc/systems/system</code> 下创建一个单位文件名字为 <code>redis_6379.service</code>。</p><pre tabindex=0><code>vi /etc/systemd/system/redis_6379.service
</code></pre><p>填写下面的内容，详情可见 systemd.service。</p><pre tabindex=0><code>[Unit]
Description=Redis on port 6379

[Service]
Type=forking
ExecStart=/etc/init.d/redis_6379 start
ExecStop=/etc/init.d/redis_6379 stop

[Install]
WantedBy=multi-user.target
</code></pre><p>现在添加我之前在 <code>/etc/sysctl.conf</code> 里面修改过的内存过量使用和 backlog 最大值的选项。</p><pre tabindex=0><code>vm.overcommit_memory = 1

net.core.somaxconn=512
</code></pre><p>对于透明巨页内存支持，并没有直接 sysctl 命令可以控制，所以需要将下面的命令放到 <code>/etc/rc.local</code> 的结尾。</p><pre tabindex=0><code>echo never &gt; /sys/kernel/mm/transparent_hugepage/enabled
</code></pre><h3 id=总结>总结</h3><p>这样就可以启动了，通过设置这些选项你就可以部署 redis 服务到很多简单的场景，然而在 redis.conf 还有很多为复杂环境准备的 redis 选项。在一些情况下，你可以使用 <a href=http://redis.io/topics/replication>replication</a> 和 <a href=http://redis.io/topics/sentinel>Sentinel</a> 来提高可用性，或者<a href=http://redis.io/topics/partitioning>将数据分散</a>在多个服务器上，创建服务器集群。</p><p>谢谢阅读。</p><hr><p>via: <a href=http://linoxide.com/storage/install-redis-server-centos-7/>http://linoxide.com/storage/install-redis-server-centos-7/</a></p><p>作者：<a href=http://linoxide.com/author/carlosal/>Carlos Alberto</a> 译者：<a href=https://github.com/oska874>ezio</a> 校对：<a href=https://github.com/wxy>wxy</a></p><p>本文由 <a href=https://github.com/LCTT/TranslateProject>LCTT</a> 原创编译，<a href=https://linux.cn/>Linux中国</a> 荣誉推出</p></div><footer class=post__footer><div class="post__tags tags clearfix"><svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5.0 11V3C0 1.5.8.8.8.8S1.5.0 3 0h8c1.5.0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 100-6 3 3 0 000 6z"/></svg><ul class=tags__list><li class=tags__item><a class="tags__link btn" href=/tags/redis/ rel=tag>redis</a></li></ul></div></footer></article></main></div></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2025 Linux.cn Archive.
<span class=footer__copyright-credits>Generated with <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> and <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a> theme.</span></div></div></footer></div><script async defer src=/js/menu.js></script></body></html>