<!doctype html><html class=no-js lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>一个转换花引号的 gawk 脚本 - Linux.cn Archive</title>
<script>(function(e,t){e[t]=e[t].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content><meta property="og:title" content="一个转换花引号的 gawk 脚本"><meta property="og:description" content="得到我的 awk 秘籍。"><meta property="og:type" content="article"><meta property="og:url" content="/article-9969-1.html"><meta property="article:section" content="posts"><meta property="article:published_time" content="2018-08-31T22:35:00+00:00"><meta property="article:modified_time" content="2018-08-31T22:35:00+00:00"><meta itemprop=name content="一个转换花引号的 gawk 脚本"><meta itemprop=description content="得到我的 awk 秘籍。"><meta itemprop=datePublished content="2018-08-31T22:35:00+00:00"><meta itemprop=dateModified content="2018-08-31T22:35:00+00:00"><meta itemprop=wordCount content="300"><meta itemprop=keywords content="awk,"><link rel=preconnect href=https://fonts.bunny.net crossorigin><link rel=dns-prefetch href=//fonts.bunny.net><link rel=dns-prefetch href=//fonts.bunny.net><link rel=stylesheet href="https://fonts.bunny.net/css?family=Open+Sans:400,400i,700"><link rel=stylesheet href=/css/style.css><link rel="shortcut icon" href=/favicon.ico></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class=logo><a class=logo__link href=/ title="Linux.cn Archive" rel=home><div class="logo__item logo__text"><div class=logo__title>Linux.cn Archive</div></div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>Menu</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/><span class=menu__text>Home</span></a></li><li class=menu__item><a class=menu__link href=/categories/><span class=menu__text>Categories</span></a></li><li class=menu__item><a class=menu__link href=/tags/><span class=menu__text>Tags</span></a></li><li class=menu__item><a class=menu__link href><span class=menu__text>RSS</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>一个转换花引号的 gawk 脚本</h1><div class="post__meta meta"><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class=meta__text datetime=2018-08-31T22:35:00Z>August 31, 2018</time></div></div></header><div class="content post__content clearfix"><blockquote><p>得到我的 awk 秘籍。</p></blockquote><p><img src=/data/attachment/album/201808/31/223600zlqjltbr1aljlqpa.png alt></p><p>我管理着一个个人网站，用手工编辑网站上的网页。由于网站上的页面并不多，这种方法对我很适合，可以让我对网站代码的细节一清二楚。</p><p>最近我升级了网站的设计样式，我决定把所有的普通引号都转换成“花引号”，即在打印材料中使用的那种引号：用 “” 来代替 &ldquo;"。</p><p>手工修改所有的引号太耗时了，因此我决定将这个转换所有 HTML 文件中引号的过程自动化。不过通过程序或脚本来实现该功能需要费点劲。这个脚本需要知道何时将普通引号转换成花引号，并决定使用哪种引号（LCTT 译注：左引号还是右引号，单引号还是双引号）。</p><p>有多种方法可以转换引号。Greg Pittman 写过一个 <a href=https://opensource.com/article/17/3/python-scribus-smart-quotes>Python 脚本</a> 来修正文本中的花引号。而我自己使用 GNU <a href=https://opensource.com/downloads/cheat-sheet-awk-features>awk</a> (gawk) 来实现。</p><blockquote><p>下载我的 awk 秘籍。<a href=https://opensource.com/downloads/cheat-sheet-awk-features>免费下载</a>。</p></blockquote><p>开始之前，我写了一个简单的 gawk 函数来评估单个字符。若该字符是一个引号，这该函数判断是输出普通引号还是花引号。函数查看前一个字符；若前一个字符是空格，则函数输出左花引号。否则函数输出右花引号。脚本对单引号的处理方式也一样。</p><pre tabindex=0><code>function smartquote (char, prevchar) {
        # print smart quotes depending on the previous character
        # otherwise just print the character as-is

        if (prevchar ~ /\s/) {
                # prev char is a space
                if (char == &#34;&#39;&#34;) {
                        printf(&#34;&amp;lsquo;&#34;);
                }
                else if (char == &#34;\&#34;&#34;) {
                        printf(&#34;&amp;ldquo;&#34;);
                }
                else {
                        printf(&#34;%c&#34;, char);
                }
        }
        else {
                # prev char is not a space
                if (char == &#34;&#39;&#34;) {
                        printf(&#34;&amp;rsquo;&#34;);
                }
                else if (char == &#34;\&#34;&#34;) {
                        printf(&#34;&amp;rdquo;&#34;);
                }
                else {
                        printf(&#34;%c&#34;, char);
                }
        }
}
</code></pre><p>这个 gawk 脚本的主体部分通过该函数处理 HTML 输入文件的一个个字符。该脚本在 HTML 标签内部逐字原样输出所有内容（比如，<code>&lt;html lang="en"></code>）。在 HTML 标签外，脚本使用 <code>smartquote()</code> 函数来输出文本。<code>smartquote()</code> 函数来评估是输出普通引号还是花引号。</p><pre tabindex=0><code>function smartquote (char, prevchar) {
        ...
}

BEGIN {htmltag = 0}

{
        # for each line, scan one letter at a time:

        linelen = length($0);

        prev = &#34;\n&#34;;

        for (i = 1; i &lt;= linelen; i++) {
                char = substr($0, i, 1);

                if (char == &#34;&lt;&#34;) {
                        htmltag = 1;
                }

                if (htmltag == 1) {
                        printf(&#34;%c&#34;, char);
                }
                else {
                        smartquote(char, prev);
                        prev = char;
                }

                if (char == &#34;&gt;&#34;) {
                        htmltag = 0;
                }
        }

        # add trailing newline at end of each line
        printf (&#34;\n&#34;);
}
</code></pre><p>下面是一个例子：</p><pre tabindex=0><code>gawk -f quotes.awk test.html &gt; test2.html
</code></pre><p>其输入为：</p><pre tabindex=0><code>&lt;!DOCTYPE html&gt;
&lt;html lang=&#34;en&#34;&gt;
&lt;head&gt;
  &lt;title&gt;Test page&lt;/title&gt;
  &lt;link rel=&#34;stylesheet&#34; type=&#34;text/css&#34; href=&#34;/test.css&#34; /&gt;
  &lt;meta charset=&#34;UTF-8&#34;&gt;
  &lt;meta name=&#34;viewport&#34; content=&#34;width=device-width&#34; /&gt;
&lt;/head&gt;
&lt;body&gt;
  &lt;h1&gt;&lt;a href=&#34;/&#34;&gt;&lt;img src=&#34;logo.png&#34; alt=&#34;Website logo&#34; /&gt;&lt;/a&gt;&lt;/h1&gt;
  &lt;p&gt;&#34;Hi there!&#34;&lt;/p&gt;
  &lt;p&gt;It&#39;s and its.&lt;/p&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre><p>其输出为：</p><pre tabindex=0><code>&lt;!DOCTYPE html&gt;
&lt;html lang=&#34;en&#34;&gt;
&lt;head&gt;
  &lt;title&gt;Test page&lt;/title&gt;
  &lt;link rel=&#34;stylesheet&#34; type=&#34;text/css&#34; href=&#34;/test.css&#34; /&gt;
  &lt;meta charset=&#34;UTF-8&#34;&gt;
  &lt;meta name=&#34;viewport&#34; content=&#34;width=device-width&#34; /&gt;
&lt;/head&gt;
&lt;body&gt;
  &lt;h1&gt;&lt;a href=&#34;/&#34;&gt;&lt;img src=&#34;logo.png&#34; alt=&#34;Website logo&#34; /&gt;&lt;/a&gt;&lt;/h1&gt;
  &lt;p&gt;&amp;ldquo;Hi there!&amp;rdquo;&lt;/p&gt;
  &lt;p&gt;It&amp;rsquo;s and its.&lt;/p&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre><hr><p>via: <a href=https://opensource.com/article/18/8/gawk-script-convert-smart-quotes>https://opensource.com/article/18/8/gawk-script-convert-smart-quotes</a></p><p>作者：<a href=https://opensource.com/users/jim-hall>Jim Hall</a> 选题：<a href=https://github.com/lujun9972>lujun9972</a> 译者：<a href=https://github.com/lujun9972>lujun9972</a> 校对：<a href=https://github.com/wxy>wxy</a></p><p>本文由 <a href=https://github.com/LCTT/TranslateProject>LCTT</a> 原创编译，<a href=https://linux.cn/>Linux中国</a> 荣誉推出</p></div><footer class=post__footer><div class="post__tags tags clearfix"><svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5.0 11V3C0 1.5.8.8.8.8S1.5.0 3 0h8c1.5.0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 100-6 3 3 0 000 6z"/></svg><ul class=tags__list><li class=tags__item><a class="tags__link btn" href=/tags/awk/ rel=tag>awk</a></li></ul></div></footer></article></main></div></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2025 Linux.cn Archive.
<span class=footer__copyright-credits>Generated with <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> and <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a> theme.</span></div></div></footer></div><script async defer src=/js/menu.js></script></body></html>