<!doctype html><html class=no-js lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>在 Ubuntu 中使用 NTP 进行时间同步 - Linux.cn Archive</title>
<script>(function(e,t){e[t]=e[t].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content><meta property="og:title" content="在 Ubuntu 中使用 NTP 进行时间同步"><meta property="og:description" content="NTP 是通过网络来同步时间的一种 TCP/IP 协议。通常客户端向服务器请求当前的时间，并根据结果来设置其时钟。这个描述是挺简单的，实现这一功能却是极为复杂的，幸运的是，所有的这些复杂性都进行了封装，你是不可见也不需要见到的。"><meta property="og:type" content="article"><meta property="og:url" content="/article-8091-1.html"><meta property="article:section" content="posts"><meta property="article:published_time" content="2017-01-05T11:14:00+00:00"><meta property="article:modified_time" content="2017-01-05T11:14:00+00:00"><meta itemprop=name content="在 Ubuntu 中使用 NTP 进行时间同步"><meta itemprop=description content="NTP 是通过网络来同步时间的一种 TCP/IP 协议。通常客户端向服务器请求当前的时间，并根据结果来设置其时钟。这个描述是挺简单的，实现这一功能却是极为复杂的，幸运的是，所有的这些复杂性都进行了封装，你是不可见也不需要见到的。"><meta itemprop=datePublished content="2017-01-05T11:14:00+00:00"><meta itemprop=dateModified content="2017-01-05T11:14:00+00:00"><meta itemprop=wordCount content="296"><meta itemprop=keywords content="timedatectl,ntpdate,timesyncd,时间服务器,ntp,"><link rel=preconnect href=https://fonts.bunny.net crossorigin><link rel=dns-prefetch href=//fonts.bunny.net><link rel=dns-prefetch href=//fonts.bunny.net><link rel=stylesheet href="https://fonts.bunny.net/css?family=Open+Sans:400,400i,700"><link rel=stylesheet href=/css/style.css><link rel="shortcut icon" href=/favicon.ico></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class=logo><a class=logo__link href=/ title="Linux.cn Archive" rel=home><div class="logo__item logo__text"><div class=logo__title>Linux.cn Archive</div></div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>Menu</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/><span class=menu__text>Home</span></a></li><li class=menu__item><a class=menu__link href=/categories/><span class=menu__text>Categories</span></a></li><li class=menu__item><a class=menu__link href=/tags/><span class=menu__text>Tags</span></a></li><li class=menu__item><a class=menu__link href><span class=menu__text>RSS</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>在 Ubuntu 中使用 NTP 进行时间同步</h1><div class="post__meta meta"><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class=meta__text datetime=2017-01-05T11:14:00Z>January 05, 2017</time></div></div></header><div class="content post__content clearfix"><p>NTP 是通过网络来同步时间的一种 TCP/IP 协议。通常客户端向服务器请求当前的时间，并根据结果来设置其时钟。</p><p>这个描述是挺简单的，实现这一功能却是极为复杂的 - 首先要有多层 NTP 服务器，第一层 NTP 服务器连接原子时钟，第二层、第三层服务器则担起负载均衡的责任，以处理因特网传来的所有请求。另外，客户端可能也超乎你想象的复杂 - 它必须排除通讯延迟，调整时间的同时不干扰其它在服务器中运行的进程。幸运的是，所有的这些复杂性都进行了封装，你是不可见也不需要见到的。</p><p><img src=/data/attachment/album/201701/05/111343e3mf2ahai26iifz9.jpg alt></p><p>在 Ubuntu 中，是使用 <code>ntpdate</code> 和 <code>ntpd</code> 来同步时间的。</p><h3 id=timedatectl>timedatectl</h3><p>在最新的 Ubuntu 版本中，<code>timedatectl</code> 替代了老旧的 <code>ntpdate</code>。默认情况下，<code>timedatectl</code> 在系统启动的时候会立刻同步时间，并在稍后网络连接激活后通过 socket 再次检查一次。</p><p>如果已安装了 <code>ntpdate</code> / <code>ntp</code>，<code>timedatectl</code> 会退而让你使用之前的设置。这样确保了两个时间同步服务不会相互冲突，同时在你升级的时候还保留原本的行为和配置。但这也意味着从旧版本的发行版升级时 <code>ntp</code>/<code>ntpdate</code> 仍会安装，因此会导致新的基于 systemd 的时间服务被禁用。</p><h3 id=timesyncd>timesyncd</h3><p>在最新的 Ubuntu 版本中，<code>timesyncd</code> 替代了 <code>ntpd</code> 的客户端的部分。默认情况下 <code>timesyncd</code> 会定期检测并同步时间。它还会在本地存储更新的时间，以便在系统重启时做时间单步调整。</p><p>通过 <code>timedatectl</code> 和 <code>timesyncd</code> 设置的当前时间状态和时间配置，可以使用 <code>timedatectl status</code> 命令来进行确认。</p><pre tabindex=0><code>timedatectl status
      Local time: Fri 2016-04-29 06:32:57 UTC
  Universal time: Fri 2016-04-29 06:32:57 UTC
        RTC time: Fri 2016-04-29 07:44:02
       Time zone: Etc/UTC (UTC, +0000)
 Network time on: yes
NTP synchronized: no
 RTC in local TZ: no
</code></pre><p>如果安装了 NTP，并用它替代 <code>timedatectl</code> 来同步时间，则 <code>NTP synchronized</code> 将被设置为 <code>yes</code>。</p><p><code>timedatectl</code> 和 <code>timesyncd</code> 用来获取时间的 nameserver 可以通过 <code>/etc/systemd/timesyncd.conf</code> 来指定，另外在 <code>/etc/systemd/timesyncd.conf.d/</code> 下还有灵活的附加配置文件。</p><h3 id=ntpdate>ntpdate</h3><p>由于 <code>timedatectl</code> 的存在，各发行版已经弃用了 <code>ntpdate</code>，默认不再进行安装。如果你安装了，它会在系统启动的时候根据 Ubuntu 的 NTP 服务器来设置你电脑的时间。之后每当一个新的网络接口启动时，它就会重新尝试同步时间 —— 在这期间只要其涵盖的时间差不是太大，它就会慢慢偏移时间。该行为可以通过 <code>-B</code>/<code>-b</code> 开关来进行控制。</p><pre tabindex=0><code>ntpdate ntp.ubuntu.com
</code></pre><h3 id=时间服务器>时间服务器</h3><p>默认情况下，基于 systemd 的工具都是从 <code>ntp.ubuntu.com</code> 请求时间同步的。经典的基于 <code>ntpd</code> 的服务基本上都是使用 <code>[0-3].ubuntu.pool.ntp.org</code> 池中的 <code>2.ubuntu.pool.ntp.org</code>，还有 <code>ntp.ubuntu.com</code>，此外需要的话还支持 IPv6。如果想强制使用 IPv6，可以使用 <code>ipv6.ntp.ubuntu.com</code>，不过这并非默认配置。</p><h3 id=ntpd>ntpd</h3><p>ntp 的守护进程 <code>ntpd</code> 会计算你的系统时钟的时间偏移量并且持续的进行调整，所以不会出现时间差距较大的更正，比如说，不会导致不连续的日志。该进程只花费少量的进程资源和内存，但对于现代的服务器来说实在是微不足道的了。</p><h3 id=安装>安装</h3><p>要安装 <code>ntpd</code>，在终端命令行中输入：</p><pre tabindex=0><code>sudo apt install ntp
</code></pre><h3 id=配置>配置</h3><p>编辑 <code>/etc/ntp.conf</code> —— 增加/移除 <code>server</code> 行。默认配置有以下服务器：</p><pre tabindex=0><code># Use servers from the NTP Pool Project. Approved by Ubuntu Technical Board
# on 2011-02-08 (LP: #104525). See http://www.pool.ntp.org/join.html for
# more information.
server 0.ubuntu.pool.ntp.org
server 1.ubuntu.pool.ntp.org
server 2.ubuntu.pool.ntp.org
server 3.ubuntu.pool.ntp.org
</code></pre><p>修改配置文件之后，你需要重新加载 <code>ntpd</code>：</p><pre tabindex=0><code>sudo systemctl reload ntp.service
</code></pre><h3 id=查看状态>查看状态</h3><p>使用 <code>ntpq</code> 来查看更多信息：</p><pre tabindex=0><code># sudo ntpq -p
     remote           refid      st t when poll reach   delay   offset  jitter
==============================================================================
+stratum2-2.NTP. 129.70.130.70    2 u    5   64  377   68.461  -44.274 110.334
+ntp2.m-online.n 212.18.1.106     2 u    5   64  377   54.629  -27.318  78.882
*145.253.66.170  .DCFa.           1 u   10   64  377   83.607  -30.159  68.343
+stratum2-3.NTP. 129.70.130.70    2 u    5   64  357   68.795  -68.168 104.612
+europium.canoni 193.79.237.14    2 u   63   64  337   81.534  -67.968  92.792
</code></pre><h3 id=pps-支持>PPS 支持</h3><p>从 Ubuntu 16.04 开始，ntp 支持 PPS 规范，给 ntp 提供了本地时间源，以提供更高的精度。查看下边列出的链接来获取更多配置信息。</p><h3 id=参考资料>参考资料</h3><ul><li>参考 <a href=https://help.ubuntu.com/community/UbuntuTime>Ubuntu Time</a> wiki 页来获取更多信息</li><li><a href=http://www.ntp.org/>ntp.org，网络时间协议项目主页</a></li><li><a href=http://www.ntp.org/ntpfaq/NTP-s-config-adv.htm#S-CONFIG-ADV-PPS>ntp.org，关于配置 PPS 的 FAQ</a></li></ul><hr><p>via: <a href=https://help.ubuntu.com/lts/serverguide/NTP.html>https://help.ubuntu.com/lts/serverguide/NTP.html</a></p><p>作者：<a href=https://help.ubuntu.com/lts/serverguide/NTP.html>Ubuntu</a> 译者：<a href=https://github.com/GHLandy>GHLandy</a> 校对：<a href=https://github.com/jasminepeng>jasminepeng</a></p><p>本文由 <a href=https://github.com/LCTT/TranslateProject>LCTT</a> 原创编译，<a href=https://linux.cn/>Linux中国</a> 荣誉推出</p></div><footer class=post__footer><div class="post__tags tags clearfix"><svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5.0 11V3C0 1.5.8.8.8.8S1.5.0 3 0h8c1.5.0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 100-6 3 3 0 000 6z"/></svg><ul class=tags__list><li class=tags__item><a class="tags__link btn" href=/tags/timedatectl/ rel=tag>timedatectl</a></li><li class=tags__item><a class="tags__link btn" href=/tags/ntpdate/ rel=tag>ntpdate</a></li><li class=tags__item><a class="tags__link btn" href=/tags/timesyncd/ rel=tag>timesyncd</a></li><li class=tags__item><a class="tags__link btn" href=/tags/%E6%97%B6%E9%97%B4%E6%9C%8D%E5%8A%A1%E5%99%A8/ rel=tag>时间服务器</a></li><li class=tags__item><a class="tags__link btn" href=/tags/ntp/ rel=tag>ntp</a></li></ul></div></footer></article></main></div></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2025 Linux.cn Archive.
<span class=footer__copyright-credits>Generated with <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> and <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a> theme.</span></div></div></footer></div><script async defer src=/js/menu.js></script></body></html>