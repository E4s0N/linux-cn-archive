<!doctype html><html class=no-js lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>详解在 Ubuntu 从外部存储库安装软件包 - Linux.cn Archive</title>
<script>(function(e,t){e[t]=e[t].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content><meta property="og:title" content="详解在 Ubuntu 从外部存储库安装软件包"><meta property="og:description" content="我来解释一下这些代码背后的逻辑。"><meta property="og:type" content="article"><meta property="og:url" content="/article-15299-1.html"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-11-29T15:44:12+00:00"><meta property="article:modified_time" content="2022-11-29T15:44:12+00:00"><meta itemprop=name content="详解在 Ubuntu 从外部存储库安装软件包"><meta itemprop=description content="我来解释一下这些代码背后的逻辑。"><meta itemprop=datePublished content="2022-11-29T15:44:12+00:00"><meta itemprop=dateModified content="2022-11-29T15:44:12+00:00"><meta itemprop=wordCount content="333"><meta itemprop=keywords content="apt,软件包,"><link rel=preconnect href=https://fonts.bunny.net crossorigin><link rel=dns-prefetch href=//fonts.bunny.net><link rel=dns-prefetch href=//fonts.bunny.net><link rel=stylesheet href="https://fonts.bunny.net/css?family=Open+Sans:400,400i,700"><link rel=stylesheet href=/css/style.css><link rel="shortcut icon" href=/favicon.ico></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class=logo><a class=logo__link href=/ title="Linux.cn Archive" rel=home><div class="logo__item logo__text"><div class=logo__title>Linux.cn Archive</div></div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>Menu</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/><span class=menu__text>Home</span></a></li><li class=menu__item><a class=menu__link href=/categories/><span class=menu__text>Categories</span></a></li><li class=menu__item><a class=menu__link href=/tags/><span class=menu__text>Tags</span></a></li><li class=menu__item><a class=menu__link href><span class=menu__text>RSS</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>详解在 Ubuntu 从外部存储库安装软件包</h1><div class="post__meta meta"><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class=meta__text datetime=2022-11-29T15:44:12Z>November 29, 2022</time></div></div></header><div class="content post__content clearfix"><p><img src=/data/attachment/album/202211/29/154339id0xb2exw0c8y222.jpg alt></p><p>你大概知道怎么在 Ubuntu 中使用 <code>apt</code> 命令安装软件包。那些软件包都是来自 Ubuntu 的官方存储库。</p><p>那第三方或者外部存储库呢？不，我这里并不是要讲 PPA。</p><p>早晚你会碰到那种至少四行的安装说明：你需要安装名为 <code>apt-transport-https</code> 的包、操作一下 GPG 和 源列表 source list 之后，你才能正常安装软件包。</p><p>没有什么印象的话，那我分享一个 <a href=https://itsfoss.com/install-yarn-ubuntu/>在 Ubuntu 上安装最新版本的 Yarn</a> 的例子：</p><pre tabindex=0><code>sudo apt install apt-transport-https curl
curl -sS https://dl.yarnpkg.com/debian/pubkey.gpg | sudo apt-key add -
sudo sh -c &#39;echo &#34;deb https://dl.yarnpkg.com/debian/ stable main&#34; &gt;&gt; /etc/apt/sources.list.d/yarn.list&#39;
sudo apt update &amp;&amp; sudo apt install yarn
</code></pre><p>当你需要直接从开发者那里安装编程工具的时候，大概率会碰到这种安装方式。</p><p>许多人只是按照说明进行操作，并不会去思考其中的原理。这也没什么不对，但了解该过程实际上可以提升你在这方面的知识，而且有助于之后排除故障。</p><p>我来解释一下这些代码背后的逻辑。</p><h3 id=理解从外部存储库安装的过程>理解从外部存储库安装的过程</h3><p>在你继续往下阅读之前，我强烈建议你先看看下面这两篇文章，方便理解后续的概念：</p><ul><li><a href=https://itsfoss.com/ubuntu-repositories/>什么是 Ubuntu 中的存储库</a></li><li><a href=https://itsfoss.com/ppa-guide/#comments>什么是 Ubuntu 中 PPA</a></li></ul><p>为了让你有点印象，这里有一张软件包存储库和 <a href=https://itsfoss.com/package-manager/>Linux 中的包管理器</a> 的图片。</p><p><img src=/data/attachment/album/202211/29/154413e3wlpwy0wkaz3jqp.png alt="Illustration of repository and package manager"></p><p>整件事情其实就是在系统中添加一个新的外部存储库。这样，你就可以从这个新存储库下载并安装可用的软件包。如果这个存储库提供了包版本的更新，你可以在更新系统的同时更新这些软件包（<code>apt update && apt upgrade</code>）。</p><p>那么，这是什么工作原理呢？让我们一条一条地过一遍。</p><h4 id=第-1-部分为-apt-获取-https-支持>第 1 部分：为 apt 获取 HTTPS 支持</h4><p>第一行是这样的：</p><pre tabindex=0><code>sudo apt install apt-transport-https curl
</code></pre><p><code>curl</code> 是一个 <a href=https://itsfoss.com/download-files-from-linux-terminal/>Linux 终端下载文件的工具</a>。这里主要的部分是安装 <code>apt-transport-https</code>，但事实上已经不需要了。</p><p>明白了吗？这个 <code>apt-transport-https</code> 包让你的系统通过 HTTPS 协议安全访问存储库。按照设计，Ubuntu 的存储库使用 http 而不是 https 协议。</p><p>看看下面的截图。 https 这张图是我已经添加到系统中的外部存储库。Ubuntu 的存储库和 PPA 使用 http 协议。</p><p><img src=/data/attachment/album/202211/29/154413xqgfd7mczq72ye99.png alt></p><p>在旧版本的 <code>apt</code> 包管理器中，不支持 https 协议。<code>apt-transport-https</code> 包为 <code>apt</code> 添加了 https 支持。要新增一个使用 https 的存储库，首先就得先安装此包。</p><p>我之前不是说不需要安装这个包了吗？是的，因为较新版本的 <code>apt</code>（高于 1.5）已经支持 https，所以你不需要再安装 <code>apt-transport-https</code>。</p><p>但是你依然看到我在说明中提到了这个包。这更多是出于遗留原因，而且可能还有很旧的发行版在使用旧版本的 <code>apt</code> 包。</p><p>现在，你可能想知道既然 https 是安全协议，那为什么 Ubuntu 的存储库还要使用 http 而不是 https。这难道没有安全风险吗？接着往下看你就知道答案了。</p><h4 id=第-2-部分添加远程存储库的-gpg-密钥>第 2 部分：添加远程存储库的 GPG 密钥</h4><p>Linux 存储库内置了基于 GPG 密钥的安全机制。每个存储库都将其 GPG 公钥添加到你的系统信任密钥中。来自存储库的包由这个 GPG 密钥“ 签名 signed ”，并且通过这份存储的公钥，系统能够验证软件包正是来自这个存储库。</p><p>如果 <a href=https://itsfoss.com/solve-gpg-error-signatures-verified-ubuntu/>密钥之间不匹配，你的系统会发出提醒</a>，而不会继续从该存储库安装或者更新软件包。</p><p>到目前为止，一切都很顺利。下一步是将外部存储库的 GPG 公钥添加到你的 Linux 系统，以便它能接收来自该存储库的软件包。</p><pre tabindex=0><code>curl -sS https://dl.yarnpkg.com/debian/pubkey.gpg | sudo apt-key add -
</code></pre><p>在上面的命令中，你使用 <code>curl</code> 从指定的 URL 下载 GPG 密钥。选项 <code>-sS</code> 能够让你不看多余的输出（静默模式），但会显示错误（如果有的话）。最后一个 <code>-</code> 告诉 <code>apt-key</code> 使用 标准输入 stdin 而不是文件（在本例中是 <code>curl</code> 命令的输出）。</p><p><code>apt-key add</code> 命令已经将下载的密钥添加到系统中。</p><p>你可以通过 <code>apt-key list</code> 命令查看系统中各种存储库添加的 GPG 密钥。</p><p><img src=/data/attachment/album/202211/29/154414uxq1blyopshq0qbx.png alt="List GPG keys"></p><p>这是将 GPG 密钥添加到系统的一种方法。你会看到一些其它的命令，看起来略有不同，但效果一样，都是将存储库的公钥添加到你的系统里面。</p><pre tabindex=0><code>sudo apt-key adv --keyserver keyserver.ubuntu.com --recv-keys E298A3A825C0D65DFD57CBB651716619E084DAB9
</code></pre><p>你会注意到 <code>apt-key</code> 已被弃用的警告。在 Ubuntu 22.04 之前，你还可以使用 <code>apt-key</code> 命令，但它最终会被删除。现在不需要杞人忧天。</p><h4 id=第-3-部分将外部存储库添加到源列表>第 3 部分：将外部存储库添加到源列表</h4><p>下个命令是在系统的源列表中添加一个新条目。这样，你的系统就会知道它得检查该存储库中的包和更新。</p><pre tabindex=0><code>sudo sh -c &#39;echo &#34;deb https://dl.yarnpkg.com/debian/ stable main&#34; &gt;&gt; /etc/apt/sources.list.d/yarn.list&#39;
</code></pre><p>有一个文件 <code>/etc/apt/sources.list</code> 包含 Ubuntu 存储库的详细信息。最好不要随便动这个文件。所有新增的存储库都应放在 <code>/etc/apt/sources.list.d</code> 目录中相应的文件里（约定以 <code>.list</code> 结尾）。</p><p><img src=/data/attachment/album/202211/29/154414noxzxn96xcna8mdu.png alt="External repository should have their own sources list file in the /etc/apt/sources.list.d directory"></p><p>这使得包管理变得更容易。如果你要从系统中删除一个存储库，只需删除相应的源文件即可。无需修改主 <code>sources.list</code> 文件。</p><p>让我们再仔细地看一下这行命令。</p><pre tabindex=0><code>sudo sh -c &#39;echo &#34;deb https://dl.yarnpkg.com/debian/ stable main&#34; &gt;&gt; /etc/apt/sources.list.d/yarn.list&#39;
</code></pre><p>使用 <code>sh</code> 可以在一个新的 shell 进程中运行命令，而不是 <a href=https://linuxhandbook.com/subshell/>子 shel​​l</a>。 <code>-c</code> 选项告诉 <code>sh</code> 命令从参数而不是标准输入读取命令。然后它运行 <code>echo</code> 命令，也就是把 <code>deb https://dl.yarnpkg.com/debian/ stable main</code> 这一行添加到 <code>/etc/apt/sources.list.d/yarn.list</code> 文件（会创建该文件）。</p><p>现在，你可以通过各种方法在指定目录中创建 <code>.list</code> 文件并在其中添加包含存储库详细信息的数据行。你也可以像这样使用：</p><pre tabindex=0><code>echo &#34;deb https://dl.yarnpkg.com/debian/ stable main&#34; | sudo tee /etc/apt/sources.list.d/yarn.list
</code></pre><p>明白了吧？</p><h4 id=第-4-部分从新添加的存储库安装应用程序>第 4 部分：从新添加的存储库安装应用程序</h4><p>到目前为止，你已经将存储库的 GPG 密钥和存储库的 URL 添加到系统中。</p><p>但是系统仍然不晓得这个新存储库中有哪些可用的包。这就是为什么你需要先使用下面这个命令更新包元数据的本地缓存：</p><pre tabindex=0><code>sudo apt update
</code></pre><p>这时你的系统就已经知道新增存储库中可用软件包的信息，现在可以试试安装软件包：</p><pre tabindex=0><code>sudo apt install yarn
</code></pre><p>为了节省时间，你可以在 <a href=https://itsfoss.com/run-multiple-commands-linux/>同一行挨着运行这两个命令</a>e。</p><pre tabindex=0><code>sudo apt update &amp;&amp; sudo apt install yarn
</code></pre><p><code>&&</code> 可以确保第二个命令只会在前一个命令没有任何报错的前提下运行。</p><p>整个流程就是这样。</p><h4 id=有没有豁然开朗呢还是一脸懵逼>有没有豁然开朗呢，还是一脸懵逼？</h4><p>我已经解释了在 Ubuntu 中使用外部存储库背后的逻辑。希望你现在能更好地理解它，当然可能还有很多细节会让你困惑。</p><p>如果你还不清楚或者还有其他问题，可以联系我。如果你发现了技术上的纰漏，记得在评论区告诉我。</p><hr><p>via: <a href=https://itsfoss.com/adding-external-repositories-ubuntu/>https://itsfoss.com/adding-external-repositories-ubuntu/</a></p><p>作者：<a href=https://itsfoss.com/author/abhishek/>Abhishek Prakash</a> 选题：<a href=https://github.com/lujun9972>lujun9972</a> 译者：<a href=https://github.com/nophDog>nophDog</a> 校对：<a href=https://github.com/wxy>wxy</a></p><p>本文由 <a href=https://github.com/LCTT/TranslateProject>LCTT</a> 原创编译，<a href=https://linux.cn/>Linux中国</a> 荣誉推出</p></div><footer class=post__footer><div class="post__tags tags clearfix"><svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5.0 11V3C0 1.5.8.8.8.8S1.5.0 3 0h8c1.5.0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 100-6 3 3 0 000 6z"/></svg><ul class=tags__list><li class=tags__item><a class="tags__link btn" href=/tags/apt/ rel=tag>apt</a></li><li class=tags__item><a class="tags__link btn" href=/tags/%E8%BD%AF%E4%BB%B6%E5%8C%85/ rel=tag>软件包</a></li></ul></div></footer></article></main></div></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2025 Linux.cn Archive.
<span class=footer__copyright-credits>Generated with <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> and <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a> theme.</span></div></div></footer></div><script async defer src=/js/menu.js></script></body></html>