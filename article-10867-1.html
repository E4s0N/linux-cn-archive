<!doctype html><html class=no-js lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>使用 Python 构建可扩展的社交媒体情感分析服务 - Linux.cn Archive</title>
<script>(function(e,t){e[t]=e[t].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content><meta property="og:title" content="使用 Python 构建可扩展的社交媒体情感分析服务"><meta property="og:description" content="学习如何使用 spaCy、vaderSentiment、Flask 和 Python 来为你的作品添加情感分析能力。"><meta property="og:type" content="article"><meta property="og:url" content="/article-10867-1.html"><meta property="article:section" content="posts"><meta property="article:published_time" content="2019-05-17T23:53:00+00:00"><meta property="article:modified_time" content="2019-05-17T23:53:00+00:00"><meta itemprop=name content="使用 Python 构建可扩展的社交媒体情感分析服务"><meta itemprop=description content="学习如何使用 spaCy、vaderSentiment、Flask 和 Python 来为你的作品添加情感分析能力。"><meta itemprop=datePublished content="2019-05-17T23:53:00+00:00"><meta itemprop=dateModified content="2019-05-17T23:53:00+00:00"><meta itemprop=wordCount content="583"><meta itemprop=keywords content="情感,"><link rel=preconnect href=https://fonts.bunny.net crossorigin><link rel=dns-prefetch href=//fonts.bunny.net><link rel=dns-prefetch href=//fonts.bunny.net><link rel=stylesheet href="https://fonts.bunny.net/css?family=Open+Sans:400,400i,700"><link rel=stylesheet href=/css/style.css><link rel="shortcut icon" href=/favicon.ico></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class=logo><a class=logo__link href=/ title="Linux.cn Archive" rel=home><div class="logo__item logo__text"><div class=logo__title>Linux.cn Archive</div></div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>Menu</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/><span class=menu__text>Home</span></a></li><li class=menu__item><a class=menu__link href=/categories/><span class=menu__text>Categories</span></a></li><li class=menu__item><a class=menu__link href=/tags/><span class=menu__text>Tags</span></a></li><li class=menu__item><a class=menu__link href><span class=menu__text>RSS</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>使用 Python 构建可扩展的社交媒体情感分析服务</h1><div class="post__meta meta"><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class=meta__text datetime=2019-05-17T23:53:00Z>May 17, 2019</time></div></div></header><div class="content post__content clearfix"><blockquote><p>学习如何使用 spaCy、vaderSentiment、Flask 和 Python 来为你的作品添加情感分析能力。</p></blockquote><p><img src=/data/attachment/album/201905/17/235241zr0cs4czu4psmrl6.jpg alt></p><p>本系列的<a href=/article-10852-1.html>第一部分</a>提供了情感分析工作原理的一些背景知识，现在让我们研究如何将这些功能添加到你的设计中。</p><h3 id=探索-python-库-spacy-和-vadersentiment>探索 Python 库 spaCy 和 vaderSentiment</h3><h4 id=前提条件>前提条件</h4><ul><li>一个终端 shell</li><li>shell 中的 Python 语言二进制文件（3.4+ 版本）</li><li>用于安装 Python 包的 <code>pip</code> 命令</li><li>（可选）一个 <a href=https://virtualenv.pypa.io/en/stable/>Python 虚拟环境</a>使你的工作与系统隔离开来</li></ul><h4 id=配置环境>配置环境</h4><p>在开始编写代码之前，你需要安装 <a href=https://pypi.org/project/spacy/>spaCy</a> 和 <a href=https://pypi.org/project/vaderSentiment/>vaderSentiment</a> 包来设置 Python 环境，同时下载一个语言模型来帮助你分析。幸运的是，大部分操作都容易在命令行中完成。</p><p>在 shell 中，输入以下命令来安装 spaCy 和 vaderSentiment 包：</p><pre tabindex=0><code>pip install spacy vaderSentiment
</code></pre><p>命令安装完成后，安装 spaCy 可用于文本分析的语言模型。以下命令将使用 spaCy 模块下载并安装英语<a href=https://spacy.io/models>模型</a>：</p><pre tabindex=0><code>python -m spacy download en_core_web_sm
</code></pre><p>安装了这些库和模型之后，就可以开始编码了。</p><h4 id=一个简单的文本分析>一个简单的文本分析</h4><p>使用 <a href=https://docs.python.org/3.6/tutorial/interpreter.html>Python 解释器交互模式</a> 编写一些代码来分析单个文本片段。首先启动 Python 环境：</p><pre tabindex=0><code>$ python
Python 3.6.8 (default, Jan 31 2019, 09:38:34)
[GCC 8.2.1 20181215 (Red Hat 8.2.1-6)] on linux
Type &#34;help&#34;, &#34;copyright&#34;, &#34;credits&#34; or &#34;license&#34; for more information.
&gt;&gt;&gt;
</code></pre><p><em>（你的 Python 解释器版本打印可能与此不同。）</em></p><p>1、导入所需模块：</p><pre tabindex=0><code>&gt;&gt;&gt; import spacy
&gt;&gt;&gt; from vaderSentiment import vaderSentiment 
</code></pre><p>2、从 spaCy 加载英语语言模型：</p><pre tabindex=0><code>&gt;&gt;&gt; english = spacy.load(&#34;en_core_web_sm&#34;)
</code></pre><p>3、处理一段文本。本例展示了一个非常简单的句子，我们希望它能给我们带来些许积极的情感：</p><pre tabindex=0><code>&gt;&gt;&gt; result = english(&#34;I like to eat applesauce with sugar and cinnamon.&#34;)
</code></pre><p>4、从处理后的结果中收集句子。SpaCy 已识别并处理短语中的实体，这一步为每个句子生成情感（即时在本例中只有一个句子）：</p><pre tabindex=0><code>&gt;&gt;&gt; sentences = [str(s) for s in result.sents]
</code></pre><p>5、使用 vaderSentiments 创建一个分析器：</p><pre tabindex=0><code>&gt;&gt;&gt; analyzer = vaderSentiment.SentimentIntensityAnalyzer()
</code></pre><p>6、对句子进行情感分析：</p><pre tabindex=0><code>&gt;&gt;&gt; sentiment = [analyzer.polarity_scores(str(s)) for s in sentences]
</code></pre><p><code>sentiment</code> 变量现在包含例句的极性分数。打印出这个值，看看它是如何分析这个句子的。</p><pre tabindex=0><code>&gt;&gt;&gt; print(sentiment)
[{&#39;neg&#39;: 0.0, &#39;neu&#39;: 0.737, &#39;pos&#39;: 0.263, &#39;compound&#39;: 0.3612}]
</code></pre><p>这个结构是什么意思？</p><p>表面上，这是一个只有一个字典对象的数组。如果有多个句子，那么每个句子都会对应一个字典对象。字典中有四个键对应不同类型的情感。<code>neg</code> 键表示负面情感，因为在本例中没有报告任何负面情感，<code>0.0</code> 值证明了这一点。<code>neu</code> 键表示中性情感，它的得分相当高，为 <code>0.737</code>（最高为 <code>1.0</code>）。<code>pos</code> 键代表积极情感，得分适中，为 <code>0.263</code>。最后，<code>cmpound</code> 键代表文本的总体得分，它可以从负数到正数，<code>0.3612</code> 表示积极方面的情感多一点。</p><p>要查看这些值可能如何变化，你可以使用已输入的代码做一个小实验。以下代码块显示了如何对类似句子的情感评分的评估。</p><pre tabindex=0><code>&gt;&gt;&gt; result = english(&#34;I love applesauce!&#34;)
&gt;&gt;&gt; sentences = [str(s) for s in result.sents]
&gt;&gt;&gt; sentiment = [analyzer.polarity_scores(str(s)) for s in sentences]
&gt;&gt;&gt; print(sentiment)
[{&#39;neg&#39;: 0.0, &#39;neu&#39;: 0.182, &#39;pos&#39;: 0.818, &#39;compound&#39;: 0.6696}]
</code></pre><p>你可以看到，通过将例句改为非常积极的句子，<code>sentiment</code> 的值发生了巨大变化。</p><h3 id=建立一个情感分析服务>建立一个情感分析服务</h3><p>现在你已经为情感分析组装了基本的代码块，让我们将这些东西转化为一个简单的服务。</p><p>在这个演示中，你将使用 Python <a href=http://flask.pocoo.org/>Flask 包</a> 创建一个 <a href=https://en.wikipedia.org/wiki/Representational_state_transfer>RESTful</a> HTTP 服务器。此服务将接受英文文本数据并返回情感分析结果。请注意，此示例服务是用于学习所涉及的技术，而不是用于投入生产的东西。</p><h4 id=前提条件-1>前提条件</h4><ul><li>一个终端 shell</li><li>shell 中的 Python 语言二进制文件（3.4+ 版本）</li><li>安装 Python 包的 <code>pip</code> 命令</li><li><code>curl</code> 命令</li><li>一个文本编辑器</li><li>(可选) 一个 <a href=https://virtualenv.pypa.io/en/stable/>Python 虚拟环境</a>使你的工作与系统隔离开来</li></ul><h4 id=配置环境-1>配置环境</h4><p>这个环境几乎与上一节中的环境相同，唯一的区别是在 Python 环境中添加了 Flask 包。</p><p>1、安装所需依赖项：</p><pre tabindex=0><code>pip install spacy vaderSentiment flask
</code></pre><p>2、安装 spaCy 的英语语言模型：</p><pre tabindex=0><code>python -m spacy download en_core_web_sm
</code></pre><h4 id=创建应用程序文件>创建应用程序文件</h4><p>打开编辑器，创建一个名为 <code>app.py</code> 的文件。添加以下内容 <em>（不用担心，我们将解释每一行）</em>：</p><pre tabindex=0><code>import flask
import spacy
import vaderSentiment.vaderSentiment as vader

app = flask.Flask(__name__)
analyzer = vader.SentimentIntensityAnalyzer()
english = spacy.load(&#34;en_core_web_sm&#34;)

def get_sentiments(text):
    result = english(text)
    sentences = [str(sent) for sent in result.sents]
    sentiments = [analyzer.polarity_scores(str(s)) for s in sentences]
    return sentiments

@app.route(&#34;/&#34;, methods=[&#34;POST&#34;, &#34;GET&#34;])
def index():
    if flask.request.method == &#34;GET&#34;:
        return &#34;To access this service send a POST request to this URL with&#34; \
                &#34; the text you want analyzed in the body.&#34;
    body = flask.request.data.decode(&#34;utf-8&#34;)
    sentiments = get_sentiments(body)
    return flask.json.dumps(sentiments)
</code></pre><p>虽然这个源文件不是很大，但它非常密集。让我们来看看这个应用程序的各个部分，并解释它们在做什么。</p><pre tabindex=0><code>import flask
import spacy
import vaderSentiment.vaderSentiment as vader
</code></pre><p>前三行引入了执行语言分析和 HTTP 框架所需的包。</p><pre tabindex=0><code>app = flask.Flask(__name__)
analyzer = vader.SentimentIntensityAnalyzer()
english = spacy.load(&#34;en_core_web_sm&#34;)
</code></pre><p>接下来的三行代码创建了一些全局变量。第一个变量 <code>app</code>，它是 Flask 用于创建 HTTP 路由的主要入口点。第二个变量 <code>analyzer</code> 与上一个示例中使用的类型相同，它将用于生成情感分数。最后一个变量 <code>english</code> 也与上一个示例中使用的类型相同，它将用于注释和标记初始文本输入。</p><p>你可能想知道为什么全局声明这些变量。对于 <code>app</code> 变量，这是许多 Flask 应用程序的标准过程。但是，对于 <code>analyzer</code> 和 <code>english</code> 变量，将它们设置为全局变量的决定是基于与所涉及的类关联的加载时间。虽然加载时间可能看起来很短，但是当它在 HTTP 服务器的上下文中运行时，这些延迟会对性能产生负面影响。</p><pre tabindex=0><code>def get_sentiments(text):
    result = english(text)
    sentences = [str(sent) for sent in result.sents]
    sentiments = [analyzer.polarity_scores(str(s)) for s in sentences]
    return sentiments
</code></pre><p>这部分是服务的核心 —— 一个用于从一串文本生成情感值的函数。你可以看到此函数中的操作对应于你之前在 Python 解释器中运行的命令。这里它们被封装在一个函数定义中，<code>text</code> 源作为文本变量传入，最后 <code>sentiments</code> 变量返回给调用者。</p><pre tabindex=0><code>@app.route(&#34;/&#34;, methods=[&#34;POST&#34;, &#34;GET&#34;])
def index():
  if flask.request.method == &#34;GET&#34;:
      return &#34;To access this service send a POST request to this URL with&#34; \
              &#34; the text you want analyzed in the body.&#34;
  body = flask.request.data.decode(&#34;utf-8&#34;)
  sentiments = get_sentiments(body)
  return flask.json.dumps(sentiments)
</code></pre><p>源文件的最后一个函数包含了指导 Flask 如何为服务配置 HTTP 服务器的逻辑。它从一行开始，该行将 HTTP 路由 <code>/</code> 与请求方法 <code>POST</code> 和 <code>GET</code> 相关联。</p><p>在函数定义行之后，<code>if</code> 子句将检测请求方法是否为 <code>GET</code>。如果用户向服务发送此请求，那么下面的行将返回一条指示如何访问服务器的文本消息。这主要是为了方便最终用户。</p><p>下一行使用 <code>flask.request</code> 对象来获取请求的主体，该主体应包含要处理的文本字符串。<code>decode</code> 函数将字节数组转换为可用的格式化字符串。经过解码的文本消息被传递给 <code>get_sentiments</code> 函数以生成情感分数。最后，分数通过 HTTP 框架返回给用户。</p><p>你现在应该保存文件，如果尚未保存，那么返回 shell。</p><h4 id=运行情感服务>运行情感服务</h4><p>一切就绪后，使用 Flask 的内置调试服务器运行服务非常简单。要启动该服务，请从与源文件相同的目录中输入以下命令：</p><pre tabindex=0><code>FLASK_APP=app.py flask run
</code></pre><p>现在，你将在 shell 中看到来自服务器的一些输出，并且服务器将处于运行状态。要测试服务器是否正在运行，你需要打开第二个 shell 并使用 <code>curl</code> 命令。</p><p>首先，输入以下命令检查是否打印了指令信息：</p><pre tabindex=0><code>curl http://localhost:5000
</code></pre><p>你应该看到说明消息：</p><pre tabindex=0><code>To access this service send a POST request to this URI with the text you want analyzed in the body.
</code></pre><p>接下来，运行以下命令发送测试消息，查看情感分析：</p><pre tabindex=0><code>curl http://localhost:5000 --header &#34;Content-Type: application/json&#34; --data &#34;I love applesauce!&#34;
</code></pre><p>你从服务器获得的响应应类似于以下内容：</p><pre tabindex=0><code>[{&#34;compound&#34;: 0.6696, &#34;neg&#34;: 0.0, &#34;neu&#34;: 0.182, &#34;pos&#34;: 0.818}]
</code></pre><p>恭喜！你现在已经实现了一个 RESTful HTTP 情感分析服务。你可以在 <a href=https://github.com/elmiko/social-moments-service>GitHub 上找到此服务的参考实现和本文中的所有代码</a>。</p><h3 id=继续探索>继续探索</h3><p>现在你已经了解了自然语言处理和情感分析背后的原理和机制，下面是进一步发现探索该主题的一些方法。</p><h4 id=在-openshift-上创建流式情感分析器>在 OpenShift 上创建流式情感分析器</h4><p>虽然创建本地应用程序来研究情绪分析很方便，但是接下来需要能够部署应用程序以实现更广泛的用途。按照<a href=https://github.com/radanalyticsio/streaming-lab>Radnaalytics.io</a> 提供的指导和代码进行操作，你将学习如何创建一个情感分析仪，可以容器化并部署到 Kubernetes 平台。你还将了解如何将 Apache Kafka 用作事件驱动消息传递的框架，以及如何将 Apache Spark 用作情绪分析的分布式计算平台。</p><h4 id=使用-twitter-api-发现实时数据>使用 Twitter API 发现实时数据</h4><p>虽然 <a href=http://Radanalytics.io>Radanalytics.io</a> 实验室可以生成合成推文流，但你可以不受限于合成数据。事实上，拥有 Twitter 账户的任何人都可以使用 <a href=https://github.com/tweepy/tweepy>Tweepy Python</a> 包访问 Twitter 流媒体 API 对推文进行情感分析。</p><hr><p>via: <a href=https://opensource.com/article/19/4/social-media-sentiment-analysis-python-scalable>https://opensource.com/article/19/4/social-media-sentiment-analysis-python-scalable</a></p><p>作者：<a href=https://opensource.com/users/elmiko/users/jschlessman>Michael McCune</a> 选题：<a href=https://github.com/lujun9972>lujun9972</a> 译者：<a href=https://github.com/MjSeven>MjSeven</a> 校对：<a href=https://github.com/wxy>wxy</a></p><p>本文由 <a href=https://github.com/LCTT/TranslateProject>LCTT</a> 原创编译，<a href=https://linux.cn/>Linux中国</a> 荣誉推出</p></div><footer class=post__footer><div class="post__tags tags clearfix"><svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5.0 11V3C0 1.5.8.8.8.8S1.5.0 3 0h8c1.5.0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 100-6 3 3 0 000 6z"/></svg><ul class=tags__list><li class=tags__item><a class="tags__link btn" href=/tags/%E6%83%85%E6%84%9F/ rel=tag>情感</a></li></ul></div></footer></article></main></div></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2025 Linux.cn Archive.
<span class=footer__copyright-credits>Generated with <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> and <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a> theme.</span></div></div></footer></div><script async defer src=/js/menu.js></script></body></html>