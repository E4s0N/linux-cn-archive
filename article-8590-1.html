<!doctype html><html class=no-js lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>cron 与 anacron：如何在 Linux 中计划任务 - Linux.cn Archive</title>
<script>(function(e,t){e[t]=e[t].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content><meta property="og:title" content="cron 与 anacron：如何在 Linux 中计划任务"><meta property="og:description" content="cron 和 anacron 主要的区别在于 cron 能在那些持续运行的机器上有效地运行，而 anacron 是针对那些会在一天内或者一周内会关机的机器。"><meta property="og:type" content="article"><meta property="og:url" content="/article-8590-1.html"><meta property="article:section" content="posts"><meta property="article:published_time" content="2017-06-09T09:56:00+00:00"><meta property="article:modified_time" content="2017-06-09T09:56:00+00:00"><meta itemprop=name content="cron 与 anacron：如何在 Linux 中计划任务"><meta itemprop=description content="cron 和 anacron 主要的区别在于 cron 能在那些持续运行的机器上有效地运行，而 anacron 是针对那些会在一天内或者一周内会关机的机器。"><meta itemprop=datePublished content="2017-06-09T09:56:00+00:00"><meta itemprop=dateModified content="2017-06-09T09:56:00+00:00"><meta itemprop=wordCount content="270"><meta itemprop=keywords content="cron,anacron,"><link rel=preconnect href=https://fonts.bunny.net crossorigin><link rel=dns-prefetch href=//fonts.bunny.net><link rel=dns-prefetch href=//fonts.bunny.net><link rel=stylesheet href="https://fonts.bunny.net/css?family=Open+Sans:400,400i,700"><link rel=stylesheet href=/css/style.css><link rel="shortcut icon" href=/favicon.ico></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class=logo><a class=logo__link href=/ title="Linux.cn Archive" rel=home><div class="logo__item logo__text"><div class=logo__title>Linux.cn Archive</div></div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>Menu</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/><span class=menu__text>Home</span></a></li><li class=menu__item><a class=menu__link href=/categories/><span class=menu__text>Categories</span></a></li><li class=menu__item><a class=menu__link href=/tags/><span class=menu__text>Tags</span></a></li><li class=menu__item><a class=menu__link href><span class=menu__text>RSS</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>cron 与 anacron：如何在 Linux 中计划任务</h1><div class="post__meta meta"><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class=meta__text datetime=2017-06-09T09:56:00Z>June 09, 2017</time></div></div></header><div class="content post__content clearfix"><p><img src=https://img.linux.net.cn/data/attachment/album/201706/08/230239x0dew0x0mbf1x05m.jpg alt></p><p>在本篇中，我们会解释 cron 和 anacron，并向你展示如何在 Linux 中设置 anacron。我们也会比较这两个工具。</p><p>要<a href=https://www.tecmint.com/linux-cron-alternative-at-command-to-schedule-tasks/>在一个给定时间或者稍后安排一个任务</a>，你可以使用 <code>at</code> 或者 <code>batch</code> 命令，要使命令能够重复运行，你可以使用 cron 以及 anacron 工具。</p><p><a href=https://www.tecmint.com/11-cron-scheduling-task-examples-in-linux/>cron</a> - 是一个用于运行计划任务如系统备份、更新等的守护进程。它适合在那些 24X7 不间断运行的机器如服务器上运行的计划任务。</p><p>命令/脚本被写在 cron 任务脚本中，它是在 <code>crontab</code> 文件中被安排的。系统默认的 <code>crontab</code> 文件是 <code>/etc/crontab</code>，但是每个用户也可以创建自己的 <code>crontab</code> 文件来在特定时间运行用户定义的命令。</p><p>要创建一份个人 <code>crontab</code> 文件，只要输入：</p><pre tabindex=0><code>$ crontab -e
</code></pre><h3 id=如何在-linux-中设置-anacron>如何在 Linux 中设置 anacron</h3><p>anacron 用于以天为单位的频率运行命令。它的工作与 cron 稍有不同，<strong>它假设机器不会一直开机</strong>。</p><p>cron 也适合在那些不会 24X7 运行如笔记本以及桌面电脑的机器上运行每日、每周以及每月的计划任务（LCTT 译注：不适合按小时、分钟执行任务）。</p><p>假设你有一个计划任务（比如备份脚本）要使用 cron 在每天半夜运行，也许你以及睡着，那时你的桌面/笔记本电脑已经关机。你的备份脚本就不会被运行。</p><p>然而，如果你使用 anacron，你可以确保在你下次开启桌面/笔记本电脑的时候，备份脚本会被执行。</p><h3 id=anacron-如何在-linux-工作>anacron 如何在 Linux 工作</h3><p>anacron 任务被列在 <code>/etc/anacrontab</code> 中，任务可以使用下面的格式（anacron 文件中的注释必须以 <code>#</code> 号开始）安排。</p><pre tabindex=0><code>period   delay   job-identifier   command
</code></pre><p>从上面的格式中：</p><ul><li><code>period</code> - 这是任务的频率，以天来指定，或者是 <code>@daily</code>、<code>@weekly</code>、<code>@monthly</code> 代表每天、每周、每月一次。你也可以使用数字：<code>1</code> - 每天、<code>7</code> - 每周、<code>30</code> - 每月，或者 <code>N</code> - 几天。</li><li><code>delay</code> - 这是在执行一个任务前等待的分钟数。</li><li><code>job-id</code> - 这是写在日志文件中任务的独特名字。</li><li><code>command</code> - 这是要执行的命令或 shell 脚本。</li></ul><p>要浏览示例文件，输入：</p><pre tabindex=0><code>$ ls -l /var/spool/anacron/
total 12
-rw------- 1 root root 9 Jun  1 10:25 cron.daily
-rw------- 1 root root 9 May 27 11:01 cron.monthly
-rw------- 1 root root 9 May 30 10:28 cron.weekly
</code></pre><p>这是实际发生的：</p><ul><li>anacron 会检查任务是否已经在 <code>period</code> 字段指定的时间被被执行了。如果没有，则在等待 <code>delay</code> 字段中指定的分钟数后，执行 <code>command</code> 字段中指定的命令。</li><li>一旦任务被执行了，它会使用 <code>job-id</code>（时间戳文件名）字段中指定的名称将日期记录在 <code>/var/spool/anacron</code> 目录中的时间戳文件中。</li></ul><p>现在让我们看一个例子。这个会每天运行 <code>/home/aaronkilik/bin/backup.sh</code> 脚本：</p><pre tabindex=0><code>@daily    10    example.daily   /bin/bash /home/aaronkilik/bin/backup.sh
</code></pre><p>当机器在 <code>backup.sh</code> 期望被运行时是关机的，anacron 会在机器开机十分钟之后运行它，而不用再等待 7 天。</p><p>这里有两个你应该理解的 anacrontab 文件的重要变量：</p><ul><li><code>START_HOURS_RANGE</code> - 这个设置任务开始运行的时间范围（也就是任务只在这几个小时内运行）。</li><li><code>RANDOM_DELAY</code> - 这定义添加到用户定义的任务延迟的最大随机延迟（默认为 45）。</li></ul><p>这是你的 anacrontab 文件可能看上去的样子。</p><p>Anacron – <code>/etc/anacrontab</code>：</p><pre tabindex=0><code># /etc/anacrontab: configuration file for anacron
# See anacron(8) and anacrontab(5) for details.
SHELL=/bin/sh
PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin
HOME=/root
LOGNAME=root
# These replace cron&#39;s entries
1       5       cron.daily      run-parts --report /etc/cron.daily
7       10      cron.weekly     run-parts --report /etc/cron.weekly
@monthly        15      cron.monthly    run-parts --report /etc/cron.monthly
@daily    10    example.daily   /bin/bash /home/aaronkilik/bin/backup.sh                                                                      
</code></pre><p>下面是 cron 以及 anacron 的比较，帮助你理解何时用他们其中一个。</p><table><thead><tr><th>cron</th><th>anacron</th></tr></thead><tbody><tr><td>它是守护进程</td><td>它不是守护进程</td></tr><tr><td>适合服务器</td><td>适合桌面/笔记本电脑</td></tr><tr><td>可以让你以分钟级运行计划任务</td><td>只能让你以天为基础来运行计划任务</td></tr><tr><td>关机时不会执行计划任务</td><td>如果计划任务到期，机器是关机的，那么它会在机器下次开机后执行计划任务</td></tr><tr><td>普通用户和 root 用户都可以使用</td><td>只有 root 用户可以使用（使用特定的配置启动普通任务）</td></tr></tbody></table><p>cron 和 anacron 主要的区别在于 cron 能在那些持续运行的机器上有效地运行，而 anacron 是针对那些会在一天内或者一周内会关机的机器。</p><p>如果你还知道其他方式，请在评论栏中与我们分享。</p><p>（题图：Pixabay，CC0）</p><hr><p>作者简介：</p><p>Aaron Kili 是一个 Linux 和 F.O.S.S 爱好者、Linux 系统管理员、网络开发人员，现在也是 TecMint 的内容创作者，他喜欢和电脑一起工作，坚信共享知识。</p><hr><p>via: <a href=https://www.tecmint.com/cron-vs-anacron-schedule-jobs-using-anacron-on-linux/>https://www.tecmint.com/cron-vs-anacron-schedule-jobs-using-anacron-on-linux/</a></p><p>作者：<a href=https://www.tecmint.com/author/aaronkili/>Aaron Kili</a> 译者：<a href=https://github.com/geekpi>geekpi</a> 校对：<a href=https://github.com/wxy>wxy</a></p><p>本文由 <a href=https://github.com/LCTT/TranslateProject>LCTT</a> 原创编译，<a href=https://linux.cn/>Linux中国</a> 荣誉推出</p></div><footer class=post__footer><div class="post__tags tags clearfix"><svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5.0 11V3C0 1.5.8.8.8.8S1.5.0 3 0h8c1.5.0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 100-6 3 3 0 000 6z"/></svg><ul class=tags__list><li class=tags__item><a class="tags__link btn" href=/tags/cron/ rel=tag>cron</a></li><li class=tags__item><a class="tags__link btn" href=/tags/anacron/ rel=tag>anacron</a></li></ul></div></footer></article></main></div></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2025 Linux.cn Archive.
<span class=footer__copyright-credits>Generated with <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> and <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a> theme.</span></div></div></footer></div><script async defer src=/js/menu.js></script></body></html>