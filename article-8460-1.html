<!doctype html><html class=no-js lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>如何在 CentOS 7 上安装 Elastic Stack - Linux.cn Archive</title>
<script>(function(e,t){e[t]=e[t].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content><meta property="og:title" content="如何在 CentOS 7 上安装 Elastic Stack"><meta property="og:description" content="我将向您展示如何在 CentOS 7 服务器上安装和配置 Elastic Stack 以监视服务器日志。 然后，我将向您展示如何在操作系统为 CentOS 7 和 Ubuntu 16 的客户端上安装 “Elastic beats”。"><meta property="og:type" content="article"><meta property="og:url" content="/article-8460-1.html"><meta property="article:section" content="posts"><meta property="article:published_time" content="2017-04-29T10:36:00+00:00"><meta property="article:modified_time" content="2017-04-29T10:36:00+00:00"><meta itemprop=name content="如何在 CentOS 7 上安装 Elastic Stack"><meta itemprop=description content="我将向您展示如何在 CentOS 7 服务器上安装和配置 Elastic Stack 以监视服务器日志。 然后，我将向您展示如何在操作系统为 CentOS 7 和 Ubuntu 16 的客户端上安装 “Elastic beats”。"><meta itemprop=datePublished content="2017-04-29T10:36:00+00:00"><meta itemprop=dateModified content="2017-04-29T10:36:00+00:00"><meta itemprop=wordCount content="1043"><meta itemprop=keywords content="Lucene,搜索引擎,日志,"><link rel=preconnect href=https://fonts.bunny.net crossorigin><link rel=dns-prefetch href=//fonts.bunny.net><link rel=dns-prefetch href=//fonts.bunny.net><link rel=stylesheet href="https://fonts.bunny.net/css?family=Open+Sans:400,400i,700"><link rel=stylesheet href=/css/style.css><link rel="shortcut icon" href=/favicon.ico></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class=logo><a class=logo__link href=/ title="Linux.cn Archive" rel=home><div class="logo__item logo__text"><div class=logo__title>Linux.cn Archive</div></div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>Menu</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/><span class=menu__text>Home</span></a></li><li class=menu__item><a class=menu__link href=/categories/><span class=menu__text>Categories</span></a></li><li class=menu__item><a class=menu__link href=/tags/><span class=menu__text>Tags</span></a></li><li class=menu__item><a class=menu__link href><span class=menu__text>RSS</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>如何在 CentOS 7 上安装 Elastic Stack</h1><div class="post__meta meta"><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class=meta__text datetime=2017-04-29T10:36:00Z>April 29, 2017</time></div></div></header><div class="content post__content clearfix"><p><strong>Elasticsearch</strong> 是基于 Lucene 由 Java 开发的开源搜索引擎。它提供了一个分布式、多租户的全文搜索引擎（LCTT 译注：多租户是指多租户技术，是一种软件架构技术，用来探讨与实现如何在多用户的环境下共用相同的系统或程序组件，并且仍可确保各用户间数据的隔离性。），并带有 HTTP 仪表盘的 Web 界面（Kibana）。数据会被 Elasticsearch 查询、检索，并且使用 JSON 文档方案存储。Elasticsearch 是一个可扩展的搜索引擎，可用于搜索所有类型的文本文档，包括日志文件。Elasticsearch 是 Elastic Stack 的核心，Elastic Stack 也被称为 ELK Stack。</p><p><strong>Logstash</strong> 是用于管理事件和日志的开源工具。它为数据收集提供实时传递途径。 Logstash 将收集您的日志数据，将数据转换为 JSON 文档，并将其存储在 Elasticsearch 中。</p><p><strong>Kibana</strong> 是 Elasticsearch 的开源数据可视化工具。Kibana 提供了一个漂亮的仪表盘 Web 界面。 你可以用它来管理和可视化来自 Elasticsearch 的数据。 它不仅美丽，而且强大。</p><p>在本教程中，我将向您展示如何在 CentOS 7 服务器上安装和配置 Elastic Stack 以监视服务器日志。 然后，我将向您展示如何在操作系统为 CentOS 7 和 Ubuntu 16 的客户端上安装 “Elastic beats”。</p><p><img src=https://img.linux.net.cn/data/attachment/album/201704/29/004453qr9m7m8322rs2ere.jpg alt></p><p><strong>前提条件</strong></p><ul><li>64 位的 CentOS 7，4 GB 内存 - elk 主控机</li><li>64 位的 CentOS 7 ，1 GB 内存 - 客户端 1</li><li>64 位的 Ubuntu 16 ，1 GB 内存 - 客户端 2</li></ul><h3 id=步骤-1---准备操作系统>步骤 1 - 准备操作系统</h3><p>在本教程中，我们将禁用 CentOS 7 服务器上的 SELinux。 编辑 SELinux 配置文件。</p><pre tabindex=0><code>vim /etc/sysconfig/selinux
</code></pre><p>将 <code>SELINUX</code> 的值从 <code>enforcing</code> 改成 <code>disabled</code> 。</p><pre tabindex=0><code>SELINUX=disabled
</code></pre><p>然后重启服务器：</p><pre tabindex=0><code>reboot
</code></pre><p>再次登录服务器并检查 SELinux 状态。</p><pre tabindex=0><code>getenforce
</code></pre><p>确保结果是 <code>disabled</code>。</p><h3 id=步骤-2---安装-java>步骤 2 - 安装 Java</h3><p>部署 Elastic stack 依赖于Java，Elasticsearch 需要 Java 8 版本，推荐使用 Oracle JDK 1.8 。我将从官方的 Oracle rpm 包安装 Java 8。</p><p>使用 <code>wget</code> 命令下载 Java 8 的 JDK。</p><pre tabindex=0><code>wget --no-cookies --no-check-certificate --header &#34;Cookie: gpw_e24=http:%2F%2Fwww.oracle.com%2F; oraclelicense=accept-securebackup-cookie&#34; &#34;http://download.oracle.com/otn-pub/java/jdk/8u77-b02/jdk-8u77-linux-x64.rpm&#34;
</code></pre><p>然后使用 <code>rpm</code> 命令安装：</p><pre tabindex=0><code>rpm -ivh jdk-8u77-linux-x64.rpm
</code></pre><p>最后，检查 java JDK 版本，确保它正常工作。</p><pre tabindex=0><code>java -version
</code></pre><p>您将看到服务器的 Java 版本。</p><h3 id=步骤-3---安装和配置-elasticsearch>步骤 3 - 安装和配置 Elasticsearch</h3><p>在此步骤中，我们将安装和配置 Elasticsearch。 从 elastic.co 网站提供的 rpm 包安装 Elasticsearch，并将其配置运行在 localhost 上（以确保该程序安全，而且不能从外部访问）。</p><p>在安装 Elasticsearch 之前，将 elastic.co 的密钥添加到服务器。</p><pre tabindex=0><code>rpm --import https://artifacts.elastic.co/GPG-KEY-elasticsearch
</code></pre><p>接下来，使用 <code>wget</code> 下载 Elasticsearch 5.1，然后安装它。</p><pre tabindex=0><code>wget https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-5.1.1.rpm
rpm -ivh elasticsearch-5.1.1.rpm
</code></pre><p>Elasticsearch 已经安装好了。 现在进入配置目录编辑 <code>elasticsaerch.yml</code> 配置文件。</p><pre tabindex=0><code>cd /etc/elasticsearch/
vim elasticsearch.yml
</code></pre><p>去掉第 40 行的注释，启用 Elasticsearch 的内存锁。这将禁用 Elasticsearch 的内存交换。</p><pre tabindex=0><code>bootstrap.memory_lock: true
</code></pre><p>在 <code>Network</code> 块中，取消注释 <code>network.host</code> 和 <code>http.port</code> 行。</p><pre tabindex=0><code>network.host: localhost
http.port: 9200
</code></pre><p>保存文件并退出编辑器。</p><p>现在编辑 <code>elasticsearch.service</code> 文件的内存锁配置。</p><pre tabindex=0><code>vim /usr/lib/systemd/system/elasticsearch.service
</code></pre><p>去掉第 60 行的注释，确保该值为 <code>unlimited</code>。</p><pre tabindex=0><code>MAX_LOCKED_MEMORY=unlimited
</code></pre><p>保存并退出。</p><p>Elasticsearch 配置到此结束。Elasticsearch 将在本机的 9200 端口运行，我们通过在 CentOS 服务器上启用 <code>mlockall</code> 来禁用内存交换。重新加载 systemd，将 Elasticsearch 置为开机启动，然后启动服务。</p><pre tabindex=0><code>sudo systemctl daemon-reload
sudo systemctl enable elasticsearch
sudo systemctl start elasticsearch
</code></pre><p>等待 Eelasticsearch 启动成功，然后检查服务器上打开的端口，确保 9200 端口的状态是 <code>LISTEN</code>。</p><pre tabindex=0><code>netstat -plntu
</code></pre><p><img src=https://img.linux.net.cn/data/attachment/album/201704/29/004509cumkpy8plxqqbxxz.png alt="Check elasticsearch running on port 9200"></p><p>然后检查内存锁以确保启用 <code>mlockall</code>，并使用以下命令检查 Elasticsearch 是否正在运行。</p><pre tabindex=0><code>curl -XGET &#39;localhost:9200/_nodes?filter_path=**.mlockall&amp;pretty&#39;
curl -XGET &#39;localhost:9200/?pretty&#39;
</code></pre><p>会看到如下结果。</p><p><img src=https://img.linux.net.cn/data/attachment/album/201704/29/004512mt7f2mtur3t0fm7m.png alt="Check memory lock elasticsearch and check status"></p><h3 id=步骤-4---安装和配置-kibana-和-nginx>步骤 4 - 安装和配置 Kibana 和 Nginx</h3><p>在这一步，我们将在 Nginx Web 服务器上安装并配置 Kibana。 Kibana 监听在 localhost 上，而 Nginx 作为 Kibana 的反向代理。</p><p>用 <code>wget</code> 下载 Kibana 5.1，然后使用 <code>rpm</code> 命令安装：</p><pre tabindex=0><code>wget https://artifacts.elastic.co/downloads/kibana/kibana-5.1.1-x86_64.rpm
rpm -ivh kibana-5.1.1-x86_64.rpm
</code></pre><p>编辑 Kibana 配置文件。</p><pre tabindex=0><code>vim /etc/kibana/kibana.yml
</code></pre><p>去掉配置文件中 <code>server.port</code>、<code>server.host</code> 和 <code>elasticsearch.url</code> 这三行的注释。</p><pre tabindex=0><code>server.port: 5601
server.host: &#34;localhost&#34;
elasticsearch.url: &#34;http://localhost:9200&#34;
</code></pre><p>保存并退出。</p><p>将 Kibana 设为开机启动，并且启动 Kibana 。</p><pre tabindex=0><code>sudo systemctl enable kibana
sudo systemctl start kibana
</code></pre><p>Kibana 将作为 node 应用程序运行在端口 5601 上。</p><pre tabindex=0><code>netstat -plntu
</code></pre><p><img src=https://img.linux.net.cn/data/attachment/album/201704/29/004515rfpdup3bi2f2zuw2.png alt="Kibana running as node application on port 5601"></p><p>Kibana 安装到此结束。 现在我们需要安装 Nginx 并将其配置为反向代理，以便能够从公共 IP 地址访问 Kibana。</p><p>Nginx 在 Epel 资源库中可以找到，用 <code>yum</code> 安装 epel-release。</p><pre tabindex=0><code>yum -y install epel-release
</code></pre><p>然后安装 Nginx 和 httpd-tools 这两个包。</p><pre tabindex=0><code>yum -y install nginx httpd-tools
</code></pre><p>httpd-tools 软件包包含 Web 服务器的工具，可以为 Kibana 添加 htpasswd 基础认证。</p><p>编辑 Nginx 配置文件并删除 <code>server {}</code> 块，这样我们可以添加一个新的虚拟主机配置。</p><pre tabindex=0><code>cd /etc/nginx/
vim nginx.conf
</code></pre><p>删除 <code>server { }</code> 块。</p><p><img src=https://img.linux.net.cn/data/attachment/album/201704/29/004517s2ihfkof5fj5zag1.png alt="Remove Server Block on Nginx configuration"></p><p>保存并退出。</p><p>现在我们需要在 <code>conf.d</code> 目录中创建一个新的虚拟主机配置文件。 用 <code>vim</code> 创建新文件 <code>kibana.conf</code>。</p><pre tabindex=0><code>vim /etc/nginx/conf.d/kibana.conf
</code></pre><p>复制下面的配置。</p><pre tabindex=0><code>server {
    listen 80;

    server_name elk-stack.co;

    auth_basic &#34;Restricted Access&#34;;
    auth_basic_user_file /etc/nginx/.kibana-user;

    location / {
        proxy_pass http://localhost:5601;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection &#39;upgrade&#39;;
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }
}
</code></pre><p>保存并退出。</p><p>然后使用 <code>htpasswd</code> 命令创建一个新的基本认证文件。</p><pre tabindex=0><code>sudo htpasswd -c /etc/nginx/.kibana-user admin
“输入你的密码”
</code></pre><p>测试 Nginx 配置，确保没有错误。 然后设定 Nginx 开机启动并启动 Nginx。</p><pre tabindex=0><code>nginx -t
systemctl enable nginx
systemctl start nginx
</code></pre><p><img src=https://img.linux.net.cn/data/attachment/album/201704/29/004520arcbpi9v0x119ctc.png alt="Add nginx virtual host configuration for Kibana Application"></p><h3 id=步骤-5---安装和配置-logstash>步骤 5 - 安装和配置 Logstash</h3><p>在此步骤中，我们将安装 Logstash，并将其配置为：从配置了 filebeat 的 logstash 客户端里集中化服务器的日志，然后过滤和转换 Syslog 数据，并将其移动到存储中心（Elasticsearch）中。</p><p>下载 Logstash 并使用 rpm 进行安装。</p><pre tabindex=0><code>wget https://artifacts.elastic.co/downloads/logstash/logstash-5.1.1.rpm
rpm -ivh logstash-5.1.1.rpm
</code></pre><p>生成新的 SSL 证书文件，以便客户端可以识别 elastic 服务端。</p><p>进入 <code>tls</code> 目录并编辑 <code>openssl.cnf</code> 文件。</p><pre tabindex=0><code>cd /etc/pki/tls
vim openssl.cnf
</code></pre><p>在 <code>[v3_ca]</code> 部分添加服务器标识。</p><pre tabindex=0><code>[ v3_ca ]

# Server IP Address
subjectAltName = IP: 10.0.15.10
</code></pre><p>保存并退出。</p><p>使用 <code>openssl</code> 命令生成证书文件。</p><pre tabindex=0><code>openssl req -config /etc/pki/tls/openssl.cnf -x509 -days 3650 -batch -nodes -newkey rsa:2048 -keyout /etc/pki/tls/private/logstash-forwarder.key -out /etc/pki/tls/certs/logstash-forwarder.crt
</code></pre><p>证书文件可以在 <code>/etc/pki/tls/certs/</code> 和 <code>/etc/pki/tls/private/</code> 目录中找到。</p><p>接下来，我们会为 Logstash 创建新的配置文件。创建一个新的 <code>filebeat-input.conf</code> 文件来为 filebeat 配置日志源，然后创建一个 <code>syslog-filter.conf</code> 配置文件来处理 syslog，再创建一个 <code>output-elasticsearch.conf</code> 文件来定义输出日志数据到 Elasticsearch。</p><p>转到 logstash 配置目录，并在 <code>conf.d</code> 子目录中创建新的配置文件。</p><pre tabindex=0><code>cd /etc/logstash/
vim conf.d/filebeat-input.conf
</code></pre><p>输入配置，粘贴以下配置：</p><pre tabindex=0><code>input {
  beats {
    port =&gt; 5443
    ssl =&gt; true
    ssl_certificate =&gt; &#34;/etc/pki/tls/certs/logstash-forwarder.crt&#34;
    ssl_key =&gt; &#34;/etc/pki/tls/private/logstash-forwarder.key&#34;
  }
}
</code></pre><p>保存并退出。</p><p>创建 <code>syslog-filter.conf</code> 文件。</p><pre tabindex=0><code>vim conf.d/syslog-filter.conf
</code></pre><p>粘贴以下配置：</p><pre tabindex=0><code>filter {
  if [type] == &#34;syslog&#34; {
    grok {
      match =&gt; { &#34;message&#34; =&gt; &#34;%{SYSLOGTIMESTAMP:syslog_timestamp} %{SYSLOGHOST:syslog_hostname} %{DATA:syslog_program}(?:\[%{POSINT:syslog_pid}\])?: %{GREEDYDATA:syslog_message}&#34; }
      add_field =&gt; [ &#34;received_at&#34;, &#34;%{@timestamp}&#34; ]
      add_field =&gt; [ &#34;received_from&#34;, &#34;%{host}&#34; ]
    }
    date {
      match =&gt; [ &#34;syslog_timestamp&#34;, &#34;MMM  d HH:mm:ss&#34;, &#34;MMM dd HH:mm:ss&#34; ]
    }
  }
}
</code></pre><p>我们使用名为 <code>grok</code> 的过滤器插件来解析 syslog 文件。</p><p>保存并退出。</p><p>创建输出配置文件 <code>output-elasticsearch.conf</code>。</p><pre tabindex=0><code>vim conf.d/output-elasticsearch.conf
</code></pre><p>粘贴以下配置：</p><pre tabindex=0><code>output {
  elasticsearch { hosts =&gt; [&#34;localhost:9200&#34;]
    hosts =&gt; &#34;localhost:9200&#34;
    manage_template =&gt; false
    index =&gt; &#34;%{[@metadata][beat]}-%{+YYYY.MM.dd}&#34;
    document_type =&gt; &#34;%{[@metadata][type]}&#34;
  }
}
</code></pre><p>保存并退出。</p><p>最后，将 logstash 设定为开机启动并且启动服务。</p><pre tabindex=0><code>sudo systemctl enable logstash
sudo systemctl start logstash
</code></pre><p><img src=https://img.linux.net.cn/data/attachment/album/201704/29/004523i98f4qasoq8qt94t.png alt="Logstash started on port 5443 with SSL Connection"></p><h3 id=步骤-6---在-centos-客户端上安装并配置-filebeat>步骤 6 - 在 CentOS 客户端上安装并配置 Filebeat</h3><p>Beat 作为数据发送人的角色，是一种可以安装在客户端节点上的轻量级代理，将大量数据从客户机发送到 Logstash 或 Elasticsearch 服务器。有 4 种 beat，<code>Filebeat</code> 用于发送“日志文件”，<code>Metricbeat</code> 用于发送“指标”，<code>Packetbeat</code> 用于发送“网络数据”，<code>Winlogbeat</code> 用于发送 Windows 客户端的“事件日志”。</p><p>在本教程中，我将向您展示如何安装和配置 <code>Filebeat</code>，通过 SSL 连接将数据日志文件传输到 Logstash 服务器。</p><p>登录到客户端1的服务器上。 然后将证书文件从 elastic 服务器复制到客户端1的服务器上。</p><pre tabindex=0><code>ssh root@client1IP
</code></pre><p>使用 <code>scp</code> 命令拷贝证书文件。</p><pre tabindex=0><code>scp root@elk-serverIP:~/logstash-forwarder.crt .
输入 elk-server 的密码
</code></pre><p>创建一个新的目录，将证书移动到这个目录中。</p><pre tabindex=0><code>sudo mkdir -p /etc/pki/tls/certs/
mv ~/logstash-forwarder.crt /etc/pki/tls/certs/
</code></pre><p>接下来，在客户端 1 服务器上导入 elastic 密钥。</p><pre tabindex=0><code>rpm --import https://artifacts.elastic.co/GPG-KEY-elasticsearch
</code></pre><p>下载 Filebeat 并且用 <code>rpm</code> 命令安装。</p><pre tabindex=0><code>wget https://artifacts.elastic.co/downloads/beats/filebeat/filebeat-5.1.1-x86_64.rpm
rpm -ivh filebeat-5.1.1-x86_64.rpm
</code></pre><p>Filebeat 已经安装好了，请转到配置目录并编辑 <code>filebeat.yml</code> 文件。</p><pre tabindex=0><code>cd /etc/filebeat/
vim filebeat.yml
</code></pre><p>在第 21 行的路径部分，添加新的日志文件。 我们将创建两个文件，记录 ssh 活动的 <code>/var/log/secure</code> 文件 ，以及服务器日志 <code>/var/log/messages</code> 。</p><pre tabindex=0><code>  paths:
    - /var/log/secure
    - /var/log/messages
</code></pre><p>在第 26 行添加一个新配置来定义 syslog 类型的文件。</p><pre tabindex=0><code>  document-type: syslog
</code></pre><p>Filebeat 默认使用 Elasticsearch 作为输出目标。 在本教程中，我们将其更改为 Logshtash。 在 83 行和 85 行添加注释来禁用 Elasticsearch 输出。</p><p>禁用 Elasticsearch 输出：</p><pre tabindex=0><code>#-------------------------- Elasticsearch output ------------------------------
#output.elasticsearch:
  # Array of hosts to connect to.
#  hosts: [&#34;localhost:9200&#34;]
</code></pre><p>现在添加新的 logstash 输出配置。 去掉 logstash 输出配置的注释，并将所有值更改为下面配置中的值。</p><pre tabindex=0><code>output.logstash:
  # The Logstash hosts
  hosts: [&#34;10.0.15.10:5443&#34;]
  bulk_max_size: 1024
  ssl.certificate_authorities: [&#34;/etc/pki/tls/certs/logstash-forwarder.crt&#34;]
  template.name: &#34;filebeat&#34;
  template.path: &#34;filebeat.template.json&#34;
  template.overwrite: false
</code></pre><p>保存文件并退出 vim。</p><p>将 Filebeat 设定为开机启动并启动。</p><pre tabindex=0><code>sudo systemctl enable filebeat
sudo systemctl start filebeat
</code></pre><h3 id=步骤-7---在-ubuntu-客户端上安装并配置-filebeat>步骤 7 - 在 Ubuntu 客户端上安装并配置 Filebeat</h3><p>使用 <code>ssh</code> 连接到服务器。</p><pre tabindex=0><code>ssh root@ubuntu-clientIP
</code></pre><p>使用 <code>scp</code> 命令拷贝证书文件。</p><pre tabindex=0><code>scp root@elk-serverIP:~/logstash-forwarder.crt .
</code></pre><p>创建一个新的目录，将证书移动到这个目录中。</p><pre tabindex=0><code>sudo mkdir -p /etc/pki/tls/certs/
mv ~/logstash-forwarder.crt /etc/pki/tls/certs/
</code></pre><p>在服务器上导入 elastic 密钥。</p><pre tabindex=0><code>wget -qO - https://artifacts.elastic.co/GPG-KEY-elasticsearch | sudo apt-key add -
</code></pre><p>下载 Filebeat .deb 包并且使用 <code>dpkg</code> 命令进行安装。</p><pre tabindex=0><code>wget https://artifacts.elastic.co/downloads/beats/filebeat/filebeat-5.1.1-amd64.deb
dpkg -i filebeat-5.1.1-amd64.deb
</code></pre><p>转到配置目录并编辑 <code>filebeat.yml</code> 文件。</p><pre tabindex=0><code>cd /etc/filebeat/
vim filebeat.yml
</code></pre><p>在路径配置部分添加新的日志文件路径。</p><pre tabindex=0><code>  paths:
    - /var/log/auth.log
    - /var/log/syslog
</code></pre><p>设定文档类型为 <code>syslog</code> 。</p><pre tabindex=0><code>  document-type: syslog
</code></pre><p>将下列几行注释掉，禁用输出到 Elasticsearch。</p><pre tabindex=0><code>#-------------------------- Elasticsearch output ------------------------------
#output.elasticsearch:
  # Array of hosts to connect to.
#  hosts: [&#34;localhost:9200&#34;]
</code></pre><p>启用 logstash 输出，去掉以下配置的注释并且按照如下所示更改值。</p><pre tabindex=0><code>output.logstash:
  # The Logstash hosts
  hosts: [&#34;10.0.15.10:5443&#34;]
  bulk_max_size: 1024
  ssl.certificate_authorities: [&#34;/etc/pki/tls/certs/logstash-forwarder.crt&#34;]
  template.name: &#34;filebeat&#34;
  template.path: &#34;filebeat.template.json&#34;
  template.overwrite: false
</code></pre><p>保存并退出 vim。</p><p>将 Filebeat 设定为开机启动并启动。</p><pre tabindex=0><code>sudo systemctl enable filebeat
sudo systemctl start filebeat
</code></pre><p>检查服务状态：</p><pre tabindex=0><code>systemctl status filebeat
</code></pre><p><img src=https://img.linux.net.cn/data/attachment/album/201704/29/004526pa3c2cze7u7yyvkz.png alt="Filebeat is running on the client Ubuntu"></p><h3 id=步骤-8---测试>步骤 8 - 测试</h3><p>打开您的网络浏览器，并访问您在 Nginx 中配置的 elastic stack 域名，我的是“elk-stack.co”。 使用管理员密码登录，然后按 Enter 键登录 Kibana 仪表盘。</p><p><img src=https://img.linux.net.cn/data/attachment/album/201704/29/004530wvvf0ini30k8npni.png alt="Login to the Kibana Dashboard with Basic Auth"></p><p>创建一个新的默认索引 <code>filebeat-*</code>，然后点击“创建”按钮。</p><p><img src=https://img.linux.net.cn/data/attachment/album/201704/29/004533ff3rzp89ppf3lm2k.png alt="Create First index filebeat for Kibana"></p><p>默认索引已创建。 如果 elastic stack 上有多个 beat，您可以在“星形”按钮上点击一下即可配置默认 beat。</p><p><img src=https://img.linux.net.cn/data/attachment/album/201704/29/004534lchbbto58h7b5cz8.png alt="Filebeat index as default index on Kibana Dashboard"></p><p>转到 “发现” 菜单，您就可以看到 elk-client1 和 elk-client2 服务器上的所有日志文件。</p><p><img src=https://img.linux.net.cn/data/attachment/album/201704/29/004536i8mh48fx54kr42hz.png alt="Discover all Log Files from the Servers"></p><p>来自 elk-client1 服务器日志中的无效 ssh 登录的 JSON 输出示例。</p><p><img src=https://img.linux.net.cn/data/attachment/album/201704/29/004547r1g0erhfl72vi15v.png alt="JSON output for Failed SSH Login"></p><p>使用其他的选项，你可以使用 Kibana 仪表盘做更多的事情。</p><p>Elastic Stack 已安装在 CentOS 7 服务器上。 Filebeat 已安装在 CentOS 7 和 Ubuntu 客户端上。</p><hr><p>via: <a href=https://www.howtoforge.com/tutorial/how-to-install-elastic-stack-on-centos-7/>https://www.howtoforge.com/tutorial/how-to-install-elastic-stack-on-centos-7/</a></p><p>作者：<a href=https://www.howtoforge.com/tutorial/how-to-install-elastic-stack-on-centos-7/>Muhammad Arul</a> 译者：<a href=https://github.com/Flowsnow>Flowsnow</a> 校对：<a href=https://github.com/wxy>wxy</a></p><p>本文由 <a href=https://github.com/LCTT/TranslateProject>LCTT</a> 原创编译，<a href=https://linux.cn/>Linux中国</a> 荣誉推出</p></div><footer class=post__footer><div class="post__tags tags clearfix"><svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5.0 11V3C0 1.5.8.8.8.8S1.5.0 3 0h8c1.5.0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 100-6 3 3 0 000 6z"/></svg><ul class=tags__list><li class=tags__item><a class="tags__link btn" href=/tags/lucene/ rel=tag>Lucene</a></li><li class=tags__item><a class="tags__link btn" href=/tags/%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E/ rel=tag>搜索引擎</a></li><li class=tags__item><a class="tags__link btn" href=/tags/%E6%97%A5%E5%BF%97/ rel=tag>日志</a></li></ul></div></footer></article></main></div></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2025 Linux.cn Archive.
<span class=footer__copyright-credits>Generated with <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> and <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a> theme.</span></div></div></footer></div><script async defer src=/js/menu.js></script></body></html>