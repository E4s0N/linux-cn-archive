<!doctype html><html class=no-js lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>性能基准测试：KVM大战Xen - Linux.cn Archive</title>
<script>(function(e,t){e[t]=e[t].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content><meta property="og:title" content="性能基准测试：KVM大战Xen"><meta property="og:description" content="在上周，我们对 KVM 和 Xen 近几年里在性能上的改进进行了一些有趣的探讨后，我打算自己做一些这方面的小研究。我能找到的最新的资料，是来自2013年 Phoronix Haswell 性能评测上的基准测试。当然，还有其它一些2011年的评测，不过由于 Xen 被收录进 Kernel 3.0，它们都已被热烈地讨论过。 2011年的测试提供了许多很好的基准报表，在三年后的现在，我尽最大努力把它们列出的属性重新测试一遍。但我删减了其中两三个基准测试，原因是它们在未经特定优化的配置后跑出来的数据不是很好，或者它们需要跑很长时间才能得到结果。 测试环境 测试"><meta property="og:type" content="article"><meta property="og:url" content="/article-3496-1.html"><meta property="article:section" content="posts"><meta property="article:published_time" content="2014-07-30T18:17:00+00:00"><meta property="article:modified_time" content="2014-07-30T18:17:00+00:00"><meta itemprop=name content="性能基准测试：KVM大战Xen"><meta itemprop=description content="在上周，我们对 KVM 和 Xen 近几年里在性能上的改进进行了一些有趣的探讨后，我打算自己做一些这方面的小研究。我能找到的最新的资料，是来自2013年 Phoronix Haswell 性能评测上的基准测试。当然，还有其它一些2011年的评测，不过由于 Xen 被收录进 Kernel 3.0，它们都已被热烈地讨论过。 2011年的测试提供了许多很好的基准报表，在三年后的现在，我尽最大努力把它们列出的属性重新测试一遍。但我删减了其中两三个基准测试，原因是它们在未经特定优化的配置后跑出来的数据不是很好，或者它们需要跑很长时间才能得到结果。 测试环境 测试"><meta itemprop=datePublished content="2014-07-30T18:17:00+00:00"><meta itemprop=dateModified content="2014-07-30T18:17:00+00:00"><meta itemprop=wordCount content="247"><meta itemprop=keywords content="KVM,Xen,"><link rel=preconnect href=https://fonts.bunny.net crossorigin><link rel=dns-prefetch href=//fonts.bunny.net><link rel=dns-prefetch href=//fonts.bunny.net><link rel=stylesheet href="https://fonts.bunny.net/css?family=Open+Sans:400,400i,700"><link rel=stylesheet href=/css/style.css><link rel="shortcut icon" href=/favicon.ico></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class=logo><a class=logo__link href=/ title="Linux.cn Archive" rel=home><div class="logo__item logo__text"><div class=logo__title>Linux.cn Archive</div></div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>Menu</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/><span class=menu__text>Home</span></a></li><li class=menu__item><a class=menu__link href=/categories/><span class=menu__text>Categories</span></a></li><li class=menu__item><a class=menu__link href=/tags/><span class=menu__text>Tags</span></a></li><li class=menu__item><a class=menu__link href><span class=menu__text>RSS</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>性能基准测试：KVM大战Xen</h1><div class="post__meta meta"><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class=meta__text datetime=2014-07-30T18:17:00Z>July 30, 2014</time></div></div></header><div class="content post__content clearfix"><p><img src=/data/attachment/album/201407/30/181645e1ilzcf3lwel8fm8.jpg alt></p><p>在上周，我们对 KVM 和 Xen 近几年里在性能上的改进进行了一些有趣的探讨后，我打算自己做一些这方面的小研究。我能找到的最新的资料，是来自<a href="http://www.phoronix.com/scan.php?page=article&amp;item=intel_haswell_virtualization&amp;num=1">2013年 Phoronix Haswell 性能评测</a>上的基准测试。当然，还有<a href=http://blog.xen.org/index.php/2011/11/29/baremetal-vs-xen-vs-kvm-redux/>其它一些2011年的评测</a>，不过由于 Xen 被收录进 Kernel 3.0，它们都已被热烈地讨论过。</p><p>2011年的测试提供了<a href=http://blog.xen.org/wp-content/uploads/2011/11/overview.png>许多很好的基准报表</a>，在三年后的现在，我尽最大努力把它们列出的属性重新测试一遍。但我删减了其中两三个基准测试，原因是它们在未经特定优化的配置后跑出来的数据不是很好，或者它们需要跑很长时间才能得到结果。</p><h3 id=测试环境>测试环境</h3><p>测试环境由两台一模一样的超微服务器组成，分别都配备一颗<a href="http://ark.intel.com/products/52269/Intel-Xeon-Processor-E3-1220-8M-Cache-3_10-GHz?q=e3-1220">Intel 至强 E3-1220</a>（4核，3.10GHz），24G 金士顿 DDR3 内存，4块西数 RE-3 160G 磁盘（组成 RAID10 阵列）。另外 BIOS 也是一模一样。</p><p>所有测试项目（即实体机和虚拟机）都在 Fedora 20 （开 SELinux）上进行，并且测试过程中几乎没有运行的不相关的服务。这里列一下相关服务的版本：</p><ul><li>Kernel: 3.14.8</li><li>For KVM: qemu-kvm 1.6.2</li><li>For Xen: xen 4.3.2</li></ul><p>根文件系统都是使用默认配置的 XFS。虚拟机使用 virt-manager 来创建（virt-mamager 也使用默认配置）。虚拟磁盘使用 raw 镜像，容量为 8GB，虚拟4颗 CPU。Xen 虚拟机使用 <a href=http://wiki.xen.org/wiki/Xen_Linux_PV_on_HVM_drivers>PVHVM</a> 建立虚拟磁盘。</p><h3 id=附加说明>附加说明</h3><p>也许有人会考虑到 Fedora 是红帽公司所有，红帽一直在维护 KVM，而 Xen 则自从<a href=http://www.infoworld.com/d/virtualization/red-hat-releases-first-kvm-support-rhel-54-376>在2009年红帽重新选择 KVM 作为虚拟化产品</a>后，再没得到这个公司的重要改进。我将这个因素排除在了测试所考虑的范围之外，不过仍然可以在心里稍微注意一下。</p><p>并且，资源竞争产生的影响也有被严格控制并最小化。在大多数虚拟服务器上，你可以跑多个虚拟机，而这些虚拟机会争用 CPU 时间片、磁盘 IO、网络带宽等等资源。在本测试中也不考虑这些因素。一台虚拟机抢到资源少，性能就差，而另一台抢得多，性能就好（LCTT译注：它们的性能总和，就可 以大致当作是 KVM 或 Xen 的性能了）。</p><p>本测试运行在 Intel 的 CPU 上。如果使用的是 AMD 或 ARM，可能有些数据会不一样。</p><h3 id=结果>结果</h3><p>本测试使用裸机作为虚拟服务测试的基准设备。在不跑虚拟机的情况下，两台裸机的性能偏差不会大于0.51%</p><p>在几乎所有测试中，KVM 的性能相比宿主机而言下降了1.5%以内，只有两项测试例外。第一个是 7-zip 压缩，比宿主机慢了 2.79%。第二个就奇怪了，我们搭了一个邮件服务器，用 PostMark 测试其性能，结果表明 KVM 竟比宿主机快了4.11%。然后我在两台服务器中重新跑了几遍 PostMark 测试，结果性能差异基本不变，浮动都在最初测试结果的1%以内。由于我对 virtio 的内部机制没有很深的理解，我只能在以后再对这个怪现象进行进一步了解。</p><p>Xen 的性能相对宿主机而言差异就比较大了。有3项测试性能下降在2.5%以内，剩下的性能下降率都是 KVM 的2～4倍。PostMark 测试的性能比 KVM 慢了14.41%，这结果令我大吃一惊。重新跑了下测试，性能差还是几乎不变，浮动都在最初结果的2%以内。KVM 表现最好的 CPU 测试：MAFFT 对齐测试，是 Xen 表现倒数第二差的。</p><p>现在奉上一个简短得总结表：</p><table><thead><tr><th></th><th><strong>Best Value</strong></th><th><strong>Bare Metal</strong></th><th><strong>KVM</strong></th><th><strong>Xen</strong></th></tr></thead><tbody><tr><td>C-Ray</td><td>lower</td><td>35.35</td><td>35.66</td><td>36.13</td></tr><tr><td>POV-Ray</td><td>lower</td><td>230.02</td><td>232.44</td><td>235.89</td></tr><tr><td>Smallpt</td><td>lower</td><td>160</td><td>162</td><td>167.5</td></tr><tr><td>John the Ripper (Blowfish)</td><td>higher</td><td>3026</td><td>2991.5</td><td>2856</td></tr><tr><td>John the Ripper (DES)</td><td>higher</td><td>7374833.5</td><td>7271833.5</td><td>6911167</td></tr><tr><td>John the Ripper (MD5)</td><td>higher</td><td>49548</td><td>48899.5</td><td>46653.5</td></tr><tr><td>OpenSSL</td><td>higher</td><td>397.68</td><td>393.95</td><td>388.25</td></tr><tr><td>7-Zip</td><td>higher</td><td>12467.5</td><td>12129.5</td><td>11879</td></tr><tr><td>Timed MAFFT Alignment</td><td>lower</td><td>7.78</td><td>7.795</td><td>8.42</td></tr><tr><td>CLOMP</td><td>higher</td><td>3.3</td><td>3.285</td><td>3.125</td></tr><tr><td>PostMark</td><td>higher</td><td>3667</td><td>3824</td><td>3205</td></tr></tbody></table><p>如果需要完整数据，请查看<a href="https://docs.google.com/spreadsheets/d/1kmudbOjCDUgfw76b8qP2GqNqF1ddlTOKyOjc0GmNOIE/edit?usp=sharing">Goole Docs 电子表格</a>。</p><h3 id=结论>结论</h3><p>基于上面的测试环境，KVM 的性能损耗几乎都在2％以内，Xen 则在十多项测试中有3项损耗在2.5％以内，而其他几项损耗都在5~7%之间。虽然 KVM 在 PostMark 测试中性能表现优异，但这是众多测试中仅有的一项 I/O 测试，如果想证明 KVM 确实在 I/O 处理方面很强悍，就需要更多测试。</p><p>对我来说，我想要深入了解一下 KVM 和 Xen 在 I/O 方面的处理，以及它们之间为什么会有这么大的差别。我也许还会跑一些有竞争的测试，来看看虚拟机在有压力的条件下是否真的能比宿主机表现得更出色。</p><p>我鼓励读者通过使用<a href=http://www.phoronix-test-suite.com/>Phoronix 测试套件</a>来进行一些基准测试，你们可以找到一些能模仿你们工作环境的用例。如果你的工作环境是低 CPU 高 I/O，你可以找找套件里面的 I/O 压力测试。另一方面，如果你的工作是音频、视频转码，你可以试试套件里面的 x264 或 mp3 测试。</p><p>更新：<a href=https://twitter.com/comstud/status/480785742730252288>Chris Behrens 指出</a>， 我忘了提到 Xen 虚拟机类型了。这里补充下，我使用的是 PVHVM 模型（LCTT译注：目前支持的模型包括 PV、HVM 和 PVHVM），因为在 Xen 4.3 中这个选拥有最好的性能。另外需要注意的是在 Xen 4.4 中可以使用 PVH，但是在 Fedora 20 中还没有使用 Xen 4.4。</p><hr><p>via: <a href=http://major.io/2014/06/22/performance-benchmarks-kvm-vs-xen/>http://major.io/2014/06/22/performance-benchmarks-kvm-vs-xen/</a></p><p>译者：<a href=https://github.com/bazz2>bazz2</a> 校对：<a href=https://github.com/reinoir>ReiNoir</a></p><p>本文由 <a href=https://github.com/LCTT/TranslateProject>LCTT</a> 原创翻译，<a href=http://linux.cn/>Linux中国</a> 荣誉推出</p></div><footer class=post__footer><div class="post__tags tags clearfix"><svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5.0 11V3C0 1.5.8.8.8.8S1.5.0 3 0h8c1.5.0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 100-6 3 3 0 000 6z"/></svg><ul class=tags__list><li class=tags__item><a class="tags__link btn" href=/tags/kvm/ rel=tag>KVM</a></li><li class=tags__item><a class="tags__link btn" href=/tags/xen/ rel=tag>Xen</a></li></ul></div></footer></article></main></div></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2025 Linux.cn Archive.
<span class=footer__copyright-credits>Generated with <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> and <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a> theme.</span></div></div></footer></div><script async defer src=/js/menu.js></script></body></html>