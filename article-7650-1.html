<!doctype html><html class=no-js lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>awk 系列：怎样使用 awk 变量、数值表达式以及赋值运算符 - Linux.cn Archive</title>
<script>(function(e,t){e[t]=e[t].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content><meta property="og:title" content="awk 系列：怎样使用 awk 变量、数值表达式以及赋值运算符"><meta property="og:description" content="在这一部分，我们将会进入 awk 更高级的部分，使用 awk 处理更复杂的文本和进行字符串过滤操作。"><meta property="og:type" content="article"><meta property="og:url" content="/article-7650-1.html"><meta property="article:section" content="posts"><meta property="article:published_time" content="2016-08-05T09:14:43+00:00"><meta property="article:modified_time" content="2016-08-05T09:14:43+00:00"><meta itemprop=name content="awk 系列：怎样使用 awk 变量、数值表达式以及赋值运算符"><meta itemprop=description content="在这一部分，我们将会进入 awk 更高级的部分，使用 awk 处理更复杂的文本和进行字符串过滤操作。"><meta itemprop=datePublished content="2016-08-05T09:14:43+00:00"><meta itemprop=dateModified content="2016-08-05T09:14:43+00:00"><meta itemprop=wordCount content="459"><meta itemprop=keywords content="awk,"><link rel=preconnect href=https://fonts.bunny.net crossorigin><link rel=dns-prefetch href=//fonts.bunny.net><link rel=dns-prefetch href=//fonts.bunny.net><link rel=stylesheet href="https://fonts.bunny.net/css?family=Open+Sans:400,400i,700"><link rel=stylesheet href=/css/style.css><link rel="shortcut icon" href=/favicon.ico></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class=logo><a class=logo__link href=/ title="Linux.cn Archive" rel=home><div class="logo__item logo__text"><div class=logo__title>Linux.cn Archive</div></div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>Menu</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/><span class=menu__text>Home</span></a></li><li class=menu__item><a class=menu__link href=/categories/><span class=menu__text>Categories</span></a></li><li class=menu__item><a class=menu__link href=/tags/><span class=menu__text>Tags</span></a></li><li class=menu__item><a class=menu__link href><span class=menu__text>RSS</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>awk 系列：怎样使用 awk 变量、数值表达式以及赋值运算符</h1><div class="post__meta meta"><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class=meta__text datetime=2016-08-05T09:14:43Z>August 05, 2016</time></div></div></header><div class="content post__content clearfix"><p>我觉得 <a href=/article-7586-1.html>awk 系列</a> 将会越来越好，在本系列的前七节我们讨论了在 Linux 中处理文件和筛选字符串所需要的一些 awk 命令基础。</p><p>在这一部分，我们将会进入 awk 更高级的部分，使用 awk 处理更复杂的文本和进行字符串过滤操作。因此，我们将会讲到 Awk 的一些特性，诸如变量、数值表达式和赋值运算符。</p><p><img src=/data/attachment/album/201608/05/091445ktem9q8x6qtubqke.png alt></p><p><em>学习 Awk 变量，数值表达式和赋值运算符</em></p><p>你可能已经在很多编程语言中接触过它们，比如 shell，C，Python 等；这些概念在理解上和这些语言没有什么不同，所以在这一小节中你不用担心很难理解，我们将会简短的提及常用的一些 awk 特性。</p><p>这一小节可能是 awk 命令里最容易理解的部分，所以放松点，我们开始吧。</p><h3 id=1-awk-变量>1. Awk 变量</h3><p>在很多编程语言中，变量就是一个存储了值的占位符，当你在程序中新建一个变量的时候，程序一运行就会在内存中创建一些空间，你为变量赋的值会存储在这些内存空间上。</p><p>你可以像下面这样定义 shell 变量一样定义 awk 变量：</p><pre tabindex=0><code>variable_name=value 
</code></pre><p>上面的语法：</p><ul><li><code>variable_name</code>: 为定义的变量的名字</li><li><code>value</code>: 为变量赋的值</li></ul><p>再看下面的一些例子:</p><pre tabindex=0><code>computer_name=”tecmint.com”
port_no=”22”
email=”admin@tecmint.com”
server=computer_name
</code></pre><p>观察上面的简单的例子，在定义第一个变量的时候，值 &rsquo;tecmint.com&rsquo; 被赋给了 &lsquo;computer_name&rsquo; 变量。</p><p>此外，值 22 也被赋给了 port_no 变量，把一个变量的值赋给另一个变量也是可以的，在最后的例子中我们把变量 computer_name 的值赋给了变量 server。</p><p>你可以看看<a href=/article-7587-1.html>本系列的第 2 节</a>中提到的字段编辑，我们讨论了 awk 怎样将输入的行分隔为若干字段并且使用标准字段访问操作符 <code>$</code> 来访问拆分出来的不同字段。我们也可以像下面这样使用变量为字段赋值。</p><pre tabindex=0><code>first_name=$2
second_name=$3
</code></pre><p>在上面的例子中，变量 first_name 的值设置为第二个字段，second_name 的值设置为第三个字段。</p><p>再举个例子，有一个名为 names.txt 的文件，这个文件包含了一个应用程序的用户列表，这个用户列表包含了用户的名和姓以及性别。可以使用 <a href=http://www.tecmint.com/13-basic-cat-command-examples-in-linux/>cat 命令</a> 查看文件内容：</p><pre tabindex=0><code>$ cat names.txt
</code></pre><p><img src=/data/attachment/album/201608/05/091446k6x9hc4xyoldrhl6.png alt></p><p><em>使用 cat 命令查看列表文件内容</em></p><p>然后，我们也可以使用下面的 awk 命令把列表中第一个用户的第一个和第二个名字分别存储到变量 first_name 和 second_name 上：</p><pre tabindex=0><code>$ awk &#39;/Aaron/{ first_name=$2 ; second_name=$3 ; print first_name, second_name ; }&#39; names.txt
</code></pre><p><img src=/data/attachment/album/201608/05/091447gkkavpk6bk4cgtkx.png alt></p><p><em>使用 Awk 命令为变量赋值</em></p><p>再看一个例子，当你在终端运行 &lsquo;uname -a&rsquo; 时，它可以打印出所有的系统信息。</p><p>第二个字段包含了你的主机名，因此，我们可以像下面这样把它赋给一个叫做 hostname 的变量并且用 awk 打印出来。</p><pre tabindex=0><code>$ uname -a
$ uname -a | awk &#39;{hostname=$2 ; print hostname ; }&#39; 
</code></pre><p><img src=/data/attachment/album/201608/05/091448az7dwrr5h0881xxz.png alt></p><p><em>使用 Awk 把命令的输出赋给变量</em></p><h3 id=2-数值表达式>2. 数值表达式</h3><p>在 Awk 中，数值表达式使用下面的数值运算符组成：</p><ul><li><code>*</code> : 乘法运算符</li><li><code>+</code> : 加法运算符</li><li><code>/</code> : 除法运算符</li><li><code>-</code> : 减法运算符</li><li><code>%</code> : 取模运算符</li><li><code>^</code> : 指数运算符</li></ul><p>数值表达式的语法是：</p><pre tabindex=0><code>$ operand1 operator operand2
</code></pre><p>上面的 operand1 和 operand2 可以是数值和变量，运算符可以是上面列出的任意一种。</p><p>下面是一些展示怎样使用数值表达式的例子：</p><pre tabindex=0><code>counter=0
num1=5
num2=10
num3=num2-num1
counter=counter+1
</code></pre><p>要理解 Awk 中数值表达式的用法，我们可以看看下面的例子，文件 domians.txt 里包括了所有属于 Tecmint 的域名。</p><pre tabindex=0><code>news.tecmint.com
tecmint.com
linuxsay.com
windows.tecmint.com
tecmint.com
news.tecmint.com
tecmint.com
linuxsay.com
tecmint.com
news.tecmint.com
tecmint.com
linuxsay.com
windows.tecmint.com
tecmint.com
</code></pre><p>可以使用下面的命令查看文件的内容：</p><pre tabindex=0><code>$ cat domains.txt
</code></pre><p><img src=/data/attachment/album/201608/05/091448t90f5k74b5skkbmf.png alt></p><p><em>查看文件内容</em></p><p>如果想要计算出域名 tecmint.com 在文件中出现的次数，我们就可以通过写一个简单的脚本实现这个功能：</p><pre tabindex=0><code>#!/bin/bash
for file in $@; do
if [ -f $file ] ; then
#print out filename
echo &#34;File is: $file&#34;
#print a number incrementally for every line containing tecmint.com 
awk  &#39;/^tecmint.com/ { counter=counter+1 ; printf &#34;%s\n&#34;, counter ; }&#39;   $file
else
#print error info incase input is not a file
echo &#34;$file is not a file, please specify a file.&#34; &gt;&amp;2 &amp;&amp; exit 1
fi
done
#terminate script with exit code 0 in case of successful execution 
exit 0
</code></pre><p><img src=/data/attachment/album/201608/05/091449z44tdta5ak7xnz7t.png alt></p><p><em>计算一个字符串或文本在文件中出现次数的 shell 脚本</em></p><p>写完脚本后保存并赋予执行权限，当我们使用文件运行脚本的时候，文件 domains.txt 作为脚本的输入，我们会得到下面的输出：</p><pre tabindex=0><code>$ ./script.sh  ~/domains.txt
</code></pre><p><img src=/data/attachment/album/201608/05/091449j48eu282p1orv6oj.png alt></p><p><em>计算字符串或文本出现次数的脚本</em></p><p>从脚本执行后的输出中，可以看到在文件 domains.txt 中包含域名 tecmint.com 的地方有 6 行，你可以自己计算进行验证。</p><h3 id=3-赋值操作符>3. 赋值操作符</h3><p>我们要说的最后的 Awk 特性是赋值操作符，下面列出的只是 awk 中的部分赋值运算符：</p><ul><li><code>*=</code> : 乘法赋值操作符</li><li><code>+=</code> : 加法赋值操作符</li><li><code>/=</code> : 除法赋值操作符</li><li><code>-=</code> : 减法赋值操作符</li><li><code>%=</code> : 取模赋值操作符</li><li><code>^=</code> : 指数赋值操作符</li></ul><p>下面是 Awk 中最简单的一个赋值操作的语法：</p><pre tabindex=0><code>$ variable_name=variable_name operator operand
</code></pre><p>例子：</p><pre tabindex=0><code>counter=0
counter=counter+1
num=20
num=num-1
</code></pre><p>你可以使用在 awk 中使用上面的赋值操作符使命令更简短，从先前的例子中，我们可以使用下面这种格式进行赋值操作：</p><pre tabindex=0><code>variable_name operator=operand
counter=0
counter+=1
num=20
num-=1
</code></pre><p>因此，我们可以在 shell 脚本中改变 awk 命令，使用上面提到的 += 操作符:</p><pre tabindex=0><code>#!/bin/bash
for file in $@; do
if [ -f $file ] ; then
#print out filename
echo &#34;File is: $file&#34;
#print a number incrementally for every line containing tecmint.com 
awk  &#39;/^tecmint.com/ { counter+=1 ; printf  &#34;%s\n&#34;,  counter ; }&#39;   $file
else
#print error info incase input is not a file
echo &#34;$file is not a file, please specify a file.&#34; &gt;&amp;2 &amp;&amp; exit 1
fi
done
#terminate script with exit code 0 in case of successful execution 
exit 0
</code></pre><p><img src=/data/attachment/album/201608/05/091449rwv95ues879dtdv4.png alt></p><p><em>修改了的 shell 脚本</em></p><p>在 <a href=/article-7586-1.html>awk 系列</a> 的这一部分，我们讨论了一些有用的 awk 特性，有变量，使用数值表达式和赋值运算符，还有一些使用它们的实例。</p><p>这些概念和其他的编程语言没有任何不同，但是可能在 awk 中有一些意义上的区别。</p><p>在本系列的第 9 节，我们会学习更多的 awk 特性，比如特殊格式： BEGIN 和 END。请继续关注。</p><hr><p>via: <a href=http://www.tecmint.com/learn-awk-variables-numeric-expressions-and-assignment-operators/>http://www.tecmint.com/learn-awk-variables-numeric-expressions-and-assignment-operators/</a></p><p>作者：<a href=http://www.tecmint.com/author/aaronkili/>Aaron Kili</a> 译者：<a href=https://github.com/vim-kakali>vim-kakali</a> 校对：<a href=https://github.com/wxy>wxy</a></p><p>本文由 <a href=https://github.com/LCTT/TranslateProject>LCTT</a> 原创编译，<a href=https://linux.cn/>Linux中国</a> 荣誉推出</p></div><footer class=post__footer><div class="post__tags tags clearfix"><svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5.0 11V3C0 1.5.8.8.8.8S1.5.0 3 0h8c1.5.0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 100-6 3 3 0 000 6z"/></svg><ul class=tags__list><li class=tags__item><a class="tags__link btn" href=/tags/awk/ rel=tag>awk</a></li></ul></div></footer></article></main></div></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2025 Linux.cn Archive.
<span class=footer__copyright-credits>Generated with <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> and <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a> theme.</span></div></div></footer></div><script async defer src=/js/menu.js></script></body></html>