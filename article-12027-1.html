<!doctype html><html class=no-js lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>如何在 Linux 上为特定的用户或用户组启用或禁用 SSH？ - Linux.cn Archive</title>
<script>(function(e,t){e[t]=e[t].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content><meta property="og:title" content="如何在 Linux 上为特定的用户或用户组启用或禁用 SSH？"><meta property="og:description" content="由于你的公司标准规定，你可能只能允许部分人访问 Linux 系统。"><meta property="og:type" content="article"><meta property="og:url" content="/article-12027-1.html"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-03-23T10:59:29+00:00"><meta property="article:modified_time" content="2020-03-23T10:59:29+00:00"><meta itemprop=name content="如何在 Linux 上为特定的用户或用户组启用或禁用 SSH？"><meta itemprop=description content="由于你的公司标准规定，你可能只能允许部分人访问 Linux 系统。"><meta itemprop=datePublished content="2020-03-23T10:59:29+00:00"><meta itemprop=dateModified content="2020-03-23T10:59:29+00:00"><meta itemprop=wordCount content="729"><meta itemprop=keywords content="SSH,"><link rel=preconnect href=https://fonts.bunny.net crossorigin><link rel=dns-prefetch href=//fonts.bunny.net><link rel=dns-prefetch href=//fonts.bunny.net><link rel=stylesheet href="https://fonts.bunny.net/css?family=Open+Sans:400,400i,700"><link rel=stylesheet href=/css/style.css><link rel="shortcut icon" href=/favicon.ico></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class=logo><a class=logo__link href=/ title="Linux.cn Archive" rel=home><div class="logo__item logo__text"><div class=logo__title>Linux.cn Archive</div></div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>Menu</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/><span class=menu__text>Home</span></a></li><li class=menu__item><a class=menu__link href=/categories/><span class=menu__text>Categories</span></a></li><li class=menu__item><a class=menu__link href=/tags/><span class=menu__text>Tags</span></a></li><li class=menu__item><a class=menu__link href><span class=menu__text>RSS</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>如何在 Linux 上为特定的用户或用户组启用或禁用 SSH？</h1><div class="post__meta meta"><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class=meta__text datetime=2020-03-23T10:59:29Z>March 23, 2020</time></div></div></header><div class="content post__content clearfix"><p><img src=/data/attachment/album/202003/23/105915r1azn34i82sp48ca.jpg alt></p><p>由于你的公司标准规定，你可能只能允许部分人访问 Linux 系统。或者你可能只能够允许几个用户组中的用户访问 Linux 系统。那么如何实现这样的要求呢？最好的方法是什么呢？如何使用一个简单的方法去实现呢？</p><p>是的，我们会有很多种方法去实现它。但是我们应该使用简单轻松的方法。为了简单轻松的完成目的，我们可以通过对 <code>/etc/ssh/sshd_config</code> 文件做必要的修改来实现。在这篇文章中我们将会向你展示实现要求的详细步骤。</p><p>为什么我们要这样做呢？是出于安全的原因。你可以访问<a href=https://www.2daygeek.com/category/ssh-tutorials/>这个链接</a>来获取更多关于 openSSH 的使用方法。</p><h3 id=什么是-ssh->什么是 SSH ？</h3><p>openssh 全称为 OpenBSD Secure Shell。Secure Shell（ssh）是一个自由开源的网络工具，它能让我们在一个不安全的网络中通过使用 Secure Shell（SSH）协议来安全访问远程主机。</p><p>它采用了客户端-服务器架构（C/S），拥有用户身份认证、加密、在计算机和隧道之间传输文件等功能。</p><p>我们也可以用 <code>telnet</code> 或 <code>rcp</code> 等传统工具来完成，但是这些工具都不安全，因为它们在执行任何动作时都会使用明文来传输密码。</p><h3 id=如何在-linux-中允许用户使用-ssh>如何在 Linux 中允许用户使用 SSH？</h3><p>通过以下内容，我们可以为指定的用户或用户列表启用 <code>ssh</code> 访问。如果你想要允许多个用户，那么你可以在添加用户时在同一行中用空格来隔开他们。</p><p>为了达到目的只需要将下面的值追加到 <code>/etc/ssh/sshd_config</code> 文件中去。 在这个例子中， 我们将会允许用户 <code>user3</code> 使用 ssh。</p><pre tabindex=0><code># echo &#34;AllowUsers user3&#34; &gt;&gt; /etc/ssh/sshd_config
</code></pre><p>你可以运行下列命令再次检查是否添加成功。</p><pre tabindex=0><code># cat /etc/ssh/sshd_config | grep -i allowusers
AllowUsers user3
</code></pre><p>这样就行了， 现在只需要重启 <code>ssh</code> 服务和见证奇迹了。（下面这两条命令效果相同， 请根据你的服务管理方式选择一条执行即可）</p><pre tabindex=0><code># systemctl restart sshd
或
# service restart sshd
</code></pre><p>接下来很简单，只需打开一个新的终端或者会话尝试用不同的用户身份访问 Linux 系统。是的，这里 <code>user2</code> 用户是不被允许使用 SSH 登录的并且会得到如下所示的错误信息。</p><pre tabindex=0><code># ssh user2@192.168.1.4
user2@192.168.1.4&#39;s password: 
Permission denied, please try again.
</code></pre><p>输出:</p><pre tabindex=0><code>Mar 29 02:00:35 CentOS7 sshd[4900]: User user2 from 192.168.1.6 not allowed because not listed in AllowUsers
Mar 29 02:00:35 CentOS7 sshd[4900]: input_userauth_request: invalid user user2 [preauth]
Mar 29 02:00:40 CentOS7 unix_chkpwd[4902]: password check failed for user (user2)
Mar 29 02:00:40 CentOS7 sshd[4900]: pam_unix(sshd:auth): authentication failure; logname= uid=0 euid=0 tty=ssh ruser= rhost=192.168.1.6  user=user2
Mar 29 02:00:43 CentOS7 sshd[4900]: Failed password for invalid user user2 from 192.168.1.6 port 42568 ssh2
</code></pre><p>与此同时用户 <code>user3</code> 被允许登入系统因为他在被允许的用户列表中。</p><pre tabindex=0><code># ssh user3@192.168.1.4
user3@192.168.1.4&#39;s password: 
[user3@CentOS7 ~]$
</code></pre><p>输出:</p><pre tabindex=0><code>Mar 29 02:01:13 CentOS7 sshd[4939]: Accepted password for user3 from 192.168.1.6 port 42590 ssh2
Mar 29 02:01:13 CentOS7 sshd[4939]: pam_unix(sshd:session): session opened for user user3 by (uid=0)
</code></pre><h3 id=如何在-linux-中阻止用户使用-ssh->如何在 Linux 中阻止用户使用 SSH ？</h3><p>通过以下内容，我们可以配置指定的用户或用户列表禁用 <code>ssh</code>。如果你想要禁用多个用户，那么你可以在添加用户时在同一行中用空格来隔开他们。</p><p>为了达到目的只需要将以下值追加到 <code>/etc/ssh/sshd_config</code> 文件中去。 在这个例子中， 我们将禁用用户 <code>user1</code> 使用 <code>ssh</code>。</p><pre tabindex=0><code># echo &#34;DenyUsers user1&#34; &gt;&gt; /etc/ssh/sshd_config
</code></pre><p>你可以运行下列命令再次检查是否添加成功。</p><pre tabindex=0><code># cat /etc/ssh/sshd_config | grep -i denyusers
DenyUsers user1
</code></pre><p>这样就行了， 现在只需要重启 <code>ssh</code> 服务和见证奇迹了。</p><pre tabindex=0><code># systemctl restart sshd
活
# service restart sshd
</code></pre><p>接下来很简单，只需打开一个新的终端或者会话，尝试使用被禁用的用户身份被访问 Linux 系统。是的，这里 <code>user1</code> 用户在禁用名单中。所以，当你尝试登录时，你将会得到如下所示的错误信息。</p><pre tabindex=0><code># ssh user1@192.168.1.4
user1@192.168.1.4&#39;s password: 
Permission denied, please try again.
</code></pre><p>输出:</p><pre tabindex=0><code>Mar 29 01:53:42 CentOS7 sshd[4753]: User user1 from 192.168.1.6 not allowed because listed in DenyUsers
Mar 29 01:53:42 CentOS7 sshd[4753]: input_userauth_request: invalid user user1 [preauth]
Mar 29 01:53:46 CentOS7 unix_chkpwd[4755]: password check failed for user (user1)
Mar 29 01:53:46 CentOS7 sshd[4753]: pam_unix(sshd:auth): authentication failure; logname= uid=0 euid=0 tty=ssh ruser= rhost=192.168.1.6  user=user1
Mar 29 01:53:48 CentOS7 sshd[4753]: Failed password for invalid user user1 from 192.168.1.6 port 42522 ssh2
</code></pre><h3 id=如何在-linux-中允许用户组使用-ssh>如何在 Linux 中允许用户组使用 SSH?</h3><p>通过以下内容，我们可以允许一个指定的组或多个组使用 <code>ssh</code>。</p><p>如果你想要允许多个组使用 <code>ssh</code> 那么你在添加用户组时需要在同一行中使用空格来隔开他们。</p><p>为了达到目的只需将以下值追加到 <code>/etc/ssh/sshd_config</code> 文件中去。在这个例子中，我们将允许 <code>2g-admin</code> 组使用 ssh。</p><pre tabindex=0><code># echo &#34;AllowGroups 2g-admin&#34; &gt;&gt; /etc/ssh/sshd_config
</code></pre><p>你可以运行下列命令再次检查是否添加成功。</p><pre tabindex=0><code># cat /etc/ssh/sshd_config | grep -i allowgroups
AllowGroups 2g-admin
</code></pre><p>运行下列命令查看属于该用户组的用户有哪些。</p><pre tabindex=0><code># getent group 2g-admin
2g-admin:x:1005:user1,user2,user3
</code></pre><p>这样就行了， 现在只需要重启 <code>ssh</code> 服务和见证奇迹了。</p><pre tabindex=0><code># systemctl restart sshd
或
# service restart sshd
</code></pre><p>是的， <code>user1</code> 被允许登入系统因为用户 <code>user1</code> 属于 <code>2g-admin</code> 组。</p><pre tabindex=0><code># ssh user1@192.168.1.4
user1@192.168.1.4&#39;s password: 
[user1@CentOS7 ~]$
</code></pre><p>输出:</p><pre tabindex=0><code>Mar 29 02:10:21 CentOS7 sshd[5165]: Accepted password for user1 from 192.168.1.6 port 42640 ssh2
Mar 29 02:10:22 CentOS7 sshd[5165]: pam_unix(sshd:session): session opened for user user1 by (uid=0)
</code></pre><p>是的， <code>user2</code> 被允许登入系统因为用户 <code>user2</code> 同样属于 <code>2g-admin</code> 组。</p><pre tabindex=0><code># ssh user2@192.168.1.4
user2@192.168.1.4&#39;s password: 
[user2@CentOS7 ~]$
</code></pre><p>输出:</p><pre tabindex=0><code>Mar 29 02:10:38 CentOS7 sshd[5225]: Accepted password for user2 from 192.168.1.6 port 42642 ssh2
Mar 29 02:10:38 CentOS7 sshd[5225]: pam_unix(sshd:session): session opened for user user2 by (uid=0)
</code></pre><p>当你尝试使用其他不在被允许的组中的用户去登入系统时， 你将会得到如下所示的错误信息。</p><pre tabindex=0><code># ssh ladmin@192.168.1.4
ladmin@192.168.1.4&#39;s password: 
Permission denied, please try again.
</code></pre><p>输出:</p><pre tabindex=0><code>Mar 29 02:12:36 CentOS7 sshd[5306]: User ladmin from 192.168.1.6 not allowed because none of user&#39;s groups are listed in AllowGroups
Mar 29 02:12:36 CentOS7 sshd[5306]: input_userauth_request: invalid user ladmin [preauth]
Mar 29 02:12:56 CentOS7 unix_chkpwd[5310]: password check failed for user (ladmin)
Mar 29 02:12:56 CentOS7 sshd[5306]: pam_unix(sshd:auth): authentication failure; logname= uid=0 euid=0 tty=ssh ruser= rhost=192.168.1.6  user=ladmin
Mar 29 02:12:58 CentOS7 sshd[5306]: Failed password for invalid user ladmin from 192.168.1.6 port 42674 ssh2
</code></pre><h3 id=如何在-linux-中阻止用户组使用-ssh>如何在 Linux 中阻止用户组使用 SSH？</h3><p>通过以下内容，我们可以禁用指定的组或多个组使用 <code>ssh</code>。</p><p>如果你想要禁用多个用户组使用 <code>ssh</code>，那么你需要在添加用户组时在同一行中使用空格来隔开他们。</p><p>为了达到目的只需要将下面的值追加到 <code>/etc/ssh/sshd_config</code> 文件中去。</p><pre tabindex=0><code># echo &#34;DenyGroups 2g-admin&#34; &gt;&gt; /etc/ssh/sshd_config
</code></pre><p>你可以运行下列命令再次检查是否添加成功。</p><pre tabindex=0><code># # cat /etc/ssh/sshd_config | grep -i denygroups
DenyGroups 2g-admin

# getent group 2g-admin
2g-admin:x:1005:user1,user2,user3
</code></pre><p>这样就行了， 现在只需要重启 <code>ssh</code> 服务和见证奇迹了。</p><pre tabindex=0><code># systemctl restart sshd
或
# service restart sshd
</code></pre><p>是的 <code>user1</code> 不被允许登入系统，因为他是 <code>2g-admin</code> 用户组中的一员。他属于被禁用 <code>ssh</code> 的组中。</p><pre tabindex=0><code># ssh user1@192.168.1.4
user1@192.168.1.4&#39;s password: 
Permission denied, please try again.
</code></pre><p>输出:</p><pre tabindex=0><code>Mar 29 02:17:32 CentOS7 sshd[5400]: User user1 from 192.168.1.6 not allowed because a group is listed in DenyGroups
Mar 29 02:17:32 CentOS7 sshd[5400]: input_userauth_request: invalid user user1 [preauth]
Mar 29 02:17:38 CentOS7 unix_chkpwd[5402]: password check failed for user (user1)
Mar 29 02:17:38 CentOS7 sshd[5400]: pam_unix(sshd:auth): authentication failure; logname= uid=0 euid=0 tty=ssh ruser= rhost=192.168.1.6  user=user1
Mar 29 02:17:41 CentOS7 sshd[5400]: Failed password for invalid user user1 from 192.168.1.6 port 42710 ssh2
</code></pre><p>除了 <code>2g-admin</code> 用户组之外的用户都可以使用 ssh 登入系统。 例如，<code>ladmin</code> 等用户就允许登入系统。</p><pre tabindex=0><code># ssh ladmin@192.168.1.4
ladmin@192.168.1.4&#39;s password: 
[ladmin@CentOS7 ~]$
</code></pre><p>输出:</p><pre tabindex=0><code>Mar 29 02:19:13 CentOS7 sshd[5432]: Accepted password for ladmin from 192.168.1.6 port 42716 ssh2
Mar 29 02:19:13 CentOS7 sshd[5432]: pam_unix(sshd:session): session opened for user ladmin by (uid=0)
</code></pre><hr><p>via: <a href=https://www.2daygeek.com/allow-deny-enable-disable-ssh-access-user-group-in-linux/>https://www.2daygeek.com/allow-deny-enable-disable-ssh-access-user-group-in-linux/</a></p><p>作者：<a href=http://www.2daygeek.com/author/2daygeek/>2daygeek</a> 选题：<a href=https://github.com/lujun9972>lujun9972</a> 译者：<a href=https://github.com/way-ww>way-ww</a> 校对：<a href=https://github.com/wxy>wxy</a></p><p>本文由 <a href=https://github.com/LCTT/TranslateProject>LCTT</a> 原创编译，<a href=https://linux.cn/>Linux中国</a> 荣誉推出</p></div><footer class=post__footer><div class="post__tags tags clearfix"><svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5.0 11V3C0 1.5.8.8.8.8S1.5.0 3 0h8c1.5.0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 100-6 3 3 0 000 6z"/></svg><ul class=tags__list><li class=tags__item><a class="tags__link btn" href=/tags/ssh/ rel=tag>SSH</a></li></ul></div></footer></article></main></div></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2025 Linux.cn Archive.
<span class=footer__copyright-credits>Generated with <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> and <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a> theme.</span></div></div></footer></div><script async defer src=/js/menu.js></script></body></html>