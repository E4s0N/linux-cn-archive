<!doctype html><html class=no-js lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>使用 Bokeh 为你的 Python 绘图添加交互性 - Linux.cn Archive</title>
<script>(function(e,t){e[t]=e[t].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content><meta property="og:title" content="使用 Bokeh 为你的 Python 绘图添加交互性"><meta property="og:description" content="在 Bokeh 中绘图比其他一些绘图库要复杂一些，但付出额外的努力是有回报的。"><meta property="og:type" content="article"><meta property="og:url" content="/article-12329-1.html"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-06-18T16:47:00+00:00"><meta property="article:modified_time" content="2020-06-18T16:47:00+00:00"><meta itemprop=name content="使用 Bokeh 为你的 Python 绘图添加交互性"><meta itemprop=description content="在 Bokeh 中绘图比其他一些绘图库要复杂一些，但付出额外的努力是有回报的。"><meta itemprop=datePublished content="2020-06-18T16:47:00+00:00"><meta itemprop=dateModified content="2020-06-18T16:47:00+00:00"><meta itemprop=wordCount content="368"><meta itemprop=keywords content="Python,绘图,"><link rel=preconnect href=https://fonts.bunny.net crossorigin><link rel=dns-prefetch href=//fonts.bunny.net><link rel=dns-prefetch href=//fonts.bunny.net><link rel=stylesheet href="https://fonts.bunny.net/css?family=Open+Sans:400,400i,700"><link rel=stylesheet href=/css/style.css><link rel="shortcut icon" href=/favicon.ico></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class=logo><a class=logo__link href=/ title="Linux.cn Archive" rel=home><div class="logo__item logo__text"><div class=logo__title>Linux.cn Archive</div></div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>Menu</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/><span class=menu__text>Home</span></a></li><li class=menu__item><a class=menu__link href=/categories/><span class=menu__text>Categories</span></a></li><li class=menu__item><a class=menu__link href=/tags/><span class=menu__text>Tags</span></a></li><li class=menu__item><a class=menu__link href><span class=menu__text>RSS</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>使用 Bokeh 为你的 Python 绘图添加交互性</h1><div class="post__meta meta"><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class=meta__text datetime=2020-06-18T16:47:00Z>June 18, 2020</time></div></div></header><div class="content post__content clearfix"><blockquote><p>在 Bokeh 中绘图比其他一些绘图库要复杂一些，但付出额外的努力是有回报的。</p></blockquote><p><img src=/data/attachment/album/202006/18/164708zz7tjxz7m7ax5lt3.jpg alt></p><p>在这一系列文章中，我通过在每个 Python 绘图库中制作相同的多条形绘图，来研究不同 Python 绘图库的特性。这次我重点介绍的是 <a href=https://bokeh.org/>Bokeh</a>（读作 “BOE-kay”）。</p><p>Bokeh 中的绘图比<a href=/article-12327-1.html>其它一些绘图库</a>要复杂一些，但付出的额外努力是有回报的。Bokeh 的设计既允许你在 Web 上创建自己的交互式绘图，又能让你详细控制交互性如何工作。我将通过给我在这个系列中一直使用的多条形图添加工具提示来展示这一点。它绘制了 1966 年到 2020 年之间英国选举结果的数据。</p><p><img src=/data/attachment/album/202006/18/164745tbgswq11b3qqqito.png alt title="A zoomed-in view on the plot"></p><p><em>绘图的放大视图（©2019 年 <a href=https://anvil.works/blog/plotting-in-bokeh>Anvil</a>）</em></p><h3 id=制作多条形图>制作多条形图</h3><p>在我们继续之前，请注意你可能需要调整你的 Python 环境来让这段代码运行，包括以下：</p><ul><li>运行最新版本的 Python （在 <a href=https://opensource.com/article/20/4/install-python-linux>Linux</a>、<a href=https://opensource.com/article/19/5/python-3-default-mac>Mac</a> 和 <a href=https://opensource.com/article/19/8/how-install-python-windows>Windows</a> 上的说明）</li><li>确认你运行的 Python 版本能与这些库一起工作。</li></ul><p>数据可在线获得，可以用 Pandas 导入。</p><pre tabindex=0><code>import pandas as pd
df = pd.read_csv(&#39;https://anvil.works/blog/img/plotting-in-python/uk-election-results.csv&#39;)
</code></pre><p>现在我们可以继续进行了。</p><p>为了做出多条形图，你需要对你的数据进行一下调整。</p><p>原始数据是这样的：</p><pre tabindex=0><code>&gt;&gt; print(long)
        year         party  seats
0       1966  Conservative    253
1       1970  Conservative    330
2   Feb 1974  Conservative    297
3   Oct 1974  Conservative    277
4       1979  Conservative    339
..       ...           ...    ...
103     2005        Others     30
104     2010        Others     29
105     2015        Others     80
106     2017        Others     59
107     2019        Others     72

[60 rows x 3 columns]
</code></pre><p>你可以把数据看成是每一个可能的 <code>(year, party)</code> 组合的一系列 <code>seats</code> 值。这正是 Bokeh 处理的方式。你需要做一个 <code>(year, party)</code> 元组的列表：</p><pre tabindex=0><code># 得到每种可能的 (year, party) 组合的元组
x = [(str(r[1][&#39;year&#39;]), r[1][&#39;party&#39;]) for r in df.iterrows()]
   
# This comes out as [(&#39;1922&#39;, &#39;Conservative&#39;), (&#39;1923&#39;, &#39;Conservative&#39;), ... (&#39;2019&#39;, &#39;Others&#39;)]
</code></pre><p>这些将是 <code>x</code> 值。<code>y</code> 值就是席位（<code>seats</code>）。</p><pre tabindex=0><code>y = df[&#39;seats&#39;]
</code></pre><p>现在你的数据看起来应该像这样：</p><pre tabindex=0><code>x                               y
(&#39;1966&#39;, &#39;Conservative&#39;)        253
(&#39;1970&#39;, &#39;Conservative&#39;)        330
(&#39;Feb 1974&#39;, &#39;Conservative&#39;)    297
(&#39;Oct 1974&#39;, &#39;Conservative&#39;)    277
(&#39;1979&#39;, &#39;Conservative&#39;)        339
 ...      ...                   ...
(&#39;2005&#39;, &#39;Others&#39;)              30
(&#39;2010&#39;, &#39;Others&#39;)              29
(&#39;2015&#39;, &#39;Others&#39;)              80
(&#39;2017&#39;, &#39;Others&#39;)              59
(&#39;2019&#39;, &#39;Others&#39;)              72
</code></pre><p>Bokeh 需要你将数据封装在它提供的一些对象中，这样它就能给你提供交互功能。将你的 <code>x</code> 和 <code>y</code> 数据结构封装在一个 <code>ColumnDataSource</code> 对象中。</p><pre tabindex=0><code>    from bokeh.models import ColumnDataSource

    source = ColumnDataSource(data={&#39;x&#39;: x, &#39;y&#39;: y})
</code></pre><p>然后构造一个 <code>Figure</code> 对象，并传入你用 <code>FactorRange</code> 对象封装的 <code>x</code> 数据。</p><pre tabindex=0><code>    from bokeh.plotting import figure
    from bokeh.models import FactorRange
   
    p = figure(x_range=FactorRange(*x), width=2000, title=&#34;Election results&#34;)
</code></pre><p>你需要让 Bokeh 创建一个颜色表，这是一个特殊的 <code>DataSpec</code> 字典，它根据你给它的颜色映射生成。在这种情况下，颜色表是一个简单的党派名称和一个十六进制值之间的映射。</p><pre tabindex=0><code>    from bokeh.transform import factor_cmap

    cmap = {
        &#39;Conservative&#39;: &#39;#0343df&#39;,
        &#39;Labour&#39;: &#39;#e50000&#39;,
        &#39;Liberal&#39;: &#39;#ffff14&#39;,
        &#39;Others&#39;: &#39;#929591&#39;,
    }
    fill_color = factor_cmap(&#39;x&#39;, palette=list(cmap.values()), factors=list(cmap.keys()), start=1, end=2)
</code></pre><p>现在你可以创建条形图了：</p><pre tabindex=0><code>    p.vbar(x=&#39;x&#39;, top=&#39;y&#39;, width=0.9, source=source, fill_color=fill_color, line_color=fill_color)
</code></pre><p>Bokeh 图表上数据的可视化形式被称为“ 字形 glyphs ”，因此你已经创建了一组条形字形。</p><p>调整图表的细节，让它看起来像你想要的样子。</p><pre tabindex=0><code>    p.y_range.start = 0
    p.x_range.range_padding = 0.1
    p.yaxis.axis_label = &#39;Seats&#39;
    p.xaxis.major_label_orientation = 1
    p.xgrid.grid_line_color = None
</code></pre><p>最后，告诉 Bokeh 你现在想看你的绘图：</p><pre tabindex=0><code>   from bokeh.io import show

   show(p)
</code></pre><p>这将绘图写入一个 HTML 文件，并在默认的 Web 浏览器中打开它。如下结果：</p><p><img src=/data/attachment/album/202006/18/164747njmjfybwkbb9jlgv.png alt title="A multi-bar plot in Bokeh"></p><p><em>Bokeh 中的多条形绘图（©2019年<a href=https://anvil.works/blog/plotting-in-bokeh>Anvil</a>）</em></p><p>它已经有了一些互动功能，比如盒子缩放。</p><p><img src=/data/attachment/album/202006/18/164826c8yyefswvspee6v6.gif alt title="Bokeh's built-in box zoom"></p><p><em>Bokeh 内置的盒子缩放（©2019<a href=https://anvil.works/blog/plotting-in-bokeh>Anvil</a>）</em></p><p>但 Bokeh 的厉害之处在于你可以添加自己的交互性。在下一节中，我们通过在条形图中添加工具提示来探索这个问题。</p><h3 id=给条形图添加工具提示>给条形图添加工具提示</h3><p>要在条形图上添加工具提示，你只需要创建一个 <code>HoverTool</code> 对象并将其添加到你的绘图中。</p><pre tabindex=0><code>    h = HoverTool(tooltips=[
        (&#39;Seats&#39;, &#39;@y&#39;),
        (&#39;(Year, Party)&#39;, &#39;(@x)&#39;)
    ])
    p.add_tools(h)
</code></pre><p>参数定义了哪些数据会显示在工具提示上。变量 <code>@y</code> 和 <code>@x</code> 是指你传入 <code>ColumnDataSource</code> 的变量。你还可以使用一些其他的值。例如，光标在图上的位置由 <code>$x</code> 和 <code>$y</code> 给出（与 <code>@x</code> 和 <code>@y</code> 没有关系）。</p><p>下面是结果：</p><p><img src=/data/attachment/album/202006/18/164835yihiiitmiiwu5tpl.gif alt title="The election graph, now with tooltips"></p><p><em>选举图，现在带有工具提示（© 2019 <a href=https://anvil.works/blog/plotting-in-bokeh>Anvil</a>）</em></p><p>借助 Bokeh 的 HTML 输出，将绘图嵌入到 Web 应用中时，你可以获得完整的交互体验。你可以在<a href=https://anvil.works/build#clone:CFRUWSM6PQ6JUUXH%3dSX4SACDSXBB4UOIVEVPWXH55%7cMYTOLCU2HM5WKJYM%3d6VJKGRSF74TCCVDG5CTVDOCS>这里</a>把这个例子复制为 Anvil 应用（注：Anvil 需要注册才能使用）。</p><p>现在，你可以看到付出额外努力在 Bokeh 中将所有数据封装在 <code>ColumnDataSource</code> 等对象的原因了。作为回报，你可以相对轻松地添加交互性。</p><h3 id=回归简单altair>回归简单：Altair</h3><p>Bokeh 是四大最流行的绘图库之一，本系列将研究<a href=https://opensource.com/article/20/4/plot-data-python>它们各自的特别之处</a>。</p><p>我也在研究几个因其有趣的方法而脱颖而出的库。接下来，我将看看 <a href=https://altair-viz.github.io/>Altair</a>，它的声明式 API 意味着它可以做出非常复杂的绘图，而不会让你头疼。</p><hr><p>via: <a href=https://opensource.com/article/20/5/bokeh-python>https://opensource.com/article/20/5/bokeh-python</a></p><p>作者：<a href=https://opensource.com/users/shaun-taylor-morgan>Shaun Taylor-Morgan</a> 选题：<a href=https://github.com/lujun9972>lujun9972</a> 译者：<a href=https://github.com/wxy>wxy</a> 校对：<a href=https://github.com/wxy>wxy</a></p><p>本文由 <a href=https://github.com/LCTT/TranslateProject>LCTT</a> 原创编译，<a href=https://linux.cn/>Linux中国</a> 荣誉推出</p></div><footer class=post__footer><div class="post__tags tags clearfix"><svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5.0 11V3C0 1.5.8.8.8.8S1.5.0 3 0h8c1.5.0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 100-6 3 3 0 000 6z"/></svg><ul class=tags__list><li class=tags__item><a class="tags__link btn" href=/tags/python/ rel=tag>Python</a></li><li class=tags__item><a class="tags__link btn" href=/tags/%E7%BB%98%E5%9B%BE/ rel=tag>绘图</a></li></ul></div></footer></article></main></div></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2025 Linux.cn Archive.
<span class=footer__copyright-credits>Generated with <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> and <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a> theme.</span></div></div></footer></div><script async defer src=/js/menu.js></script></body></html>