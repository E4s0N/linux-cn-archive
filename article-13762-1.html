<!doctype html><html class=no-js lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>通过 ncurses 在 Linux 上写一个猜谜游戏 - Linux.cn Archive</title>
<script>(function(e,t){e[t]=e[t].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content><meta property="og:title" content="通过 ncurses 在 Linux 上写一个猜谜游戏"><meta property="og:description" content="使用 ncurses 的灵活性和强大功能在 Linux 上创建一个猜数字游戏。"><meta property="og:type" content="article"><meta property="og:url" content="/article-13762-1.html"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-09-07T22:43:22+00:00"><meta property="article:modified_time" content="2021-09-07T22:43:22+00:00"><meta itemprop=name content="通过 ncurses 在 Linux 上写一个猜谜游戏"><meta itemprop=description content="使用 ncurses 的灵活性和强大功能在 Linux 上创建一个猜数字游戏。"><meta itemprop=datePublished content="2021-09-07T22:43:22+00:00"><meta itemprop=dateModified content="2021-09-07T22:43:22+00:00"><meta itemprop=wordCount content="275"><meta itemprop=keywords content="ncurses,"><link rel=preconnect href=https://fonts.bunny.net crossorigin><link rel=dns-prefetch href=//fonts.bunny.net><link rel=dns-prefetch href=//fonts.bunny.net><link rel=stylesheet href="https://fonts.bunny.net/css?family=Open+Sans:400,400i,700"><link rel=stylesheet href=/css/style.css><link rel="shortcut icon" href=/favicon.ico></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class=logo><a class=logo__link href=/ title="Linux.cn Archive" rel=home><div class="logo__item logo__text"><div class=logo__title>Linux.cn Archive</div></div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>Menu</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/><span class=menu__text>Home</span></a></li><li class=menu__item><a class=menu__link href=/categories/><span class=menu__text>Categories</span></a></li><li class=menu__item><a class=menu__link href=/tags/><span class=menu__text>Tags</span></a></li><li class=menu__item><a class=menu__link href><span class=menu__text>RSS</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>通过 ncurses 在 Linux 上写一个猜谜游戏</h1><div class="post__meta meta"><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class=meta__text datetime=2021-09-07T22:43:22Z>September 07, 2021</time></div></div></header><div class="content post__content clearfix"><blockquote><p>使用 ncurses 的灵活性和强大功能在 Linux 上创建一个猜数字游戏。</p></blockquote><p><img src=https://img.linux.net.cn/data/attachment/album/202109/07/224224ecchm0t5jbjc1dzy.jpg alt title="question mark in chalk"></p><p>在我的 <a href=/article-13756-1.html>上一篇文章</a>，我简要介绍了使用 ncurses 库通过 C 语言编写文本模式交互式应用程序。使用 ncurses，我们可以控制文本在终端上的显示位置和方式。如果你通过阅读手册页探索 ncurses 库函数，你会发现显示文本有很多不同的方式，包括粗体文本、颜色、闪烁文本、窗口、边框、图形字符和其它功能，这些都可以使你的应用脱颖而出。</p><p>如果你想探索一个更高级的程序来演示其中一些有趣的功能，有一个简单的“猜数字”游戏，我已更新为使用 ncurses 编写的了。该程序在一个范围内选择一个随机数，然后要求用户进行重复猜测，直到他们猜到这个秘密数字。当用户进行猜测时，程序会告知他们猜测的数字是太低还是太高。</p><p>请注意，程序限定可能的数字范围是 0 到 7。将值保持在有限的个位数数字范围内，可以更轻松的使用 <code>getch()</code> 函数从用户读取单个数字。我还使用了 <code>getrandom</code> 内核系统调用来生成随机数，设定数字最大值为 7，以从 0 （二进制 <code>0000</code>）到 7 （二进制 <code>0111</code>）中选择一个随机数。</p><pre tabindex=0><code>#include &lt;curses.h&gt;;
#include &lt;string.h&gt;;          /* for strlen */
#include &lt;sys/random.h&gt;;      /* for getrandom */

int
random0_7()
{
   int num;
   getrandom(&amp;num, sizeof(int), GRND_NONBLOCK);
   return (num &amp; 7); /* from 0000 to 0111 */
}

int
read_guess()
{
  int ch;

  do {
    ch = getch();
  } while ((ch &lt; &#39;0&#39;) || (ch &gt; &#39;7&#39;));

  return (ch - &#39;0&#39;); /* turn into a number */
}
</code></pre><p>通过使用 ncurses，我们可以增加一些有趣的视觉体验。通过添加函数，我们可以在屏幕顶部显示重要的文本信息，在屏幕底部显示状态消息行：</p><pre tabindex=0><code>void
print_header(const char *text)
{
  move(0, 0);
  clrtoeol();

  attron(A_BOLD);
  mvaddstr(0, (COLS / 2) - (strlen(text) / 2), text);
  attroff(A_BOLD);
  refresh();
}

void
print_status(const char *text)
{
  move(LINES - 1, 0);
  clrtoeol();
 
  attron(A_REVERSE);
  mvaddstr(LINES - 1, 0, text);
  attroff(A_REVERSE);
  refresh();
}
</code></pre><p>通过这些函数，我们就可以构建猜数字游戏的主要部分。首先，程序为 ncurses 设置终端，然后从 0 到 7 中选择一个随机数。显示数字刻度后，程序启动一个循环，询问用户的猜测。</p><p>当用户进行猜测时，程序会在屏幕上提供反馈。如果猜测太低，程序会在屏幕上的数字下方打印一个左方括号。如果猜测太高，程序会在屏幕上的数字下方打印一个右方括号。这有助于用户缩小他们的选择范围，直到他们猜出正确的数字。</p><pre tabindex=0><code>int
main()
{
  int number, guess;

  initscr();
  cbreak();
  noecho();

  number = random0_7();
  mvprintw(1, COLS - 1, &#34;%d&#34;, number); /* debugging */

  print_header(&#34;Guess the number 0-7&#34;);

  mvaddstr(9, (COLS / 2) - 7, &#34;0 1 2 3 4 5 6 7&#34;);

  print_status(&#34;Make a guess...&#34;);

  do {
    guess = read_guess();

    move(10, (COLS / 2) - 7 + (guess * 2));

    if (guess &lt; number) {
      addch(&#39;[&#39;);
      print_status(&#34;Too low&#34;);
    }

    else if (guess &gt; number) {
      addch(&#39;]&#39;);
      print_status(&#34;Too high&#34;);
    }

    else {
      addch(&#39;^&#39;);
    }
  } while (guess != number);

  print_header(&#34;That&#39;s right!&#34;);
  print_status(&#34;Press any key to quit&#34;);
  getch();

  endwin();

  return 0;
}
</code></pre><p>复制这个程序，自己尝试编译它。不要忘记你需要告诉 GCC 编译器链接到 ncurses 库：</p><pre tabindex=0><code>$ gcc -o guess guess.c -lncurses
</code></pre><p>我留下了一个调试行，所以你可以看到屏幕右上角附近的秘密数字：</p><p><img src=https://img.linux.net.cn/data/attachment/album/202109/07/224324xocg7hbo0gc7jccg.png alt="guess number game interface"></p><p><em>图1：猜数字游戏。注意右上角的秘密数字。</em></p><h3 id=开始使用-ncurses>开始使用 ncurses</h3><p>该程序使用了 ncurses 的许多其它函数，你可以从这些函数开始。例如，<code>print_header</code> 函数在屏幕顶部居中以粗体文本打印消息，<code>print_status</code> 函数在屏幕左下角以反向文本打印消息。使用它来帮助你开始使用 ncurses 编程。</p><hr><p>via: <a href=https://opensource.com/article/21/8/guess-number-game-ncurses-linux>https://opensource.com/article/21/8/guess-number-game-ncurses-linux</a></p><p>作者：<a href=https://opensource.com/users/jim-hall>Jim Hall</a> 选题：<a href=https://github.com/lujun9972>lujun9972</a> 译者：<a href=https://github.com/perfiffer>perfiffer</a> 校对：<a href=https://github.com/wxy>wxy</a></p><p>本文由 <a href=https://github.com/LCTT/TranslateProject>LCTT</a> 原创编译，<a href=https://linux.cn/>Linux中国</a> 荣誉推出</p></div><footer class=post__footer><div class="post__tags tags clearfix"><svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5.0 11V3C0 1.5.8.8.8.8S1.5.0 3 0h8c1.5.0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 100-6 3 3 0 000 6z"/></svg><ul class=tags__list><li class=tags__item><a class="tags__link btn" href=/tags/ncurses/ rel=tag>ncurses</a></li></ul></div></footer></article></main></div></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2025 Linux.cn Archive.
<span class=footer__copyright-credits>Generated with <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> and <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a> theme.</span></div></div></footer></div><script async defer src=/js/menu.js></script></body></html>